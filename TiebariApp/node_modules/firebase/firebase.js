!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).firebase=e()}(this,function(){"use strict";!function(t){if(!t.fetch){var e="URLSearchParams"in t,n="Symbol"in t&&"iterator"in Symbol,a="FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),r="FormData"in t,i="ArrayBuffer"in t;if(i)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(t){return t&&DataView.prototype.isPrototypeOf(t)},u=ArrayBuffer.isView||function(t){return t&&-1<o.indexOf(Object.prototype.toString.call(t))};d.prototype.append=function(t,e){t=l(t),e=f(e);var n=this.map[t];this.map[t]=n?n+","+e:e},d.prototype.delete=function(t){delete this.map[l(t)]},d.prototype.get=function(t){return t=l(t),this.has(t)?this.map[t]:null},d.prototype.has=function(t){return this.map.hasOwnProperty(l(t))},d.prototype.set=function(t,e){this.map[l(t)]=f(e)},d.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},d.prototype.keys=function(){var n=[];return this.forEach(function(t,e){n.push(e)}),p(n)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},d.prototype.entries=function(){var n=[];return this.forEach(function(t,e){n.push([e,t])}),p(n)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(T.prototype),T.prototype.clone=function(){return new T(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},T.error=function(){var t=new T(null,{status:0,statusText:""});return t.type="error",t};var h=[301,302,303,307,308];T.redirect=function(t,e){if(-1===h.indexOf(e))throw new RangeError("Invalid status code");return new T(null,{status:e,headers:{location:t}})},t.Headers=d,t.Request=w,t.Response=T,t.fetch=function(i,o){return new Promise(function(n,t){var e=new w(i,o),r=new XMLHttpRequest;r.onload=function(){var t={status:r.status,statusText:r.statusText,headers:function(t){var i=new d;return t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(t){var e=t.split(":"),n=e.shift().trim();if(n){var r=e.join(":").trim();i.append(n,r)}}),i}(r.getAllResponseHeaders()||"")};t.url="responseURL"in r?r.responseURL:t.headers.get("X-Request-URL");var e="response"in r?r.response:r.responseText;n(new T(e,t))},r.onerror=function(){t(new TypeError("Network request failed"))},r.ontimeout=function(){t(new TypeError("Network request failed"))},r.open(e.method,e.url,!0),"include"===e.credentials?r.withCredentials=!0:"omit"===e.credentials&&(r.withCredentials=!1),"responseType"in r&&a&&(r.responseType="blob"),e.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send(void 0===e._bodyInit?null:e._bodyInit)})},t.fetch.polyfill=!0}function l(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function f(t){return"string"!=typeof t&&(t=String(t)),t}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,e){this.append(e,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function m(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function y(n){return new Promise(function(t,e){n.onload=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function g(t){var e=new FileReader,n=y(e);return e.readAsArrayBuffer(t),n}function v(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t)if("string"==typeof t)this._bodyText=t;else if(a&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(r&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(e&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(i&&a&&s(t))this._bodyArrayBuffer=v(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!i||!ArrayBuffer.prototype.isPrototypeOf(t)&&!u(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):e&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var t=m(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?m(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var t=m(this);if(t)return t;if(this._bodyBlob)return function(t){var e=new FileReader,n=y(e);return e.readAsText(t),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),r=0;r<e.length;r++)n[r]=String.fromCharCode(e[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}function w(t,e){var n=(e=e||{}).body;if(t instanceof w){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new d(t.headers)),this.method=t.method,this.mode=t.mode,n||null==t._bodyInit||(n=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new d(e.headers)),this.method=function(t){var e=t.toUpperCase();return-1<c.indexOf(e)?e:t}(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function _(t){var i=new FormData;return t.trim().split("&").forEach(function(t){if(t){var e=t.split("="),n=e.shift().replace(/\+/g," "),r=e.join("=").replace(/\+/g," ");i.append(decodeURIComponent(n),decodeURIComponent(r))}}),i}function T(t,e){e=e||{},this.type="default",this.status=void 0===e.status?200:e.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new d(e.headers),this.url=e.url||"",this._initBody(t)}}("undefined"!=typeof self?self:void 0);var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}function n(t){return t&&t.Math==Math&&t}function y(t){try{return!!t()}catch(t){return!0}}function g(t){return"object"==typeof t?null!==t:"function"==typeof t}function i(t){return l?u.createElement(t):{}}function d(t){if(!g(t))throw TypeError(String(t)+" is not an object");return t}function o(t,e){if(!g(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!g(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!g(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}function v(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}function h(e,n){try{_(b,e,n)}catch(t){b[e]=n}return n}function c(t,e){return I.call(t,e)}function s(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++C+N).toString(36)}function r(t){return c(D,t)||(A&&c(R,t)?D[t]=R[t]:D[t]=O("Symbol."+t)),D[t]}var b=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")(),a=!1,f=!y(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),u=b.document,l=g(u)&&g(u.createElement),p=!f&&!y(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}),m=Object.defineProperty,w={f:f?m:function(t,e,n){if(d(t),e=o(e,!0),d(n),p)try{return m(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},_=f?function(t,e,n){return w.f(t,e,v(1,n))}:function(t,e,n){return t[e]=n,t},T="__core-js_shared__",E=b[T]||h(T,{}),S=e(function(t){(t.exports=function(t,e){return E[t]||(E[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.4.8",mode:"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})}),I={}.hasOwnProperty,C=0,N=Math.random(),A=!!Object.getOwnPropertySymbols&&!y(function(){return!String(Symbol())}),k=A&&!Symbol.sham&&"symbol"==typeof Symbol(),D=S("wks"),R=b.Symbol,O=k?R:s,P={};P[r("toStringTag")]="z";var M="[object z]"===String(P),x=Function.toString;"function"!=typeof E.inspectSource&&(E.inspectSource=function(t){return x.call(t)});function L(t){return W[t]||(W[t]=s(t))}var F,U,V,q=E.inspectSource,B=b.WeakMap,j="function"==typeof B&&/native code/.test(q(B)),W=S("keys"),K={},Q=b.WeakMap;if(j){var H=new Q,G=H.get,z=H.has,Y=H.set;F=function(t,e){return Y.call(H,t,e),e},U=function(t){return G.call(H,t)||{}},V=function(t){return z.call(H,t)}}else{var X=L("state");K[X]=!0,F=function(t,e){return _(t,X,e),e},U=function(t){return c(t,X)?t[X]:{}},V=function(t){return c(t,X)}}function J(t){return tt.call(t).slice(8,-1)}var $={set:F,get:U,has:V,enforce:function(t){return V(t)?U(t):F(t,{})},getterFor:function(n){return function(t){var e;if(!g(t)||(e=U(t)).type!==n)throw TypeError("Incompatible receiver, "+n+" required");return e}}},Z=e(function(t){var e=$.get,s=$.enforce,u=String(String).split("String");(t.exports=function(t,e,n,r){var i=!!r&&!!r.unsafe,o=!!r&&!!r.enumerable,a=!!r&&!!r.noTargetGet;"function"==typeof n&&("string"!=typeof e||c(n,"name")||_(n,"name",e),s(n).source=u.join("string"==typeof e?e:"")),t!==b?(i?!a&&t[e]&&(o=!0):delete t[e],o?t[e]=n:_(t,e,n)):o?t[e]=n:h(e,n)})(Function.prototype,"toString",function(){return"function"==typeof this&&e(this).source||q(this)})}),tt={}.toString,et=r("toStringTag"),nt="Arguments"==J(function(){return arguments}()),rt=M?J:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),et))?n:nt?J(e):"Object"==(r=J(e))&&"function"==typeof e.callee?"Arguments":r},it=M?{}.toString:function(){return"[object "+rt(this)+"]"};M||Z(Object.prototype,"toString",it,{unsafe:!0});function ot(t){return isNaN(t=+t)?0:(0<t?Tt:_t)(t)}function at(t){if(null==t)throw TypeError("Can't call method on "+t);return t}function st(s){return function(t,e){var n,r,i=String(at(t)),o=ot(e),a=i.length;return o<0||a<=o?s?"":void 0:(n=i.charCodeAt(o))<55296||56319<n||o+1===a||(r=i.charCodeAt(o+1))<56320||57343<r?s?i.charAt(o):n:s?i.slice(o,o+2):r-56320+(n-55296<<10)+65536}}function ut(t){return At(at(t))}function ct(t){return"function"==typeof t?t:void 0}function ht(t,e){return arguments.length<2?ct(Rt[t])||ct(b[t]):Rt[t]&&Rt[t][e]||b[t]&&b[t][e]}function lt(t){return 0<t?Ot(ot(t),9007199254740991):0}function ft(s){return function(t,e,n){var r,i=ut(t),o=lt(i.length),a=function(t,e){var n=ot(t);return n<0?Pt(n+e,0):Mt(n,e)}(n,o);if(s&&e!=e){for(;a<o;)if((r=i[a++])!=r)return!0}else for(;a<o;a++)if((s||a in i)&&i[a]===e)return s||a||0;return!s&&-1}}function pt(t,e){var n,r=ut(t),i=0,o=[];for(n in r)!c(K,n)&&c(r,n)&&o.push(n);for(;e.length>i;)c(r,n=e[i++])&&(~xt(o,n)||o.push(n));return o}function dt(t,e){for(var n=qt(e),r=w.f,i=Dt.f,o=0;o<n.length;o++){var a=n[o];c(t,a)||r(t,a,i(e,a))}}function mt(t,e){var n=Wt[jt(t)];return n==Qt||n!=Kt&&("function"==typeof e?y(e):!!e)}function yt(t,e){var n,r,i,o,a,s=t.target,u=t.global,c=t.stat;if(n=u?b:c?b[s]||h(s,{}):(b[s]||{}).prototype)for(r in e){if(o=e[r],i=t.noTargetGet?(a=Gt(n,r))&&a.value:n[r],!Ht(u?r:s+(c?".":"#")+r,t.forced)&&void 0!==i){if(typeof o==typeof i)continue;dt(o,i)}(t.sham||i&&i.sham)&&_(o,"sham",!0),Z(n,r,o,t)}}function gt(t){return Object(at(t))}var vt,bt,wt,_t=Math.ceil,Tt=Math.floor,Et={codeAt:st(!1),charAt:st(!0)},St={}.propertyIsEnumerable,It=Object.getOwnPropertyDescriptor,Ct={f:It&&!St.call({1:2},1)?function(t){var e=It(this,t);return!!e&&e.enumerable}:St},Nt="".split,At=y(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==J(t)?Nt.call(t,""):Object(t)}:Object,kt=Object.getOwnPropertyDescriptor,Dt={f:f?kt:function(t,e){if(t=ut(t),e=o(e,!0),p)try{return kt(t,e)}catch(t){}if(c(t,e))return v(!Ct.f.call(t,e),t[e])}},Rt=b,Ot=Math.min,Pt=Math.max,Mt=Math.min,xt={includes:ft(!0),indexOf:ft(!1)}.indexOf,Lt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ft=Lt.concat("length","prototype"),Ut={f:Object.getOwnPropertyNames||function(t){return pt(t,Ft)}},Vt={f:Object.getOwnPropertySymbols},qt=ht("Reflect","ownKeys")||function(t){var e=Ut.f(d(t)),n=Vt.f;return n?e.concat(n(t)):e},Bt=/#|\.prototype\./,jt=mt.normalize=function(t){return String(t).replace(Bt,".").toLowerCase()},Wt=mt.data={},Kt=mt.NATIVE="N",Qt=mt.POLYFILL="P",Ht=mt,Gt=Dt.f,zt=!y(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),Yt=L("IE_PROTO"),Xt=Object.prototype,Jt=zt?Object.getPrototypeOf:function(t){return t=gt(t),c(t,Yt)?t[Yt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Xt:null},$t=r("iterator"),Zt=!1;[].keys&&("next"in(wt=[].keys())?(bt=Jt(Jt(wt)))!==Object.prototype&&(vt=bt):Zt=!0),null==vt&&(vt={}),c(vt,$t)||_(vt,$t,function(){return this});function te(){}var ee={IteratorPrototype:vt,BUGGY_SAFARI_ITERATORS:Zt},ne=Object.keys||function(t){return pt(t,Lt)},re=f?Object.defineProperties:function(t,e){d(t);for(var n,r=ne(e),i=r.length,o=0;o<i;)w.f(t,n=r[o++],e[n]);return t},ie=ht("document","documentElement"),oe=L("IE_PROTO"),ae="prototype",se=function(){var t,e=i("iframe"),n=Lt.length,r="script";for(e.style.display="none",ie.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write("<script>document.F=Object</"+r+">"),t.close(),se=t.F;n--;)delete se[ae][Lt[n]];return se()},ue=Object.create||function(t,e){var n;return null!==t?(te[ae]=d(t),n=new te,te[ae]=null,n[oe]=t):n=se(),void 0===e?n:re(n,e)};K[oe]=!0;function ce(t,e,n){t&&!c(t=n?t:t.prototype,de)&&pe(t,de,{configurable:!0,value:e})}function he(){return this}function le(){return this}function fe(t,e,n,r,i,o,a){function s(t){if(t===i&&m)return m;if(!be&&t in p)return p[t];switch(t){case"keys":case _e:case Te:return function(){return new n(this,t)}}return function(){return new n(this)}}!function(t,e,n){var r=e+" Iterator";t.prototype=ue(ye,{next:v(1,n)}),ce(t,r,!1),me[r]=he}(n,e,r);var u,c,h,l=e+" Iterator",f=!1,p=t.prototype,d=p[we]||p["@@iterator"]||i&&p[i],m=!be&&d||s(i),y="Array"==e&&p.entries||d;if(y&&(u=Jt(y.call(new t)),ve!==Object.prototype&&u.next&&(Jt(u)!==ve&&(ge?ge(u,ve):"function"!=typeof u[we]&&_(u,we,le)),ce(u,l,!0))),i==_e&&d&&d.name!==_e&&(f=!0,m=function(){return d.call(this)}),p[we]!==m&&_(p,we,m),me[e]=m,i)if(c={values:s(_e),keys:o?m:s("keys"),entries:s(Te)},a)for(h in c)!be&&!f&&h in p||Z(p,h,c[h]);else yt({target:e,proto:!0,forced:be||f},c);return c}var pe=w.f,de=r("toStringTag"),me={},ye=ee.IteratorPrototype,ge=Object.setPrototypeOf||("__proto__"in{}?function(){var n,r=!1,t={};try{(n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(t,[]),r=t instanceof Array}catch(t){}return function(t,e){return d(t),function(t){if(!g(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(e),r?n.call(t,e):t.__proto__=e,t}}():void 0),ve=ee.IteratorPrototype,be=ee.BUGGY_SAFARI_ITERATORS,we=r("iterator"),_e="values",Te="entries",Ee=Et.charAt,Se="String Iterator",Ie=$.set,Ce=$.getterFor(Se);fe(String,"String",function(t){Ie(this,{type:Se,string:String(t),index:0})},function(){var t,e=Ce(this),n=e.string,r=e.index;return r>=n.length?{value:void 0,done:!0}:(t=Ee(n,r),e.index+=t.length,{value:t,done:!1})});var Ne={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ae=r("unscopables"),ke=Array.prototype;null==ke[Ae]&&_(ke,Ae,ue(null));function De(t){ke[Ae][t]=!0}var Re="Array Iterator",Oe=$.set,Pe=$.getterFor(Re),Me=fe(Array,"Array",function(t,e){Oe(this,{type:Re,target:ut(t),index:0,kind:e})},function(){var t=Pe(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?{value:t.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values");me.Arguments=me.Array,De("keys"),De("values"),De("entries");var xe=r("iterator"),Le=r("toStringTag"),Fe=Me.values;for(var Ue in Ne){var Ve=b[Ue],qe=Ve&&Ve.prototype;if(qe){if(qe[xe]!==Fe)try{_(qe,xe,Fe)}catch(zs){qe[xe]=Fe}if(qe[Le]||_(qe,Le,Ue),Ne[Ue])for(var Be in Me)if(qe[Be]!==Me[Be])try{_(qe,Be,Me[Be])}catch(zs){qe[Be]=Me[Be]}}}function je(t,e,n){for(var r in e)Z(t,r,e[r],n);return t}function We(t){var e=ht(t),n=w.f;f&&e&&!e[Je]&&n(e,Je,{configurable:!0,get:function(){return this}})}function Ke(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}function Qe(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}function He(t){return void 0!==t&&(me.Array===t||Ze[$e]===t)}function Ge(r,i,t){if(Ke(r),void 0===i)return r;switch(t){case 0:return function(){return r.call(i)};case 1:return function(t){return r.call(i,t)};case 2:return function(t,e){return r.call(i,t,e)};case 3:return function(t,e,n){return r.call(i,t,e,n)}}return function(){return r.apply(i,arguments)}}function ze(t){if(null!=t)return t[tn]||t["@@iterator"]||me[rt(t)]}function Ye(e,t,n,r){try{return r?t(d(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&d(i.call(e)),t}}var Xe=b.Promise,Je=r("species"),$e=r("iterator"),Ze=Array.prototype,tn=r("iterator"),en=e(function(t){function p(t,e){this.stopped=t,this.result=e}(t.exports=function(t,e,n,r,i){var o,a,s,u,c,h,l,f=Ge(e,n,r?2:1);if(i)o=t;else{if("function"!=typeof(a=ze(t)))throw TypeError("Target is not iterable");if(He(a)){for(s=0,u=lt(t.length);s<u;s++)if((c=r?f(d(l=t[s])[0],l[1]):f(t[s]))&&c instanceof p)return c;return new p(!1)}o=a.call(t)}for(h=o.next;!(l=h.call(o)).done;)if("object"==typeof(c=Ye(o,f,l.value,r))&&c&&c instanceof p)return c;return new p(!1)}).stop=function(t){return new p(!0,t)}}),nn=r("iterator"),rn=!1;try{var on=0,an={next:function(){return{done:!!on++}},return:function(){rn=!0}};an[nn]=function(){return this},Array.from(an,function(){throw 2})}catch(zs){}function sn(t,e){if(!e&&!rn)return!1;var n=!1;try{var r={};r[nn]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}function un(t,e){var n,r=d(t).constructor;return void 0===r||null==(n=d(r)[yn])?e:Ke(n)}function cn(t){if(Cn.hasOwnProperty(t)){var e=Cn[t];delete Cn[t],e()}}function hn(t){return function(){cn(t)}}function ln(t){cn(t.data)}function fn(t){b.postMessage(t+"",bn.protocol+"//"+bn.host)}var pn,dn,mn,yn=r("species"),gn=ht("navigator","userAgent")||"",vn=/(iphone|ipod|ipad).*applewebkit/i.test(gn),bn=b.location,wn=b.setImmediate,_n=b.clearImmediate,Tn=b.process,En=b.MessageChannel,Sn=b.Dispatch,In=0,Cn={},Nn="onreadystatechange";wn&&_n||(wn=function(t){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);return Cn[++In]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},pn(In),In},_n=function(t){delete Cn[t]},"process"==J(Tn)?pn=function(t){Tn.nextTick(hn(t))}:Sn&&Sn.now?pn=function(t){Sn.now(hn(t))}:En&&!vn?(mn=(dn=new En).port2,dn.port1.onmessage=ln,pn=Ge(mn.postMessage,mn,1)):!b.addEventListener||"function"!=typeof postMessage||b.importScripts||y(fn)?pn=Nn in i("script")?function(t){ie.appendChild(i("script"))[Nn]=function(){ie.removeChild(this),cn(t)}}:function(t){setTimeout(hn(t),0)}:(pn=fn,b.addEventListener("message",ln,!1)));var An,kn,Dn,Rn,On,Pn,Mn,xn,Ln={set:wn,clear:_n},Fn=Dt.f,Un=Ln.set,Vn=b.MutationObserver||b.WebKitMutationObserver,qn=b.process,Bn=b.Promise,jn="process"==J(qn),Wn=Fn(b,"queueMicrotask"),Kn=Wn&&Wn.value;Kn||(An=function(){var t,e;for(jn&&(t=qn.domain)&&t.exit();kn;){e=kn.fn,kn=kn.next;try{e()}catch(t){throw kn?Rn():Dn=void 0,t}}Dn=void 0,t&&t.enter()},Rn=jn?function(){qn.nextTick(An)}:Vn&&!vn?(On=!0,Pn=document.createTextNode(""),new Vn(An).observe(Pn,{characterData:!0}),function(){Pn.data=On=!On}):Bn&&Bn.resolve?(Mn=Bn.resolve(void 0),xn=Mn.then,function(){xn.call(Mn,An)}):function(){Un.call(b,An)});function Qn(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw TypeError("Bad Promise constructor");n=t,r=e}),this.resolve=Ke(n),this.reject=Ke(r)}function Hn(t,e){if(d(t),g(e)&&e.constructor===t)return e;var n=Jn.f(t);return(0,n.resolve)(e),n.promise}function Gn(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}var zn,Yn,Xn=Kn||function(t){var e={fn:t,next:void 0};Dn&&(Dn.next=e),kn||(kn=e,Rn()),Dn=e},Jn={f:function(t){return new Qn(t)}},$n=b.process,Zn=$n&&$n.versions,tr=Zn&&Zn.v8;tr?Yn=(zn=tr.split("."))[0]+zn[1]:gn&&(!(zn=gn.match(/Edge\/(\d+)/))||74<=zn[1])&&(zn=gn.match(/Chrome\/(\d+)/))&&(Yn=zn[1]);function er(t){var e;return!(!g(t)||"function"!=typeof(e=t.then))&&e}function nr(l,f,p){if(!f.notified){f.notified=!0;var d=f.reactions;Xn(function(){for(var t=f.value,e=1==f.state,n=0;d.length>n;){var r,i,o,a=d[n++],s=e?a.ok:a.fail,u=a.resolve,c=a.reject,h=a.domain;try{s?(e||(2===f.rejection&&Rr(l,f),f.rejection=1),!0===s?r=t:(h&&h.enter(),r=s(t),h&&(h.exit(),o=!0)),r===a.promise?c(vr("Promise-chain cycle")):(i=er(r))?i.call(r,u,c):u(r)):c(t)}catch(t){h&&!o&&h.exit(),c(t)}}f.reactions=[],f.notified=!1,p&&!f.rejection&&kr(l,f)})}}function rr(t,e,n){var r,i;Ir?((r=br.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),b.dispatchEvent(r)):r={promise:e,reason:n},(i=b["on"+t])?i(r):t===Cr&&function(t,e){var n=b.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)}function ir(e,n,r,i){return function(t){e(n,r,t,i)}}function or(t,e,n,r){e.done||(e.done=!0,r&&(e=r),e.value=n,e.state=2,nr(t,e,!0))}var ar,sr,ur,cr,hr=Yn&&+Yn,lr=Ln.set,fr=r("species"),pr="Promise",dr=$.get,mr=$.set,yr=$.getterFor(pr),gr=Xe,vr=b.TypeError,br=b.document,wr=b.process,_r=ht("fetch"),Tr=Jn.f,Er=Tr,Sr="process"==J(wr),Ir=!!(br&&br.createEvent&&b.dispatchEvent),Cr="unhandledrejection",Nr=Ht(pr,function(){if(!(q(gr)!==String(gr))){if(66===hr)return!0;if(!Sr&&"function"!=typeof PromiseRejectionEvent)return!0}if(51<=hr&&/native code/.test(gr))return!1;function t(t){t(function(){},function(){})}var e=gr.resolve(1);return(e.constructor={})[fr]=t,!(e.then(function(){})instanceof t)}),Ar=Nr||!sn(function(t){gr.all(t).catch(function(){})}),kr=function(n,r){lr.call(b,function(){var t,e=r.value;if(Dr(r)&&(t=Gn(function(){Sr?wr.emit("unhandledRejection",e,n):rr(Cr,n,e)}),r.rejection=Sr||Dr(r)?2:1,t.error))throw t.value})},Dr=function(t){return 1!==t.rejection&&!t.parent},Rr=function(t,e){lr.call(b,function(){Sr?wr.emit("rejectionHandled",t):rr("rejectionhandled",t,e.value)})},Or=function(n,r,t,e){if(!r.done){r.done=!0,e&&(r=e);try{if(n===t)throw vr("Promise can't be resolved itself");var i=er(t);i?Xn(function(){var e={done:!1};try{i.call(t,ir(Or,n,e,r),ir(or,n,e,r))}catch(t){or(n,e,t,r)}}):(r.value=t,r.state=1,nr(n,r,!1))}catch(t){or(n,{done:!1},t,r)}}};Nr&&(gr=function(t){Qe(this,gr,pr),Ke(t),ar.call(this);var e=dr(this);try{t(ir(Or,this,e),ir(or,this,e))}catch(t){or(this,e,t)}},(ar=function(t){mr(this,{type:pr,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=je(gr.prototype,{then:function(t,e){var n=yr(this),r=Tr(un(this,gr));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=Sr?wr.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&nr(this,n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),sr=function(){var t=new ar,e=dr(t);this.promise=t,this.resolve=ir(Or,t,e),this.reject=ir(or,t,e)},Jn.f=Tr=function(t){return t===gr||t===ur?new sr(t):Er(t)},"function"==typeof Xe&&(cr=Xe.prototype.then,Z(Xe.prototype,"then",function(t,e){var n=this;return new gr(function(t,e){cr.call(n,t,e)}).then(t,e)},{unsafe:!0}),"function"==typeof _r&&yt({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return Hn(gr,_r.apply(b,arguments))}}))),yt({global:!0,wrap:!0,forced:Nr},{Promise:gr}),ce(gr,pr,!1),We(pr),ur=ht(pr),yt({target:pr,stat:!0,forced:Nr},{reject:function(t){var e=Tr(this);return e.reject.call(void 0,t),e.promise}}),yt({target:pr,stat:!0,forced:Nr},{resolve:function(t){return Hn(this,t)}}),yt({target:pr,stat:!0,forced:Ar},{all:function(t){var s=this,e=Tr(s),u=e.resolve,c=e.reject,n=Gn(function(){var r=Ke(s.resolve),i=[],o=0,a=1;en(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(s,t).then(function(t){n||(n=!0,i[e]=t,--a||u(i))},c)}),--a||u(i)});return n.error&&c(n.value),e.promise},race:function(t){var n=this,r=Tr(n),i=r.reject,e=Gn(function(){var e=Ke(n.resolve);en(t,function(t){e.call(n,t).then(r.resolve,i)})});return e.error&&i(e.value),r.promise}}),yt({target:"Promise",stat:!0},{allSettled:function(t){var s=this,e=Jn.f(s),u=e.resolve,n=e.reject,r=Gn(function(){var r=Ke(s.resolve),i=[],o=0,a=1;en(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(s,t).then(function(t){n||(n=!0,i[e]={status:"fulfilled",value:t},--a||u(i))},function(t){n||(n=!0,i[e]={status:"rejected",reason:t},--a||u(i))})}),--a||u(i)});return r.error&&n(r.value),e.promise}});var Pr=!!Xe&&y(function(){Xe.prototype.finally.call({then:function(){}},function(){})});yt({target:"Promise",proto:!0,real:!0,forced:Pr},{finally:function(e){var n=un(this,ht("Promise")),t="function"==typeof e;return this.then(t?function(t){return Hn(n,e()).then(function(){return t})}:e,t?function(t){return Hn(n,e()).then(function(){throw t})}:e)}}),"function"!=typeof Xe||Xe.prototype.finally||Z(Xe.prototype,"finally",ht("Promise").prototype.finally);Rt.Promise;var Mr=$.set,xr=$.getterFor("AggregateError"),Lr=function(t,e){var n=this;if(!(n instanceof Lr))return new Lr(t,e);ge&&(n=ge(new Error(e),Jt(n)));var r=[];return en(t,r.push,r),f?Mr(n,{errors:r,type:"AggregateError"}):n.errors=r,void 0!==e&&_(n,"message",String(e)),n};Lr.prototype=ue(Error.prototype,{constructor:v(5,Lr),message:v(5,""),name:v(5,"AggregateError")}),f&&w.f(Lr.prototype,"errors",{get:function(){return xr(this).errors},configurable:!0}),yt({global:!0},{AggregateError:Lr}),yt({target:"Promise",stat:!0},{try:function(t){var e=Jn.f(this),n=Gn(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var Fr="No one promise resolved";yt({target:"Promise",stat:!0},{any:function(t){var u=this,e=Jn.f(u),c=e.resolve,h=e.reject,n=Gn(function(){var r=Ke(u.resolve),i=[],o=0,a=1,s=!1;en(t,function(t){var e=o++,n=!1;i.push(void 0),a++,r.call(u,t).then(function(t){n||s||(s=!0,c(t))},function(t){n||s||(n=!0,i[e]=t,--a||h(new(ht("AggregateError"))(i,Fr)))})}),--a||h(new(ht("AggregateError"))(i,Fr))});return n.error&&h(n.value),e.promise}});function Ur(t,e){var n;return qr(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!qr(n.prototype)?g(n)&&null===(n=n[Br])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}function Vr(p){var d=1==p,m=2==p,y=3==p,g=4==p,v=6==p,b=5==p||v;return function(t,e,n,r){for(var i,o,a=gt(t),s=At(a),u=Ge(e,n,3),c=lt(s.length),h=0,l=r||Ur,f=d?l(t,c):m?l(t,0):void 0;h<c;h++)if((b||h in s)&&(o=u(i=s[h],h,a),p))if(d)f[h]=o;else if(o)switch(p){case 3:return!0;case 5:return i;case 6:return h;case 2:jr.call(f,i)}else if(g)return!1;return v?-1:y||g?g:f}}var qr=Array.isArray||function(t){return"Array"==J(t)},Br=r("species"),jr=[].push,Wr={forEach:Vr(0),map:Vr(1),filter:Vr(2),some:Vr(3),every:Vr(4),find:Vr(5),findIndex:Vr(6)},Kr=Wr.find,Qr="find",Hr=!0;Qr in[]&&Array(1)[Qr](function(){Hr=!1}),yt({target:"Array",proto:!0,forced:Hr},{find:function(t,e){return Kr(this,t,1<arguments.length?e:void 0)}}),De(Qr);function Gr(t,e,n){return Ge(zr,b[t].prototype[e],n)}var zr=Function.call,Yr=(Gr("Array","find"),Wr.findIndex),Xr="findIndex",Jr=!0;Xr in[]&&Array(1)[Xr](function(){Jr=!1}),yt({target:"Array",proto:!0,forced:Jr},{findIndex:function(t,e){return Yr(this,t,1<arguments.length?e:void 0)}}),De(Xr);function $r(t,e,n){var r=o(e);r in t?w.f(t,r,v(0,n)):t[r]=n}Gr("Array","findIndex");var Zr=!sn(function(t){Array.from(t)});yt({target:"Array",stat:!0,forced:Zr},{from:function(t,e,n){var r,i,o,a,s,u=gt(t),c="function"==typeof this?this:Array,h=arguments.length,l=1<h?e:void 0,f=void 0!==l,p=0,d=ze(u);if(f&&(l=Ge(l,2<h?n:void 0,2)),null==d||c==Array&&He(d))for(i=new c(r=lt(u.length));p<r;p++)$r(i,p,f?l(u[p],p):u[p]);else for(s=(a=d.call(u)).next,i=new c;!(o=s.call(a)).done;p++)$r(i,p,f?Ye(a,l,[o.value,p],!0):o.value);return i.length=p,i}});Rt.Array.from;var ti,ei,ni,ri=Wr.some;yt({target:"Array",proto:!0,forced:(ti="some",ni=[][ti],!ni||!y(function(){ni.call(null,ei||function(){throw 1},1)}))},{some:function(t,e){return ri(this,t,1<arguments.length?e:void 0)}});Gr("Array","some");function ii(t){return g(t)&&c(wi,rt(t))}var oi,ai=w.f,si=b.DataView,ui=si&&si.prototype,ci=b.Int8Array,hi=ci&&ci.prototype,li=b.Uint8ClampedArray,fi=li&&li.prototype,pi=ci&&Jt(ci),di=hi&&Jt(hi),mi=Object.prototype,yi=(mi.isPrototypeOf,r("toStringTag")),gi=s("TYPED_ARRAY_TAG"),vi=!(!b.ArrayBuffer||!si),bi=vi&&!!ge&&"Opera"!==rt(b.opera),wi={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8};for(oi in wi)b[oi]||(bi=!1);if((!bi||"function"!=typeof pi||pi===Function.prototype)&&(pi=function(){throw TypeError("Incorrect invocation")},bi))for(oi in wi)b[oi]&&ge(b[oi],pi);if((!bi||!di||di===mi)&&(di=pi.prototype,bi))for(oi in wi)b[oi]&&ge(b[oi].prototype,di);if(bi&&Jt(fi)!==di&&ge(fi,di),f&&!c(di,yi))for(oi in!0,ai(di,yi,{get:function(){return g(this)?this[gi]:void 0}}),wi)b[oi]&&_(b[oi],gi,oi);vi&&ge&&Jt(ui)!==mi&&ge(ui,mi);function _i(){return Ci.call(ki(this))}var Ti=function(t){if(ii(t))return t;throw TypeError("Target is not a typed array")},Ei=function(t,e,n){if(f){if(n)for(var r in wi){var i=b[r];i&&c(i.prototype,t)&&delete i.prototype[t]}di[t]&&!n||Z(di,t,n?e:bi&&hi[t]||e)}},Si=r("iterator"),Ii=b.Uint8Array,Ci=Me.values,Ni=Me.keys,Ai=Me.entries,ki=Ti,Di=Ei,Ri=Ii&&Ii.prototype[Si],Oi=!!Ri&&("values"==Ri.name||null==Ri.name);Di("entries",function(){return Ai.call(ki(this))}),Di("keys",function(){return Ni.call(ki(this))}),Di("values",_i,!Oi),Di(Si,_i,!Oi);var Pi=Object.assign,Mi=Object.defineProperty,xi=!Pi||y(function(){if(f&&1!==Pi({b:1},Pi(Mi({},"a",{enumerable:!0,get:function(){Mi(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(t){e[t]=t}),7!=Pi({},t)[n]||ne(Pi({},e)).join("")!=r})?function(t,e){for(var n=gt(t),r=arguments.length,i=1,o=Vt.f,a=Ct.f;i<r;)for(var s,u=At(arguments[i++]),c=o?ne(u).concat(o(u)):ne(u),h=c.length,l=0;l<h;)s=c[l++],f&&!a.call(u,s)||(n[s]=u[s]);return n}:Pi;yt({target:"Object",stat:!0,forced:Object.assign!==xi},{assign:xi});Rt.Object.assign;function Li(s){return function(t){for(var e,n=ut(t),r=ne(n),i=r.length,o=0,a=[];o<i;)e=r[o++],f&&!Fi.call(n,e)||a.push(s?[e,n[e]]:n[e]);return a}}var Fi=Ct.f,Ui={entries:Li(!0),values:Li(!1)},Vi=Ui.entries;yt({target:"Object",stat:!0},{entries:function(t){return Vi(t)}});Rt.Object.entries;var qi=Ui.values;yt({target:"Object",stat:!0},{values:function(t){return qi(t)}});Rt.Object.values;function Bi(t){if(function(t){var e;return g(t)&&(void 0!==(e=t[Wi])?!!e:"RegExp"==J(t))}(t))throw TypeError("The method doesn't accept regular expressions");return t}function ji(e){var n=/./;try{"/./"[e](n)}catch(t){try{return n[Ki]=!1,"/./"[e](n)}catch(t){}}return!1}var Wi=r("match"),Ki=r("match");yt({target:"String",proto:!0,forced:!ji("includes")},{includes:function(t,e){return!!~String(at(this)).indexOf(Bi(t),1<arguments.length?e:void 0)}});Gr("String","includes");var Qi,Hi=Dt.f,Gi="".startsWith,zi=Math.min,Yi=ji("startsWith"),Xi=!(Yi||(!(Qi=Hi(String.prototype,"startsWith"))||Qi.writable));yt({target:"String",proto:!0,forced:!Xi&&!Yi},{startsWith:function(t,e){var n=String(at(this));Bi(t);var r=lt(zi(1<arguments.length?e:void 0,n.length)),i=String(t);return Gi?Gi.call(n,i,r):n.slice(r,r+i.length)===i}});Gr("String","startsWith");yt({target:"String",proto:!0},{repeat:"".repeat||function(t){var e=String(at(this)),n="",r=ot(t);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;0<r;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n}});Gr("String","repeat");function Ji(t){if(!g(t))return!1;var e=t[to];return void 0!==e?!!e:qr(t)}var $i,Zi=r("species"),to=r("isConcatSpreadable"),eo=9007199254740991,no="Maximum allowed index exceeded",ro=51<=hr||!y(function(){var t=[];return t[to]=!1,t.concat()[0]!==t}),io=($i="concat",51<=hr||!y(function(){var t=[];return(t.constructor={})[Zi]=function(){return{foo:1}},1!==t[$i](Boolean).foo}));yt({target:"Array",proto:!0,forced:!ro||!io},{concat:function(t){var e,n,r,i,o,a=gt(this),s=Ur(a,0),u=0;for(e=-1,r=arguments.length;e<r;e++)if(Ji(o=-1===e?a:arguments[e])){if(i=lt(o.length),eo<u+i)throw TypeError(no);for(n=0;n<i;n++,u++)n in o&&$r(s,u,o[n])}else{if(eo<=u)throw TypeError(no);$r(s,u++,o)}return s.length=u,s}});function oo(t){var e=Rt.Symbol||(Rt.Symbol={});c(e,t)||yo(e,t,{value:mo.f(t)})}function ao(t,e){var n=Ro[t]=ue(Io[wo]);return To(n,{type:bo,tag:t,description:e}),f||(n.description=e),n}function so(e,t){d(e);var n=ut(t),r=ne(n).concat(jo(n));return go(r,function(t){f&&!Bo.call(n,t)||qo(e,t,n[t])}),e}function uo(t,e){var n=ut(t),r=o(e,!0);if(n!==So||!c(Ro,r)||c(Oo,r)){var i=No(n,r);return!i||!c(Ro,r)||c(n,vo)&&n[vo][r]||(i.enumerable=!0),i}}function co(t){var e=ko(ut(t)),n=[];return go(e,function(t){c(Ro,t)||c(K,t)||n.push(t)}),n}var ho=Ut.f,lo={}.toString,fo="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],po={f:function(t){return fo&&"[object Window]"==lo.call(t)?function(t){try{return ho(t)}catch(t){return fo.slice()}}(t):ho(ut(t))}},mo={f:r},yo=w.f,go=Wr.forEach,vo=L("hidden"),bo="Symbol",wo="prototype",_o=r("toPrimitive"),To=$.set,Eo=$.getterFor(bo),So=Object[wo],Io=b.Symbol,Co=ht("JSON","stringify"),No=Dt.f,Ao=w.f,ko=po.f,Do=Ct.f,Ro=S("symbols"),Oo=S("op-symbols"),Po=S("string-to-symbol-registry"),Mo=S("symbol-to-string-registry"),xo=S("wks"),Lo=b.QObject,Fo=!Lo||!Lo[wo]||!Lo[wo].findChild,Uo=f&&y(function(){return 7!=ue(Ao({},"a",{get:function(){return Ao(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=No(So,e);r&&delete So[e],Ao(t,e,n),r&&t!==So&&Ao(So,e,r)}:Ao,Vo=A&&"symbol"==typeof Io.iterator?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Io},qo=function(t,e,n){t===So&&qo(Oo,e,n),d(t);var r=o(e,!0);return d(n),c(Ro,r)?(n.enumerable?(c(t,vo)&&t[vo][r]&&(t[vo][r]=!1),n=ue(n,{enumerable:v(0,!1)})):(c(t,vo)||Ao(t,vo,v(1,{})),t[vo][r]=!0),Uo(t,r,n)):Ao(t,r,n)},Bo=function(t){var e=o(t,!0),n=Do.call(this,e);return!(this===So&&c(Ro,e)&&!c(Oo,e))&&(!(n||!c(this,e)||!c(Ro,e)||c(this,vo)&&this[vo][e])||n)},jo=function(t){var e=t===So,n=ko(e?Oo:ut(t)),r=[];return go(n,function(t){!c(Ro,t)||e&&!c(So,t)||r.push(Ro[t])}),r};if(A||(Z((Io=function(t){if(this instanceof Io)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==t?String(t):void 0,n=s(e),r=function(t){this===So&&r.call(Oo,t),c(this,vo)&&c(this[vo],n)&&(this[vo][n]=!1),Uo(this,n,v(1,t))};return f&&Fo&&Uo(So,n,{configurable:!0,set:r}),ao(n,e)})[wo],"toString",function(){return Eo(this).tag}),Ct.f=Bo,w.f=qo,Dt.f=uo,Ut.f=po.f=co,Vt.f=jo,f&&(Ao(Io[wo],"description",{configurable:!0,get:function(){return Eo(this).description}}),Z(So,"propertyIsEnumerable",Bo,{unsafe:!0}))),k||(mo.f=function(t){return ao(r(t),t)}),yt({global:!0,wrap:!0,forced:!A,sham:!A},{Symbol:Io}),go(ne(xo),function(t){oo(t)}),yt({target:bo,stat:!0,forced:!A},{for:function(t){var e=String(t);if(c(Po,e))return Po[e];var n=Io(e);return Po[e]=n,Mo[n]=e,n},keyFor:function(t){if(!Vo(t))throw TypeError(t+" is not a symbol");if(c(Mo,t))return Mo[t]},useSetter:function(){Fo=!0},useSimple:function(){Fo=!1}}),yt({target:"Object",stat:!0,forced:!A,sham:!f},{create:function(t,e){return void 0===e?ue(t):so(ue(t),e)},defineProperty:qo,defineProperties:so,getOwnPropertyDescriptor:uo}),yt({target:"Object",stat:!0,forced:!A},{getOwnPropertyNames:co,getOwnPropertySymbols:jo}),yt({target:"Object",stat:!0,forced:y(function(){Vt.f(1)})},{getOwnPropertySymbols:function(t){return Vt.f(gt(t))}}),Co){var Wo=!A||y(function(){var t=Io();return"[null]"!=Co([t])||"{}"!=Co({a:t})||"{}"!=Co(Object(t))});yt({target:"JSON",stat:!0,forced:Wo},{stringify:function(t,e,n){for(var r,i=[t],o=1;o<arguments.length;)i.push(arguments[o++]);if((g(r=e)||void 0!==t)&&!Vo(t))return qr(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!Vo(e))return e}),i[1]=e,Co.apply(null,i)}})}Io[wo][_o]||_(Io[wo],_o,Io[wo].valueOf),ce(Io,bo),K[vo]=!0,oo("asyncIterator");var Ko=w.f,Qo=b.Symbol;if(!(!f||"function"!=typeof Qo||"description"in Qo.prototype&&void 0===Qo().description)){var Ho={},Go=function(t){var e=arguments.length<1||void 0===t?void 0:String(t),n=this instanceof Go?new Qo(e):void 0===e?Qo():Qo(e);return""===e&&(Ho[n]=!0),n};dt(Go,Qo);var zo=Go.prototype=Qo.prototype;zo.constructor=Go;var Yo=zo.toString,Xo="Symbol(test)"==String(Qo("test")),Jo=/^Symbol\((.*)\)[^)]+$/;Ko(zo,"description",{configurable:!0,get:function(){var t=g(this)?this.valueOf():this,e=Yo.call(t);if(c(Ho,t))return"";var n=Xo?e.slice(7,-1):e.replace(Jo,"$1");return""===n?void 0:n}}),yt({global:!0,forced:!0},{Symbol:Go})}oo("hasInstance"),oo("isConcatSpreadable"),oo("iterator"),oo("match"),oo("matchAll"),oo("replace"),oo("search"),oo("species"),oo("split"),oo("toPrimitive"),oo("toStringTag"),oo("unscopables"),ce(Math,"Math",!0),ce(b.JSON,"JSON",!0);Rt.Symbol;oo("asyncDispose"),oo("dispose"),oo("observable"),oo("patternMatch"),oo("replaceAll");mo.f("iterator");function $o(r,t,e){function n(t){var n=u[t];Z(u,t,"add"==t?function(t){return n.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!g(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!g(t)?void 0:n.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!g(t))&&n.call(this,0===t?0:t)}:function(t,e){return n.call(this,0===t?0:t,e),this})}var i=-1!==r.indexOf("Map"),o=-1!==r.indexOf("Weak"),a=i?"set":"add",s=b[r],u=s&&s.prototype,c=s,h={};if(Ht(r,"function"!=typeof s||!(o||u.forEach&&!y(function(){(new s).entries().next()}))))c=e.getConstructor(t,r,i,a),ea.REQUIRED=!0;else if(Ht(r,!0)){var l=new c,f=l[a](o?{}:-0,1)!=l,p=y(function(){l.has(1)}),d=sn(function(t){new s(t)}),m=!o&&y(function(){for(var t=new s,e=5;e--;)t[a](e,e);return!t.has(-0)});d||(((c=t(function(t,e){Qe(t,c,r);var n=function(t,e,n){var r,i;return ge&&"function"==typeof(r=e.constructor)&&r!==n&&g(i=r.prototype)&&i!==n.prototype&&ge(t,i),t}(new s,t,c);return null!=e&&en(e,n[a],n,i),n})).prototype=u).constructor=c),(p||m)&&(n("delete"),n("has"),i&&n("get")),(m||f)&&n(a),o&&u.clear&&delete u.clear}return h[r]=c,yt({global:!0,forced:c!=s},h),ce(c,r),o||e.setStrong(c,r,i),c}function Zo(t,e,n){var r,i,o,a,s=arguments.length,u=1<s?e:void 0;return Ke(this),(r=void 0!==u)&&Ke(u),null==t?new this:(i=[],r?(o=0,a=Ge(u,2<s?n:void 0,2),en(t,function(t){i.push(a(t,o++))})):en(t,i.push,i),new this(i))}var ta=!y(function(){return Object.isExtensible(Object.preventExtensions({}))}),ea=e(function(t){function n(t){e(t,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var e=w.f,r=s("meta"),i=0,o=Object.isExtensible||function(){return!0},a=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!g(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!c(t,r)){if(!o(t))return"F";if(!e)return"E";n(t)}return t[r].objectID},getWeakData:function(t,e){if(!c(t,r)){if(!o(t))return!0;if(!e)return!1;n(t)}return t[r].weakData},onFreeze:function(t){return ta&&a.REQUIRED&&o(t)&&!c(t,r)&&n(t),t}};K[r]=!0}),na=(ea.REQUIRED,ea.fastKey,ea.getWeakData,ea.onFreeze,w.f),ra=ea.fastKey,ia=$.set,oa=$.getterFor,aa={getConstructor:function(t,n,r,i){function o(t,e,n){var r,i,o=s(t),a=u(t,e);return a?a.value=n:(o.last=a={index:i=ra(e,!0),key:e,value:n,previous:r=o.last,next:void 0,removed:!1},o.first||(o.first=a),r&&(r.next=a),f?o.size++:t.size++,"F"!==i&&(o.index[i]=a)),t}var a=t(function(t,e){Qe(t,a,n),ia(t,{type:n,index:ue(null),first:void 0,last:void 0,size:0}),f||(t.size=0),null!=e&&en(e,t[i],t,r)}),s=oa(n),u=function(t,e){var n,r=s(t),i=ra(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return je(a.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,f?t.size=0:this.size=0},delete:function(t){var e=s(this),n=u(this,t);if(n){var r=n.next,i=n.previous;delete e.index[n.index],n.removed=!0,i&&(i.next=r),r&&(r.previous=i),e.first==n&&(e.first=r),e.last==n&&(e.last=i),f?e.size--:this.size--}return!!n},forEach:function(t,e){for(var n,r=s(this),i=Ge(t,1<arguments.length?e:void 0,3);n=n?n.next:r.first;)for(i(n.value,n.key,this);n&&n.removed;)n=n.previous},has:function(t){return!!u(this,t)}}),je(a.prototype,r?{get:function(t){var e=u(this,t);return e&&e.value},set:function(t,e){return o(this,0===t?0:t,e)}}:{add:function(t){return o(this,t=0===t?0:t,t)}}),f&&na(a.prototype,"size",{get:function(){return s(this).size}}),a},setStrong:function(t,e,n){var r=e+" Iterator",i=oa(e),o=oa(r);fe(t,e,function(t,e){ia(this,{type:r,target:t,state:i(t),kind:e,last:void 0})},function(){for(var t=o(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:{value:t.target=void 0,done:!0}},n?"entries":"values",!n,!0),We(e)}};$o("Map",function(e){return function(t){return e(this,arguments.length?t:void 0)}},aa),Rt.Map;yt({target:"Map",stat:!0},{from:Zo});function sa(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}yt({target:"Map",stat:!0},{of:sa});function ua(){for(var t,e=d(this),n=Ke(e.delete),r=!0,i=0,o=arguments.length;i<o;i++)t=n.call(e,arguments[i]),r=r&&t;return!!r}yt({target:"Map",proto:!0,real:!0,forced:a},{deleteAll:function(){return ua.apply(this,arguments)}});function ca(t){return Map.prototype.entries.call(t)}yt({target:"Map",proto:!0,real:!0,forced:a},{every:function(t,e){var n=d(this),r=ca(n),i=Ge(t,1<arguments.length?e:void 0,3);return!en(r,function(t,e){if(!i(e,t,n))return en.stop()},void 0,!0,!0).stopped}}),yt({target:"Map",proto:!0,real:!0,forced:a},{filter:function(t,e){var n=d(this),r=ca(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(un(n,ht("Map"))),a=Ke(o.set);return en(r,function(t,e){i(e,t,n)&&a.call(o,t,e)},void 0,!0,!0),o}}),yt({target:"Map",proto:!0,real:!0,forced:a},{find:function(t,e){var n=d(this),r=ca(n),i=Ge(t,1<arguments.length?e:void 0,3);return en(r,function(t,e){if(i(e,t,n))return en.stop(e)},void 0,!0,!0).result}}),yt({target:"Map",proto:!0,real:!0,forced:a},{findKey:function(t,e){var n=d(this),r=ca(n),i=Ge(t,1<arguments.length?e:void 0,3);return en(r,function(t,e){if(i(e,t,n))return en.stop(t)},void 0,!0,!0).result}}),yt({target:"Map",stat:!0},{groupBy:function(t,n){var r=new this;Ke(n);var i=Ke(r.has),o=Ke(r.get),a=Ke(r.set);return en(t,function(t){var e=n(t);i.call(r,e)?o.call(r,e).push(t):a.call(r,e,[t])}),r}});yt({target:"Map",proto:!0,real:!0,forced:a},{includes:function(n){return en(ca(d(this)),function(t,e){if(function(t,e){return t===e||t!=t&&e!=e}(e,n))return en.stop()},void 0,!0,!0).stopped}}),yt({target:"Map",stat:!0},{keyBy:function(t,e){var n=new this;Ke(e);var r=Ke(n.set);return en(t,function(t){r.call(n,e(t),t)}),n}}),yt({target:"Map",proto:!0,real:!0,forced:a},{keyOf:function(n){return en(ca(d(this)),function(t,e){if(e===n)return en.stop(t)},void 0,!0,!0).result}}),yt({target:"Map",proto:!0,real:!0,forced:a},{mapKeys:function(t,e){var n=d(this),r=ca(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(un(n,ht("Map"))),a=Ke(o.set);return en(r,function(t,e){a.call(o,i(e,t,n),e)},void 0,!0,!0),o}}),yt({target:"Map",proto:!0,real:!0,forced:a},{mapValues:function(t,e){var n=d(this),r=ca(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(un(n,ht("Map"))),a=Ke(o.set);return en(r,function(t,e){a.call(o,t,i(e,t,n))},void 0,!0,!0),o}}),yt({target:"Map",proto:!0,real:!0,forced:a},{merge:function(t){for(var e=d(this),n=Ke(e.set),r=0;r<arguments.length;)en(arguments[r++],n,e,!0);return e}}),yt({target:"Map",proto:!0,real:!0,forced:a},{reduce:function(n,t){var r=d(this),e=ca(r),i=arguments.length<2,o=i?void 0:t;if(Ke(n),en(e,function(t,e){o=i?(i=!1,e):n(o,e,t,r)},void 0,!0,!0),i)throw TypeError("Reduce of empty map with no initial value");return o}}),yt({target:"Map",proto:!0,real:!0,forced:a},{some:function(t,e){var n=d(this),r=ca(n),i=Ge(t,1<arguments.length?e:void 0,3);return en(r,function(t,e){if(i(e,t,n))return en.stop()},void 0,!0,!0).stopped}}),yt({target:"Map",proto:!0,real:!0,forced:a},{update:function(t,e,n){var r=d(this),i=arguments.length;Ke(e);var o=r.has(t);if(!o&&i<3)throw TypeError("Updating absent value");var a=o?r.get(t):Ke(2<i?n:void 0)(t,r);return r.set(t,e(a,t,r)),r}});function ha(t,e,n){var r,i=d(this),o=2<arguments.length?n:void 0;if("function"!=typeof e&&"function"!=typeof o)throw TypeError("At least one callback required");return i.has(t)?(r=i.get(t),"function"==typeof e&&(r=e(r),i.set(t,r))):"function"==typeof o&&(r=o(),i.set(t,r)),r}yt({target:"Map",proto:!0,real:!0,forced:a},{upsert:ha}),yt({target:"Map",proto:!0,real:!0,forced:a},{updateOrInsert:ha});$o("Set",function(e){return function(t){return e(this,arguments.length?t:void 0)}},aa),Rt.Set;yt({target:"Set",stat:!0},{from:Zo}),yt({target:"Set",stat:!0},{of:sa});yt({target:"Set",proto:!0,real:!0,forced:a},{addAll:function(){return function(){for(var t=d(this),e=Ke(t.add),n=0,r=arguments.length;n<r;n++)e.call(t,arguments[n]);return t}.apply(this,arguments)}}),yt({target:"Set",proto:!0,real:!0,forced:a},{deleteAll:function(){return ua.apply(this,arguments)}});function la(t){return Set.prototype.values.call(t)}yt({target:"Set",proto:!0,real:!0,forced:a},{every:function(t,e){var n=d(this),r=la(n),i=Ge(t,1<arguments.length?e:void 0,3);return!en(r,function(t){if(!i(t,t,n))return en.stop()},void 0,!1,!0).stopped}}),yt({target:"Set",proto:!0,real:!0,forced:a},{difference:function(t){var e=d(this),n=new(un(e,ht("Set")))(e),r=Ke(n.delete);return en(t,function(t){r.call(n,t)}),n}}),yt({target:"Set",proto:!0,real:!0,forced:a},{filter:function(t,e){var n=d(this),r=la(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(un(n,ht("Set"))),a=Ke(o.add);return en(r,function(t){i(t,t,n)&&a.call(o,t)},void 0,!1,!0),o}}),yt({target:"Set",proto:!0,real:!0,forced:a},{find:function(t,e){var n=d(this),r=la(n),i=Ge(t,1<arguments.length?e:void 0,3);return en(r,function(t){if(i(t,t,n))return en.stop(t)},void 0,!1,!0).result}}),yt({target:"Set",proto:!0,real:!0,forced:a},{intersection:function(t){var e=d(this),n=new(un(e,ht("Set"))),r=Ke(e.has),i=Ke(n.add);return en(t,function(t){r.call(e,t)&&i.call(n,t)}),n}}),yt({target:"Set",proto:!0,real:!0,forced:a},{isDisjointFrom:function(t){var e=d(this),n=Ke(e.has);return!en(t,function(t){if(!0===n.call(e,t))return en.stop()}).stopped}}),yt({target:"Set",proto:!0,real:!0,forced:a},{isSubsetOf:function(t){var e=function(t){var e=ze(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return d(e.call(t))}(this),n=d(t),r=n.has;return"function"!=typeof r&&(n=new(ht("Set"))(t),r=Ke(n.has)),!en(e,function(t){if(!1===r.call(n,t))return en.stop()},void 0,!1,!0).stopped}}),yt({target:"Set",proto:!0,real:!0,forced:a},{isSupersetOf:function(t){var e=d(this),n=Ke(e.has);return!en(t,function(t){if(!1===n.call(e,t))return en.stop()}).stopped}}),yt({target:"Set",proto:!0,real:!0,forced:a},{join:function(t){var e=d(this),n=la(e),r=void 0===t?",":String(t),i=[];return en(n,i.push,i,!1,!0),i.join(r)}}),yt({target:"Set",proto:!0,real:!0,forced:a},{map:function(t,e){var n=d(this),r=la(n),i=Ge(t,1<arguments.length?e:void 0,3),o=new(un(n,ht("Set"))),a=Ke(o.add);return en(r,function(t){a.call(o,i(t,t,n))},void 0,!1,!0),o}}),yt({target:"Set",proto:!0,real:!0,forced:a},{reduce:function(e,t){var n=d(this),r=la(n),i=arguments.length<2,o=i?void 0:t;if(Ke(e),en(r,function(t){o=i?(i=!1,t):e(o,t,t,n)},void 0,!1,!0),i)throw TypeError("Reduce of empty set with no initial value");return o}}),yt({target:"Set",proto:!0,real:!0,forced:a},{some:function(t,e){var n=d(this),r=la(n),i=Ge(t,1<arguments.length?e:void 0,3);return en(r,function(t){if(i(t,t,n))return en.stop()},void 0,!1,!0).stopped}}),yt({target:"Set",proto:!0,real:!0,forced:a},{symmetricDifference:function(t){var e=d(this),n=new(un(e,ht("Set")))(e),r=Ke(n.delete),i=Ke(n.add);return en(t,function(t){r.call(n,t)||i.call(n,t)}),n}}),yt({target:"Set",proto:!0,real:!0,forced:a},{union:function(t){var e=d(this),n=new(un(e,ht("Set")))(e);return en(t,Ke(n.add),n),n}});var fa=Math.floor;yt({target:"Number",stat:!0},{isInteger:function(t){return!g(t)&&isFinite(t)&&fa(t)===t}});Rt.Number.isInteger;var pa=function(t,e){return(pa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function da(t,e){function n(){this.constructor=t}pa(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var ma=function(){return(ma=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function ya(o,a,s,u){return new(s=s||Promise)(function(t,e){function n(t){try{i(u.next(t))}catch(t){e(t)}}function r(t){try{i(u.throw(t))}catch(t){e(t)}}function i(e){e.done?t(e.value):new s(function(t){t(e.value)}).then(n,r)}i((u=u.apply(o,a||[])).next())})}function ga(n,r){var i,o,a,t,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=2&e[0]?o.return:e[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,e[1])).done)return a;switch(o=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return s.label++,{value:e[1],done:!1};case 5:s.label++,o=e[1],e=[0];continue;case 7:e=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){s=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){s.label=e[1];break}if(6===e[0]&&s.label<a[1]){s.label=a[1],a=e;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(e);break}a[2]&&s.ops.pop(),s.trys.pop();continue}e=r.call(n,s)}catch(t){e=[6,t],o=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function va(t){var e="function"==typeof Symbol&&t[Symbol.iterator],n=0;return e?e.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}}function ba(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function wa(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ba(arguments[e]));return t}function _a(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}function Ta(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}function Ea(t){try{return Na.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}var Sa={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},Ia=function(t,e){if(!t)throw Ca(e)},Ca=function(t){return new Error("Firebase Database ("+Sa.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},Na={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],a=i+1<t.length,s=a?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|s>>4,f=(15&s)<<2|c>>6,p=63&c;u||(p=64,a||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Ta(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(191<i&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(239<i&&i<365){var a=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(s=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(a>>10)),e[r++]=String.fromCharCode(56320+(1023&a))}else{o=t[n++];var s=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0,s=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();var c=o<<2|a>>4;if(r.push(c),64!==s){var h=a<<4&240|s>>2;if(r.push(h),64!==u){var l=s<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};function Aa(t){return ka(void 0,t)}function ka(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=ka(t[n],e[n]));return t}var Da=(Ra.prototype.wrapCallback=function(n){var r=this;return function(t,e){t?r.reject(t):r.resolve(e),"function"==typeof n&&(r.promise.catch(function(){}),1===n.length?n(t):n(t,e))}},Ra);function Ra(){var n=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}function Oa(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Pa(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Oa())}function Ma(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function xa(){return!0===Sa.NODE_ADMIN}var La,Fa=(da(Ua,La=Error),Ua);function Ua(t,e){var n=La.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,Ua.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,Va.prototype.create),n}var Va=(qa.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,r){return t.replace(Ba,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Fa(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},qa);function qa(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var Ba=/\{\$([^}]+)}/g;function ja(t){return JSON.parse(t)}function Wa(t){return JSON.stringify(t)}function Ka(t){var e={},n={},r={},i="";try{var o=t.split(".");e=ja(Ea(o[0])||""),n=ja(Ea(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}}function Qa(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ha(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function Ga(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function za(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}var Ya=(Xa.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},Xa.prototype.compress_=function(t,e){e=e||0;var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a,s=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++)a=r<40?r<20?(o=h^u&(c^h),1518500249):(o=u^c^h,1859775393):r<60?(o=u&c|h&(u|c),2400959708):(o=u^c^h,3395469782),i=(s<<5|s>>>27)+o+l+a+n[r]&4294967295,l=h,h=c,c=4294967295&(u<<30|u>>>2),u=s,s=i;this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},Xa.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},Xa.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},Xa);function Xa(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}function Ja(t,e){var n=new $a(t,e);return n.subscribe.bind(n)}var $a=(Za.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},Za.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},Za.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},Za.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=ts),void 0===r.error&&(r.error=ts),void 0===r.complete&&(r.complete=ts);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},Za.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},Za.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},Za.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},Za.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},Za);function Za(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}function ts(){}function es(t,e,n,r){var i;if(r<e?i="at least "+e:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function ns(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}function rs(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(ns(t,e,r)+"must be a valid function.")}function is(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(ns(t,e,r)+"must be a valid context object.")}function os(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:55296<=r&&r<=56319?(e+=4,n++):e+=3}return e}var as=(ss.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},ss.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},ss.prototype.setServiceProps=function(t){return this.serviceProps=t,this},ss);function ss(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var us="[DEFAULT]",cs=(hs.prototype.get=function(t){void 0===t&&(t=us);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new Da;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},hs.prototype.getImmediate=function(t){var e=ma({identifier:us,optional:!1},t),n=e.identifier,r=e.optional,i=this.normalizeInstanceIdentifier(n);try{var o=this.getOrInitializeService(i);if(o)return o;if(r)return null;throw Error("Service "+this.name+" is not available")}catch(t){if(r)return null;throw t}},hs.prototype.getComponent=function(){return this.component},hs.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(function(t){return"EAGER"===t.instantiationMode}(this.component=t))try{this.getOrInitializeService(us)}catch(t){}try{for(var r=va(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=ba(i.value,2),a=o[0],s=o[1],u=this.normalizeInstanceIdentifier(a);try{var c=this.getOrInitializeService(u);s.resolve(c)}catch(t){}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},hs.prototype.clearInstance=function(t){void 0===t&&(t=us),this.instancesDeferred.delete(t),this.instances.delete(t)},hs.prototype.delete=function(){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))];case 1:return t.sent(),[2]}})})},hs.prototype.isComponentSet=function(){return null!=this.component},hs.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return t===us?void 0:t}(t)),this.instances.set(t,e)),e||null},hs.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:us:t},hs);function hs(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}var ls,fs,ps=(ds.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},ds.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},ds.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new cs(t,this);return this.providers.set(t,e),e},ds.prototype.getProviders=function(){return Array.from(this.providers.values())},ds);function ds(t){this.name=t,this.providers=new Map}function ms(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}(fs=ls=ls||{})[fs.DEBUG=0]="DEBUG",fs[fs.VERBOSE=1]="VERBOSE",fs[fs.INFO=2]="INFO",fs[fs.WARN=3]="WARN",fs[fs.ERROR=4]="ERROR",fs[fs.SILENT=5]="SILENT";function ys(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case ls.DEBUG:case ls.VERBOSE:console.log.apply(console,ms(["["+i+"]  "+t.name+":"],n));break;case ls.INFO:console.info.apply(console,ms(["["+i+"]  "+t.name+":"],n));break;case ls.WARN:console.warn.apply(console,ms(["["+i+"]  "+t.name+":"],n));break;case ls.ERROR:console.error.apply(console,ms(["["+i+"]  "+t.name+":"],n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}}var gs,vs=ls.INFO,bs=(Object.defineProperty(ws.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in ls))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(ws.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),ws.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ms([this,ls.DEBUG],t))},ws.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ms([this,ls.VERBOSE],t))},ws.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ms([this,ls.INFO],t))},ws.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ms([this,ls.WARN],t))},ws.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,ms([this,ls.ERROR],t))},ws);function ws(t){this.name=t,this._logLevel=vs,this._logHandler=ys}var _s,Ts=((gs={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",gs["bad-app-name"]="Illegal App name: '{$appName}",gs["duplicate-app"]="Firebase App named '{$appName}' already exists",gs["app-deleted"]="Firebase App named '{$appName}' already deleted",gs["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",gs),Es=new Va("app","Firebase",Ts),Ss="@firebase/app",Is="[DEFAULT]",Cs=((_s={})[Ss]="fire-core",_s["@firebase/analytics"]="fire-analytics",_s["@firebase/auth"]="fire-auth",_s["@firebase/database"]="fire-rtdb",_s["@firebase/functions"]="fire-fn",_s["@firebase/installations"]="fire-iid",_s["@firebase/messaging"]="fire-fcm",_s["@firebase/performance"]="fire-perf",_s["@firebase/remote-config"]="fire-rc",_s["@firebase/storage"]="fire-gcs",_s["@firebase/firestore"]="fire-fst",_s["fire-js"]="fire-js",_s["firebase-wrapper"]="fire-js-all",_s),Ns=new bs("@firebase/app"),As=(Object.defineProperty(ks.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(ks.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(ks.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),ks.prototype.delete=function(){var e=this;return new Promise(function(t){e.checkDestroyed_(),t()}).then(function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map(function(t){return t.delete()}))}).then(function(){e.isDeleted_=!0})},ks.prototype._getService=function(t,e){return void 0===e&&(e=Is),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},ks.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=Is),this.container.getProvider(t).clearInstance(e)},ks.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){Ns.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},ks.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},ks.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw Es.create("app-deleted",{appName:this.name_})},ks);function ks(t,e,n){var r,i,o=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Aa(t),this.container=new ps(e.name),this._addComponent(new as("app",function(){return o},"PUBLIC"));try{for(var a=va(this.firebase_.INTERNAL.components.values()),s=a.next();!s.done;s=a.next()){var u=s.value;this._addComponent(u)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}As.prototype.name&&As.prototype.options||As.prototype.delete||console.log("dc");var Ds="7.6.2";function Rs(u){var c={},h=new Map,l={__esModule:!0,initializeApp:function(t,e){void 0===e&&(e={});if("object"!=typeof e||null===e){e={name:e}}var n=e;void 0===n.name&&(n.name=Is);var r=n.name;if("string"!=typeof r||!r)throw Es.create("bad-app-name",{appName:String(r)});if(Qa(c,r))throw Es.create("duplicate-app",{appName:r});var i=new u(t,n,l);return c[r]=i},app:f,registerVersion:function(t,e,n){var r,i=null!==(r=Cs[t])&&void 0!==r?r:t;n&&(i+="-"+n);var o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){var s=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&s.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&a&&s.push("and"),a&&s.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void Ns.warn(s.join(" "))}p(new as(i+"-version",function(){return{library:i,version:e}},"VERSION"))},apps:null,SDK_VERSION:Ds,INTERNAL:{registerComponent:p,removeApp:function(t){delete c[t]},components:h,useAsService:function(t,e){return"serverAuth"!==e?e:null}}};function f(t){if(!Qa(c,t=t||Is))throw Es.create("no-app",{appName:t});return c[t]}function p(n){var e,t,r=n.name;if(h.has(r))return Ns.debug("There were multiple attempts to register component "+r+"."),"PUBLIC"===n.type?l[r]:null;if(h.set(r,n),"PUBLIC"===n.type){var i=function(t){if(void 0===t&&(t=f()),"function"!=typeof t[r])throw Es.create("invalid-app-argument",{appName:r});return t[r]()};void 0!==n.serviceProps&&ka(i,n.serviceProps),l[r]=i,u.prototype[r]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,r).apply(this,n.multipleInstances?t:[])}}try{for(var o=va(Object.keys(c)),a=o.next();!a.done;a=o.next()){var s=a.value;c[s]._addComponent(n)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return"PUBLIC"===n.type?l[r]:null}return l.default=l,Object.defineProperty(l,"apps",{get:function(){return Object.keys(c).map(function(t){return c[t]})}}),f.App=u,l}var Os=function t(){var e=Rs(As);return e.INTERNAL=ma(ma({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){ka(e,t)},createSubscribe:Ja,ErrorFactory:Va,deepExtend:ka}),e}(),Ps=(Ms.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(t){if(function(t){var e,n=t.getComponent();return"VERSION"===(null===(e=n)||void 0===e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null}).filter(function(t){return t}).join(" ")},Ms);function Ms(t){this.container=t}if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Ns.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var xs=self.firebase.SDK_VERSION;xs&&0<=xs.indexOf("LITE")&&Ns.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var Ls=Os.initializeApp;Os.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&Ns.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),Ls.apply(void 0,t)};var Fs,Us,fl=Os;(Fs=fl).INTERNAL.registerComponent(new as("platform-logger",function(t){return new Ps(t)},"PRIVATE")),Fs.registerVersion(Ss,"0.5.1",Us),Fs.registerVersion("fire-js","");fl.registerVersion("firebase","7.6.2","app");(function(){var t,o="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},a="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function c(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:function(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}(t)}}!function(t,e){if(e){var n=a;t=t.split(".");for(var r=0;r<t.length-1;r++){var i=t[r];i in n||(n[i]={}),n=n[i]}(e=e(r=n[t=t[t.length-1]]))!=r&&null!=e&&o(n,t,{configurable:!0,writable:!0,value:e})}}("Promise",function(t){function s(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function e(){this.a=null}function u(e){return e instanceof s?e:new s(function(t){t(e)})}if(t)return t;e.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var n=a.setTimeout;e.prototype.c=function(t){n(t,0)},e.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},e.prototype.f=function(t){this.c(function(){throw t})},s.prototype.f=function(){function t(e){return function(t){r||(r=!0,e.call(n,t))}}var n=this,r=!1;return{resolve:t(this.m),reject:t(this.g)}},s.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof s)this.o(t);else{t:switch(typeof t){case"object":var e=null!=t;break t;case"function":e=!0;break t;default:e=!1}e?this.u(t):this.h(t)}},s.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},s.prototype.g=function(t){this.i(2,t)},s.prototype.h=function(t){this.i(1,t)},s.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},s.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)i.b(this.a[t]);this.a=null}};var i=new e;return s.prototype.o=function(t){var e=this.f();t.La(e.resolve,e.reject)},s.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},s.prototype.then=function(t,e){function n(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(t){i(t)}}:t}var r,i,o=new s(function(t,e){r=t,i=e});return this.La(n(t,r),n(e,i)),o},s.prototype.catch=function(t){return this.then(void 0,t)},s.prototype.La=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?i.b(n):this.a.push(n)},s.resolve=u,s.reject=function(n){return new s(function(t,e){e(n)})},s.race=function(i){return new s(function(t,e){for(var n=c(i),r=n.next();!r.done;r=n.next())u(r.value).La(t,e)})},s.all=function(t){var o=c(t),a=o.next();return a.done?u([]):new s(function(n,t){function e(e){return function(t){r[e]=t,0==--i&&n(r)}}for(var r=[],i=0;r.push(void 0),i++,u(a.value).La(e(r.length-1),t),!(a=o.next()).done;);})},s});var u=u||{},l=this||self;function h(t){return"string"==typeof t}function n(t){return"boolean"==typeof t}var s=/^[\w+/_-]+[=]{0,2}$/,f=null;function p(){}function r(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function i(t){return null===t}function d(t){return"array"==r(t)}function m(t){var e=r(t);return"array"==e||"object"==e&&"number"==typeof t.length}function y(t){return"function"==r(t)}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var e="closure_uid_"+(1e9*Math.random()>>>0),v=0;function b(t,e,n){return t.call.apply(t.bind,arguments)}function w(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function _(t,e,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:w).apply(null,arguments)}function T(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var E=Date.now||function(){return+new Date};function S(t,o){function e(){}e.prototype=o.prototype,t.qb=o.prototype,t.prototype=new e,(t.prototype.constructor=t).gd=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function I(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function C(t){if(Error.captureStackTrace)Error.captureStackTrace(this,C);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function N(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");C.call(this,n+t[r])}function A(t,e){throw new N("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function k(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function D(t,e){t.f(e),t.b<100&&(t.b++,e.next=t.a,t.a=e)}function R(){this.b=this.a=null}S(C,Error),C.prototype.name="CustomError",S(N,C),N.prototype.name="AssertionError",k.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var O=new k(function(){return new P},function(t){t.reset()});function P(){this.next=this.b=this.a=null}function M(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||l).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(g(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;A("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}R.prototype.add=function(t,e){var n=O.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},P.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},P.prototype.reset=function(){this.next=this.b=this.a=null};var x=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(h(t))return h(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},L=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=h(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var F=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=h(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},U=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function V(t,e){return 0<=x(t,e)}function q(t,e){var n;return(n=0<=(e=x(t,e)))&&Array.prototype.splice.call(t,e,1),n}function B(n,r){!function(t,e){for(var n=h(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(n,function(t,e){r.call(void 0,t,e,n)&&1==Array.prototype.splice.call(n,e,1).length&&0})}function j(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function Q(t){for(var e in t)return!1;return!0}function H(t){var e,n={};for(e in t)n[e]=t[e];return n}var G="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<G.length;o++)n=G[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Y(t,e){this.a=t===$&&e||"",this.b=J}function X(t){return t instanceof Y&&t.constructor===Y&&t.b===J?t.a:(A("expected object of type Const, got '"+t+"'"),"type_error:Const")}Y.prototype.qa=!0,Y.prototype.pa=function(){return this.a},Y.prototype.toString=function(){return"Const{"+this.a+"}"};var J={},$={},Z=new Y($,"");function tt(){this.a="",this.b=ot}function et(t){return t instanceof tt&&t.constructor===tt&&t.b===ot?t.a:(A("expected object of type TrustedResourceUrl, got '"+t+"' of type "+r(t)),"type_error:TrustedResourceUrl")}function nt(t,n){var r=X(t);if(!it.test(r))throw Error("Invalid TrustedResourceUrl format: "+r);return at(t=r.replace(rt,function(t,e){if(!Object.prototype.hasOwnProperty.call(n,e))throw Error('Found marker, "'+e+'", in format string, "'+r+'", but no valid label mapping found in args: '+JSON.stringify(n));return(t=n[e])instanceof Y?X(t):encodeURIComponent(String(t))}))}tt.prototype.qa=!0,tt.prototype.pa=function(){return this.a.toString()},tt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var rt=/%{(\w+)}/g,it=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,ot={};function at(t){var e=new tt;return e.a=t,e}var st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ut=/&/g,ct=/</g,ht=/>/g,lt=/"/g,ft=/'/g,pt=/\x00/g,dt=/[\x00&<>"']/;function mt(t,e){return-1!=t.indexOf(e)}function yt(t,e){return t<e?-1:e<t?1:0}function gt(){this.a="",this.b=Tt}function vt(t){return t instanceof gt&&t.constructor===gt&&t.b===Tt?t.a:(A("expected object of type SafeUrl, got '"+t+"' of type "+r(t)),"type_error:SafeUrl")}gt.prototype.qa=!0,gt.prototype.pa=function(){return this.a.toString()},gt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var bt=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function wt(t){return t instanceof gt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),bt.test(t)||(t="about:invalid#zClosurez"),Et(t))}var _t,Tt={};function Et(t){var e=new gt;return e.a=t,e}Et("about:blank");t:{var St=l.navigator;if(St){var It=St.userAgent;if(It){_t=It;break t}}_t=""}function Ct(t){return mt(_t,t)}function Nt(){this.a="",this.b=kt}function At(t){return t instanceof Nt&&t.constructor===Nt&&t.b===kt?t.a:(A("expected object of type SafeHtml, got '"+t+"' of type "+r(t)),"type_error:SafeHtml")}Nt.prototype.qa=!0,Nt.prototype.pa=function(){return this.a.toString()},Nt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var kt={};function Dt(t){var e=new Nt;return e.a=t,e}Dt("<!DOCTYPE html>");var Rt,Ot,Pt=Dt("");function Mt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function xt(t){return dt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ut,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ct,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ht,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(lt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(ft,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(pt,"&#0;"))),t}function Lt(t){l.setTimeout(function(){throw t},0)}function Ft(){var t=l.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Ct("Presto")&&(t=function(){var t=document.createElement("IFRAME");t.style.display="none",function(t){var e=at(X(Z));M(t,"HTMLIFrameElement"),t.src=et(e).toString()}(t),document.documentElement.appendChild(t);var e=t.contentWindow;(t=e.document).open(),t.write(At(Pt)),t.close();var n="callImmediate"+Math.random(),r="file:"==e.location.protocol?"*":e.location.protocol+"//"+e.location.host;t=_(function(t){"*"!=r&&t.origin!=r||t.data!=n||this.port1.onmessage()},this),e.addEventListener("message",t,!1),this.port1={},this.port2={postMessage:function(){e.postMessage(n,r)}}}),void 0===t||Ct("Trident")||Ct("MSIE"))return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){l.setTimeout(t,0)};var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}function Ut(t,e){Ot||function(){if(l.Promise&&l.Promise.resolve){var t=l.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}else Ot=function(){var t=Bt;!y(l.setImmediate)||l.Window&&l.Window.prototype&&!Ct("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(Rt=Rt||Ft())(t):l.setImmediate(t)}}(),Vt||(Ot(),Vt=!0),qt.add(t,e)}Dt("<br>");var Vt=!1,qt=new R;function Bt(){for(var t;n=e=void 0,n=null,(e=qt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Lt(t)}D(O,t)}var e,n;Vt=!1}function jt(t,e){if(this.a=Wt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=p)try{var n=this;t.call(e,function(t){ee(n,Kt,t)},function(t){if(!(t instanceof ue))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}ee(n,Qt,t)})}catch(t){ee(this,Qt,t)}}var Wt=0,Kt=2,Qt=3;function Ht(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}Ht.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Gt=new k(function(){return new Ht},function(t){t.reset()});function zt(t,e,n){var r=Gt.get();return r.g=t,r.b=e,r.f=n,r}function Yt(t){if(t instanceof jt)return t;var e=new jt(p);return ee(e,Kt,t),e}function Xt(n){return new jt(function(t,e){e(n)})}function Jt(t,e,n){ne(t,e,n,null)||Ut(T(e,t))}function $t(n){return new jt(function(r){var i=n.length,o=[];if(i)for(var t=function(t,e,n){i--,o[t]=e?{Gb:!0,value:n}:{Gb:!1,reason:n},0==i&&r(o)},e=0;e<n.length;e++)Jt(n[e],T(t,e,!0),T(t,e,!1));else r(o)})}function Zt(t,e){t.b||t.a!=Kt&&t.a!=Qt||re(t),t.f?t.f.next=e:t.b=e,t.f=e}function te(t,i,o,a){var e=zt(null,null,null);return e.a=new jt(function(n,r){e.g=i?function(t){try{var e=i.call(a,t);n(e)}catch(t){r(t)}}:n,e.b=o?function(t){try{var e=o.call(a,t);void 0===e&&t instanceof ue?r(t):n(e)}catch(t){r(t)}}:r}),Zt(e.a.c=t,e),e.a}function ee(t,e,n){t.a==Wt&&(t===n&&(e=Qt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ne(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,re(t),e!=Qt||n instanceof ue||function(t,e){t.g=!0,Ut(function(){t.g&&se.call(null,e)})}(t,n)))}function ne(t,e,n,r){if(t instanceof jt)return Zt(t,zt(e||p,n||null,r)),!0;if(I(t))return t.then(e,n,r),!0;if(g(t))try{var i=t.then;if(y(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function re(t){t.h||(t.h=!0,Ut(t.Zb,t))}function ie(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function oe(t,e,n,r){if(n==Qt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ae(e,n,r);else try{e.c?e.g.call(e.f):ae(e,n,r)}catch(t){se.call(null,t)}D(Gt,e)}function ae(t,e,n){e==Kt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}jt.prototype.then=function(t,e,n){return te(this,y(t)?t:null,y(e)?e:null,n)},jt.prototype.$goog_Thenable=!0,(t=jt.prototype).ka=function(t,e){return(t=zt(t,t,e)).c=!0,Zt(this,t),this},t.s=function(t,e){return te(this,null,t,e)},t.cancel=function(t){this.a==Wt&&Ut(function(){!function t(e,n){if(e.a==Wt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Wt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ie(r),oe(r,o,Qt,n)))}e.c=null}else ee(e,Qt,n)}(this,new ue(t))},this)},t.Oc=function(t){this.a=Wt,ee(this,Kt,t)},t.Pc=function(t){this.a=Wt,ee(this,Qt,t)},t.Zb=function(){for(var t;t=ie(this);)oe(this,t,this.a,this.i);this.h=!1};var se=Lt;function ue(t){C.call(this,t)}function ce(){this.va=this.va,this.la=this.la}S(ue,C);var he=0;function le(t){if(!t.va&&(t.va=!0,t.za(),0!=he))t[e]||(t[e]=++v)}function fe(t){return fe[" "](t),t}ce.prototype.va=!(ue.prototype.name="cancel"),ce.prototype.za=function(){if(this.la)for(;this.la.length;)this.la.shift()()},fe[" "]=p;var pe,de,me=Ct("Opera"),ye=Ct("Trident")||Ct("MSIE"),ge=Ct("Edge"),ve=ge||ye,be=Ct("Gecko")&&!(mt(_t.toLowerCase(),"webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),we=mt(_t.toLowerCase(),"webkit")&&!Ct("Edge");function _e(){var t=l.document;return t?t.documentMode:void 0}t:{var Te="",Ee=(de=_t,be?/rv:([^\);]+)(\)|;)/.exec(de):ge?/Edge\/([\d\.]+)/.exec(de):ye?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(de):we?/WebKit\/(\S+)/.exec(de):me?/(?:Version)[ \/]?(\S+)/.exec(de):void 0);if(Ee&&(Te=Ee?Ee[1]:""),ye){var Se=_e();if(null!=Se&&Se>parseFloat(Te)){pe=String(Se);break t}}pe=Te}var Ie,Ce={};function Ne(s){return function(t,e){var n=Ce;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=st(String(pe)).split("."),n=st(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=yt(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||yt(0==o[2].length,0==a[2].length)||yt(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}Ie=l.document&&ye?_e():void 0;var Ae=Object.freeze||function(t){return t},ke=!ye||9<=Number(Ie),De=ye&&!Ne("9"),Re=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",p,e),l.removeEventListener("test",p,e)}catch(t){}return t}();function Oe(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function Pe(t,e){if(Oe.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(be){t:{try{fe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=h(t.pointerType)?t.pointerType:Me[t.pointerType]||"",(this.a=t).defaultPrevented&&this.preventDefault()}}Oe.prototype.preventDefault=function(){this.Mb=!1},S(Pe,Oe);var Me=Ae({2:"touch",3:"pen",4:"mouse"});Pe.prototype.preventDefault=function(){Pe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,De)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}},Pe.prototype.f=function(){return this.a};var xe="closure_listenable_"+(1e6*Math.random()|0),Le=0;function Fe(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Pa=i,this.key=++Le,this.ta=this.Ka=!1}function Ue(t){t.ta=!0,t.listener=null,t.proxy=null,t.src=null,t.Pa=null}function Ve(t){this.src=t,this.a={},this.b=0}function qe(t,e){var n=e.type;n in t.a&&q(t.a[n],e)&&(Ue(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function Be(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ta&&o.listener==e&&o.capture==!!n&&o.Pa==r)return i}return-1}Ve.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Be(t,e,r,i);return-1<a?(e=t[a],n||(e.Ka=!1)):((e=new Fe(e,this.src,o,!!r,i)).Ka=n,t.push(e)),e};var je="closure_lm_"+(1e6*Math.random()|0),We={};function Ke(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ke(t,e[o],n,r,i);else n=en(n),t&&t[xe]?rn(t,e,n,g(r)?!!r.capture:!!r,i):Qe(t,e,n,!1,r,i)}function Qe(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=g(i)?!!i.capture:!!i,s=Ze(t);if(s||(t[je]=s=new Ve(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var e=$e,n=ke?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)Re||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ye(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=en(n),t&&t[xe]?on(t,e,n,g(r)?!!r.capture:!!r,i):Qe(t,e,n,!0,r,i)}function Ge(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else r=g(r)?!!r.capture:!!r,n=en(n),t&&t[xe]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=Be(o=t.a[e],n,r,i))&&(Ue(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):(t=t&&Ze(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Be(e,n,r,i)),(n=-1<t?e[t]:null)&&ze(n))}function ze(t){if("number"!=typeof t&&t&&!t.ta){var e=t.src;if(e&&e[xe])qe(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ye(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ze(e))?(qe(n,t),0==n.b&&(n.src=null,e[je]=null)):Ue(t)}}}function Ye(t){return t in We?We[t]:We[t]="on"+t}function Xe(t,e,n,r){var i=!0;if((t=Ze(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ta&&(o=Je(o,r),i=i&&!1!==o)}return i}function Je(t,e){var n=t.listener,r=t.Pa||t.src;return t.Ka&&ze(t),n.call(r,e)}function $e(t,e){if(t.ta)return!0;if(ke)return Je(t,new Pe(e,this));if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new Pe(r=e,this),n=!0,!(r.keyCode<0||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}!i&&null!=r.returnValue||(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Xe(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Xe(r[i],t,!1,e),n=n&&o}return n}function Ze(t){return(t=t[je])instanceof Ve?t:null}var tn="__closure_events_fn_"+(1e9*Math.random()>>>0);function en(e){return y(e)?e:(e[tn]||(e[tn]=function(t){return e.handleEvent(t)}),e[tn])}function nn(){ce.call(this),this.u=new Ve(this),(this.Sb=this).Xa=null}function rn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function on(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function an(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ta&&a.capture==n){var s=a.listener,u=a.Pa||a.src;a.Ka&&qe(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function sn(t,e,n){if(y(t))n&&(t=_(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=_(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function un(n){var r=null;return new jt(function(t,e){-1==(r=sn(function(){t(void 0)},n))&&e(Error("Failed to schedule timer."))}).s(function(t){throw l.clearTimeout(r),t})}function cn(t){if(t.U&&"function"==typeof t.U)return t.U();if(h(t))return t.split("");if(m(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function hn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(m(t)||h(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function ln(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ln)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function fn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];pn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)pn(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function pn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}S(nn,ce),nn.prototype[xe]=!0,nn.prototype.addEventListener=function(t,e,n,r){Ke(this,t,e,n,r)},nn.prototype.removeEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},nn.prototype.dispatchEvent=function(t){var e,n=this.Xa;if(n)for(e=[];n;n=n.Xa)e.push(n);n=this.Sb;var r=t.type||t;if(h(t))t=new Oe(t,n);else if(t instanceof Oe)t.target=t.target||n;else{var i=t;z(t=new Oe(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=an(a,r,!0,t)&&i}if(i=an(a=t.b=n,r,!0,t)&&i,i=an(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=an(a=t.b=e[o],r,!1,t)&&i;return i},nn.prototype.za=function(){if(nn.qb.za.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ue(n[r]);delete e.a[t],e.b--}}this.Xa=null},(t=ln.prototype).U=function(){fn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return fn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return pn(this.b,t)?this.b[t]:e},t.set=function(t,e){pn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var dn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function mn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof mn?(this.h=void 0!==e?e:t.h,yn(this,t.f),this.i=t.i,this.b=t.b,gn(this,t.l),this.c=t.c,vn(this,Fn(t.a)),this.g=t.g):t&&(n=String(t).match(dn))?(this.h=!!e,yn(this,n[1]||"",!0),this.i=En(n[2]||""),this.b=En(n[3]||"",!0),gn(this,n[4]),this.c=En(n[5]||"",!0),vn(this,n[6]||"",!0),this.g=En(n[7]||"")):(this.h=!!e,this.a=new Rn(null,this.h))}function yn(t,e,n){t.f=n?En(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function gn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.l=e}else t.l=null}function vn(t,e,n){e instanceof Rn?(t.a=e,function(t,e){e&&!t.f&&(On(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Mn(this,e),Ln(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=Sn(e,kn)),t.a=new Rn(e,t.h))}function bn(t,e,n){t.a.set(e,n)}function wn(t,e){return t.a.get(e)}function _n(t){return t instanceof mn?new mn(t):new mn(t,void 0)}function Tn(t,e){var n=new mn(null,void 0);return yn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function En(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Sn(t,e,n){return h(t)?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}mn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Sn(e,Cn,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.i)&&t.push(Sn(e,Cn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Sn(n,"/"==n.charAt(0)?An:Nn,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Sn(n,Dn)),t.join("")},mn.prototype.resolve=function(t){var e=new mn(this),n=!!t.f;n?yn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)gn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(mt(i,"./")||mt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?vn(e,Fn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var Cn=/[#\/\?@]/g,Nn=/[#\?:]/g,An=/[#\?]/g,kn=/[#\?@]/g,Dn=/#/g;function Rn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function On(n){n.a||(n.a=new ln,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function Pn(t){var e=hn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Rn(null,void 0);t=cn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Ln(n,i,o):n.add(i,o)}return n}function Mn(t,e){On(t),e=Un(t,e),pn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,pn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&fn(t)))}function xn(t,e){return On(t),e=Un(t,e),pn(t.a.b,e)}function Ln(t,e,n){Mn(t,e),0<n.length&&(t.c=null,t.a.set(Un(t,e),W(n)),t.b+=n.length)}function Fn(t){var e=new Rn;return e.c=t.c,t.a&&(e.a=new ln(t.a),e.b=t.b),e}function Un(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Rn.prototype).add=function(t,e){On(this),this.c=null,t=Un(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(n,r){On(this),this.a.forEach(function(t,e){L(t,function(t){n.call(r,t,e,this)},this)},this)},t.X=function(){On(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){On(this);var e=[];if(h(t))xn(this,t)&&(e=j(e,this.a.get(Un(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},t.set=function(t,e){return On(this),this.c=null,xn(this,t=Un(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var Vn=!ye||9<=Number(Ie);function qn(t){var e=document;return h(t)?e.getElementById(t):t}function Bn(n,t){K(t,function(t,e){t&&"object"==typeof t&&t.qa&&(t=t.pa()),"style"==e?n.style.cssText=t:"class"==e?n.className=t:"for"==e?n.htmlFor=t:jn.hasOwnProperty(e)?n.setAttribute(jn[e],t):0==e.lastIndexOf("aria-",0)||0==e.lastIndexOf("data-",0)?n.setAttribute(e,t):n[e]=t})}var jn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!Vn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',xt(a.name),'"'),a.type){o.push(' type="',xt(a.type),'"');var s={};z(s,a),delete s.type,a=s}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(h(a)?o.className=a:d(a)?o.className=a.join(" "):Bn(o,a)),2<r.length&&function(e,n,t){function r(t){t&&n.appendChild(h(t)?e.createTextNode(t):t)}for(var i=2;i<t.length;i++){var o=t[i];!m(o)||g(o)&&0<o.nodeType?r(o):L(Kn(o)?W(o):o,r)}}(i,o,r),o}function Kn(t){if(t&&"number"==typeof t.length){if(g(t))return"function"==typeof t.item||"string"==typeof t.item;if(y(t))return"function"==typeof t.item}return!1}function Qn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Yn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Yn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Gn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},zn=/\uffff/.test("ï¿¿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Yn(t,e){e.push('"',t.replace(zn,function(t){var e=Gn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Gn[t]=e),e}),'"')}function Xn(){var t=mr();return ye&&!!Ie&&11==Ie||/Edge\/\d+/.test(t)}function Jn(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function $n(t,e){e=e||l.window;var n="about:blank";t&&(n=vt(wt(t)).toString()),e.location.href=n}function Zn(t){return!!((t=(t||mr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function tr(t){t=t||l.window;try{t.close()}catch(t){}}function er(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=mr().toLowerCase(),r&&(e.target=r,mt(n,"crios/")&&(e.target="_blank")),fr(mr())==hr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof gt?n:wt(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Ct("iPhone")&&!Ct("iPod")&&!Ct("iPad")||Ct("iPad")||Ct("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(M(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof gt||e instanceof gt||(e="object"==typeof e&&e.qa?e.pa():String(e),bt.test(e)||(e="about:invalid#zClosurez"),e=Et(e)),a.href=vt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=vt(e).toString(),a&&(ve&&mt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Dt('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+xt(t)+'">'),a.document.write(At(t)),a.document.close())):(a=r.open(vt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var nr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,rr=/^[^@]+@[^@]+$/;function ir(){var e=null;return new jt(function(t){"complete"==l.document.readyState?t():(e=function(){t()},He(window,"load",e))}).s(function(t){throw Ge(window,"load",e),t})}function or(t){return t=t||mr(),!("file:"!==wr()&&"ionic:"!==wr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function ar(){var t=l.window;try{return!(!t||t==t.top)}catch(t){return!1}}function sr(){return void 0!==l.WorkerGlobalScope&&"function"==typeof l.importScripts}function ur(){return fl.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":fl.INTERNAL.hasOwnProperty("node")?"Node":sr()?"Worker":"Browser"}function cr(){var t=ur();return"ReactNative"===t||"Node"===t}var hr="Firefox",lr="Chrome";function fr(t){var e=t.toLowerCase();return mt(e,"opera/")||mt(e,"opr/")||mt(e,"opios/")?"Opera":mt(e,"iemobile")?"IEMobile":mt(e,"msie")||mt(e,"trident/")?"IE":mt(e,"edge/")?"Edge":mt(e,"firefox/")?hr:mt(e,"silk/")?"Silk":mt(e,"blackberry")?"Blackberry":mt(e,"webos")?"Webos":!mt(e,"safari/")||mt(e,"chrome/")||mt(e,"crios/")||mt(e,"android")?!mt(e,"chrome/")&&!mt(e,"crios/")||mt(e,"edge/")?mt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":lr:"Safari"}var pr={Wc:"FirebaseCore-web",Yc:"FirebaseUI-web"};function dr(t,e){e=e||[];var n,r=[],i={};for(n in pr)i[pr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=ur())?r=fr(i=mr()):"Worker"===r&&(r=fr(i=mr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function mr(){return l.navigator&&l.navigator.userAgent||""}function yr(t,e){t=t.split("."),e=e||l;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function gr(){try{var t=l.localStorage,e=Ir();if(t)return t.setItem(e,"1"),t.removeItem(e),!Xn()||!!l.indexedDB}catch(t){return sr()&&!!l.indexedDB}return!1}function vr(){return(br()||"chrome-extension:"===wr()||or())&&!cr()&&gr()&&!sr()}function br(){return"http:"===wr()||"https:"===wr()}function wr(){return l.location&&l.location.protocol||null}function _r(t){return!Zn(t=t||mr())&&fr(t)!=hr}function Tr(t){return void 0===t?null:Qn(t)}function Er(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Sr(t){if(null!==t)return JSON.parse(t)}function Ir(t){return t||Math.floor(1e9*Math.random()).toString()}function Cr(t){return"Safari"!=fr(t=t||mr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function Nr(){var t=l.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Ar(t,e){if(e<t)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=mr(),e=ur(),this.b=Zn(t)||"ReactNative"===e}function kr(){var t=l.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Dr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Rr(){return!(!yr("fireauth.oauthhelper",l)&&!yr("fireauth.iframe",l))}Ar.prototype.get=function(){var t=l.navigator;return!t||"boolean"!=typeof t.onLine||!br()&&"chrome-extension:"!==wr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Or,Pr={};function Mr(t){Pr[t]||(Pr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var xr={};Object.defineProperty(xr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(xr,"abcd",{configurable:!0,enumerable:!0,value:2}),Or=2==xr.abcd}catch(t){Or=!1}function Lr(t,e,n){Or?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Fr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Lr(t,n,e[n])}function Ur(t){var e={};return Fr(e,t),e}function Vr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Lr(e,n,Vr(t[n]));return e}function qr(t){var e={},n=t[jr],r=t[Wr];if(!(t=t[Kr])||t!=Br&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[Qr]=n||null,Lr(this,zr,t),Lr(this,Gr,Vr(e))}var Br="EMAIL_SIGNIN",jr="email",Wr="newEmail",Kr="requestType",Qr="email",Hr="fromEmail",Gr="data",zr="operation";function Yr(t,e){this.code=Jr+t,this.message=e||$r[t]||""}function Xr(t){var e=t&&t.code;return e?new Yr(e.substring(Jr.length),t.message):null}S(Yr,Error),Yr.prototype.A=function(){return{code:this.code,message:this.message}},Yr.prototype.toJSON=function(){return this.A()};var Jr="auth/",$r={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function Zr(t){var e=wn(t=_n(t),ti)||null,n=wn(t,ei)||null,r=wn(t,ii)||null;if(r=r&&ai[r]||null,!e||!n||!r)throw new Yr("argument-error",ti+", "+ei+"and "+ii+" are required in a valid action code URL.");Fr(this,{apiKey:e,operation:r,code:n,continueUrl:wn(t,ni)||null,languageCode:wn(t,ri)||null,tenantId:wn(t,oi)||null})}var ti="apiKey",ei="oobCode",ni="continueUrl",ri="languageCode",ii="mode",oi="tenantId",ai={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:Br,verifyEmail:"VERIFY_EMAIL"};function si(t){try{return new Zr(t)}catch(t){return null}}function ui(t){var e=t[pi];if(void 0===e)throw new Yr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Yr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[ci];if(n&&"object"==typeof n){e=n[yi];var r=n[di];if(n=n[mi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Yr("argument-error",di+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Yr("argument-error",mi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Yr("argument-error",yi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Yr("missing-android-pkg-name")}}else if(void 0!==n)throw new Yr("argument-error",ci+" property must be a non null object when specified.");if(this.f=null,(e=t[fi])&&"object"==typeof e){if("string"==typeof(e=e[gi])&&e.length)this.f=e;else if(void 0!==e)throw new Yr("argument-error",gi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Yr("argument-error",fi+" property must be a non null object when specified.");if(void 0!==(e=t[li])&&"boolean"!=typeof e)throw new Yr("argument-error",li+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[hi])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Yr("argument-error",hi+" property must be a non empty string when specified.");this.i=t||null}var ci="android",hi="dynamicLinkDomain",li="handleCodeInApp",fi="iOS",pi="url",di="installApp",mi="minimumVersion",yi="packageName",gi="bundleId";function vi(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var bi=null,wi=null;function _i(t){var e="";return function(r,t){function e(t){for(;i<r.length;){var e=r.charAt(i++),n=wi[e];if(null!=n)return n;if(!/^[\s\xa0]*$/.test(e))throw Error("Unknown base64 encoding at char: "+e)}return t}!function(){if(!bi){bi={},wi={};for(var t=0;t<65;t++)bi[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),62<=(wi[bi[t]]=t)&&(wi["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var i=0;;){var n=e(-1),o=e(0),a=e(64),s=e(64);if(64===s&&-1===n)break;t(n<<2|o>>4),64!=a&&(t(o<<4&240|a>>2),64!=s&&t(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Ti(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Ei(t){return(t=Si(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ti(t):null}function Si(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(_i(t))}catch(t){}return null}Ti.prototype.R=function(){return this.c},Ti.prototype.g=function(){return this.b};var Ii,Ci={bd:{cb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},dd:{cb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},ed:{cb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function Ni(t){for(var e in Ci)if(Ci[e].id===t)return{firebaseEndpoint:(t=Ci[e]).cb,secureTokenEndpoint:t.ib};return null}Ii=Ni("__EID__")?"__EID__":void 0;var Ai="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),ki=["client_id","response_type","scope","redirect_uri","state"],Di={Xc:{Ea:"locale",sa:700,ra:600,Fa:"facebook.com",Qa:ki},Zc:{Ea:null,sa:500,ra:750,Fa:"github.com",Qa:ki},$c:{Ea:"hl",sa:515,ra:680,Fa:"google.com",Qa:ki},fd:{Ea:"lang",sa:485,ra:705,Fa:"twitter.com",Qa:Ai},Vc:{Ea:"locale",sa:600,ra:600,Fa:"apple.com",Qa:[]}};function Ri(t){for(var e in Di)if(Di[e].Fa==t)return Di[e];return null}function Oi(t){var e={};e["facebook.com"]=Fi,e["google.com"]=Vi,e["github.com"]=Ui,e["twitter.com"]=qi;var n=t&&t[Mi];try{if(n)return e[n]?new e[n](t):new Li(t);if(void 0!==t[Pi])return new xi(t)}catch(t){}return null}var Pi="idToken",Mi="providerId";function xi(t){var e=t[Mi];if(!e&&t[Pi]){var n=Ei(t[Pi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Lr(this,"providerId",e),Lr(this,"isNewUser",n)}function Li(t){xi.call(this,t),Lr(this,"profile",Vr((t=Sr(t.rawUserInfo||"{}"))||{}))}function Fi(t){if(Li.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ui(t){if(Li.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",this.profile&&this.profile.login||null)}function Vi(t){if(Li.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function qi(t){if(Li.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Lr(this,"username",t.screenName||null)}function Bi(t){var e=_n(t),n=wn(e,"link"),r=wn(_n(n),"link");return wn(_n(e=wn(e,"deep_link_id")),"link")||e||r||n||t}function ji(){}function Wi(t,n){return t.then(function(t){if(t[Oa]){var e=Ei(t[Oa]);if(!e||n!=e.f)throw new Yr("user-mismatch");return t}throw new Yr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==Jr+"user-not-found"?new Yr("user-mismatch"):t})}function Ki(t,e){if(!e)throw new Yr("internal-error","failed to construct a credential");this.a=e,Lr(this,"providerId",t),Lr(this,"signInMethod",t)}function Qi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Hi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Ki(t.providerId,t.pendingToken)}catch(t){}return null}function Gi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Lr(this,"idToken",e.idToken),e.accessToken&&Lr(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Lr(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Yr("internal-error","failed to construct a credential");Lr(this,"accessToken",e.oauthToken),Lr(this,"secret",e.oauthTokenSecret)}Lr(this,"providerId",t),Lr(this,"signInMethod",n)}function zi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:Pn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Yi(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Gi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Xi(t,e){this.Fc=e||[],Fr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.eb=(Ri(t)||{}).Ea||null,this.bb=null}function Ji(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Yr("argument-error",'SAML provider IDs must be prefixed with "saml."');Xi.call(this,t,[])}function $i(t){Xi.call(this,t,ki),this.a=[]}function Zi(){$i.call(this,"facebook.com")}function to(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new Zi).credential({accessToken:e})}function eo(){$i.call(this,"github.com")}function no(t){if(!t)throw new Yr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new eo).credential({accessToken:e})}function ro(){$i.call(this,"google.com"),this.ya("profile")}function io(t,e){var n=t;return g(t)&&(n=t.idToken,e=t.accessToken),(new ro).credential({idToken:n,accessToken:e})}function oo(){Xi.call(this,"twitter.com",Ai)}function ao(t,e){var n=t;if(g(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Yr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Gi("twitter.com",n,"twitter.com")}function so(t,e,n){this.a=t,this.c=e,Lr(this,"providerId","password"),Lr(this,"signInMethod",n===co.EMAIL_LINK_SIGN_IN_METHOD?co.EMAIL_LINK_SIGN_IN_METHOD:co.EMAIL_PASSWORD_SIGN_IN_METHOD)}function uo(t){return t&&t.email&&t.password?new so(t.email,t.password,t.signInMethod):null}function co(){Fr(this,{providerId:"password",isOAuthProvider:!1})}function ho(t,e){if(!(e=lo(e)))throw new Yr("argument-error","Invalid email link!");return new so(t,e.code,co.EMAIL_LINK_SIGN_IN_METHOD)}function lo(t){return(t=si(t=Bi(t)))&&t.operation===Br?t:null}function fo(t){if(!(t.Va&&t.Ua||t.Ha&&t.ba))throw new Yr("internal-error");this.a=t,Lr(this,"providerId","phone"),Lr(this,"signInMethod","phone")}function po(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var n={};return L(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(t){e[t]&&(n[t]=e[t])}),new fo(n)}return null}function mo(t){return t.a.Ha&&t.a.ba?{temporaryProof:t.a.Ha,phoneNumber:t.a.ba}:{sessionInfo:t.a.Va,code:t.a.Ua}}function yo(t){try{this.a=t||fl.auth()}catch(t){throw new Yr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Fr(this,{providerId:"phone",isOAuthProvider:!1})}function go(t,e){if(!t)throw new Yr("missing-verification-id");if(!e)throw new Yr("missing-verification-code");return new fo({Va:t,Ua:e})}function vo(t){if(t.temporaryProof&&t.phoneNumber)return new fo({Ha:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return io(o,n);case"facebook.com":return to(n);case"github.com":return no(n);case"twitter.com":return ao(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Ki(e,a):new Gi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new $i(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function bo(t){if(!t.isOAuthProvider)throw new Yr("invalid-oauth-provider")}function wo(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new Yr("invalid-auth-event");if(this.g&&this.a)throw new Yr("invalid-auth-event");if(this.g&&!this.f)throw new Yr("invalid-auth-event")}function _o(t){return(t=t||{}).type?new wo(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Xr(t.error),t.postBody,t.tenantId):null}function To(){this.b=null,this.a=[]}S(Li,xi),S(Fi,Li),S(Ui,Li),S(Vi,Li),S(qi,Li),Ki.prototype.na=function(t){return Xa(t,Qi(this))},Ki.prototype.b=function(t,e){var n=Qi(this);return n.idToken=e,Ja(t,n)},Ki.prototype.f=function(t,e){return Wi($a(t,Qi(this)),e)},Ki.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Gi.prototype.na=function(t){return Xa(t,zi(this))},Gi.prototype.b=function(t,e){var n=zi(this);return n.idToken=e,Ja(t,n)},Gi.prototype.f=function(t,e){return Wi($a(t,zi(this)),e)},Gi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Xi.prototype.Ga=function(t){return this.zb=H(t),this},S(Ji,Xi),S($i,Xi),$i.prototype.ya=function(t){return V(this.a,t)||this.a.push(t),this},$i.prototype.Hb=function(){return W(this.a)},$i.prototype.credential=function(t,e){var n;if(!(n=g(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Yr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Gi(this.providerId,n,this.providerId)},S(Zi,$i),Lr(Zi,"PROVIDER_ID","facebook.com"),Lr(Zi,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),S(eo,$i),Lr(eo,"PROVIDER_ID","github.com"),Lr(eo,"GITHUB_SIGN_IN_METHOD","github.com"),S(ro,$i),Lr(ro,"PROVIDER_ID","google.com"),Lr(ro,"GOOGLE_SIGN_IN_METHOD","google.com"),S(oo,Xi),Lr(oo,"PROVIDER_ID","twitter.com"),Lr(oo,"TWITTER_SIGN_IN_METHOD","twitter.com"),so.prototype.na=function(t){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,as,{email:this.a,oobCode:this.c}):Ns(t,Es,{email:this.a,password:this.c})},so.prototype.b=function(t,e){return this.signInMethod==co.EMAIL_LINK_SIGN_IN_METHOD?Ns(t,ss,{idToken:e,email:this.a,oobCode:this.c}):Ns(t,gs,{idToken:e,email:this.a,password:this.c})},so.prototype.f=function(t,e){return Wi(this.na(t),e)},so.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Fr(co,{PROVIDER_ID:"password"}),Fr(co,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Fr(co,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),fo.prototype.na=function(t){return t.Wa(mo(this))},fo.prototype.b=function(t,e){var n=mo(this);return n.idToken=e,Ns(t,Is,n)},fo.prototype.f=function(t,e){var n=mo(this);return n.operation="REAUTH",Wi(t=Ns(t,Cs,n),e)},fo.prototype.A=function(){var t={providerId:"phone"};return this.a.Va&&(t.verificationId=this.a.Va),this.a.Ua&&(t.verificationCode=this.a.Ua),this.a.Ha&&(t.temporaryProof=this.a.Ha),this.a.ba&&(t.phoneNumber=this.a.ba),t},yo.prototype.Wa=function(e,n){var r=this.a.b;return Yt(n.verify()).then(function(t){if(!h(t))throw new Yr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(n.type){case"recaptcha":return function(t,e){return Ns(t,ms,e)}(r,{phoneNumber:e,recaptchaToken:t}).then(function(t){return"function"==typeof n.reset&&n.reset(),t},function(t){throw"function"==typeof n.reset&&n.reset(),t});default:throw new Yr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Fr(yo,{PROVIDER_ID:"phone"}),Fr(yo,{PHONE_SIGN_IN_METHOD:"phone"}),wo.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},wo.prototype.R=function(){return this.h},wo.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var Eo,So=null;function Io(t){var e="unauthorized-domain",n=void 0,r=_n(t);t=r.b,"chrome-extension"==(r=r.f)?n=Mt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=Mt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Yr.call(this,e,n)}function Co(t,e,n){Yr.call(this,t,n),(t=e||{}).Ab&&Lr(this,"email",t.Ab),t.ba&&Lr(this,"phoneNumber",t.ba),t.credential&&Lr(this,"credential",t.credential),t.Qb&&Lr(this,"tenantId",t.Qb)}function No(t){if(t.code){var e=t.code||"";0==e.indexOf(Jr)&&(e=e.substring(Jr.length));var n={credential:vo(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Yr(e,t.message||void 0);return new Co(e,n,t.message)}return null}function Ao(){}function ko(t){return t.c||(t.c=t.b())}function Do(){}function Ro(t){if(t.f||"undefined"!=typeof XMLHttpRequest||"undefined"==typeof ActiveXObject)return t.f;for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}function Oo(){}function Po(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=_(this.fc,this),this.a.onerror=_(this.Ib,this),this.a.onprogress=_(this.gc,this),this.a.ontimeout=_(this.kc,this)}function Mo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function xo(t,e,n){this.reset(t,e,n,void 0,void 0)}function Lo(t){this.f=t,this.b=this.c=this.a=null}function Fo(t,e){this.name=t,this.value=e}S(Io,Yr),S(Co,Yr),Co.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&z(t,e),t},Co.prototype.toJSON=function(){return this.A()},Ao.prototype.c=null,S(Do,Ao),Do.prototype.a=function(){var t=Ro(this);return t?new ActiveXObject(t):new XMLHttpRequest},Do.prototype.b=function(){var t={};return Ro(this)&&(t[0]=!0,t[1]=!0),t},Eo=new Do,S(Oo,Ao),Oo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new Po;throw Error("Unsupported browser")},Oo.prototype.b=function(){return{}},(t=Po.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,Mo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",Mo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,Mo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},xo.prototype.a=null,xo.prototype.reset=function(t,e,n,r,i){delete this.a},Fo.prototype.toString=function(){return this.name};var Uo=new Fo("SEVERE",1e3),Vo=new Fo("WARNING",900),qo=new Fo("CONFIG",700),Bo=new Fo("FINE",500);Lo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(A("Root logger has no level set."),null)}(this).value)for(y(e)&&(e=e()),t=new xo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var jo,Wo={},Ko=null;function Qo(t){var e;if(Ko||(Ko=new Lo(""),(Wo[""]=Ko).c=qo),!(e=Wo[t])){e=new Lo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Qo(t.substr(0,n))).b||(n.b={}),(n.b[r]=e).a=n,Wo[t]=e}return e}function Ho(t,e){t&&t.log(Bo,e,void 0)}function Go(t){this.f=t}function zo(t){nn.call(this),this.o=t,this.readyState=Yo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Qo("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}S(Go,Ao),Go.prototype.a=function(){return new zo(this.f)},Go.prototype.b=(jo={},function(){return jo}),S(zo,nn);var Yo=0;function Xo(t){t.c.read().then(t.ec.bind(t)).catch(t.Oa.bind(t))}function Jo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,$o(t)}function $o(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Zo(t){nn.call(this),this.headers=new ln,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=ta,this.v=this.P=!1}(t=zo.prototype).open=function(t,e){if(this.readyState!=Yo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,$o(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Oa.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Jo(this,!1)),this.readyState=Yo},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,$o(this)),this.a&&(this.readyState=3,$o(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Oa.bind(this)):void 0!==l.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Xo(this)):t.text().then(this.ic.bind(this),this.Oa.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Jo(this,!0):$o(this),3==this.readyState&&Xo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Jo(this,!0))},t.hc=function(t){this.a&&(this.response=t,Jo(this,!0))},t.Oa=function(t){var e=this.h;e&&e.log(Vo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Jo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(Vo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(Vo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},S(Zo,nn);var ta="";Zo.prototype.b=Qo("goog.net.XhrIo");var ea=/^https?$/i,na=["POST","PUT"];function ra(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.O=n,e.I=!1,e.c=!0,e.a=e.B?e.B.a():Eo.a(),e.w=e.B?ko(e.B):ko(Eo),e.a.onreadystatechange=_(e.Lb,e);try{Ho(e.b,fa(e,"Opening Xhr")),e.J=!0,e.a.open(n,String(t),!0),e.J=!1}catch(t){return Ho(e.b,fa(e,"Error opening Xhr: "+t.message)),void oa(e,t)}t=r||"";var o=new ln(e.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(m(t)||h(t))L(t,e,void 0);else for(var n=hn(t),r=cn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=ia,n=t.length,r=h(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:h(t)?t.charAt(e):t[e]}(o.X()),r=l.FormData&&t instanceof l.FormData,!V(na,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.P&&(e.a.withCredentials=e.P);try{ca(e),0<e.g&&(e.v=function(t){return ye&&Ne(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(e.a),Ho(e.b,fa(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.v)),e.v?(e.a.timeout=e.g,e.a.ontimeout=_(e.Ia,e)):e.o=sn(e.Ia,e.g,e)),Ho(e.b,fa(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(t){Ho(e.b,fa(e,"Send error: "+t.message)),oa(e,t)}}function ia(t){return"content-type"==t.toLowerCase()}function oa(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,aa(t),ua(t)}function aa(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function sa(e){if(e.c&&void 0!==u)if(e.w[1]&&4==ha(e)&&2==la(e))Ho(e.b,fa(e,"Local request error detected and ignored"));else if(e.i&&4==ha(e))sn(e.Lb,0,e);else if(e.dispatchEvent("readystatechange"),4==ha(e)){Ho(e.b,fa(e,"Request complete")),e.c=!1;try{var t,n=la(e);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.l).match(dn)[1]||null;if(!o&&l.self&&l.self.location){var a=l.self.location.protocol;o=a.substr(0,a.length-1)}i=!ea.test(o?o.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var s=2<ha(e)?e.a.statusText:""}catch(t){Ho(e.b,"Can not get status: "+t.message),s=""}e.h=s+" ["+la(e)+"]",aa(e)}}finally{ua(e)}}}function ua(e,t){if(e.a){ca(e);var n=e.a,r=e.w[0]?p:null;e.a=null,e.w=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){(e=e.b)&&e.log(Uo,"Problem encountered resetting onreadystatechange: "+t.message,void 0)}}}function ca(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(l.clearTimeout(t.o),t.o=null)}function ha(t){return t.a?t.a.readyState:0}function la(t){try{return 2<ha(t)?t.a.status:-1}catch(t){return-1}}function fa(t,e){return e+" ["+t.O+" "+t.l+" "+la(t)+"]"}function pa(t){var e=Sa;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function da(t,e,n){t.a=!0,t.c=n,t.f=!e,va(t)}function ma(t){if(t.a){if(!t.u)throw new ba(t);t.u=!1}}function ya(t,e,n,r){t.g.push([e,n,r]),t.a&&va(t)}function ga(t){return U(t.g,function(t){return y(t[1])})}function va(e){if(e.h&&e.a&&ga(e)){var n=e.h,r=Ta[n];r&&(l.clearTimeout(r.a),delete Ta[n]),e.h=0}e.b&&(e.b.l--,delete e.b),n=e.c;for(var t=r=!1;e.g.length&&!e.i;){var i=e.g.shift(),o=i[0],a=i[1];if(i=i[2],o=e.f?a:o)try{var s=o.call(i||e.o,n);void 0!==s&&(e.f=e.f&&(s==n||s instanceof Error),e.c=n=s),(I(n)||"function"==typeof l.Promise&&n instanceof l.Promise)&&(t=!0,e.i=!0)}catch(t){n=t,e.f=!0,ga(e)||(r=!0)}}e.c=n,t&&(s=_(e.m,e,!0),t=_(e.m,e,!1),n instanceof pa?(ya(n,s,t),n.w=!0):n.then(s,t)),r&&(n=new _a(n),Ta[n.a]=n,e.h=n.a)}function ba(){C.call(this)}function wa(){C.call(this)}function _a(t){this.a=l.setTimeout(_(this.c,this),0),this.b=t}(t=Zo.prototype).Ia=function(){void 0!==u&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",Ho(this.b,fa(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(Ho(this.b,fa(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ua(this))},t.za=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ua(this,!0)),Zo.qb.za.call(this)},t.Lb=function(){this.va||(this.J||this.i||this.f?sa(this):this.yc())},t.yc=function(){sa(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case ta:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Uo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return Ho(this.b,"Can not get response: "+t.message),null}},pa.prototype.cancel=function(t){if(this.a)this.c instanceof pa&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,e.l<=0&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new wa(this),ma(this),da(this,!1,t))}},pa.prototype.m=function(t,e){this.i=!1,da(this,t,e)},pa.prototype.then=function(t,e,n){var r,i,o=new jt(function(t,e){r=t,i=e});return ya(this,r,function(t){t instanceof wa?o.cancel():i(t)}),o.then(t,e,n)},pa.prototype.$goog_Thenable=!0,S(ba,C),ba.prototype.message="Deferred has already fired",ba.prototype.name="AlreadyCalledError",S(wa,C),wa.prototype.message="Deferred was canceled",wa.prototype.name="CanceledError",_a.prototype.c=function(){throw delete Ta[this.a],this.b};var Ta={};function Ea(t){var e,n=document,r=et(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ia:void 0},a=new pa(o);return e=window.setTimeout(function(){Ia(i,!0);var t=new Aa(Na,"Timeout reached for loading script "+r);ma(a),da(a,!1,t)},5e3),o.Ia=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ia(i,!1,e),ma(a),da(a,!0,null))},i.onerror=function(){Ia(i,!0,e);var t=new Aa(Ca,"Error while loading script "+r);ma(a),da(a,!1,t)},z(o={},{type:"text/javascript",charset:"UTF-8"}),Bn(i,o),function(t,e){M(t,"HTMLScriptElement"),t.src=et(e),null===f&&(f=(e=(e=l.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&s.test(e)?e:""),(e=f)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),a}function Sa(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Ia(t,!0,this.Ia)}}function Ia(t,e,n){null!=n&&l.clearTimeout(n),t.onload=p,t.onerror=p,t.onreadystatechange=p,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Ca=0,Na=1;function Aa(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),C.call(this,n),this.code=t}function ka(t){this.f=t}function Da(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||Pa,this.g=H(t.secureTokenHeaders||Ma),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||xa,this.a=H(t.firebaseHeaders||La),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==ur(),!(n=l.XMLHttpRequest||n&&fl.INTERNAL.node&&fl.INTERNAL.node.XMLHttpRequest)&&!sr())throw new Yr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,sr()?this.f=new Go(self):cr()?this.f=new ka(n):this.f=new Oo,this.b=null}S(Aa,C),S(ka,Ao),ka.prototype.a=function(){return new this.f},ka.prototype.b=function(){return{}};var Ra,Oa="idToken",Pa=new Ar(3e4,6e4),Ma={"Content-Type":"application/x-www-form-urlencoded"},xa=new Ar(3e4,6e4),La={"Content-Type":"application/json"};function Fa(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Ua(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function Va(t,e,n,r,i,o,a){(t=function(){var t=mr();return!((t=fr(t)!=lr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&t<30)&&(!ye||!Ie||9<Ie)}()||sr()?_(t.o,t):(Ra=Ra||new jt(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{l[Ba]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))},function(t,e){ya(t,null,e,void 0)}(Ea(nt(qa,{onload:Ba})),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)}),_(t.m,t)))(e,n,r,i,o,a)}Da.prototype.R=function(){return this.b},Da.prototype.o=function(t,n,e,r,i,o){if(sr()&&(void 0===l.fetch||void 0===l.Headers||void 0===l.Request))throw new Yr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var a=new Zo(this.f);if(o){a.g=Math.max(0,o);var s=setTimeout(function(){a.dispatchEvent("timeout")},o)}rn(a,"complete",function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return Ho(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(t){e=null}n&&n(e)}),on(a,"ready",function(){s&&clearTimeout(s),le(this)}),on(a,"timeout",function(){s&&clearTimeout(s),le(this),n&&n(null)}),ra(a,t,e,r,i)};var qa=new Y($,"https://apis.google.com/js/client.js?onload=%{onload}"),Ba="__fcb"+Math.floor(1e6*Math.random()).toString();function ja(t){if(!h(t=t.email)||!rr.test(t))throw new Yr("invalid-email")}function Wa(t){"email"in t&&ja(t)}function Ka(t){if(!t[Oa])throw new Yr("internal-error")}function Qa(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Yr("internal-error")}else{if(!t.sessionInfo)throw new Yr("missing-verification-id");if(!t.code)throw new Yr("missing-verification-code")}}Da.prototype.m=function(t,n,r,i,o){var a=this;Ra.then(function(){window.gapi.client.setApiKey(a.c);var e=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:r,body:i,headers:o,authType:"none",callback:function(t){window.gapi.auth.setToken(e),n&&n(t)}})}).s(function(t){n&&n({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Da.prototype.ob=function(){return Ns(this,vs,{})},Da.prototype.rb=function(t,e){return Ns(this,ys,{idToken:t,email:e})},Da.prototype.sb=function(t,e){return Ns(this,gs,{idToken:t,password:e})};var Ha={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ga(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Yr("internal-error")}function za(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(xn(t=new Rn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Ya(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=No(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=No(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=No(t)):t.errorMessage&&(e=As(t.errorMessage)),e)throw e;if(!t[Oa])throw new Yr("internal-error")}function Xa(t,e){return e.returnIdpCredential=!0,Ns(t,bs,e)}function Ja(t,e){return e.returnIdpCredential=!0,Ns(t,_s,e)}function $a(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,Ns(t,ws,e)}function Za(t){if(!t.oobCode)throw new Yr("invalid-action-code")}(t=Da.prototype).tb=function(t,r){var i={idToken:t},o=[];return K(Ha,function(t,e){var n=r[e];null===n?o.push(t):e in r&&(i[e]=n)}),o.length&&(i.deleteAttribute=o),Ns(this,ys,i)},t.kb=function(t,e){return z(t={requestType:"PASSWORD_RESET",email:t},e),Ns(this,ls,t)},t.lb=function(t,e){return z(t={requestType:"EMAIL_SIGNIN",email:t},e),Ns(this,cs,t)},t.jb=function(t,e){return z(t={requestType:"VERIFY_EMAIL",idToken:t},e),Ns(this,hs,t)},t.Wa=function(t){return Ns(this,Ss,t)},t.ab=function(t,e){return Ns(this,ds,{oobCode:t,newPassword:e})},t.Ma=function(t){return Ns(this,es,{oobCode:t})},t.Ya=function(t){return Ns(this,ts,{oobCode:t})};var ts={endpoint:"setAccountInfo",D:Za,fa:"email",F:!0},es={endpoint:"resetPassword",D:Za,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Yr("internal-error")},F:!0},ns={endpoint:"signupNewUser",D:function(t){if(ja(t),!t.password)throw new Yr("weak-password")},K:Ka,T:!0,F:!0},rs={endpoint:"createAuthUri",F:!0},is={endpoint:"deleteAccount",V:["idToken"]},os={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new Yr("internal-error")}},as={endpoint:"emailLinkSignin",V:["email","oobCode"],D:ja,K:Ka,T:!0,F:!0},ss={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:ja,K:Ka,T:!0},us={endpoint:"getAccountInfo"},cs={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},hs={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Yr("internal-error")},fa:"email",F:!0},ls={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Yr("internal-error");ja(t)},fa:"email",F:!0},fs={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ps={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Yr("internal-error")}},ds={endpoint:"resetPassword",D:Za,fa:"email",F:!0},ms={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},ys={endpoint:"setAccountInfo",V:["idToken"],D:Wa,T:!0},gs={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Wa(t),!t.password)throw new Yr("weak-password")},K:Ka,T:!0},vs={endpoint:"signupNewUser",K:Ka,T:!0,F:!0},bs={endpoint:"verifyAssertion",D:Ga,Ra:za,K:Ya,T:!0,F:!0},ws={endpoint:"verifyAssertion",D:Ga,Ra:za,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Yr("user-not-found");if(t.errorMessage)throw As(t.errorMessage);if(!t[Oa])throw new Yr("internal-error")},T:!0,F:!0},_s={endpoint:"verifyAssertion",D:function(t){if(Ga(t),!t.idToken)throw new Yr("internal-error")},Ra:za,K:Ya,T:!0},Ts={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Yr("invalid-custom-token")},K:Ka,T:!0,F:!0},Es={endpoint:"verifyPassword",D:function(t){if(ja(t),!t.password)throw new Yr("wrong-password")},K:Ka,T:!0,F:!0},Ss={endpoint:"verifyPhoneNumber",D:Qa,K:Ka,F:!0},Is={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Yr("internal-error");Qa(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",No(t);Ka(t)}},Cs={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Qa,K:Ka,F:!0};function Ns(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Xt(new Yr("internal-error"));var r,i=e.Kb||"POST";return Yt(n).then(e.D).then(function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,r,i,o,n){var a=_n(t.h+e);bn(a,"key",t.c),n&&bn(a,"cb",E().toString());var s="GET"==r;if(s)for(var u in i)i.hasOwnProperty(u)&&bn(a,u,i[u]);return new jt(function(e,n){Va(t,a.toString(),function(t){t?t.error?n(ks(t,o||{})):e(t):n(new Yr("network-request-failed"))},r,s?void 0:Qn(Er(i)),t.a,t.i.get())})}(t,e.endpoint,i,n,e.Yb,e.wb||!1)}).then(function(t){return r=t,e.Ra?e.Ra(n,r):r}).then(e.K).then(function(){if(!e.fa)return r;if(!(e.fa in r))throw new Yr("internal-error");return r[e.fa]})}function As(t){return ks({error:{errors:[{message:t}],code:400,message:t}})}function ks(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Yr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",z(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Yr(r[i],e);return!e&&t&&(e=Tr(t)),new Yr("internal-error",e)}function Ds(t){this.b=t,this.a=null,this.gb=function(o){return(Ms=Ms||new jt(function(t,e){function n(){Nr(),yr("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){Nr(),e(Error("Network Error"))},timeout:Os.get()})}if(yr("gapi.iframes.Iframe"))t();else if(yr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){yr("gapi.load")?n():e(Error("Network Error"))},Yt(Ea(r=nt(Rs,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw Ms=null,t})).then(function(){return new jt(function(r,i){yr("gapi.iframes.getContext")().open({where:document.body,url:o.b,messageHandlersFilter:yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(t){function e(){clearTimeout(n),r()}o.a=t,o.a.restyle({setHideOnLeave:!1});var n=setTimeout(function(){i(Error("Network Error"))},Ps.get());t.ping(e).then(e,function(){i(Error("Network Error"))})})})})}(this)}var Rs=new Y($,"https://apis.google.com/js/api.js?onload=%{onload}"),Os=new Ar(3e4,6e4),Ps=new Ar(5e3,15e3),Ms=null;function xs(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Tn(this.i,"/__/auth/iframe"),bn(this.a,"apiKey",this.g),bn(this.a,"appName",this.h),this.b=null,this.c=[]}function Ls(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Fs(t){try{return fl.app(t).auth().Ca()}catch(t){return[]}}function Us(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Vs(t){var s=Jn();return function(t){return Ns(t,fs,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var e=_n(s),n=e.f;e=e.b;for(var r=0;r<t.length;r++){var i=t[r],o=e,a=n;if(o=0==i.indexOf("chrome-extension://")?_n(i).b==o&&"chrome-extension"==a:("http"==a||"https"==a)&&(nr.test(i)?o==i:(i=i.split(".").join("\\."),new RegExp("^(.+\\."+i+"|"+i+")$","i").test(o)))){t=!0;break t}}t=!1}if(!t)throw new Io(Jn())})}function qs(i){return i.l||(i.l=ir().then(function(){if(!i.o){var t=i.c,e=i.h,n=Fs(i.b),r=new xs(i.u,i.f,i.b);r.f=t,r.b=e,r.c=W(n||[]),i.o=r.toString()}i.i=new Ds(i.o),function(r){if(!r.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.gb.then(function(){t.a.register("authEvent",e,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(r.i,function(t){var e={};if(t&&t.authEvent){var n=!1;for(t=_o(t.authEvent),e=0;e<r.g.length;e++)n=r.g[e](t)||n;return(e={}).status=n?"ACK":"ERROR",Yt(e)}return e.status="ERROR",Yt(e)})}(i)})),i.l}function Bs(t){return t.m||(t.v=t.c?dr(t.c,Fs(t.b)):null,t.m=new Da(t.f,Ni(t.h),t.v)),t.m}function js(t,e,n,r,i,o,a,s,u,c,h){return(t=new Ls(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=H(u||null),t.f=c,t.nb(h).toString()}function Ws(t){if(this.a=t||fl.INTERNAL.reactNative&&fl.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Yr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ks(t){this.b=t,this.a={},this.f=_(this.c,this)}xs.prototype.toString=function(){return this.f?bn(this.a,"v",this.f):Mn(this.a.a,"v"),this.b?bn(this.a,"eid",this.b):Mn(this.a.a,"eid"),this.c.length?bn(this.a,"fw",this.c.join(",")):Mn(this.a.a,"fw"),this.a.toString()},Ls.prototype.nb=function(t){return this.h=t,this},Ls.prototype.toString=function(){var t=Tn(this.o,"/__/auth/handler");if(bn(t,"apiKey",this.m),bn(t,"appName",this.c),bn(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=fl.app(this.c).auth().ha()}catch(t){n=null}for(var r in e.bb=n,bn(t,"providerId",this.a.providerId),n=Er((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=H(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.eb&&e.bb&&!n[e.eb]&&(n[e.eb]=e.bb),Q(n)||bn(t,"customParameters",Tr(n))}if("function"==typeof this.a.Hb&&((e=this.a.Hb()).length&&bn(t,"scopes",e.join(","))),this.l?bn(t,"redirectUrl",this.l):Mn(t.a,"redirectUrl"),this.g?bn(t,"eventId",this.g):Mn(t.a,"eventId"),this.i?bn(t,"v",this.i):Mn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!wn(t,a)&&bn(t,a,this.b[a]);return this.h?bn(t,"tid",this.h):Mn(t.a,"tid"),this.f?bn(t,"eid",this.f):Mn(t.a,"eid"),(a=Fs(this.c)).length&&bn(t,"fw",a.join(",")),t.toString()},(t=Us.prototype).Fb=function(e,n,t){var r=new Yr("popup-closed-by-user"),i=new Yr("web-storage-unsupported"),o=this,a=!1;return this.ia().then(function(){(function(t){var e={type:"webStorageSupport"};return qs(t).then(function(){return function(e,n){return e.gb.then(function(){return new jt(function(t){e.a.send(n.type,n,t,yr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(t){t||(e&&tr(e),n(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(n){return new jt(function(e){return function t(){un(2e3).then(function(){if(n&&!n.closed)return t();e()})}()})}(e)}).then(function(){if(!a)return un(t).then(function(){n(r)})})},t.Ob=function(){var t=mr();return!_r(t)&&!Cr(t)},t.Jb=function(){return!1},t.Db=function(e,t,n,r,i,o,a,s){if(!e)return Xt(new Yr("popup-blocked"));if(a&&!_r())return this.ia().s(function(t){tr(e),i(t)}),r(),Yt();this.a||(this.a=Vs(Bs(this)));var u=this;return this.a.then(function(){var t=u.ia().s(function(t){throw tr(e),i(t),t});return r(),t}).then(function(){bo(n),a||$n(js(u.u,u.f,u.b,t,n,null,o,u.c,void 0,u.h,s),e)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},t.Eb=function(t,e,n,r){this.a||(this.a=Vs(Bs(this)));var i=this;return this.a.then(function(){bo(e),$n(js(i.u,i.f,i.b,t,e,Jn(),n,i.c,void 0,i.h,r))}).s(function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t})},t.ia=function(){var t=this;return qs(this).then(function(){return t.i.gb}).s(function(){throw t.a=null,new Yr("network-request-failed")})},t.Rb=function(){return!0},t.Aa=function(t){this.g.push(t)},t.Na=function(e){B(this.g,function(t){return t==e})},(t=Ws.prototype).get=function(t){return Yt(this.a.getItem(t)).then(function(t){return t&&Sr(t)})},t.set=function(t,e){return Yt(this.a.setItem(t,Tr(e)))},t.S=function(t){return Yt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Qs,Hs=[];function Gs(t,e,n){Q(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function zs(t){this.a=t}function Ys(t){this.c=t,this.b=!1,this.a=[]}function Xs(r,t,e,n){var i,o,a,s,u=e||{},c=null;if(r.b)return Xt(Error("connection_unavailable"));var h=n?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new jt(function(e,n){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){n(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){n(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?e(t.data.response):n(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),n(Error("invalid_response"))))}},r.a.push(c),l.port1.addEventListener("message",o),r.c.postMessage({eventType:t,eventId:i,data:u},[l.port2])):n(Error("connection_unavailable"))}).then(function(t){return Js(r,c),t}).s(function(t){throw Js(r,c),t})}function Js(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),B(t.a,function(t){return t==e})}}function $s(){if(!eu())throw new Yr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=l.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var r=this;sr()&&self?(this.l=function(){var e=sr()?self:null;if(L(Hs,function(t){t.b==e&&(n=t)}),!n){var n=new Ks(e);Hs.push(n)}return n}(),Gs(this.l,"keyChanged",function(t,n){return au(r).then(function(e){return 0<e.length&&L(r.a,function(t){t(e)}),{keyProcessed:V(e,n.key)}})}),Gs(this.l,"ping",function(){return Yt(["keyChanged"])})):function(){var t=l.navigator;return t&&t.serviceWorker?Yt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Yt(null)}().then(function(t){(r.h=t)&&(r.g=new Ys(new zs(t)),Xs(r.g,"ping",null,!0).then(function(t){t[0].fulfilled&&V(t[0].value,"keyChanged")&&(r.o=!0)}).s(function(){}))})}function Zs(r){return new jt(function(e,n){var t=r.u.open("firebaseLocalStorageDb",1);t.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},t.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},t.onsuccess=function(t){(t=t.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(t):function(r){return new jt(function(t,e){var n=r.u.deleteDatabase("firebaseLocalStorageDb");n.onsuccess=function(){t()},n.onerror=function(t){e(Error(t.target.error))}})}(r).then(function(){return Zs(r)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function tu(t){return t.m||(t.m=Zs(t)),t.m}function eu(){try{return!!l.indexedDB}catch(t){return!1}}function nu(t){return t.objectStore("firebaseLocalStorage")}function ru(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function iu(t){return new jt(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function ou(t,e){return t.g&&t.h&&function(){var t=l.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Xs(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):Yt()}function au(r){return tu(r).then(function(t){var i=nu(ru(t,!1));return i.getAll?iu(i.getAll()):new jt(function(e,n){var r=[],t=i.openCursor();t.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},t.onerror=function(t){n(t.target.error)}})}).then(function(t){var e={},n=[];if(0==r.b){for(n=0;n<t.length;n++)e[t[n].fbase_key]=t[n].value;n=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(r.c,e),r.c=e}return n})}function su(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function uu(t){var r=this,i=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Yt().then(function(){if(eu()){var e=Ir(),n="__sak"+e;return Qs=Qs||new $s,(i=Qs).set(n,e).then(function(){return i.get(n)}).then(function(t){if(t!==e)throw Error("indexedDB not supported!");return i.S(n)}).then(function(){return i}).s(function(){return r.c})}return r.c}).then(function(t){return r.type=t.type,t.$(function(e){L(r.a,function(t){t(e)})}),t})}function cu(){this.a={},this.type="inMemory"}function hu(){if(!function(){var t="Node"==ur();if(!(t=lu()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The LocalStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=lu()||fl.INTERNAL.node.localStorage,this.type="localStorage"}function lu(){try{var t=l.localStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function fu(){this.type="nullStorage"}function pu(){if(!function(){var t="Node"==ur();if(!(t=du()||t&&fl.INTERNAL.node&&fl.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==ur())throw new Yr("internal-error","The SessionStorage compatibility library was not found.");throw new Yr("web-storage-unsupported")}this.a=du()||fl.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function du(){try{var t=l.sessionStorage,e=Ir();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function mu(){var t={};t.Browser=vu,t.Node=bu,t.ReactNative=wu,t.Worker=_u,this.a=t[ur()]}Ks.prototype.c=function(n){var r=n.data.eventType,i=n.data.eventId,t=this.a[r];if(t&&0<t.length){n.ports[0].postMessage({status:"ack",eventId:i,eventType:r,response:null});var e=[];L(t,function(t){e.push(Yt().then(function(){return t(n.origin,n.data.data)}))}),$t(e).then(function(t){var e=[];L(t,function(t){e.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})}),L(e,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),n.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:e})})}},zs.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Ys.prototype.close=function(){for(;0<this.a.length;)Js(this,this.a[0]);this.b=!0},(t=$s.prototype).set=function(n,r){var i,o=!1,a=this;return tu(this).then(function(t){return iu((t=nu(ru(i=t,!0))).get(n))}).then(function(t){var e=nu(ru(i,!0));return t?(t.value=r,iu(e.put(t))):(a.b++,o=!0,(t={}).fbase_key=n,t.value=r,iu(e.add(t)))}).then(function(){return a.c[n]=r,ou(a,n)}).ka(function(){o&&a.b--})},t.get=function(e){return tu(this).then(function(t){return iu(nu(ru(t,!1)).get(e))}).then(function(t){return t&&t.value})},t.S=function(e){var n=!1,r=this;return tu(this).then(function(t){return n=!0,r.b++,iu(nu(ru(t,!0)).delete(e))}).then(function(){return delete r.c[e],ou(r,e)}).ka(function(){n&&r.b--})},t.$=function(t){0==this.a.length&&function(t){su(t),function e(){t.f=setTimeout(function(){t.i=au(t).then(function(e){0<e.length&&L(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e}),0==this.a.length&&su(this)},(t=uu.prototype).get=function(e){return this.b.then(function(t){return t.get(e)})},t.set=function(e,n){return this.b.then(function(t){return t.set(e,n)})},t.S=function(e){return this.b.then(function(t){return t.S(e)})},t.$=function(t){this.a.push(t)},t.ea=function(e){B(this.a,function(t){return t==e})},(t=cu.prototype).get=function(t){return Yt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Yt()},t.S=function(t){return delete this.a[t],Yt()},t.$=function(){},t.ea=function(){},(t=hu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Tr(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(t){l.window&&Ke(l.window,"storage",t)},t.ea=function(t){l.window&&Ge(l.window,"storage",t)},(t=fu.prototype).get=function(){return Yt(null)},t.set=function(){return Yt()},t.S=function(){return Yt()},t.$=function(){},t.ea=function(){},(t=pu.prototype).get=function(t){var e=this;return Yt().then(function(){return Sr(e.a.getItem(t))})},t.set=function(e,n){var r=this;return Yt().then(function(){var t=Tr(n);null===t?r.S(e):r.a.setItem(e,t)})},t.S=function(t){var e=this;return Yt().then(function(){e.a.removeItem(t)})},t.$=function(){},t.ea=function(){};var yu,gu,vu={C:hu,Ta:pu},bu={C:hu,Ta:pu},wu={C:Ws,Ta:fu},_u={C:hu,Ta:fu},Tu={ad:"local",NONE:"none",cd:"session"};function Eu(){var t=!(Cr(mr())||!ar()),e=_r(),n=gr();this.m=t,this.h=e,this.l=n,this.a={},t=yu=yu||new mu;try{this.g=!Xn()&&Rr()||!l.indexedDB?new t.a.C:new uu(sr()?new cu:new t.a.C)}catch(t){this.g=new cu,this.h=!0}try{this.i=new t.a.Ta}catch(t){this.i=new cu}this.u=new cu,this.f=_(this.Pb,this),this.b={}}function Su(){return gu=gu||new Eu}function Iu(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Cu(t,e){return"firebase:"+t.name+(e?":"+e:"")}function Nu(t,e,n){return n=Cu(e,n),"local"==e.C&&(t.b[n]=null),Iu(t,e.C).S(n)}function Au(t){t.c&&(clearInterval(t.c),t.c=null)}function ku(t){this.a=t,this.b=Su()}(t=Eu.prototype).get=function(t,e){return Iu(this,t.C).get(Cu(t,e))},t.set=function(e,t,n){var r=Cu(e,n),i=this,o=Iu(this,e.C);return o.set(r,t).then(function(){return o.get(r)}).then(function(t){"local"==e.C&&(i.b[r]=t)})},t.addListener=function(t,e,n){t=Cu(t,e),this.l&&(this.b[t]=l.localStorage.getItem(t)),Q(this.a)&&(Iu(this,"local").$(this.f),this.h||(Xn()||!Rr())&&l.indexedDB||!this.l||function(r){Au(r),r.c=setInterval(function(){for(var t in r.a){var e=l.localStorage.getItem(t),n=r.b[t];e!=n&&(r.b[t]=e,e=new Pe({type:"storage",key:t,target:window,oldValue:n,newValue:e,a:!0}),r.Pb(e))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Cu(t,e),this.a[t]&&(B(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),Q(this.a)&&(Iu(this,"local").ea(this.f),Au(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.$a(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Iu(this,"local").ea(this.f):Au(this),this.m)if(n=l.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?l.localStorage.setItem(e,r):l.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===l.localStorage.getItem(e)||(o.b[e]=l.localStorage.getItem(e),o.$a(e))},ye&&Ie&&10==Ie&&l.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else L(t,_(this.$a,this))},t.$a=function(t){this.a[t]&&L(this.a[t],function(t){t()})};var Du,Ru={name:"authEvent",C:"local"};function Ou(){this.a=Su()}function Pu(t,e){this.b=Mu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=l.Int32Array?new Int32Array(64):Array(64),void 0!==Du||(Du=l.Int32Array?new Int32Array(Bu):Bu),this.reset()}S(Pu,function(){this.b=-1});for(var Mu=64,xu=Mu-1,Lu=[],Fu=0;Fu<xu;Fu++)Lu[Fu]=0;var Uu=j(128,Lu);function Vu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;e<64;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;e<64;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Du[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function qu(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(h(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Vu(t),i=0);else{if(!m(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&o<=255&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Vu(t),i=0)}}t.c=i,t.g+=n}Pu.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):W(this.h)};var Bu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function ju(){Pu.call(this,8,Wu)}S(ju,Pu);var Wu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Ku(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Ou,this.g=new ku(this.h),this.f=null,this.b=[],this.a=this.c=null}function Qu(t){return new Yr("invalid-cordova-configuration",t)}function Hu(t){var e=new ju;qu(e,t),t=[];var n=8*e.g;e.c<56?qu(e,Uu,56-e.c):qu(e,Uu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Vu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return F(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Gu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function zu(r){return r.f||(r.f=r.ia().then(function(){return new jt(function(n){r.Aa(function t(e){return n(e),r.Na(t),!1}),function(i){function e(r){t=!0,n&&n.cancel(),Yu(i).then(function(t){var e=o;if(t&&r&&r.url){var n=null;-1!=(e=Bi(r.url)).indexOf("/__/auth/callback")&&(n=(n="object"==typeof(n=Sr(wn(n=_n(e),"firebaseError")||null))?Xr(n):null)?new wo(t.c,t.b,null,null,n,null,t.R()):new wo(t.c,t.b,e,t.f,null,null,t.R())),e=n||o}Gu(i,e)})}var o=new wo("unknown",null,null,null,new Yr("no-auth-event")),t=!1,n=un(500).then(function(){return Yu(i).then(function(){t||Gu(i,o)})}),r=l.handleOpenURL;l.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(yr("BuildInfo.packageName",l).toLowerCase()+"://")&&e({url:t}),"function"==typeof r)try{r(t)}catch(t){console.error(t)}},So=So||new To,function(t){var n=So;n.a.push(t),n.b||(n.b=function(t){for(var e=0;e<n.a.length;e++)n.a[e](t)},"function"==typeof(t=yr("universalLinks.subscribe",l))&&t(null,n.b))}(e)}(r)})})),r.f}function Yu(e){var n=null;return function(t){return t.b.get(Ru,t.a).then(function(t){return _o(t)})}(e.g).then(function(t){return n=t,Nu((t=e.g).b,Ru,t.a)}).then(function(){return n})}function Xu(t){this.a=t,this.b=Su()}(t=Ku.prototype).ia=function(){return this.Da?this.Da:this.Da=(or(void 0)?ir().then(function(){return new jt(function(t,e){var n=l.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Xt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof yr("universalLinks.subscribe",l))throw Qu("cordova-universal-links-plugin-fix is not installed");if(void 0===yr("BuildInfo.packageName",l))throw Qu("cordova-plugin-buildinfo is not installed");if("function"!=typeof yr("cordova.plugins.browsertab.openUrl",l))throw Qu("cordova-plugin-browsertab is not installed");if("function"!=typeof yr("cordova.InAppBrowser.open",l))throw Qu("cordova-plugin-inappbrowser is not installed")},function(){throw new Yr("cordova-not-ready")})},t.Fb=function(t,e){return e(new Yr("operation-not-supported-in-this-environment")),Yt()},t.Db=function(){return Xt(new Yr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Xt(new Yr("redirect-operation-pending"));var i=this,o=l.document,a=null,s=null,u=null,c=null;return this.c=Yt().then(function(){return bo(e),zu(i)}).then(function(){return function(n,t,e,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),a=new wo(t,r,null,o,new Yr("no-auth-event"),null,i),s=yr("BuildInfo.packageName",l);if("string"!=typeof s)throw new Yr("invalid-cordova-configuration");var u=yr("BuildInfo.displayName",l),c={};if(mr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!mr().toLowerCase().match(/android/))return Xt(new Yr("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),o=Hu(o),c.sessionId=o;var h=js(n.u,n.i,n.l,t,e,null,r,n.m,c,n.o,i);return n.ia().then(function(){var t=n.h;return n.v.a.set(Ru,a.A(),t)}).then(function(){var t=yr("cordova.plugins.browsertab.isAvailable",l);if("function"!=typeof t)throw new Yr("invalid-cordova-configuration");var e=null;t(function(t){if(t){if("function"!=typeof(e=yr("cordova.plugins.browsertab.openUrl",l)))throw new Yr("invalid-cordova-configuration");e(h)}else{if("function"!=typeof(e=yr("cordova.InAppBrowser.open",l)))throw new Yr("invalid-cordova-configuration");t=mr(),n.a=e(h,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(i,t,e,n,r)}).then(function(){return new jt(function(e,t){s=function(){var t=yr("cordova.plugins.browsertab.close",l);return e(),"function"==typeof t&&t(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Aa(s),u=function(){a=a||un(2e3).then(function(){t(new Yr("redirect-cancelled-by-user"))})},c=function(){kr()&&u()},o.addEventListener("resume",u,!1),mr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",c,!1)}).s(function(t){return Yu(i).then(function(){throw t})})}).ka(function(){u&&o.removeEventListener("resume",u,!1),c&&o.removeEventListener("visibilitychange",c,!1),a&&a.cancel(),s&&i.Na(s),i.c=null})},t.Aa=function(e){this.b.push(e),zu(this).s(function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new wo("unknown",null,null,null,new Yr("no-auth-event")),e(t))})},t.Na=function(e){B(this.b,function(t){return t==e})};var Ju={name:"pendingRedirect",C:"session"};function $u(t){return Nu(t.b,Ju,t.a)}function Zu(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=_(this.o,this),this.b=new pc,this.w=new vc,this.g=new Xu(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=tc(this.B,this.u,this.m,Ii)}function tc(t,e,n,r){var i=fl.SDK_VERSION||null;return or()?new Ku(t,e,n,i,r):new Us(t,e,n,i,r)}function ec(e){e.f||(e.f=!0,e.a.Aa(e.l));var n=e.a;return e.a.ia().s(function(t){throw e.a==n&&e.reset(),t})}function nc(n){n.a.Ob()&&ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)}),n.a.Jb()||dc(n.b)}function rc(n,t){V(n.h,t)||n.h.push(t),n.f||function(t){return t.b.get(Ju,t.a).then(function(t){return"pending"==t})}(n.g).then(function(t){t?$u(n.g).then(function(){ec(n).s(function(t){var e=new wo("unknown",null,null,null,new Yr("operation-not-supported-in-this-environment"));uc(t)&&n.o(e)})}):nc(n)}).s(function(){nc(n)})}function ic(t,e){B(t.h,function(t){return t==e})}Zu.prototype.reset=function(){this.f=!1,this.a.Na(this.l),this.a=tc(this.B,this.u,this.m),this.i={}},Zu.prototype.o=function(t){if(!t)throw new Yr("invalid-auth-event");if(6e5<=E()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=E())),e=!0;break}}return dc(this.b),e};var oc=new Ar(2e3,1e4),ac=new Ar(3e4,6e4);function sc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.Aa(t.l))},function(){t.reset()},i,o,a)}function uc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function cc(e,t,n,r,i){var o;return function(t){return t.b.set(Ju,"pending",t.a)}(e.g).then(function(){return e.a.Eb(t,n,r,i).s(function(t){if(uc(t))throw new Yr("operation-not-supported-in-this-environment");return o=t,$u(e.g).then(function(){throw o})}).then(function(){return e.a.Rb()?new jt(function(){}):$u(e.g).then(function(){return e.oa()}).then(function(){}).s(function(){})})})}function hc(t,e,n,r,i){return t.a.Fb(r,function(t){e.ja(n,null,t,i)},oc.get())}Zu.prototype.oa=function(){return this.b.oa()};var lc={};function fc(t,e,n){var r=e+":"+n;return lc[r]||(lc[r]=new Zu(t,e,n)),lc[r]}function pc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function dc(t){t.g||(t.g=!0,gc(t,!1,null,null))}function mc(t){t.g&&!t.i&&gc(t,!1,null,null)}function yc(t,e){if(t.b=function(){return Yt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function gc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Xt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):yc(t,n):yc(t,{user:null}),t.f=[],t.c=[]}function vc(){}function bc(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function wc(t,e){this.a=e,Lr(this,"verificationId",t)}function _c(t,e,n,r){return new yo(t).Wa(e,n).then(function(t){return new wc(t,r)})}function Tc(t){var e=Si(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Yr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Fr(this,{token:t,expirationTime:Dr(1e3*e.exp),authTime:Dr(1e3*e.auth_time),issuedAtTime:Dr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Ec(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Sc(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}function Ic(t){this.f=t,this.b=this.a=null,this.c=0}function Cc(t,e){var n=e[Oa],r=e.refreshToken;e=Nc(e.expiresIn),t.b=n,t.c=e,t.a=r}function Nc(t){return E()+1e3*parseInt(t,10)}function Ac(e,t){return function(t,r){return new jt(function(e,n){"refresh_token"==r.grant_type&&r.refresh_token||"authorization_code"==r.grant_type&&r.code?Va(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?n(ks(t)):t.access_token&&t.refresh_token?e(t):n(new Yr("internal-error")):n(new Yr("network-request-failed"))},"POST",Pn(r).toString(),t.g,t.u.get()):n(new Yr("internal-error"))})}(e.f,t).then(function(t){return e.b=t.access_token,e.c=Nc(t.expires_in),e.a=t.refresh_token,{accessToken:e.b,expirationTime:e.c,refreshToken:e.a}}).s(function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t})}function kc(t,e){this.a=t||null,this.b=e||null,Fr(this,{lastSignInTime:Dr(e||null),creationTime:Dr(t||null)})}function Dc(t,e,n,r,i,o){Fr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Rc(t,e){for(var n in Oe.call(this,t),e)this[n]=e[n]}function Oc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.a=new Da(this.l,Ni(Ii),t),this.b=new Ic(this.a),Vc(this,e[Oa]),Cc(this.b,e),Lr(this,"refreshToken",this.b.a),jc(this,n||{}),nn.call(this),this.J=!1,this.o&&vr()&&(this.i=fc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(e){return new Ec(function(){return e.G(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var t=e.b.c-E()-3e5;return 0<t?t:0})}(this),this.W=_(this.Ja,this);var r=this;this.ga=null,this.xa=function(t){r.ua(t.g)},this.Z=null,this.P=[],this.wa=function(t){Mc(r,t.c)},this.Y=null}function Pc(t,e){t.Z&&Ge(t.Z,"languageCodeChanged",t.xa),(t.Z=e)&&Ke(e,"languageCodeChanged",t.xa)}function Mc(t,e){t.P=e,Ua(t.a,fl.SDK_VERSION?dr(fl.SDK_VERSION,t.P):null)}function xc(t,e){t.Y&&Ge(t.Y,"frameworkChanged",t.wa),(t.Y=e)&&Ke(e,"frameworkChanged",t.wa)}function Lc(e){try{return fl.app(e.m).auth()}catch(t){throw new Yr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Fc(t){t.B||t.w.b||(t.w.start(),Ge(t,"tokenChanged",t.W),Ke(t,"tokenChanged",t.W))}function Uc(t){Ge(t,"tokenChanged",t.W),t.w.stop()}function Vc(t,e){t.ma=e,Lr(t,"_lat",e)}function qc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return $t(e).then(function(){return t})}function Bc(t){t.i&&!t.J&&(t.J=!0,rc(t.i,t))}function jc(t,e){Fr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new kc(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function Wc(){}function Kc(t){return Yt().then(function(){if(t.B)throw new Yr("app-deleted")})}function Qc(t){return F(t.providerData,function(t){return t.providerId})}function Hc(t,e){e&&(Gc(t,e.providerId),t.providerData.push(e))}function Gc(t,e){B(t.providerData,function(t){return t.providerId==e})}function zc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Lr(t,e,n)}function Yc(e,t){e!=t&&(Fr(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?Lr(e,"metadata",function(t){return new kc(t.a,t.b)}(t.metadata)):Lr(e,"metadata",new kc),L(t.providerData,function(t){Hc(e,t)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(e.b,t.b),Lr(e,"refreshToken",e.b.a))}function Xc(n){return n.G().then(function(t){var e=n.isAnonymous;return function(t,e){return Ns(t.a,us,{idToken:e}).then(_(t.zc,t))}(n,t).then(function(){return e||zc(n,"isAnonymous",!1),t})})}function Jc(t,e){e[Oa]&&t.ma!=e[Oa]&&(Cc(t.b,e),t.dispatchEvent(new Rc("tokenChanged")),Vc(t,e[Oa]),zc(t,"refreshToken",t.b.a))}function $c(t,e){return Xc(t).then(function(){if(V(Qc(t),e))return qc(t).then(function(){throw new Yr("provider-already-linked")})})}function Zc(t,e,n){return Ur({user:t,credential:vo(e),additionalUserInfo:e=Oi(e),operationType:n})}function th(t,e){return Jc(t,e),t.reload().then(function(){return t})}function eh(n,r,t,e,i){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(n.h&&!i)return Xt(n.h);var o=Ri(t.providerId),a=Ir(n.uid+":::"),s=null;(!_r()||ar())&&n.o&&t.isOAuthProvider&&(s=js(n.o,n.l,n.m,r,t,null,a,fl.SDK_VERSION||null,null,null,n.tenantId));var u=er(s,o&&o.sa,o&&o.ra);return e=e().then(function(){if(rh(n),!i)return n.G().then(function(){})}).then(function(){return sc(n.i,u,r,t,a,!!s,n.tenantId)}).then(function(){return new jt(function(t,e){n.ja(r,null,new Yr("cancelled-popup-request"),n.g||null),n.f=t,n.v=e,n.g=a,n.c=hc(n.i,n,r,u,a)})}).then(function(t){return u&&tr(u),t?Ur(t):null}).s(function(t){throw u&&tr(u),t}),ih(n,e,i)}function nh(e,t,n,r,i){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));if(e.h&&!i)return Xt(e.h);var o=null,a=Ir(e.uid+":::");return r=r().then(function(){if(rh(e),!i)return e.G().then(function(){})}).then(function(){return e.ca=a,qc(e)}).then(function(t){return e.da&&(t=(t=e.da).b.set(sh,e.A(),t.a)),t}).then(function(){return cc(e.i,t,n,a,e.tenantId)}).s(function(t){if(o=t,e.da)return uh(e.da);throw o}).then(function(){if(o)throw o}),ih(e,r,i)}function rh(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Yr("internal-error");throw new Yr("auth-domain-config-required")}}function ih(t,e,n){var r=function(e,t,n){return e.h&&!n?(t.cancel(),Xt(e.h)):t.s(function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new Rc("userInvalidated")),e.h=t),t})}(t,e,n);return t.I.push(r),r.ka(function(){q(t.I,r)}),r}function oh(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Oa]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-E())/1e3;var r=new Oc(e,n,t);return t.providerData&&L(t.providerData,function(t){t&&Hc(r,Ur(t))}),t.redirectEventId&&(r.ca=t.redirectEventId),r}function ah(t){this.a=t,this.b=Su()}pc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},pc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(gc(this,!0,null,t.a),Yt()):e.Ba(n,r)?function(e,t,n){n=n.Ba(t.c,t.b);var r=t.g,i=t.f,o=t.i,a=t.R(),s=!!t.c.match(/Redirect$/);n(r,i,a,o).then(function(t){gc(e,s,t,null)}).s(function(t){gc(e,s,null,t)})}(this,t,e):Xt(new Yr("invalid-auth-event")):(gc(this,!1,null,null),Yt())}else Xt(new Yr("invalid-auth-event"))},pc.prototype.oa=function(){var n=this;return new jt(function(t,e){n.b?n.b().then(t,e):(n.f.push(t),n.c.push(e),function(t){var e=new Yr("timeout");t.a&&t.a.cancel(),t.a=un(ac.get()).then(function(){t.b||(t.g=!0,gc(t,!0,null,e))})}(n))})},vc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Yt()):e.Ba(n,r)?function(t,e){var n=t.b,r=t.c;e.Ba(r,n)(t.g,t.f,t.R(),t.i).then(function(t){e.ja(r,t,null,n)}).s(function(t){e.ja(r,null,t,n)})}(t,e):Xt(new Yr("invalid-auth-event"))}else Xt(new Yr("invalid-auth-event"))},wc.prototype.confirm=function(t){return t=go(this.verificationId,t),this.a(t)},Ec.prototype.start=function(){this.a=this.c,function e(n,t){n.stop();n.b=un(Sc(n,t)).then(function(){return e=l.document,n=null,kr()||!e?Yt():new jt(function(t){n=function(){kr()&&(e.removeEventListener("visibilitychange",n,!1),t())},e.addEventListener("visibilitychange",n,!1)}).s(function(t){throw e.removeEventListener("visibilitychange",n,!1),t});var e,n}).then(function(){return n.h()}).then(function(){e(n,!0)}).s(function(t){n.i(t)&&e(n,!1)})}(this,!0)},Ec.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Ic.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Ic.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Xt(new Yr("user-token-expired")):t||!this.b||E()>this.c-3e4?this.a?Ac(this,{grant_type:"refresh_token",refresh_token:this.a}):Yt(null):Yt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},kc.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},S(Rc,Oe),S(Oc,nn),Oc.prototype.ua=function(t){this.ga=t,Fa(this.a,t)},Oc.prototype.ha=function(){return this.ga},Oc.prototype.Ca=function(){return W(this.P)},Oc.prototype.Ja=function(){this.w.b&&(this.w.stop(),this.w.start())},Lr(Oc.prototype,"providerId","firebase"),(t=Oc.prototype).reload=function(){var t=this;return ih(this,Kc(this).then(function(){return Xc(t).then(function(){return qc(t)}).then(Wc)}))},t.dc=function(t){return this.G(t).then(function(t){return new Tc(t)})},t.G=function(t){var e=this;return ih(this,Kc(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new Yr("internal-error");return t.accessToken!=e.ma&&(Vc(e,t.accessToken),e.dispatchEvent(new Rc("tokenChanged"))),zc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Yr("internal-error");jc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?F(t,function(t){return new Dc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Hc(this,e[n]);zc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return Mr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.hb(t)},t.hb=function(t){var e=this,n=null;return ih(this,t.f(this.a,this.uid).then(function(t){return Jc(e,t),n=Zc(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.rc=function(t){return Mr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.fb(t)},t.fb=function(e){var n=this,r=null;return ih(this,$c(this,e.providerId).then(function(){return n.G()}).then(function(t){return e.b(n.a,t)}).then(function(t){return r=Zc(n,t,"link"),th(n,t)}).then(function(){return r}))},t.sc=function(t,e){var n=this;return ih(this,$c(this,"phone").then(function(){return _c(Lc(n),t,e,_(n.fb,n))}))},t.Bc=function(t,e){var n=this;return ih(this,Yt().then(function(){return _c(Lc(n),t,e,_(n.hb,n))}),!0)},t.rb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.rb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.Sc=function(e){var n=this;return ih(this,this.G().then(function(t){return e.b(n.a,t)}).then(function(t){return Jc(n,t),n.reload()}))},t.sb=function(e){var n=this;return ih(this,this.G().then(function(t){return n.a.sb(t,e)}).then(function(t){return Jc(n,t),n.reload()}))},t.tb=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return Kc(this);var n=this;return ih(this,this.G().then(function(t){return n.a.tb(t,{displayName:e.displayName,photoUrl:e.photoURL})}).then(function(t){return Jc(n,t),zc(n,"displayName",t.displayName||null),zc(n,"photoURL",t.photoUrl||null),L(n.providerData,function(t){"password"===t.providerId&&(Lr(t,"displayName",n.displayName),Lr(t,"photoURL",n.photoURL))}),qc(n)}).then(Wc))},t.Qc=function(e){var n=this;return ih(this,Xc(this).then(function(t){return V(Qc(n),e)?function(t,e,n){return Ns(t,os,{idToken:e,deleteProvider:n})}(n.a,t,[e]).then(function(t){var e={};return L(t.providerUserInfo||[],function(t){e[t.providerId]=!0}),L(Qc(n),function(t){e[t]||Gc(n,t)}),e[yo.PROVIDER_ID]||Lr(n,"phoneNumber",null),qc(n)}):qc(n).then(function(){throw new Yr("no-such-provider")})}))},t.delete=function(){var e=this;return ih(this,this.G().then(function(t){return Ns(e.a,is,{idToken:t})}).then(function(){e.dispatchEvent(new Rc("userDeleted"))})).then(function(){for(var t=0;t<e.I.length;t++)e.I[t].cancel("app-deleted");Pc(e,null),xc(e,null),e.I=[],e.B=!0,Uc(e),Lr(e,"refreshToken",null),e.i&&ic(e.i,e)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?_(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?_(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?_(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?_(this.Cb,this):null},t.tc=function(t){var e=this;return eh(this,"linkViaPopup",t,function(){return $c(e,t.providerId).then(function(){return qc(e)})},!1)},t.Cc=function(t){return eh(this,"reauthViaPopup",t,function(){return Yt()},!0)},t.uc=function(t){var e=this;return nh(this,"linkViaRedirect",t,function(){return $c(e,t.providerId)},!1)},t.Dc=function(t){return nh(this,"reauthViaRedirect",t,function(){return Yt()},!0)},t.Bb=function(e,n,t,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return t=this.G().then(function(t){return Ja(i.a,{requestUri:e,postBody:r,sessionId:n,idToken:t})}).then(function(t){return o=Zc(i,t,"link"),th(i,t)}).then(function(){return o}),ih(this,t)},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return ih(this,Yt().then(function(){return Wi($a(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)}).then(function(t){return o=Zc(i,t,"reauthenticate"),Jc(i,t),i.h=null,i.reload()}).then(function(){return o}),!0)},t.jb=function(e){var n=this,r=null;return ih(this,this.G().then(function(t){return r=t,void 0===e||Q(e)?{}:vi(new ui(e))}).then(function(t){return n.a.jb(r,t)}).then(function(t){if(n.email!=t)return n.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&z(e,this.metadata.A()),L(this.providerData,function(t){e.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(t))}),e};var sh={name:"redirectUser",C:"session"};function uh(t){return Nu(t.b,sh,t.a)}function ch(t){this.a=t,this.b=Su(),this.c=null,this.f=function(e){var n=fh("local"),r=fh("session"),i=fh("none");return function(n,r,i){var o=Cu(r,i),a=Iu(n,r.C);return n.get(r,i).then(function(t){var e=null;try{e=Sr(l.localStorage.getItem(o))}catch(t){}if(e&&!t)return l.localStorage.removeItem(o),n.set(r,e,i);e&&t&&"localStorage"!=a.type&&l.localStorage.removeItem(o)})}(e.b,n,e.a).then(function(){return e.b.get(r,e.a)}).then(function(t){return t?r:e.b.get(i,e.a).then(function(t){return t?i:e.b.get(n,e.a).then(function(t){return t?n:e.b.get(lh,e.a).then(function(t){return t?fh(t):n})})})}).then(function(t){return e.c=t,hh(e,t.C)}).s(function(){e.c||(e.c=n)})}(this),this.b.addListener(fh("local"),this.a,_(this.g,this))}function hh(t,e){var n,r=[];for(n in Tu)Tu[n]!==e&&r.push(Nu(t.b,fh(Tu[n]),t.a));return r.push(Nu(t.b,lh,t.a)),function(s){return new jt(function(n,e){var r=s.length,i=[];if(r)for(var t=function(t,e){r--,i[t]=e,0==r&&n(i)},o=function(t){e(t)},a=0;a<s.length;a++)Jt(s[a],T(t,a),o);else n(i)})}(r)}ch.prototype.g=function(){var e=this,n=fh("local");yh(this,function(){return Yt().then(function(){return e.c&&"local"!=e.c.C?e.b.get(n,e.a):null}).then(function(t){if(t)return hh(e,"local").then(function(){e.c=n})})})};var lh={name:"persistence",C:"session"};function fh(t){return{name:"authUser",C:t}}function ph(t,e){return yh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function dh(t){return yh(t,function(){return Nu(t.b,t.c,t.a)})}function mh(t,e){return yh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})})}function yh(t,e){return t.f=t.f.then(e,e),t.f}function gh(t){if(this.l=!1,Lr(this,"settings",new bc),Lr(this,"app",t),!Ih(this).options||!Ih(this).options.apiKey)throw new Yr("invalid-api-key");t=fl.SDK_VERSION?dr(fl.SDK_VERSION):null,this.b=new Da(Ih(this).options&&Ih(this).options.apiKey,Ni(Ii),t),this.O=[],this.m=[],this.J=[],this.Ub=fl.INTERNAL.createSubscribe(_(this.oc,this)),this.W=void 0,this.Vb=fl.INTERNAL.createSubscribe(_(this.pc,this)),Eh(this,null),this.h=new ch(Ih(this).options.apiKey+":"+Ih(this).name),this.w=new ah(Ih(this).options.apiKey+":"+Ih(this).name),this.Y=kh(this,function(n){var t=Ih(n).options.authDomain,e=function(e){var t=function(t,e){return t.b.get(sh,t.a).then(function(t){return t&&e&&(t.authDomain=e),oh(t||{})})}(e.w,Ih(e).options.authDomain).then(function(t){return(e.B=t)&&(t.da=e.w),uh(e.w)});return kh(e,t)}(n).then(function(){return mh(n.h,t)}).then(function(e){return e?(e.da=n.w,n.B&&(n.B.ca||null)==(e.ca||null)?e:e.reload().then(function(){return ph(n.h,e).then(function(){return e})}).s(function(t){return"auth/network-request-failed"==t.code?e:dh(n.h)})):null}).then(function(t){Eh(n,t||null)});return kh(n,e)}(this)),this.i=kh(this,function(e){return e.Y.then(function(){return _h(e)}).s(function(){}).then(function(){if(!e.l)return e.ma()}).s(function(){}).then(function(){if(!e.l){e.ga=!0;var t=e.h;t.b.addListener(fh("local"),t.a,e.ma)}})}(this)),this.ga=!1,this.ma=_(this.Nc,this),this.ub=_(this.aa,this),this.wa=_(this.bc,this),this.xa=_(this.mc,this),this.Ja=_(this.nc,this),this.a=null,function(e){var n=Ih(e).options.authDomain,r=Ih(e).options.apiKey;n&&vr()&&(e.Tb=e.Y.then(function(){if(!e.l){if(e.a=fc(n,r,Ih(e).name),rc(e.a,e),Ch(e)&&Bc(Ch(e)),e.B){Bc(e.B);var t=e.B;t.ua(e.ha()),Pc(t,e),Mc(t=e.B,e.I),xc(t,e),e.B=null}return e.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=_(this.delete,this),this.INTERNAL.logFramework=_(this.vc,this),this.o=0,nn.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.ua(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function vh(t){Oe.call(this,"languageCodeChanged"),this.g=t}function bh(t){Oe.call(this,"frameworkChanged"),this.c=t}function wh(t){return t.Tb||Xt(new Yr("auth-domain-config-required"))}function _h(t){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=wh(t).then(function(){return t.a.oa()}).then(function(t){return t?Ur(t):null});return kh(t,e)}function Th(e,t){var n={};return n.apiKey=Ih(e).options.apiKey,n.authDomain=Ih(e).options.authDomain,n.appName=Ih(e).name,e.Y.then(function(){return function(t,e,n,r){var i=new Oc(t,e);return n&&(i.da=n),r&&Mc(i,r),i.reload().then(function(){return i})}(n,t,e.w,e.Ca())}).then(function(t){return Ch(e)&&t.uid==Ch(e).uid?Yc(Ch(e),t):(Eh(e,t),Bc(t)),e.aa(t)}).then(function(){Ah(e)})}function Eh(t,e){Ch(t)&&(function(t,e){B(t.O,function(t){return t==e})}(Ch(t),t.ub),Ge(Ch(t),"tokenChanged",t.wa),Ge(Ch(t),"userDeleted",t.xa),Ge(Ch(t),"userInvalidated",t.Ja),Uc(Ch(t))),e&&(e.O.push(t.ub),Ke(e,"tokenChanged",t.wa),Ke(e,"userDeleted",t.xa),Ke(e,"userInvalidated",t.Ja),0<t.o&&Fc(e)),Lr(t,"currentUser",e),e&&(e.ua(t.ha()),Pc(e,t),Mc(e,t.I),xc(e,t))}function Sh(e,t){var n=null,r=null;return kh(e,t.then(function(t){return n=vo(t),r=Oi(t),Th(e,t)}).then(function(){return Ur({user:Ch(e),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Ih(t){return t.app}function Ch(t){return t.currentUser}function Nh(t){return Ch(t)&&Ch(t)._lat||null}function Ah(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Nh(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Nh(t))}}function kh(t,e){return t.O.push(e),e.ka(function(){q(t.O,e)}),e}function Dh(){}function Rh(){this.a={},this.b=1e12}ch.prototype.mb=function(e){var n=null,r=this;return function(t){var e=new Yr("invalid-persistence-type"),n=new Yr("unsupported-persistence-type");t:{for(r in Tu)if(Tu[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(ur()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!gr()&&"none"!==t)throw n}}(e),yh(this,function(){return e!=r.c.C?r.b.get(r.c,r.a).then(function(t){return n=t,hh(r,e)}).then(function(){if(r.c=fh(e),n)return r.b.set(r.c,n,r.a)}):Yt()})},S(gh,nn),S(vh,Oe),S(bh,Oe),(t=gh.prototype).mb=function(t){return t=this.h.mb(t),kh(this,t)},t.ua=function(t){this.Z===t||this.l||(this.Z=t,Fa(this.b,this.Z),this.dispatchEvent(new vh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=l.navigator;this.ua(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Ua(this.b,fl.SDK_VERSION?dr(fl.SDK_VERSION,this.I):null),this.dispatchEvent(new bh(this.I))},t.Ca=function(){return W(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:Ih(this).options.apiKey,authDomain:Ih(this).options.authDomain,appName:Ih(this).name,currentUser:Ch(this)&&Ch(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.Ba=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?_(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Xa(i.b,t).then(function(t){return o=vo(t),a=Oi(t),t});return kh(this,t=i.Y.then(function(){return s}).then(function(t){return Th(i,t)}).then(function(){return Ur({user:Ch(i),credential:o,additionalUserInfo:a,operationType:"signIn"})}))},t.Lc=function(e){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var n=this,t=Ri(e.providerId),r=Ir(),i=null;(!_r()||ar())&&Ih(this).options.authDomain&&e.isOAuthProvider&&(i=js(Ih(this).options.authDomain,Ih(this).options.apiKey,Ih(this).name,"signInViaPopup",e,null,r,fl.SDK_VERSION||null,null,null,this.R()));var o=er(i,t&&t.sa,t&&t.ra);return kh(this,t=wh(this).then(function(t){return sc(t,o,"signInViaPopup",e,r,!!i,n.R())}).then(function(){return new jt(function(t,e){n.ja("signInViaPopup",null,new Yr("cancelled-popup-request"),n.g),n.f=t,n.v=e,n.g=r,n.c=hc(n.a,n,"signInViaPopup",o,r)})}).then(function(t){return o&&tr(o),t?Ur(t):null}).s(function(t){throw o&&tr(o),t}))},t.Mc=function(t){if(!vr())return Xt(new Yr("operation-not-supported-in-this-environment"));var e=this;return kh(this,wh(this).then(function(){return function(t){return yh(t,function(){return t.b.set(lh,t.c.C,t.a)})}(e.h)}).then(function(){return cc(e.a,"signInViaRedirect",t,void 0,e.R())}))},t.oa=function(){var e=this;return _h(this).then(function(t){return e.a&&mc(e.a.b),t}).s(function(t){throw e.a&&mc(e.a.b),t})},t.Rc=function(t){if(!t)return Xt(new Yr("null-user"));if(this.P!=t.tenantId)return Xt(new Yr("tenant-id-mismatch"));var e=this,n={};n.apiKey=Ih(this).options.apiKey,n.authDomain=Ih(this).options.authDomain,n.appName=Ih(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Oa]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-E())/1e3,e=new Oc(e,o),n&&(e.da=n),r&&Mc(e,r),Yc(e,t),e}(t,n,e.w,e.Ca());return kh(this,this.i.then(function(){if(Ih(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Ch(e)&&t.uid==Ch(e).uid?(Yc(Ch(e),t),e.aa(t)):(Eh(e,r),Bc(r),e.aa(r))}).then(function(){Ah(e)}))},t.pb=function(){var t=this,e=this.i.then(function(){return t.a&&mc(t.a.b),Ch(t)?(Eh(t,null),dh(t.h).then(function(){Ah(t)})):Yt()});return kh(this,e)},t.Nc=function(){var r=this;return mh(this.h,Ih(this).options.authDomain).then(function(t){if(!r.l){var e;if(e=Ch(r)&&t){e=Ch(r).uid;var n=t.uid;e=null!=e&&""!==e&&null!=n&&""!==n&&e==n}if(e)return Yc(Ch(r),t),Ch(r).G();(Ch(r)||t)&&(Eh(r,t),t&&(Bc(t),t.da=r.w),r.a&&rc(r.a,r),Ah(r))}})},t.aa=function(t){return ph(this.h,t)},t.bc=function(){Ah(this),this.aa(Ch(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Ch(e))})},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),kh(t,t.i.then(function(){!t.l&&V(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Nh(t)))}))}(this,function(){t.next(Ch(e))})},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){y(t)?t(Ch(r)):y(t.next)&&t.next(Ch(r))}),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){r.W=r.getUid(),y(t)?t(Ch(r)):y(t.next)&&t.next(Ch(r))}),this.Vb(t,e,n)},t.cc=function(t){var e=this,n=this.i.then(function(){return Ch(e)?Ch(e).G(t).then(function(t){return{accessToken:t}}):null});return kh(this,n)},t.Hc=function(t){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Ts,{token:t}))}).then(function(t){var e=t.user;return zc(e,"isAnonymous",!1),n.aa(e),t})},t.Ic=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,Es,{email:t,password:e}))})},t.Xb=function(t,e){var n=this;return this.i.then(function(){return Sh(n,Ns(n.b,ns,{email:t,password:e}))})},t.Sa=function(t){var e=this;return this.i.then(function(){return Sh(e,t.na(e.b))})},t.Gc=function(t){return Mr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Sa(t)},t.ob=function(){var n=this;return this.i.then(function(){var t=Ch(n);return t&&t.isAnonymous?Ur({user:t,credential:null,additionalUserInfo:Ur({providerId:null,isNewUser:!1}),operationType:"signIn"}):Sh(n,n.b.ob()).then(function(t){var e=t.user;return zc(e,"isAnonymous",!0),n.aa(e),t})})},t.getUid=function(){return Ch(this)&&Ch(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Ch(this)&&Fc(Ch(this))},t.Ec=function(e){var n=this;L(this.m,function(t){t==e&&n.o--}),this.o<0&&(this.o=0),0==this.o&&Ch(this)&&Uc(Ch(this)),this.removeAuthTokenListener(e)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),kh(this,this.i.then(function(){e.l||V(e.m,t)&&t(Nh(e))}))},t.removeAuthTokenListener=function(e){B(this.m,function(t){return t==e})},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(fh("local"),t.a,this.ma),this.a&&(ic(this.a,this),mc(this.a.b)),Promise.resolve()},t.$b=function(t){return kh(this,function(t,e){return Ns(t,rs,{identifier:e,continueUri:br()?Jn():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!lo(t)},t.lb=function(e,n){var r=this;return kh(this,Yt().then(function(){var t=new ui(n);if(!t.c)throw new Yr("argument-error",li+" must be true when sending sign in link to email");return vi(t)}).then(function(t){return r.b.lb(e,t)}).then(function(){}))},t.Uc=function(t){return this.Ma(t).then(function(t){return t.data.email})},t.ab=function(t,e){return kh(this,this.b.ab(t,e).then(function(){}))},t.Ma=function(t){return kh(this,this.b.Ma(t).then(function(t){return new qr(t)}))},t.Ya=function(t){return kh(this,this.b.Ya(t).then(function(){}))},t.kb=function(e,t){var n=this;return kh(this,Yt().then(function(){return void 0===t||Q(t)?{}:vi(new ui(t))}).then(function(t){return n.b.kb(e,t)}).then(function(){}))},t.Kc=function(t,e){return kh(this,_c(this,t,e,_(this.Sa,this)))},t.Jc=function(n,r){var i=this;return kh(this,Yt().then(function(){var t=r||Jn(),e=ho(n,t);if(!(t=lo(t)))throw new Yr("argument-error","Invalid email link!");if(t.tenantId!==i.R())throw new Yr("tenant-id-mismatch");return i.Sa(e)}))},Dh.prototype.render=function(){},Dh.prototype.reset=function(){},Dh.prototype.getResponse=function(){},Dh.prototype.execute=function(){};var Oh=null;function Ph(t,e){return(e=Mh(e))&&t.a[e]||null}function Mh(t){return(t=void 0===t?1e12:t)?t.toString():null}function xh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=qn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ke(this.f,"click",this.i)}function Lh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Fh(){}Rh.prototype.render=function(t,e){return this.a[this.b.toString()]=new xh(t,e),this.b++},Rh.prototype.reset=function(t){var e=Ph(this,t);t=Mh(t),e&&t&&(e.delete(),delete this.a[t])},Rh.prototype.getResponse=function(t){return(t=Ph(this,t))?t.getResponse():null},Rh.prototype.execute=function(t){(t=Ph(this,t))&&t.execute()},xh.prototype.getResponse=function(){return Lh(this),this.b},xh.prototype.execute=function(){Lh(this);var n=this;this.a||(this.a=setTimeout(function(){n.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var t=n.c.callback,e=n.c["expired-callback"];if(t)try{t(n.b)}catch(t){}n.a=setTimeout(function(){if(n.a=null,n.b=null,e)try{e()}catch(t){}n.h&&n.execute()},6e4)},500))},xh.prototype.delete=function(){Lh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ge(this.f,"click",this.i)},Fh.prototype.g=function(){return Yt(Oh=Oh||new Rh)},Fh.prototype.c=function(){};var Uh=null;function Vh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var qh=new Y($,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Bh=new Ar(3e4,6e4);Vh.prototype.g=function(i){var o=this;return new jt(function(t,e){var r=setTimeout(function(){e(new Yr("network-request-failed"))},Bh.get());!l.grecaptcha||i!==o.f&&!o.b?(l[o.a]=function(){if(l.grecaptcha){o.f=i;var n=l.grecaptcha.render;l.grecaptcha.render=function(t,e){return t=n(t,e),o.b++,t},clearTimeout(r),t(l.grecaptcha)}else clearTimeout(r),e(new Yr("internal-error"));delete l[o.a]},Yt(Ea(nt(qh,{onload:o.a,hl:i||""}))).s(function(){clearTimeout(r),e(new Yr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(r),t(l.grecaptcha))})},Vh.prototype.c=function(){this.b--};var jh=null;function Wh(t,e,n,r,i,o,a){if(Lr(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,a=a?Uh=Uh||new Fh:jh=jh||new Vh,this.m=a,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Hh])throw new Yr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Gh],!l.document)throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!qn(e)||!this.i&&qn(e).hasChildNodes())throw new Yr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Da(t,o||null,i||null),this.v=r||function(){return null};var s=this;this.l=[];var u=this.a[Kh];this.a[Kh]=function(t){if(zh(s,t),"function"==typeof u)u(t);else if("string"==typeof u){var e=yr(u,l);"function"==typeof e&&e(t)}};var c=this.a[Qh];this.a[Qh]=function(){if(zh(s,null),"function"==typeof c)c();else if("string"==typeof c){var t=yr(c,l);"function"==typeof t&&t()}}}var Kh="callback",Qh="expired-callback",Hh="sitekey",Gh="size";function zh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Yh(t,e){return t.h.push(e),e.ka(function(){q(t.h,e)}),e}function Xh(t){if(t.B)throw new Yr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Jh(t,e,n){var r=!1;try{this.b=n||fl.app()}catch(t){throw new Yr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Yr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Ca()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=fl.SDK_VERSION?dr(fl.SDK_VERSION,o):null,Wh.call(this,n,t,e,function(){try{var e=i.b.auth().ha()}catch(t){e=null}return e},o,Ni(Ii),r)}function $h(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Yr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],i<0||i>=Zh.length)throw new Yr("internal-error","Argument validator received an unsupported number of arguments.");n=Zh[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new Yr("argument-error",t+" failed: "+r)}(t=Wh.prototype).Da=function(){var e=this;return this.f?this.f:this.f=Yh(this,Yt().then(function(){if(br()&&!sr())return ir();throw new Yr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return e.m.g(e.v())}).then(function(t){return e.g=t,Ns(e.o,ps,{})}).then(function(t){e.a[Hh]=t.recaptchaSiteKey}).s(function(t){throw e.f=null,t}))},t.render=function(){Xh(this);var n=this;return Yh(this,this.Da().then(function(){if(null===n.c){var t=n.u;if(!n.i){var e=qn(t);t=Wn("DIV"),e.appendChild(t)}n.c=n.g.render(t,n.a)}return n.c}))},t.verify=function(){Xh(this);var i=this;return Yh(this,this.render().then(function(r){return new jt(function(e){var t=i.g.getResponse(r);if(t)e(t);else{var n=function(t){t&&(function(t,e){B(t.l,function(t){return t==e})}(i,n),e(t))};i.l.push(n),i.i&&i.g.execute(i.c)}})}))},t.reset=function(){Xh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Xh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=qn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},S(Jh,Wh);var Zh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function tl(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:h}}function el(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:n}}function nl(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:g}}function rl(t,e){return{name:t||"",M:"a function",optional:!!e,N:y}}function il(t,e){return{name:t||"",M:"null",optional:!!e,N:i}}function ol(n){return{name:n?n+"Credential":"credential",M:n?"a valid "+n+" credential":"a valid credential",optional:!1,N:function(t){if(!t)return!1;var e=!n||t.providerId===n;return!(!t.na||!e)}}}function al(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&h(t.type)&&y(t.verify))}}}function sl(e,n,t,r){return{name:t||"",M:e.M+" or "+n.M,optional:!!r,N:function(t){return e.N(t)||n.N(t)}}}function ul(t,e){for(var n in e){var r=e[n].name;t[r]=ll(r,t[n],e[n].j)}}function cl(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:T(function(t){return this[t]},n),set:T(function(t,e,n,r){$h(t,[n],[r],!0),this[e]=r},r,n,e[n].Za),enumerable:!0})}}function hl(t,e,n,r){t[e]=ll(e,n,r)}function ll(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return $h(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}ul(gh.prototype,{Ya:{name:"applyActionCode",j:[tl("code")]},Ma:{name:"checkActionCode",j:[tl("code")]},ab:{name:"confirmPasswordReset",j:[tl("code"),tl("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[tl("email"),tl("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[tl("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[tl("emailLink")]},wc:{name:"onAuthStateChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[sl(nl(),rl(),"nextOrObserver"),rl("opt_error",!0),rl("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[tl("email"),sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[tl("email"),nl("actionCodeSettings")]},mb:{name:"setPersistence",j:[tl("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[ol()]},ob:{name:"signInAnonymously",j:[]},Sa:{name:"signInWithCredential",j:[ol()]},Hc:{name:"signInWithCustomToken",j:[tl("token")]},Ic:{name:"signInWithEmailAndPassword",j:[tl("email"),tl("password")]},Jc:{name:"signInWithEmailLink",j:[tl("email"),tl("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[tl("phoneNumber"),al()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[sl({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Oc)}},il(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[tl("code")]}}),cl(gh.prototype,{lc:{name:"languageCode",Za:sl(tl(),il(),"languageCode")},ti:{name:"tenantId",Za:sl(tl(),il(),"tenantId")}}),(gh.Persistence=Tu).LOCAL="local",gh.Persistence.SESSION="session",gh.Persistence.NONE="none",ul(Oc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[el("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[el("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[ol()]},fb:{name:"linkWithCredential",j:[ol()]},sc:{name:"linkWithPhoneNumber",j:[tl("phoneNumber"),al()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[ol()]},hb:{name:"reauthenticateWithCredential",j:[ol()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[tl("phoneNumber"),al()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[sl(nl("opt_actionCodeSettings",!0),il(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[tl(null,!0)]},Qc:{name:"unlink",j:[tl("provider")]},rb:{name:"updateEmail",j:[tl("email")]},sb:{name:"updatePassword",j:[tl("password")]},Sc:{name:"updatePhoneNumber",j:[ol("phone")]},tb:{name:"updateProfile",j:[nl("profile")]}}),ul(Rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(Dh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),ul(jt.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),cl(bc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Za:el("appVerificationDisabledForTesting")}}),ul(wc.prototype,{confirm:{name:"confirm",j:[tl("verificationCode")]}}),hl(ji,"fromJSON",function(t){t=h(t)?JSON.parse(t):t;for(var e,n=[Yi,uo,po,Hi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[sl(tl(),nl(),"json")]),hl(co,"credential",function(t,e){return new so(t,e)},[tl("email"),tl("password")]),ul(so.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Zi.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(Zi,"credential",to,[sl(tl(),nl(),"token")]),hl(co,"credentialWithLink",ho,[tl("email"),tl("emailLink")]),ul(eo.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(eo,"credential",no,[sl(tl(),nl(),"token")]),ul(ro.prototype,{ya:{name:"addScope",j:[tl("scope")]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(ro,"credential",io,[sl(tl(),sl(nl(),il()),"idToken"),sl(tl(),il(),"accessToken",!0)]),ul(oo.prototype,{Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),hl(oo,"credential",ao,[sl(tl(),nl(),"token"),tl("secret",!0)]),ul($i.prototype,{ya:{name:"addScope",j:[tl("scope")]},credential:{name:"credential",j:[sl(tl(),sl(nl(),il()),"optionsOrIdToken"),sl(tl(),il(),"accessToken",!0)]},Ga:{name:"setCustomParameters",j:[nl("customOAuthParameters")]}}),ul(Gi.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Ki.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),hl(yo,"credential",go,[tl("verificationId"),tl("verificationCode")]),ul(yo.prototype,{Wa:{name:"verifyPhoneNumber",j:[tl("phoneNumber"),al()]}}),ul(fo.prototype,{A:{name:"toJSON",j:[tl(null,!0)]}}),ul(Yr.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Co.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Io.prototype,{toJSON:{name:"toJSON",j:[tl(null,!0)]}}),ul(Jh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),hl(Zr,"parseLink",si,[tl("link")]),function(){if(void 0===fl||!fl.INTERNAL||!fl.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Br,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:gh,AuthCredential:ji,Error:Yr};hl(t,"EmailAuthProvider",co,[]),hl(t,"FacebookAuthProvider",Zi,[]),hl(t,"GithubAuthProvider",eo,[]),hl(t,"GoogleAuthProvider",ro,[]),hl(t,"TwitterAuthProvider",oo,[]),hl(t,"OAuthProvider",$i,[tl("providerId")]),hl(t,"SAMLAuthProvider",Ji,[tl("providerId")]),hl(t,"PhoneAuthProvider",yo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof gh)}}]),hl(t,"RecaptchaVerifier",Jh,[sl(tl(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),nl("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof fl.app.App)}}]),hl(t,"ActionCodeURL",Zr,[]),fl.INTERNAL.registerComponent({name:"auth",instanceFactory:function(t){return new gh(t=t.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:t,instantiationMode:"LAZY",type:"PUBLIC"}),fl.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(t){return{getUid:_((t=t.getProvider("auth").getImmediate()).getUid,t),getToken:_(t.cc,t),addAuthTokenListener:_(t.Wb,t),removeAuthTokenListener:_(t.Ec,t)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),fl.registerVersion("@firebase/auth","0.13.3"),fl.INTERNAL.extendNamespace({User:Oc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Vs=(qs.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Wa(e))},qs.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:ja(e)},qs.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},qs.prototype.prefixedName_=function(t){return this.prefix_+t},qs.prototype.toString=function(){return this.domStorage_.toString()},qs);function qs(t){this.domStorage_=t,this.prefix_="firebase:"}var Bs=(js.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},js.prototype.get=function(t){return Qa(this.cache_,t)?this.cache_[t]:null},js.prototype.remove=function(t){delete this.cache_[t]},js);function js(){this.cache_={},this.isInMemoryStorage=!0}function Ws(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Vs(e)}}catch(t){}return new Bs}function Ks(t){var e=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);if(55296<=i&&i<=56319){var o=i-55296;Ia(++r<t.length,"Surrogate pair missing trail surrogate."),i=65536+(o<<10)+(t.charCodeAt(r)-56320)}i<128?e[n++]=i:(i<2048?e[n++]=i>>6|192:(i<65536?e[n++]=i>>12|224:(e[n++]=i>>18|240,e[n++]=i>>12&63|128),e[n++]=i>>6&63|128),e[n++]=63&i|128)}return e}(t),n=new Ya;n.update(e);var r=n.digest();return Na.encodeByteArray(r)}function Qs(t,e){Ia(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(iu.logLevel=ls.VERBOSE,su=iu.log.bind(iu),e&&ru.set("logging_enabled",!0)):"function"==typeof t?su=t:(su=null,ru.remove("logging_enabled"))}function Hs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===uu&&(uu=!1,null===su&&!0===ru.get("logging_enabled")&&Qs(!0)),su){var n=au.apply(null,t);su(n)}}function Gs(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Hs.apply(void 0,wa([n],t))}}function zs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+au.apply(void 0,wa(t));iu.error(n)}function Ys(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+au.apply(void 0,wa(t));throw iu.error(n),new Error(n)}function Xs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+au.apply(void 0,wa(t));iu.warn(n)}function Js(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)}function $s(t,e){return t===e?0:t<e?-1:1}function Zs(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Wa(e))}function tu(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)n<i+e?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r}var eu,nu=Ws("localStorage"),ru=Ws("sessionStorage"),iu=new bs("@firebase/database"),ou=(eu=1,function(){return eu++}),au=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++){var i=t[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=au.apply(null,i):n+="object"==typeof i?Wa(i):i,n+=" "}return n},su=null,uu=!0,cu="[MIN_NAME]",hu="[MAX_NAME]",lu=function(t,e){if(t===e)return 0;if(t===cu||e===hu)return-1;if(e===cu||t===hu)return 1;var n=vu(t),r=vu(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},fu=function(t){if("object"!=typeof t||null===t)return Wa(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",i=0;i<e.length;i++)0!==i&&(r+=","),r+=Wa(e[i]),r+=":",r+=fu(t[e[i]]);return r+="}"};function pu(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}function du(t){var e,n,r,i,o;Ia(!Js(t),"Invalid JSON number"),0===t?e=1/t==-1/(r=n=0)?1:0:(e=t<0,r=(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,Math.round(t*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(t/Math.pow(2,-1074))));var a=[];for(o=52;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse();var s=a.join(""),u="";for(o=0;o<64;o+=8){var c=parseInt(s.substr(o,8),2).toString(16);1===c.length&&(c="0"+c),u+=c}return u.toLowerCase()}function mu(t){try{t()}catch(e){setTimeout(function(){var t=e.stack||"";throw Xs("Exception was thrown by user callback.",t),e},Math.floor(0))}}function yu(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n}var gu=new RegExp("^-?(0*)\\d{1,10}$"),vu=function(t){if(gu.test(t)){var e=Number(t);if(-2147483648<=e&&e<=2147483647)return e}return null},bu=(Object.defineProperty(wu,"Empty",{get:function(){return new wu("")},enumerable:!0,configurable:!0}),wu.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},wu.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},wu.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new wu(this.pieces_,t)},wu.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},wu.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},wu.prototype.toUrlEncodedString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+encodeURIComponent(String(this.pieces_[e])));return t||"/"},wu.prototype.slice=function(t){return void 0===t&&(t=0),this.pieces_.slice(this.pieceNum_+t)},wu.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],e=this.pieceNum_;e<this.pieces_.length-1;e++)t.push(this.pieces_[e]);return new wu(t,0)},wu.prototype.child=function(t){for(var e=[],n=this.pieceNum_;n<this.pieces_.length;n++)e.push(this.pieces_[n]);if(t instanceof wu)for(n=t.pieceNum_;n<t.pieces_.length;n++)e.push(t.pieces_[n]);else{var r=t.split("/");for(n=0;n<r.length;n++)0<r[n].length&&e.push(r[n])}return new wu(e,0)},wu.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},wu.relativePath=function(t,e){var n=t.getFront(),r=e.getFront();if(null===n)return e;if(n===r)return wu.relativePath(t.popFront(),e.popFront());throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")},wu.comparePaths=function(t,e){for(var n=t.slice(),r=e.slice(),i=0;i<n.length&&i<r.length;i++){var o=lu(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1},wu.prototype.equals=function(t){if(this.getLength()!==t.getLength())return!1;for(var e=this.pieceNum_,n=t.pieceNum_;e<=this.pieces_.length;e++,n++)if(this.pieces_[e]!==t.pieces_[n])return!1;return!0},wu.prototype.contains=function(t){var e=this.pieceNum_,n=t.pieceNum_;if(this.getLength()>t.getLength())return!1;for(;e<this.pieces_.length;){if(this.pieces_[e]!==t.pieces_[n])return!1;++e,++n}return!0},wu);function wu(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}var _u=(Object.defineProperty(Tu,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!0,configurable:!0}),Object.defineProperty(Tu,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!0,configurable:!0}),Tu.prototype.push=function(t){0<this.parts_.length&&(this.byteLength_+=1),this.parts_.push(t),this.byteLength_+=os(t),this.checkValid_()},Tu.prototype.pop=function(){var t=this.parts_.pop();this.byteLength_-=os(t),0<this.parts_.length&&(this.byteLength_-=1)},Tu.prototype.checkValid_=function(){if(this.byteLength_>Tu.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+Tu.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>Tu.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Tu.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},Tu.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},Tu);function Tu(t,e){this.errorPrefix_=e,this.parts_=t.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=os(this.parts_[n]);this.checkValid_()}var Eu="firebaseio.com",Su="websocket",Iu="long_polling",Cu=(Nu.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},Nu.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},Nu.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},Nu.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},Nu.prototype.updateHost=function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&nu.set("host:"+this.host,this.internalHost))},Nu.prototype.connectionURL=function(t,e){var n;if(Ia("string"==typeof t,"typeof type must == string"),Ia("object"==typeof e,"typeof params must == object"),t===Su)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(t!==Iu)throw new Error("Unknown connection type: "+t);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(e.ns=this.namespace);var r=[];return pu(e,function(t,e){r.push(t+"="+e)}),n+r.join("&")},Nu.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},Nu.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host},Nu);function Nu(t,e,n,r,i,o){void 0===i&&(i=""),void 0===o&&(o=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.persistenceKey=i,this.includeNamespaceInQueryParams=o,this.host=t.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=nu.get("host:"+t)||this.host}function Au(t){var e=qu(t),n=e.namespace;"firebase"===e.domain&&Ys(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),n&&"undefined"!==n||"localhost"===e.domain||Ys("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Xs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var r="ws"===e.scheme||"wss"===e.scheme;return{repoInfo:new Cu(e.host,e.secure,n,r,"",n!==e.subdomain),path:new bu(e.pathString)}}function ku(t){return"string"==typeof t&&0!==t.length&&!Bu.test(t)}function Du(t){return"string"==typeof t&&0!==t.length&&!ju.test(t)}function Ru(t){return null===t||"string"==typeof t||"number"==typeof t&&!Js(t)||t&&"object"==typeof t&&Qa(t,".sv")}function Ou(t,e,n,r,i){i&&void 0===n||Ku(ns(t,e,i),n,r)}function Pu(t,e,n,r,i){if(!i||void 0!==n){var o=ns(t,e,i);if(!n||"object"!=typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var a=[];pu(n,function(t,e){var n=new bu(t);if(Ku(o,e,r.child(n)),".priority"===n.getBack()&&!Ru(e))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(n)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=(r=e[n]).slice(),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!ku(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(bu.comparePaths);var a=null;for(n=0;n<e.length;n++){if(r=e[n],null!==a&&a.contains(r))throw new Error(t+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(o,a)}}function Mu(t,e,n,r){if(!r||void 0!==n){if(Js(n))throw new Error(ns(t,e,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ru(n))throw new Error(ns(t,e,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function xu(t,e,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ns(t,e,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}function Lu(t,e,n,r){if(!(r&&void 0===n||ku(n)))throw new Error(ns(t,e,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}function Fu(t,e,n,r){if(!(r&&void 0===n||Du(n)))throw new Error(ns(t,e,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')}function Uu(t,e){if(".info"===e.getFront())throw new Error(t+" failed = Can't modify data under /.info/")}function Vu(t,e,n){var r=n.path.toString();if("string"!=typeof n.repoInfo.host||0===n.repoInfo.host.length||!ku(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(t){return t=t&&t.replace(/^\/*\.info(\/|$)/,"/"),Du(t)}(r))throw new Error(ns(t,e,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')}var qu=function(t){var e="",n="",r="",i="",o="",a=!0,s="https",u=443;if("string"==typeof t){var c=t.indexOf("//");0<=c&&(s=t.substring(0,c-1),t=t.substring(c+2));var h=t.indexOf("/");-1===h&&(h=t.length);var l=t.indexOf("?");-1===l&&(l=t.length),e=t.substring(0,Math.min(h,l)),h<l&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(t){}e+="/"+i}return e}(t.substring(h,l)));var f=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=va(t.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var s=a.split("=");2===s.length?r[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Xs("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,l)));0<=(c=e.indexOf(":"))?(a="https"===s||"wss"===s,u=parseInt(e.substring(c+1),10)):c=t.length;var p=e.split(".");3===p.length?(n=p[1],o=r=p[0].toLowerCase()):2===p.length?n=p[0]:"localhost"===p[0].slice(0,c).toLowerCase()&&(n="localhost"),"ns"in f&&(o=f.ns)}return{host:e,port:u,domain:n,subdomain:r,secure:a,scheme:s,pathString:i,namespace:o}},Bu=/[\[\].#$\/\u0000-\u001F\u007F]/,ju=/[\[\].#$\u0000-\u001F\u007F]/,Wu=10485760,Ku=function(n,t,e){var r=e instanceof bu?new _u(e,n):e;if(void 0===t)throw new Error(n+"contains undefined "+r.toErrorString());if("function"==typeof t)throw new Error(n+"contains a function "+r.toErrorString()+" with contents = "+t.toString());if(Js(t))throw new Error(n+"contains "+t.toString()+" "+r.toErrorString());if("string"==typeof t&&t.length>Wu/3&&os(t)>Wu)throw new Error(n+"contains a string greater than "+Wu+" utf8 bytes "+r.toErrorString()+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(pu(t,function(t,e){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!ku(t)))throw new Error(n+" contains an invalid key ("+t+") "+r.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.push(t),Ku(n,e,r),r.pop()}),i&&o)throw new Error(n+' contains ".value" child '+r.toErrorString()+" in addition to actual children.")}},Qu=(Hu.prototype.cancel=function(t){es("OnDisconnect.cancel",0,1,arguments.length),rs("OnDisconnect.cancel",1,t,!0);var e=new Da;return this.repo_.onDisconnectCancel(this.path_,e.wrapCallback(t)),e.promise},Hu.prototype.remove=function(t){es("OnDisconnect.remove",0,1,arguments.length),Uu("OnDisconnect.remove",this.path_),rs("OnDisconnect.remove",1,t,!0);var e=new Da;return this.repo_.onDisconnectSet(this.path_,null,e.wrapCallback(t)),e.promise},Hu.prototype.set=function(t,e){es("OnDisconnect.set",1,2,arguments.length),Uu("OnDisconnect.set",this.path_),Ou("OnDisconnect.set",1,t,this.path_,!1),rs("OnDisconnect.set",2,e,!0);var n=new Da;return this.repo_.onDisconnectSet(this.path_,t,n.wrapCallback(e)),n.promise},Hu.prototype.setWithPriority=function(t,e,n){es("OnDisconnect.setWithPriority",2,3,arguments.length),Uu("OnDisconnect.setWithPriority",this.path_),Ou("OnDisconnect.setWithPriority",1,t,this.path_,!1),Mu("OnDisconnect.setWithPriority",2,e,!1),rs("OnDisconnect.setWithPriority",3,n,!0);var r=new Da;return this.repo_.onDisconnectSetWithPriority(this.path_,t,e,r.wrapCallback(n)),r.promise},Hu.prototype.update=function(t,e){if(es("OnDisconnect.update",1,2,arguments.length),Uu("OnDisconnect.update",this.path_),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Xs("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Pu("OnDisconnect.update",1,t,this.path_,!1),rs("OnDisconnect.update",2,e,!0);var i=new Da;return this.repo_.onDisconnectUpdate(this.path_,t,i.wrapCallback(e)),i.promise},Hu);function Hu(t,e){this.repo_=t,this.path_=e}var Gu=(zu.prototype.toJSON=function(){return es("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},zu);function zu(t,e){this.committed=t,this.snapshot=e}var Yu,Xu,Ju,$u=(Yu="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Xu=0,Ju=[],function(t){var e,n=t===Xu;Xu=t;var r=new Array(8);for(e=7;0<=e;e--)r[e]=Yu.charAt(t%64),t=Math.floor(t/64);Ia(0===t,"Cannot push at time == 0");var i=r.join("");if(n){for(e=11;0<=e&&63===Ju[e];e--)Ju[e]=0;Ju[e]++}else for(e=0;e<12;e++)Ju[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)i+=Yu.charAt(Ju[e]);return Ia(20===i.length,"nextPushId: Length should be 20."),i}),Zu=(tc.Wrap=function(t,e){return new tc(t,e)},tc);function tc(t,e){this.name=t,this.node=e}var ec,nc=(rc.prototype.getCompare=function(){return this.compare.bind(this)},rc.prototype.indexedValueChanged=function(t,e){var n=new Zu(cu,t),r=new Zu(cu,e);return 0!==this.compare(n,r)},rc.prototype.minPost=function(){return Zu.MIN},rc);function rc(){}var ic,oc=(da(ac,ic=nc),Object.defineProperty(ac,"__EMPTY_NODE",{get:function(){return ec},set:function(t){ec=t},enumerable:!0,configurable:!0}),ac.prototype.compare=function(t,e){return lu(t.name,e.name)},ac.prototype.isDefinedOn=function(t){throw Ca("KeyIndex.isDefinedOn not expected to be called.")},ac.prototype.indexedValueChanged=function(t,e){return!1},ac.prototype.minPost=function(){return Zu.MIN},ac.prototype.maxPost=function(){return new Zu(hu,ec)},ac.prototype.makePost=function(t,e){return Ia("string"==typeof t,"KeyIndex indexValue must always be a string."),new Zu(t,ec)},ac.prototype.toString=function(){return".key"},ac);function ac(){return null!==ic&&ic.apply(this,arguments)||this}var sc,uc=new oc;function cc(t){return"number"==typeof t?"number:"+du(t):"string:"+t}function hc(t){if(t.isLeafNode()){var e=t.val();Ia("string"==typeof e||"number"==typeof e||"object"==typeof e&&Qa(e,".sv"),"Priority must be a string or number.")}else Ia(t===sc||t.isEmpty(),"priority of unexpected type.");Ia(t===sc||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}var lc,fc,pc,dc,mc=(Object.defineProperty(yc,"__childrenNodeConstructor",{get:function(){return lc},set:function(t){lc=t},enumerable:!0,configurable:!0}),yc.prototype.isLeafNode=function(){return!0},yc.prototype.getPriority=function(){return this.priorityNode_},yc.prototype.updatePriority=function(t){return new yc(this.value_,t)},yc.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:yc.__childrenNodeConstructor.EMPTY_NODE},yc.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:yc.__childrenNodeConstructor.EMPTY_NODE},yc.prototype.hasChild=function(){return!1},yc.prototype.getPredecessorChildName=function(t,e){return null},yc.prototype.updateImmediateChild=function(t,e){return".priority"===t?this.updatePriority(e):e.isEmpty()&&".priority"!==t?this:yc.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,e).updatePriority(this.priorityNode_)},yc.prototype.updateChild=function(t,e){var n=t.getFront();return null===n?e:e.isEmpty()&&".priority"!==n?this:(Ia(".priority"!==n||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(n,yc.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),e)))},yc.prototype.isEmpty=function(){return!1},yc.prototype.numChildren=function(){return 0},yc.prototype.forEachChild=function(t,e){return!1},yc.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},yc.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+cc(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"==e?du(this.value_):this.value_,this.lazyHash_=Ks(t)}return this.lazyHash_},yc.prototype.getValue=function(){return this.value_},yc.prototype.compareTo=function(t){return t===yc.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof yc.__childrenNodeConstructor?-1:(Ia(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},yc.prototype.compareToLeafNode_=function(t){var e=typeof t.value_,n=typeof this.value_,r=yc.VALUE_TYPE_ORDER.indexOf(e),i=yc.VALUE_TYPE_ORDER.indexOf(n);return Ia(0<=r,"Unknown leaf type: "+e),Ia(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:i-r},yc.prototype.withIndex=function(){return this},yc.prototype.isIndexed=function(){return!0},yc.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode()){var e=t;return this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}return!1},yc.VALUE_TYPE_ORDER=["object","boolean","number","string"],yc);function yc(t,e){void 0===e&&(e=yc.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=e,this.lazyHash_=null,Ia(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),hc(this.priorityNode_)}function gc(){return null!==dc&&dc.apply(this,arguments)||this}var vc=new(da(gc,dc=nc),gc.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?lu(t.name,e.name):i},gc.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},gc.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},gc.prototype.minPost=function(){return Zu.MIN},gc.prototype.maxPost=function(){return new Zu(hu,new mc("[PRIORITY-POST]",pc))},gc.prototype.makePost=function(t,e){var n=fc(t);return new Zu(e,new mc("[PRIORITY-POST]",n))},gc.prototype.toString=function(){return".priority"},gc),bc=(wc.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},wc.prototype.hasNext=function(){return 0<this.nodeStack_.length},wc.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},wc);function wc(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}var _c=(Tc.prototype.copy=function(t,e,n,r,i){return new Tc(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Tc.prototype.count=function(){return this.left.count()+1+this.right.count()},Tc.prototype.isEmpty=function(){return!1},Tc.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},Tc.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Tc.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},Tc.prototype.minKey=function(){return this.min_().key},Tc.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Tc.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},Tc.prototype.removeMin_=function(){if(this.left.isEmpty())return Ic.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},Tc.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Ic.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},Tc.prototype.isRed_=function(){return this.color},Tc.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},Tc.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},Tc.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},Tc.prototype.rotateLeft_=function(){var t=this.copy(null,null,Tc.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Tc.prototype.rotateRight_=function(){var t=this.copy(null,null,Tc.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Tc.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Tc.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},Tc.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},Tc.RED=!0,Tc.BLACK=!1,Tc);function Tc(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Tc.RED,this.left=null!=r?r:Ic.EMPTY_NODE,this.right=null!=i?i:Ic.EMPTY_NODE}var Ec=(Sc.prototype.copy=function(t,e,n,r,i){return this},Sc.prototype.insert=function(t,e,n){return new _c(t,e,null)},Sc.prototype.remove=function(t,e){return this},Sc.prototype.count=function(){return 0},Sc.prototype.isEmpty=function(){return!0},Sc.prototype.inorderTraversal=function(t){return!1},Sc.prototype.reverseTraversal=function(t){return!1},Sc.prototype.minKey=function(){return null},Sc.prototype.maxKey=function(){return null},Sc.prototype.check_=function(){return 0},Sc.prototype.isRed_=function(){return!1},Sc);function Sc(){}var Ic=(Cc.prototype.insert=function(t,e){return new Cc(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,_c.BLACK,null,null))},Cc.prototype.remove=function(t){return new Cc(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,_c.BLACK,null,null))},Cc.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:0<e&&(n=n.right)}return null},Cc.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:0<e&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},Cc.prototype.isEmpty=function(){return this.root_.isEmpty()},Cc.prototype.count=function(){return this.root_.count()},Cc.prototype.minKey=function(){return this.root_.minKey()},Cc.prototype.maxKey=function(){return this.root_.maxKey()},Cc.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},Cc.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},Cc.prototype.getIterator=function(t){return new bc(this.root_,null,this.comparator_,!1,t)},Cc.prototype.getIteratorFrom=function(t,e){return new bc(this.root_,t,this.comparator_,!1,e)},Cc.prototype.getReverseIteratorFrom=function(t,e){return new bc(this.root_,t,this.comparator_,!0,e)},Cc.prototype.getReverseIterator=function(t){return new bc(this.root_,null,this.comparator_,!0,t)},Cc.EMPTY_NODE=new Ec,Cc);function Cc(t,e){void 0===e&&(e=Cc.EMPTY_NODE),this.comparator_=t,this.root_=e}var Nc=Math.log(2),Ac=(kc.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},kc);function kc(t){var e;this.count=(e=t+1,parseInt(Math.log(e)/Nc,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=t+1&r}var Dc,Rc,Oc=function(c,t,h,e){c.sort(t);var l=function(t,e){var n,r,i=e-t;if(0==i)return null;if(1==i)return n=c[t],r=h?h(n):n,new _c(r,n.node,_c.BLACK,null,null);var o=parseInt(i/2,10)+t,a=l(t,o),s=l(o+1,e);return n=c[o],r=h?h(n):n,new _c(r,n.node,_c.BLACK,a,s)},n=function(t){for(var e=null,n=null,s=c.length,r=function(t,e){var n=s-t,r=s;s-=t;var i=l(1+n,r),o=c[n],a=h?h(o):o;u(new _c(a,o.node,e,null,i))},u=function(t){e=e?e.left=t:n=t},i=0;i<t.count;++i){var o=t.nextBitIsOne(),a=Math.pow(2,t.count-(i+1));o?r(a,_c.BLACK):(r(a,_c.BLACK),r(a,_c.RED))}return n}(new Ac(c.length));return new Ic(e||t,n)},Pc={},Mc=(Object.defineProperty(xc,"Default",{get:function(){return Ia(vc,"ChildrenNode.ts has not been loaded"),Dc=Dc||new xc({".priority":Pc},{".priority":vc})},enumerable:!0,configurable:!0}),xc.prototype.get=function(t){var e=Ha(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Ic?e:null},xc.prototype.hasIndex=function(t){return Qa(this.indexSet_,t.toString())},xc.prototype.addIndex=function(t,e){Ia(t!==uc,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n,r=[],i=!1,o=e.getIterator(Zu.Wrap),a=o.getNext();a;)i=i||t.isDefinedOn(a.node),r.push(a),a=o.getNext();n=i?Oc(r,t.getCompare()):Pc;var s=t.toString(),u=ma({},this.indexSet_);u[s]=t;var c=ma({},this.indexes_);return c[s]=n,new xc(c,u)},xc.prototype.addToIndexes=function(u,c){var h=this;return new xc(za(this.indexes_,function(t,e){var n=Ha(h.indexSet_,e);if(Ia(n,"Missing index implementation for "+e),t===Pc){if(n.isDefinedOn(u.node)){for(var r=[],i=c.getIterator(Zu.Wrap),o=i.getNext();o;)o.name!==u.name&&r.push(o),o=i.getNext();return r.push(u),Oc(r,n.getCompare())}return Pc}var a=c.get(u.name),s=t;return a&&(s=s.remove(new Zu(u.name,a))),s.insert(u,u.node)}),this.indexSet_)},xc.prototype.removeFromIndexes=function(n,r){return new xc(za(this.indexes_,function(t){if(t===Pc)return t;var e=r.get(n.name);return e?t.remove(new Zu(n.name,e)):t}),this.indexSet_)},xc);function xc(t,e){this.indexes_=t,this.indexSet_=e}function Lc(t,e){return lu(t.name,e.name)}function Fc(t,e){return lu(t,e)}var Uc,Vc=(Object.defineProperty(qc,"EMPTY_NODE",{get:function(){return Rc=Rc||new qc(new Ic(Fc),null,Mc.Default)},enumerable:!0,configurable:!0}),qc.prototype.isLeafNode=function(){return!1},qc.prototype.getPriority=function(){return this.priorityNode_||Rc},qc.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new qc(this.children_,t,this.indexMap_)},qc.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Rc:e},qc.prototype.getChild=function(t){var e=t.getFront();return null===e?this:this.getImmediateChild(e).getChild(t.popFront())},qc.prototype.hasChild=function(t){return null!==this.children_.get(t)},qc.prototype.updateImmediateChild=function(t,e){if(Ia(e,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(e);var n=new Zu(t,e),r=void 0,i=void 0;i=e.isEmpty()?(r=this.children_.remove(t),this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(t,e),this.indexMap_.addToIndexes(n,this.children_));var o=r.isEmpty()?Rc:this.priorityNode_;return new qc(r,o,i)},qc.prototype.updateChild=function(t,e){var n=t.getFront();if(null===n)return e;Ia(".priority"!==t.getFront()||1===t.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(t.popFront(),e);return this.updateImmediateChild(n,r)},qc.prototype.isEmpty=function(){return this.children_.isEmpty()},qc.prototype.numChildren=function(){return this.children_.count()},qc.prototype.val=function(n){if(this.isEmpty())return null;var r={},i=0,o=0,a=!0;if(this.forEachChild(vc,function(t,e){r[t]=e.val(n),i++,a&&qc.INTEGER_REGEXP_.test(t)?o=Math.max(o,Number(t)):a=!1}),!n&&a&&o<2*i){var t=[];for(var e in r)t[e]=r[e];return t}return n&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r},qc.prototype.hash=function(){if(null===this.lazyHash_){var r="";this.getPriority().isEmpty()||(r+="priority:"+cc(this.getPriority().val())+":"),this.forEachChild(vc,function(t,e){var n=e.hash();""!==n&&(r+=":"+t+":"+n)}),this.lazyHash_=""===r?"":Ks(r)}return this.lazyHash_},qc.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Zu(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},qc.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},qc.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Zu(e,this.children_.get(e)):null},qc.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},qc.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Zu(e,this.children_.get(e)):null},qc.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},qc.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},qc.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Zu.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},qc.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},qc.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Zu.Wrap),i=r.peek();null!=i&&0<e.compare(i,t);)r.getNext(),i=r.peek();return r},qc.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===jc?-1:0},qc.prototype.withIndex=function(t){if(t===uc||this.indexMap_.hasIndex(t))return this;var e=this.indexMap_.addIndex(t,this.children_);return new qc(this.children_,this.priorityNode_,e)},qc.prototype.isIndexed=function(t){return t===uc||this.indexMap_.hasIndex(t)},qc.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var n=this.getIterator(vc),r=e.getIterator(vc),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1},qc.prototype.resolveIndex_=function(t){return t===uc?null:this.indexMap_.get(t.toString())},qc.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,qc);function qc(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&hc(this.priorityNode_),this.children_.isEmpty()&&Ia(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function Bc(){return Uc.call(this,new Ic(Fc),Vc.EMPTY_NODE,Mc.Default)||this}var jc=new(da(Bc,Uc=Vc),Bc.prototype.compareTo=function(t){return t===this?0:1},Bc.prototype.equals=function(t){return t===this},Bc.prototype.getPriority=function(){return this},Bc.prototype.getImmediateChild=function(t){return Vc.EMPTY_NODE},Bc.prototype.isEmpty=function(){return!1},Bc);Object.defineProperties(Zu,{MIN:{value:new Zu(cu,Vc.EMPTY_NODE)},MAX:{value:new Zu(hu,jc)}}),oc.__EMPTY_NODE=Vc.EMPTY_NODE,mc.__childrenNodeConstructor=Vc,sc=jc,pc=jc;var Wc,Kc=!0;function Qc(r,t){if(void 0===t&&(t=null),null===r)return Vc.EMPTY_NODE;if("object"==typeof r&&".priority"in r&&(t=r[".priority"]),Ia(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof r&&".value"in r&&null!==r[".value"]&&(r=r[".value"]),"object"!=typeof r||".sv"in r)return new mc(r,Qc(t));if(r instanceof Array||!Kc){var i=Vc.EMPTY_NODE;return pu(r,function(t,e){if(Qa(r,t)&&"."!==t.substring(0,1)){var n=Qc(e);!n.isLeafNode()&&n.isEmpty()||(i=i.updateImmediateChild(t,n))}}),i.updatePriority(Qc(t))}var o=[],a=!1;if(pu(r,function(t,e){if("."!==t.substring(0,1)){var n=Qc(e);n.isEmpty()||(a=a||!n.getPriority().isEmpty(),o.push(new Zu(t,n)))}}),0===o.length)return Vc.EMPTY_NODE;var e=Oc(o,Lc,function(t){return t.name},Fc);if(a){var n=Oc(o,vc.getCompare());return new Vc(e,Qc(t),new Mc({".priority":n},{".priority":vc}))}return new Vc(e,Qc(t),Mc.Default)}function Hc(){return null!==Wc&&Wc.apply(this,arguments)||this}fc=Qc;var Gc,zc=new(da(Hc,Wc=nc),Hc.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?lu(t.name,e.name):n},Hc.prototype.isDefinedOn=function(t){return!0},Hc.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},Hc.prototype.minPost=function(){return Zu.MIN},Hc.prototype.maxPost=function(){return Zu.MAX},Hc.prototype.makePost=function(t,e){var n=Qc(t);return new Zu(e,n)},Hc.prototype.toString=function(){return".value"},Hc),Yc=(da(Xc,Gc=nc),Xc.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},Xc.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},Xc.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?lu(t.name,e.name):i},Xc.prototype.makePost=function(t,e){var n=Qc(t),r=Vc.EMPTY_NODE.updateChild(this.indexPath_,n);return new Zu(e,r)},Xc.prototype.maxPost=function(){var t=Vc.EMPTY_NODE.updateChild(this.indexPath_,jc);return new Zu(hu,t)},Xc.prototype.toString=function(){return this.indexPath_.slice().join("/")},Xc);function Xc(t){var e=Gc.call(this)||this;return e.indexPath_=t,Ia(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),e}var Jc=($c.prototype.val=function(){return es("DataSnapshot.val",0,0,arguments.length),this.node_.val()},$c.prototype.exportVal=function(){return es("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},$c.prototype.toJSON=function(){return es("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},$c.prototype.exists=function(){return es("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},$c.prototype.child=function(t){es("DataSnapshot.child",0,1,arguments.length),t=String(t),Fu("DataSnapshot.child",1,t,!1);var e=new bu(t),n=this.ref_.child(e);return new $c(this.node_.getChild(e),n,vc)},$c.prototype.hasChild=function(t){es("DataSnapshot.hasChild",1,1,arguments.length),Fu("DataSnapshot.hasChild",1,t,!1);var e=new bu(t);return!this.node_.getChild(e).isEmpty()},$c.prototype.getPriority=function(){return es("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},$c.prototype.forEach=function(n){var r=this;return es("DataSnapshot.forEach",1,1,arguments.length),rs("DataSnapshot.forEach",1,n,!1),!this.node_.isLeafNode()&&!!this.node_.forEachChild(this.index_,function(t,e){return n(new $c(e,r.ref_.child(t),vc))})},$c.prototype.hasChildren=function(){return es("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty($c.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!0,configurable:!0}),$c.prototype.numChildren=function(){return es("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},$c.prototype.getRef=function(){return es("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty($c.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),$c);function $c(t,e,n){this.node_=t,this.ref_=e,this.index_=n}var Zc=(th.prototype.getPath=function(){var t=this.snapshot.getRef();return"value"===this.eventType?t.path:t.getParent().path},th.prototype.getEventType=function(){return this.eventType},th.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},th.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Wa(this.snapshot.exportVal())},th);function th(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}var eh=(nh.prototype.getPath=function(){return this.path},nh.prototype.getEventType=function(){return"cancel"},nh.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},nh.prototype.toString=function(){return this.path.toString()+":cancel"},nh);function nh(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}var rh=(ih.prototype.respondsTo=function(t){return"value"===t},ih.prototype.createEvent=function(t,e){var n=e.getQueryParams().getIndex();return new Zc("value",this,new Jc(t.snapshotNode,e.getRef(),n))},ih.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Ia(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callback_;return function(){r.call(e,t.snapshot)}},ih.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new eh(this,t,e):null},ih.prototype.matches=function(t){return t instanceof ih&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},ih.prototype.hasAnyCallback=function(){return null!==this.callback_},ih);function ih(t,e,n){this.callback_=t,this.cancelCallback_=e,this.context_=n}var oh,ah=(sh.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return e="children_removed"===e?"child_removed":e,Qa(this.callbacks_,e)},sh.prototype.createCancelEvent=function(t,e){return this.cancelCallback_?new eh(this,t,e):null},sh.prototype.createEvent=function(t,e){Ia(null!=t.childName,"Child events should have a childName.");var n=e.getRef().child(t.childName),r=e.getQueryParams().getIndex();return new Zc(t.type,this,new Jc(t.snapshotNode,n,r),t.prevName)},sh.prototype.getEventRunner=function(t){var e=this.context_;if("cancel"===t.getEventType()){Ia(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(e,t.error)}}var r=this.callbacks_[t.eventType];return function(){r.call(e,t.snapshot,t.prevName)}},sh.prototype.matches=function(e){var n=this;if(e instanceof sh){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=Object.keys(e.callbacks_),r=Object.keys(this.callbacks_),i=t.length;if(i===r.length){if(1!==i)return r.every(function(t){return e.callbacks_[t]===n.callbacks_[t]});var o=t[0],a=r[0];return!(a!==o||e.callbacks_[o]&&this.callbacks_[a]&&e.callbacks_[o]!==this.callbacks_[a])}}}return!1},sh.prototype.hasAnyCallback=function(){return null!==this.callbacks_},sh);function sh(t,e,n){this.callbacks_=t,this.cancelCallback_=e,this.context_=n}var uh=(Object.defineProperty(ch,"__referenceConstructor",{get:function(){return Ia(oh,"Reference.ts has not been loaded"),oh},set:function(t){oh=t},enumerable:!0,configurable:!0}),ch.validateQueryEndpoints_=function(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===uc){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==cu)throw new Error(r);if("string"!=typeof e)throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==hu)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(t.getIndex()===vc){if(null!=e&&!Ru(e)||null!=n&&!Ru(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Ia(t.getIndex()instanceof Yc||t.getIndex()===zc,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},ch.validateLimit_=function(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},ch.prototype.validateNoPreviousOrderByCall_=function(t){if(!0===this.orderByCalled_)throw new Error(t+": You can't combine multiple orderBy calls.")},ch.prototype.getQueryParams=function(){return this.queryParams_},ch.prototype.getRef=function(){return es("Query.ref",0,0,arguments.length),new ch.__referenceConstructor(this.repo,this.path)},ch.prototype.on=function(t,e,n,r){es("Query.on",2,4,arguments.length),xu("Query.on",1,t,!1),rs("Query.on",2,e,!1);var i=ch.getCancelAndContextArgs_("Query.on",n,r);if("value"===t)this.onValueEvent(e,i.cancel,i.context);else{var o={};o[t]=e,this.onChildEvent(o,i.cancel,i.context)}return e},ch.prototype.onValueEvent=function(t,e,n){var r=new rh(t,e||null,n||null);this.repo.addEventCallbackForQuery(this,r)},ch.prototype.onChildEvent=function(t,e,n){var r=new ah(t,e,n);this.repo.addEventCallbackForQuery(this,r)},ch.prototype.off=function(t,e,n){es("Query.off",0,3,arguments.length),xu("Query.off",1,t,!0),rs("Query.off",2,e,!0),is("Query.off",3,n,!0);var r=null,i=null;"value"===t?r=new rh(e||null,null,n||null):t&&(e&&((i={})[t]=e),r=new ah(i,null,n||null)),this.repo.removeEventCallbackForQuery(this,r)},ch.prototype.once=function(e,n,t,r){var i=this;es("Query.once",1,4,arguments.length),xu("Query.once",1,e,!1),rs("Query.once",2,n,!0);var o=ch.getCancelAndContextArgs_("Query.once",t,r),a=!0,s=new Da;s.promise.catch(function(){});var u=function(t){a&&(a=!1,i.off(e,u),n&&n.bind(o.context)(t),s.resolve(t))};return this.on(e,u,function(t){i.off(e,u),o.cancel&&o.cancel.bind(o.context)(t),s.reject(t)}),s.promise},ch.prototype.limitToFirst=function(t){if(es("Query.limitToFirst",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new ch(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},ch.prototype.limitToLast=function(t){if(es("Query.limitToLast",1,1,arguments.length),"number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new ch(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},ch.prototype.orderByChild=function(t){if(es("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');Fu("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var e=new bu(t);if(e.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var n=new Yc(e),r=this.queryParams_.orderBy(n);return ch.validateQueryEndpoints_(r),new ch(this.repo,this.path,r,!0)},ch.prototype.orderByKey=function(){es("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(uc);return ch.validateQueryEndpoints_(t),new ch(this.repo,this.path,t,!0)},ch.prototype.orderByPriority=function(){es("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(vc);return ch.validateQueryEndpoints_(t),new ch(this.repo,this.path,t,!0)},ch.prototype.orderByValue=function(){es("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(zc);return ch.validateQueryEndpoints_(t),new ch(this.repo,this.path,t,!0)},ch.prototype.startAt=function(t,e){void 0===t&&(t=null),es("Query.startAt",0,2,arguments.length),Ou("Query.startAt",1,t,this.path,!0),Lu("Query.startAt",2,e,!0);var n=this.queryParams_.startAt(t,e);if(ch.validateLimit_(n),ch.validateQueryEndpoints_(n),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(e=t=null),new ch(this.repo,this.path,n,this.orderByCalled_)},ch.prototype.endAt=function(t,e){void 0===t&&(t=null),es("Query.endAt",0,2,arguments.length),Ou("Query.endAt",1,t,this.path,!0),Lu("Query.endAt",2,e,!0);var n=this.queryParams_.endAt(t,e);if(ch.validateLimit_(n),ch.validateQueryEndpoints_(n),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new ch(this.repo,this.path,n,this.orderByCalled_)},ch.prototype.equalTo=function(t,e){if(es("Query.equalTo",1,2,arguments.length),Ou("Query.equalTo",1,t,this.path,!1),Lu("Query.equalTo",2,e,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(t,e).endAt(t,e)},ch.prototype.toString=function(){return es("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},ch.prototype.toJSON=function(){return es("Query.toJSON",0,1,arguments.length),this.toString()},ch.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},ch.prototype.queryIdentifier=function(){var t=this.queryObject(),e=fu(t);return"{}"===e?"default":e},ch.prototype.isEqual=function(t){if(es("Query.isEqual",1,1,arguments.length),!(t instanceof ch))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");var e=this.repo===t.repo,n=this.path.equals(t.path),r=this.queryIdentifier()===t.queryIdentifier();return e&&n&&r},ch.getCancelAndContextArgs_=function(t,e,n){var r={cancel:null,context:null};if(e&&n)r.cancel=e,rs(t,3,r.cancel,!0),r.context=n,is(t,4,r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(ns(t,3,!0)+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(ch.prototype,"ref",{get:function(){return this.getRef()},enumerable:!0,configurable:!0}),ch);function ch(t,e,n,r){this.repo=t,this.path=e,this.queryParams_=n,this.orderByCalled_=r}var hh=(lh.prototype.find=function(t){if(null!=this.value)return this.value.getChild(t);if(!t.isEmpty()&&0<this.children.size){var e=t.getFront();return t=t.popFront(),this.children.has(e)?this.children.get(e).find(t):null}return null},lh.prototype.remember=function(t,e){if(t.isEmpty())this.value=e,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,e);else{var n=t.getFront();this.children.has(n)||this.children.set(n,new lh);var r=this.children.get(n);t=t.popFront(),r.remember(t,e)}},lh.prototype.forget=function(t){if(t.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var e=this.value;this.value=null;var n=this;return e.forEachChild(vc,function(t,e){n.remember(new bu(t),e)}),this.forget(t)}if(0<this.children.size){var r=t.getFront();return t=t.popFront(),!this.children.has(r)||this.children.get(r).forget(t)&&this.children.delete(r),0===this.children.size}return!0},lh.prototype.forEachTree=function(r,i){null!==this.value?i(r,this.value):this.forEachChild(function(t,e){var n=new bu(r.toString()+"/"+t);e.forEachTree(n,i)})},lh.prototype.forEachChild=function(n){this.children.forEach(function(t,e){n(e,t)})},lh);function lh(){this.value=null,this.children=new Map}function fh(t,e){return t&&"object"==typeof t?(Ia(".sv"in t,"Unexpected leaf node or priority contents"),e[t[".sv"]]):t}var ph,dh,mh=function(t,r){var i,e=t.getPriority().val(),n=fh(e,r);if(t.isLeafNode()){var o=t,a=fh(o.getValue(),r);return a!==o.getValue()||n!==o.getPriority().val()?new mc(a,Qc(n)):t}var s=t;return n!==(i=s).getPriority().val()&&(i=i.updatePriority(new mc(n))),s.forEachChild(vc,function(t,e){var n=mh(e,r);n!==e&&(i=i.updateImmediateChild(t,n))}),i};(dh=ph=ph||{})[dh.OVERWRITE=0]="OVERWRITE",dh[dh.MERGE=1]="MERGE",dh[dh.ACK_USER_WRITE=2]="ACK_USER_WRITE",dh[dh.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var yh=(gh.User=new gh(!0,!1,null,!1),gh.Server=new gh(!1,!0,null,!1),gh.forServerTaggedQuery=function(t){return new gh(!1,!0,t,!0)},gh);function gh(t,e,n,r){this.fromUser=t,this.fromServer=e,this.queryId=n,this.tagged=r,Ia(!r||e,"Tagged queries must be from server.")}var vh,bh=(wh.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Ia(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var e=this.affectedTree.subtree(new bu(t));return new wh(bu.Empty,e,this.revert)}return Ia(this.path.getFront()===t,"operationForChild called for unrelated child."),new wh(this.path.popFront(),this.affectedTree,this.revert)},wh);function wh(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=ph.ACK_USER_WRITE,this.source=yh.User}var _h=(Th.fromObject=function(t){var n=Th.Empty;return pu(t,function(t,e){n=n.set(new bu(t),e)}),n},Th.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},Th.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:bu.Empty,value:this.value};if(t.isEmpty())return null;var n=t.getFront(),r=this.children.get(n);if(null===r)return null;var i=r.findRootMostMatchingPathAndValue(t.popFront(),e);return null==i?null:{path:new bu(n).child(i.path),value:i.value}},Th.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},Th.prototype.subtree=function(t){if(t.isEmpty())return this;var e=t.getFront(),n=this.children.get(e);return null!==n?n.subtree(t.popFront()):Th.Empty},Th.prototype.set=function(t,e){if(t.isEmpty())return new Th(e,this.children);var n=t.getFront(),r=(this.children.get(n)||Th.Empty).set(t.popFront(),e),i=this.children.insert(n,r);return new Th(this.value,i)},Th.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?Th.Empty:new Th(null,this.children);var e=t.getFront(),n=this.children.get(e);if(n){var r=n.remove(t.popFront()),i=void 0;return i=r.isEmpty()?this.children.remove(e):this.children.insert(e,r),null===this.value&&i.isEmpty()?Th.Empty:new Th(this.value,i)}return this},Th.prototype.get=function(t){if(t.isEmpty())return this.value;var e=t.getFront(),n=this.children.get(e);return n?n.get(t.popFront()):null},Th.prototype.setTree=function(t,e){if(t.isEmpty())return e;var n=t.getFront(),r=(this.children.get(n)||Th.Empty).setTree(t.popFront(),e),i=void 0;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Th(this.value,i)},Th.prototype.fold=function(t){return this.fold_(bu.Empty,t)},Th.prototype.fold_=function(n,r){var i={};return this.children.inorderTraversal(function(t,e){i[t]=e.fold_(n.child(t),r)}),r(n,this.value,i)},Th.prototype.findOnPath=function(t,e){return this.findOnPath_(t,bu.Empty,e)},Th.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(t.isEmpty())return null;var i=t.getFront(),o=this.children.get(i);return o?o.findOnPath_(t.popFront(),e.child(i),n):null},Th.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,bu.Empty,e)},Th.prototype.foreachOnPath_=function(t,e,n){if(t.isEmpty())return this;this.value&&n(e,this.value);var r=t.getFront(),i=this.children.get(r);return i?i.foreachOnPath_(t.popFront(),e.child(r),n):Th.Empty},Th.prototype.foreach=function(t){this.foreach_(bu.Empty,t)},Th.prototype.foreach_=function(n,r){this.children.inorderTraversal(function(t,e){e.foreach_(n.child(t),r)}),this.value&&r(n,this.value)},Th.prototype.foreachChild=function(n){this.children.inorderTraversal(function(t,e){e.value&&n(t,e.value)})},Th.Empty=new Th(null),Th);function Th(t,e){void 0===e&&(e=vh=vh||new Ic($s)),this.value=t,this.children=e}var Eh=(Sh.prototype.operationForChild=function(t){return this.path.isEmpty()?new Sh(this.source,bu.Empty):new Sh(this.source,this.path.popFront())},Sh);function Sh(t,e){this.source=t,this.path=e,this.type=ph.LISTEN_COMPLETE}var Ih=(Ch.prototype.operationForChild=function(t){return this.path.isEmpty()?new Ch(this.source,bu.Empty,this.snap.getImmediateChild(t)):new Ch(this.source,this.path.popFront(),this.snap)},Ch);function Ch(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=ph.OVERWRITE}var Nh=(Ah.prototype.operationForChild=function(t){if(this.path.isEmpty()){var e=this.children.subtree(new bu(t));return e.isEmpty()?null:e.value?new Ih(this.source,bu.Empty,e.value):new Ah(this.source,bu.Empty,e)}return Ia(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new Ah(this.source,this.path.popFront(),this.children)},Ah.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},Ah);function Ah(t,e,n){this.source=t,this.path=e,this.children=n,this.type=ph.MERGE}var kh=(Dh.prototype.isFullyInitialized=function(){return this.fullyInitialized_},Dh.prototype.isFiltered=function(){return this.filtered_},Dh.prototype.isCompleteForPath=function(t){if(t.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var e=t.getFront();return this.isCompleteForChild(e)},Dh.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},Dh.prototype.getNode=function(){return this.node_},Dh);function Dh(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}var Rh=(Oh.prototype.updateEventSnap=function(t,e,n){return new Oh(new kh(t,e,n),this.serverCache_)},Oh.prototype.updateServerSnap=function(t,e,n){return new Oh(this.eventCache_,new kh(t,e,n))},Oh.prototype.getEventCache=function(){return this.eventCache_},Oh.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},Oh.prototype.getServerCache=function(){return this.serverCache_},Oh.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},Oh.Empty=new Oh(new kh(Vc.EMPTY_NODE,!1,!1),new kh(Vc.EMPTY_NODE,!1,!1)),Oh);function Oh(t,e){this.eventCache_=t,this.serverCache_=e}var Ph=(Mh.valueChange=function(t){return new Mh(Mh.VALUE,t)},Mh.childAddedChange=function(t,e){return new Mh(Mh.CHILD_ADDED,e,t)},Mh.childRemovedChange=function(t,e){return new Mh(Mh.CHILD_REMOVED,e,t)},Mh.childChangedChange=function(t,e,n){return new Mh(Mh.CHILD_CHANGED,e,t,n)},Mh.childMovedChange=function(t,e){return new Mh(Mh.CHILD_MOVED,e,t)},Mh.CHILD_ADDED="child_added",Mh.CHILD_REMOVED="child_removed",Mh.CHILD_CHANGED="child_changed",Mh.CHILD_MOVED="child_moved",Mh.VALUE="value",Mh);function Mh(t,e,n,r,i){this.type=t,this.snapshotNode=e,this.childName=n,this.oldSnap=r,this.prevName=i}var xh=(Lh.prototype.updateChild=function(t,e,n,r,i,o){Ia(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?t:(null!=o&&(n.isEmpty()?t.hasChild(e)?o.trackChildChange(Ph.childRemovedChange(e,a)):Ia(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ph.childAddedChange(e,n)):o.trackChildChange(Ph.childChangedChange(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},Lh.prototype.updateFullNode=function(r,n,i){return null!=i&&(r.isLeafNode()||r.forEachChild(vc,function(t,e){n.hasChild(t)||i.trackChildChange(Ph.childRemovedChange(t,e))}),n.isLeafNode()||n.forEachChild(vc,function(t,e){if(r.hasChild(t)){var n=r.getImmediateChild(t);n.equals(e)||i.trackChildChange(Ph.childChangedChange(t,e,n))}else i.trackChildChange(Ph.childAddedChange(t,e))})),n.withIndex(this.index_)},Lh.prototype.updatePriority=function(t,e){return t.isEmpty()?Vc.EMPTY_NODE:t.updatePriority(e)},Lh.prototype.filtersNodes=function(){return!1},Lh.prototype.getIndexedFilter=function(){return this},Lh.prototype.getIndex=function(){return this.index_},Lh);function Lh(t){this.index_=t}var Fh=(Uh.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;Ia(e===Ph.CHILD_ADDED||e===Ph.CHILD_CHANGED||e===Ph.CHILD_REMOVED,"Only child changes supported for tracking"),Ia(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(e===Ph.CHILD_ADDED&&i===Ph.CHILD_REMOVED)this.changeMap.set(n,Ph.childChangedChange(n,t.snapshotNode,r.snapshotNode));else if(e===Ph.CHILD_REMOVED&&i===Ph.CHILD_ADDED)this.changeMap.delete(n);else if(e===Ph.CHILD_REMOVED&&i===Ph.CHILD_CHANGED)this.changeMap.set(n,Ph.childRemovedChange(n,r.oldSnap));else if(e===Ph.CHILD_CHANGED&&i===Ph.CHILD_ADDED)this.changeMap.set(n,Ph.childAddedChange(n,t.snapshotNode));else{if(e!==Ph.CHILD_CHANGED||i!==Ph.CHILD_CHANGED)throw Ca("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,Ph.childChangedChange(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},Uh.prototype.getChanges=function(){return Array.from(this.changeMap.values())},Uh);function Uh(){this.changeMap=new Map}function Vh(){}var qh=new(Vh.prototype.getCompleteChild=function(t){return null},Vh.prototype.getChildAfterChild=function(t,e,n){return null},Vh),Bh=(jh.prototype.getCompleteChild=function(t){var e=this.viewCache_.getEventCache();if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new kh(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(t,n)},jh.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,e,1,n,t);return 0===i.length?null:i[0]},jh);function jh(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}var Wh=function(t,e){this.viewCache=t,this.changes=e},Kh=(Qh.prototype.assertIndexed=function(t){Ia(t.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Ia(t.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},Qh.prototype.applyOperation=function(t,e,n,r){var i,o,a=new Fh;if(e.type===ph.OVERWRITE){var s=e;i=s.source.fromUser?this.applyUserOverwrite_(t,s.path,s.snap,n,r,a):(Ia(s.source.fromServer,"Unknown source."),o=s.source.tagged||t.getServerCache().isFiltered()&&!s.path.isEmpty(),this.applyServerOverwrite_(t,s.path,s.snap,n,r,o,a))}else if(e.type===ph.MERGE){var u=e;i=u.source.fromUser?this.applyUserMerge_(t,u.path,u.children,n,r,a):(Ia(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.getServerCache().isFiltered(),this.applyServerMerge_(t,u.path,u.children,n,r,o,a))}else if(e.type===ph.ACK_USER_WRITE){var c=e;i=c.revert?this.revertUserWrite_(t,c.path,n,r,a):this.ackUserWrite_(t,c.path,c.affectedTree,n,r,a)}else{if(e.type!==ph.LISTEN_COMPLETE)throw Ca("Unknown operation type: "+e.type);i=this.listenComplete_(t,e.path,n,a)}var h=a.getChanges();return Qh.maybeAddValueEvent_(t,i,h),new Wh(i,h)},Qh.maybeAddValueEvent_=function(t,e,n){var r=e.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=t.getCompleteEventSnap();(0<n.length||!t.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(Ph.valueChange(e.getCompleteEventSnap()))}},Qh.prototype.generateEventCacheAfterServerEvent_=function(t,e,n,r,i){var o=t.getEventCache();if(null!=n.shadowingWrite(e))return t;var a=void 0,s=void 0;if(e.isEmpty())if(Ia(t.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),t.getServerCache().isFiltered()){var u=t.getCompleteServerSnap(),c=u instanceof Vc?u:Vc.EMPTY_NODE,h=n.calcCompleteEventChildren(c);a=this.filter_.updateFullNode(t.getEventCache().getNode(),h,i)}else{var l=n.calcCompleteEventCache(t.getCompleteServerSnap());a=this.filter_.updateFullNode(t.getEventCache().getNode(),l,i)}else{var f=e.getFront();if(".priority"===f){Ia(1===e.getLength(),"Can't have a priority with additional path components");var p=o.getNode();s=t.getServerCache().getNode();var d=n.calcEventCacheAfterServerOverwrite(e,p,s);a=null!=d?this.filter_.updatePriority(p,d):o.getNode()}else{var m=e.popFront(),y=void 0;if(o.isCompleteForChild(f)){s=t.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(e,o.getNode(),s);y=null!=g?o.getNode().getImmediateChild(f).updateChild(m,g):o.getNode().getImmediateChild(f)}else y=n.calcCompleteChild(f,t.getServerCache());a=null!=y?this.filter_.updateChild(o.getNode(),f,y,m,r,i):o.getNode()}}return t.updateEventSnap(a,o.isFullyInitialized()||e.isEmpty(),this.filter_.filtersNodes())},Qh.prototype.applyServerOverwrite_=function(t,e,n,r,i,o,a){var s,u=t.getServerCache(),c=o?this.filter_:this.filter_.getIndexedFilter();if(e.isEmpty())s=c.updateFullNode(u.getNode(),n,null);else if(c.filtersNodes()&&!u.isFiltered()){var h=u.getNode().updateChild(e,n);s=c.updateFullNode(u.getNode(),h,null)}else{var l=e.getFront();if(!u.isCompleteForPath(e)&&1<e.getLength())return t;var f=e.popFront(),p=u.getNode().getImmediateChild(l).updateChild(f,n);s=".priority"===l?c.updatePriority(u.getNode(),p):c.updateChild(u.getNode(),l,p,f,qh,null)}var d=t.updateServerSnap(s,u.isFullyInitialized()||e.isEmpty(),c.filtersNodes()),m=new Bh(r,d,i);return this.generateEventCacheAfterServerEvent_(d,e,r,m,a)},Qh.prototype.applyUserOverwrite_=function(t,e,n,r,i,o){var a,s,u=t.getEventCache(),c=new Bh(r,t,i);if(e.isEmpty())s=this.filter_.updateFullNode(t.getEventCache().getNode(),n,o),a=t.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var h=e.getFront();if(".priority"===h)s=this.filter_.updatePriority(t.getEventCache().getNode(),n),a=t.updateEventSnap(s,u.isFullyInitialized(),u.isFiltered());else{var l=e.popFront(),f=u.getNode().getImmediateChild(h),p=void 0;if(l.isEmpty())p=n;else{var d=c.getCompleteChild(h);p=null!=d?".priority"===l.getBack()&&d.getChild(l.parent()).isEmpty()?d:d.updateChild(l,n):Vc.EMPTY_NODE}if(f.equals(p))a=t;else{var m=this.filter_.updateChild(u.getNode(),h,p,l,c,o);a=t.updateEventSnap(m,u.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},Qh.cacheHasChild_=function(t,e){return t.getEventCache().isCompleteForChild(e)},Qh.prototype.applyUserMerge_=function(r,i,t,o,a,s){var u=this,c=r;return t.foreach(function(t,e){var n=i.child(t);Qh.cacheHasChild_(r,n.getFront())&&(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),t.foreach(function(t,e){var n=i.child(t);Qh.cacheHasChild_(r,n.getFront())||(c=u.applyUserOverwrite_(c,n,e,o,a,s))}),c},Qh.prototype.applyMerge_=function(n,t){return t.foreach(function(t,e){n=n.updateChild(t,e)}),n},Qh.prototype.applyServerMerge_=function(o,t,e,a,s,u,c){var h=this;if(o.getServerCache().getNode().isEmpty()&&!o.getServerCache().isFullyInitialized())return o;var n,l=o;n=t.isEmpty()?e:_h.Empty.setTree(t,e);var f=o.getServerCache().getNode();return n.children.inorderTraversal(function(t,e){if(f.hasChild(t)){var n=o.getServerCache().getNode().getImmediateChild(t),r=h.applyMerge_(n,e);l=h.applyServerOverwrite_(l,new bu(t),r,a,s,u,c)}}),n.children.inorderTraversal(function(t,e){var n=!o.getServerCache().isCompleteForChild(t)&&null==e.value;if(!f.hasChild(t)&&!n){var r=o.getServerCache().getNode().getImmediateChild(t),i=h.applyMerge_(r,e);l=h.applyServerOverwrite_(l,new bu(t),i,a,s,u,c)}}),l},Qh.prototype.ackUserWrite_=function(t,r,e,n,i,o){if(null!=n.shadowingWrite(r))return t;var a=t.getServerCache().isFiltered(),s=t.getServerCache();if(null!=e.value){if(r.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(r))return this.applyServerOverwrite_(t,r,s.getNode().getChild(r),n,i,a,o);if(r.isEmpty()){var u=_h.Empty;return s.getNode().forEachChild(uc,function(t,e){u=u.set(new bu(t),e)}),this.applyServerMerge_(t,r,u,n,i,a,o)}return t}var c=_h.Empty;return e.foreach(function(t,e){var n=r.child(t);s.isCompleteForPath(n)&&(c=c.set(t,s.getNode().getChild(n)))}),this.applyServerMerge_(t,r,c,n,i,a,o)},Qh.prototype.listenComplete_=function(t,e,n,r){var i=t.getServerCache(),o=t.updateServerSnap(i.getNode(),i.isFullyInitialized()||e.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(o,e,n,qh,r)},Qh.prototype.revertUserWrite_=function(t,e,n,r,i){var o;if(null!=n.shadowingWrite(e))return t;var a=new Bh(n,t,r),s=t.getEventCache().getNode(),u=void 0;if(e.isEmpty()||".priority"===e.getFront()){var c=void 0;if(t.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(t.getCompleteServerSnap());else{var h=t.getServerCache().getNode();Ia(h instanceof Vc,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(s,c,i)}else{var l=e.getFront(),f=n.calcCompleteChild(l,t.getServerCache());null==f&&t.getServerCache().isCompleteForChild(l)&&(f=s.getImmediateChild(l)),(u=null!=f?this.filter_.updateChild(s,l,f,e.popFront(),a,i):t.getEventCache().getNode().hasChild(l)?this.filter_.updateChild(s,l,Vc.EMPTY_NODE,e.popFront(),a,i):s).isEmpty()&&t.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(t.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=t.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(bu.Empty),t.updateEventSnap(u,o,this.filter_.filtersNodes())},Qh);function Qh(t){this.filter_=t}var Hh=(Gh.prototype.generateEventsForChanges=function(t,e,n){var r=this,i=[],o=[];return t.forEach(function(t){t.type===Ph.CHILD_CHANGED&&r.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push(Ph.childMovedChange(t.childName,t.snapshotNode))}),this.generateEventsForType_(i,Ph.CHILD_REMOVED,t,n,e),this.generateEventsForType_(i,Ph.CHILD_ADDED,t,n,e),this.generateEventsForType_(i,Ph.CHILD_MOVED,o,n,e),this.generateEventsForType_(i,Ph.CHILD_CHANGED,t,n,e),this.generateEventsForType_(i,Ph.VALUE,t,n,e),i},Gh.prototype.generateEventsForType_=function(r,e,t,i,o){var a=this,n=t.filter(function(t){return t.type===e});n.sort(this.compareChanges_.bind(this)),n.forEach(function(e){var n=a.materializeSingleChange_(e,o);i.forEach(function(t){t.respondsTo(e.type)&&r.push(t.createEvent(n,a.query_))})})},Gh.prototype.materializeSingleChange_=function(t,e){return"value"===t.type||"child_removed"===t.type||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,this.index_)),t},Gh.prototype.compareChanges_=function(t,e){if(null==t.childName||null==e.childName)throw Ca("Should only compare child_ events.");var n=new Zu(t.childName,t.snapshotNode),r=new Zu(e.childName,e.snapshotNode);return this.index_.compare(n,r)},Gh);function Gh(t){this.query_=t,this.index_=this.query_.getQueryParams().getIndex()}var zh,Yh=(Xh.prototype.getQuery=function(){return this.query_},Xh.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},Xh.prototype.getCompleteServerCache=function(t){var e=this.viewCache_.getCompleteServerSnap();return e&&(this.query_.getQueryParams().loadsAllData()||!t.isEmpty()&&!e.getImmediateChild(t.getFront()).isEmpty())?e.getChild(t):null},Xh.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},Xh.prototype.addEventRegistration=function(t){this.eventRegistrations_.push(t)},Xh.prototype.removeEventRegistration=function(t,n){var r=[];if(n){Ia(null==t,"A cancel should cancel all event registrations.");var i=this.query_.path;this.eventRegistrations_.forEach(function(t){n=n;var e=t.createCancelEvent(n,i);e&&r.push(e)})}if(t){for(var e=[],o=0;o<this.eventRegistrations_.length;++o){var a=this.eventRegistrations_[o];if(a.matches(t)){if(t.hasAnyCallback()){e=e.concat(this.eventRegistrations_.slice(o+1));break}}else e.push(a)}this.eventRegistrations_=e}else this.eventRegistrations_=[];return r},Xh.prototype.applyOperation=function(t,e,n){t.type===ph.MERGE&&null!==t.source.queryId&&(Ia(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Ia(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,t,e,n);return this.processor_.assertIndexed(i.viewCache),Ia(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},Xh.prototype.getInitialEvents=function(t){var e=this.viewCache_.getEventCache(),n=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(vc,function(t,e){n.push(Ph.childAddedChange(t,e))}),e.isFullyInitialized()&&n.push(Ph.valueChange(e.getNode())),this.generateEventsForChanges_(n,e.getNode(),t)},Xh.prototype.generateEventsForChanges_=function(t,e,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(t,e,r)},Xh);function Xh(t,e){this.query_=t,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new xh(n.getIndex()),i=n.getNodeFilter();this.processor_=new Kh(i);var o=e.getServerCache(),a=e.getEventCache(),s=r.updateFullNode(Vc.EMPTY_NODE,o.getNode(),null),u=i.updateFullNode(Vc.EMPTY_NODE,a.getNode(),null),c=new kh(s,o.isFullyInitialized(),r.filtersNodes()),h=new kh(u,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=new Rh(h,c),this.eventGenerator_=new Hh(this.query_)}var Jh=(Object.defineProperty($h,"__referenceConstructor",{get:function(){return Ia(zh,"Reference.ts has not been loaded"),zh},set:function(t){Ia(!zh,"__referenceConstructor has already been defined"),zh=t},enumerable:!0,configurable:!0}),$h.prototype.isEmpty=function(){return 0===this.views.size},$h.prototype.applyOperation=function(t,e,n){var r,i,o=t.source.queryId;if(null!==o){var a=this.views.get(o);return Ia(null!=a,"SyncTree gave us an op for an invalid query."),a.applyOperation(t,e,n)}var s=[];try{for(var u=va(this.views.values()),c=u.next();!c.done;c=u.next())a=c.value,s=s.concat(a.applyOperation(t,e,n))}catch(t){r={error:t}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}return s},$h.prototype.addEventRegistration=function(t,e,n,r,i){var o=t.queryIdentifier(),a=this.views.get(o);if(!a){var s=n.calcCompleteEventCache(i?r:null),u=!1;u=!!s||(s=r instanceof Vc?n.calcCompleteEventChildren(r):Vc.EMPTY_NODE,!1);var c=new Rh(new kh(s,u,!1),new kh(r,i,!1));a=new Yh(t,c),this.views.set(o,a)}return a.addEventRegistration(e),a.getInitialEvents(e)},$h.prototype.removeEventRegistration=function(t,e,n){var r,i,o=t.queryIdentifier(),a=[],s=[],u=this.hasCompleteView();if("default"===o)try{for(var c=va(this.views.entries()),h=c.next();!h.done;h=c.next()){var l=ba(h.value,2),f=l[0],p=l[1];s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(f),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery()))}}catch(t){r={error:t}}finally{try{h&&!h.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}else(p=this.views.get(o))&&(s=s.concat(p.removeEventRegistration(e,n)),p.isEmpty()&&(this.views.delete(o),p.getQuery().getQueryParams().loadsAllData()||a.push(p.getQuery())));return u&&!this.hasCompleteView()&&a.push(new $h.__referenceConstructor(t.repo,t.path)),{removed:a,events:s}},$h.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=va(this.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},$h.prototype.getCompleteServerCache=function(t){var e,n,r=null;try{for(var i=va(this.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;r=r||a.getCompleteServerCache(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r},$h.prototype.viewForQuery=function(t){if(t.getQueryParams().loadsAllData())return this.getCompleteView();var e=t.queryIdentifier();return this.views.get(e)},$h.prototype.viewExistsForQuery=function(t){return null!=this.viewForQuery(t)},$h.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},$h.prototype.getCompleteView=function(){var e,t;try{for(var n=va(this.views.values()),r=n.next();!r.done;r=n.next()){var i=r.value;if(i.getQuery().getQueryParams().loadsAllData())return i}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},$h);function $h(){this.views=new Map}var Zh=(tl.prototype.addWrite=function(t,e){if(t.isEmpty())return new tl(new _h(e));var n=this.writeTree_.findRootMostValueAndPath(t);if(null!=n){var r=n.path,i=n.value,o=bu.relativePath(r,t);return i=i.updateChild(o,e),new tl(this.writeTree_.set(r,i))}var a=new _h(e);return new tl(this.writeTree_.setTree(t,a))},tl.prototype.addWrites=function(n,t){var r=this;return pu(t,function(t,e){r=r.addWrite(n.child(t),e)}),r},tl.prototype.removeWrite=function(t){return t.isEmpty()?tl.Empty:new tl(this.writeTree_.setTree(t,_h.Empty))},tl.prototype.hasCompleteWrite=function(t){return null!=this.getCompleteNode(t)},tl.prototype.getCompleteNode=function(t){var e=this.writeTree_.findRootMostValueAndPath(t);return null!=e?this.writeTree_.get(e.path).getChild(bu.relativePath(e.path,t)):null},tl.prototype.getCompleteChildren=function(){var n=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(vc,function(t,e){n.push(new Zu(t,e))}):this.writeTree_.children.inorderTraversal(function(t,e){null!=e.value&&n.push(new Zu(t,e.value))}),n},tl.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var e=this.getCompleteNode(t);return new tl(null!=e?new _h(e):this.writeTree_.subtree(t))},tl.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},tl.prototype.apply=function(t){return function n(r,t,i){if(null!=t.value)return i.updateChild(r,t.value);var o=null;return t.children.inorderTraversal(function(t,e){".priority"===t?(Ia(null!==e.value,"Priority writes must always be leaf nodes"),o=e.value):i=n(r.child(t),e,i)}),i.getChild(r).isEmpty()||null===o||(i=i.updateChild(r.child(".priority"),o)),i}(bu.Empty,this.writeTree_,t)},tl.Empty=new tl(new _h(null)),tl);function tl(t){this.writeTree_=t}var el=(nl.prototype.childWrites=function(t){return new rl(t,this)},nl.prototype.addOverwrite=function(t,e,n,r){Ia(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:t,snap:e,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(t,e)),this.lastWriteId_=n},nl.prototype.addMerge=function(t,e,n){Ia(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:t,children:e,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(t,e),this.lastWriteId_=n},nl.prototype.getWrite=function(t){for(var e=0;e<this.allWrites_.length;e++){var n=this.allWrites_[e];if(n.writeId===t)return n}return null},nl.prototype.removeWrite=function(e){var n=this,t=this.allWrites_.findIndex(function(t){return t.writeId===e});Ia(0<=t,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[t];this.allWrites_.splice(t,1);for(var i=r.visible,o=!1,a=this.allWrites_.length-1;i&&0<=a;){var s=this.allWrites_[a];s.visible&&(t<=a&&this.recordContainsPath_(s,r.path)?i=!1:r.path.contains(s.path)&&(o=!0)),a--}return!!i&&(o?this.resetTree_():r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):pu(r.children,function(t){n.visibleWrites_=n.visibleWrites_.removeWrite(r.path.child(t))}),!0)},nl.prototype.getCompleteWriteData=function(t){return this.visibleWrites_.getCompleteNode(t)},nl.prototype.calcCompleteEventCache=function(e,t,n,r){if(n||r){var i=this.visibleWrites_.childCompoundWrite(e);if(!r&&i.isEmpty())return t;if(r||null!=t||i.hasCompleteWrite(bu.Empty)){var o=nl.layerTree_(this.allWrites_,function(t){return(t.visible||r)&&(!n||!~n.indexOf(t.writeId))&&(t.path.contains(e)||e.contains(t.path))},e);return u=t||Vc.EMPTY_NODE,o.apply(u)}return null}var a=this.visibleWrites_.getCompleteNode(e);if(null!=a)return a;var s=this.visibleWrites_.childCompoundWrite(e);if(s.isEmpty())return t;if(null!=t||s.hasCompleteWrite(bu.Empty)){var u=t||Vc.EMPTY_NODE;return s.apply(u)}return null},nl.prototype.calcCompleteEventChildren=function(t,e){var r=Vc.EMPTY_NODE,n=this.visibleWrites_.getCompleteNode(t);if(n)return n.isLeafNode()||n.forEachChild(vc,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(e){var i=this.visibleWrites_.childCompoundWrite(t);return e.forEachChild(vc,function(t,e){var n=i.childCompoundWrite(new bu(t)).apply(e);r=r.updateImmediateChild(t,n)}),i.getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return this.visibleWrites_.childCompoundWrite(t).getCompleteChildren().forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r},nl.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n,r){Ia(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=t.child(e);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(e):o.apply(r.getChild(e))},nl.prototype.calcCompleteChild=function(t,e,n){var r=t.child(e),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(e)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(e)):null},nl.prototype.shadowingWrite=function(t){return this.visibleWrites_.getCompleteNode(t)},nl.prototype.calcIndexedSlice=function(t,e,n,r,i,o){var a,s=this.visibleWrites_.childCompoundWrite(t),u=s.getCompleteNode(bu.Empty);if(null!=u)a=u;else{if(null==e)return[];a=s.apply(e)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];for(var c=[],h=o.getCompare(),l=i?a.getReverseIteratorFrom(n,o):a.getIteratorFrom(n,o),f=l.getNext();f&&c.length<r;)0!==h(f,n)&&c.push(f),f=l.getNext();return c},nl.prototype.recordContainsPath_=function(t,e){if(t.snap)return t.path.contains(e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&t.path.child(n).contains(e))return!0;return!1},nl.prototype.resetTree_=function(){this.visibleWrites_=nl.layerTree_(this.allWrites_,nl.DefaultFilter_,bu.Empty),0<this.allWrites_.length?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},nl.DefaultFilter_=function(t){return t.visible},nl.layerTree_=function(t,e,n){for(var r=Zh.Empty,i=0;i<t.length;++i){var o=t[i];if(e(o)){var a=o.path,s=void 0;if(o.snap)n.contains(a)?(s=bu.relativePath(n,a),r=r.addWrite(s,o.snap)):a.contains(n)&&(s=bu.relativePath(a,n),r=r.addWrite(bu.Empty,o.snap.getChild(s)));else{if(!o.children)throw Ca("WriteRecord should have .snap or .children");if(n.contains(a))s=bu.relativePath(n,a),r=r.addWrites(s,o.children);else if(a.contains(n))if((s=bu.relativePath(a,n)).isEmpty())r=r.addWrites(bu.Empty,o.children);else{var u=Ha(o.children,s.getFront());if(u){var c=u.getChild(s.popFront());r=r.addWrite(bu.Empty,c)}}}}}return r},nl);function nl(){this.visibleWrites_=Zh.Empty,this.allWrites_=[],this.lastWriteId_=-1}var rl=(il.prototype.calcCompleteEventCache=function(t,e,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,t,e,n)},il.prototype.calcCompleteEventChildren=function(t){return this.writeTree_.calcCompleteEventChildren(this.treePath_,t)},il.prototype.calcEventCacheAfterServerOverwrite=function(t,e,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,t,e,n)},il.prototype.shadowingWrite=function(t){return this.writeTree_.shadowingWrite(this.treePath_.child(t))},il.prototype.calcIndexedSlice=function(t,e,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,t,e,n,r,i)},il.prototype.calcCompleteChild=function(t,e){return this.writeTree_.calcCompleteChild(this.treePath_,t,e)},il.prototype.child=function(t){return new il(this.treePath_.child(t),this.writeTree_)},il);function il(t,e){this.treePath_=t,this.writeTree_=e}var ol=(al.prototype.applyUserOverwrite=function(t,e,n,r){return this.pendingWriteTree_.addOverwrite(t,e,n,r),r?this.applyOperationToSyncPoints_(new Ih(yh.User,t,e)):[]},al.prototype.applyUserMerge=function(t,e,n){this.pendingWriteTree_.addMerge(t,e,n);var r=_h.fromObject(e);return this.applyOperationToSyncPoints_(new Nh(yh.User,t,r))},al.prototype.ackUserWrite=function(t,e){void 0===e&&(e=!1);var n=this.pendingWriteTree_.getWrite(t);if(this.pendingWriteTree_.removeWrite(t)){var r=_h.Empty;return null!=n.snap?r=r.set(bu.Empty,!0):pu(n.children,function(t,e){r=r.set(new bu(t),e)}),this.applyOperationToSyncPoints_(new bh(n.path,r,e))}return[]},al.prototype.applyServerOverwrite=function(t,e){return this.applyOperationToSyncPoints_(new Ih(yh.Server,t,e))},al.prototype.applyServerMerge=function(t,e){var n=_h.fromObject(e);return this.applyOperationToSyncPoints_(new Nh(yh.Server,t,n))},al.prototype.applyListenComplete=function(t){return this.applyOperationToSyncPoints_(new Eh(yh.Server,t))},al.prototype.applyTaggedQueryOverwrite=function(t,e,n){var r=this.queryKeyForTag_(n);if(null==r)return[];var i=al.parseQueryKey_(r),o=i.path,a=i.queryId,s=bu.relativePath(o,t),u=new Ih(yh.forServerTaggedQuery(a),s,e);return this.applyTaggedOperation_(o,u)},al.prototype.applyTaggedQueryMerge=function(t,e,n){var r=this.queryKeyForTag_(n);if(r){var i=al.parseQueryKey_(r),o=i.path,a=i.queryId,s=bu.relativePath(o,t),u=_h.fromObject(e),c=new Nh(yh.forServerTaggedQuery(a),s,u);return this.applyTaggedOperation_(o,c)}return[]},al.prototype.applyTaggedListenComplete=function(t,e){var n=this.queryKeyForTag_(e);if(n){var r=al.parseQueryKey_(n),i=r.path,o=r.queryId,a=bu.relativePath(i,t),s=new Eh(yh.forServerTaggedQuery(o),a);return this.applyTaggedOperation_(i,s)}return[]},al.prototype.addEventRegistration=function(t,e){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,function(t,e){var n=bu.relativePath(t,r);i=i||e.getCompleteServerCache(n),o=o||e.hasCompleteView()});var n,a=this.syncPointTree_.get(r);a?(o=o||a.hasCompleteView(),i=i||a.getCompleteServerCache(bu.Empty)):(a=new Jh,this.syncPointTree_=this.syncPointTree_.set(r,a)),null!=i?n=!0:(n=!1,i=Vc.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=e.getCompleteServerCache(bu.Empty);n&&(i=i.updateImmediateChild(t,n))}));var s=a.viewExistsForQuery(t);if(!s&&!t.getQueryParams().loadsAllData()){var u=al.makeQueryKey_(t);Ia(!this.queryToTagMap.has(u),"View does not exist, but we have a tag");var c=al.getNextQueryTag_();this.queryToTagMap.set(u,c),this.tagToQueryMap.set(c,u)}var h=this.pendingWriteTree_.childWrites(r),l=a.addEventRegistration(t,e,h,i,n);if(!s&&!o){var f=a.viewForQuery(t);l=l.concat(this.setupListener_(t,f))}return l},al.prototype.removeEventRegistration=function(t,e,n){var r=this,i=t.path,o=this.syncPointTree_.get(i),a=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var s=o.removeEventRegistration(t,e,n);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(i));var u=s.removed;a=s.events;var c=-1!==u.findIndex(function(t){return t.getQueryParams().loadsAllData()}),h=this.syncPointTree_.findOnPath(i,function(t,e){return e.hasCompleteView()});if(c&&!h){var l=this.syncPointTree_.subtree(i);if(!l.isEmpty())for(var f=this.collectDistinctViewsForSubTree_(l),p=0;p<f.length;++p){var d=f[p],m=d.getQuery(),y=this.createListenerForView_(d);this.listenProvider_.startListening(al.queryForListening_(m),this.tagForQuery_(m),y.hashFn,y.onComplete)}}!h&&0<u.length&&!n&&(c?this.listenProvider_.stopListening(al.queryForListening_(t),null):u.forEach(function(t){var e=r.queryToTagMap.get(al.makeQueryKey_(t));r.listenProvider_.stopListening(al.queryForListening_(t),e)})),this.removeTags_(u)}return a},al.prototype.calcCompleteEventCache=function(i,t){var e=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(i,function(t,e){var n=bu.relativePath(t,i),r=e.getCompleteServerCache(n);if(r)return r});return e.calcCompleteEventCache(i,n,t,!0)},al.prototype.collectDistinctViewsForSubTree_=function(t){return t.fold(function(t,e,n){if(e&&e.hasCompleteView())return[e.getCompleteView()];var r=[];return e&&(r=e.getQueryViews()),pu(n,function(t,e){r=r.concat(e)}),r})},al.prototype.removeTags_=function(t){for(var e=0;e<t.length;++e){var n=t[e];if(!n.getQueryParams().loadsAllData()){var r=al.makeQueryKey_(n),i=this.queryToTagMap.get(r);this.queryToTagMap.delete(r),this.tagToQueryMap.delete(i)}}},al.queryForListening_=function(t){return t.getQueryParams().loadsAllData()&&!t.getQueryParams().isDefault()?t.getRef():t},al.prototype.setupListener_=function(t,e){var n=t.path,r=this.tagForQuery_(t),i=this.createListenerForView_(e),o=this.listenProvider_.startListening(al.queryForListening_(t),r,i.hashFn,i.onComplete),a=this.syncPointTree_.subtree(n);if(r)Ia(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(t,e,n){if(!t.isEmpty()&&e&&e.hasCompleteView())return[e.getCompleteView().getQuery()];var r=[];return e&&(r=r.concat(e.getQueryViews().map(function(t){return t.getQuery()}))),pu(n,function(t,e){r=r.concat(e)}),r}),u=0;u<s.length;++u){var c=s[u];this.listenProvider_.stopListening(al.queryForListening_(c),this.tagForQuery_(c))}return o},al.prototype.createListenerForView_=function(t){var n=this,r=t.getQuery(),i=this.tagForQuery_(r);return{hashFn:function(){return(t.getServerCache()||Vc.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return i?n.applyTaggedListenComplete(r.path,i):n.applyListenComplete(r.path);var e=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var r=new Error(t+" at "+e.path.toString()+": "+n);return r.code=t.toUpperCase(),r}(t,r);return n.removeEventRegistration(r,null,e)}}},al.makeQueryKey_=function(t){return t.path.toString()+"$"+t.queryIdentifier()},al.parseQueryKey_=function(t){var e=t.indexOf("$");return Ia(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new bu(t.substr(0,e))}},al.prototype.queryKeyForTag_=function(t){return this.tagToQueryMap.get(t)},al.prototype.tagForQuery_=function(t){var e=al.makeQueryKey_(t);return this.queryToTagMap.get(e)},al.getNextQueryTag_=function(){return al.nextQueryTag_++},al.prototype.applyTaggedOperation_=function(t,e){var n=this.syncPointTree_.get(t);Ia(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(t);return n.applyOperation(e,r,null)},al.prototype.applyOperationToSyncPoints_=function(t){return this.applyOperationHelper_(t,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(bu.Empty))},al.prototype.applyOperationHelper_=function(t,e,n,r){if(t.path.isEmpty())return this.applyOperationDescendantsHelper_(t,e,n,r);var i=e.get(bu.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(bu.Empty));var o=[],a=t.path.getFront(),s=t.operationForChild(a),u=e.children.get(a);if(u&&s){var c=n?n.getImmediateChild(a):null,h=r.child(a);o=o.concat(this.applyOperationHelper_(s,u,c,h))}return i&&(o=o.concat(i.applyOperation(t,r,n))),o},al.prototype.applyOperationDescendantsHelper_=function(o,t,a,s){var u=this,e=t.get(bu.Empty);null==a&&null!=e&&(a=e.getCompleteServerCache(bu.Empty));var c=[];return t.children.inorderTraversal(function(t,e){var n=a?a.getImmediateChild(t):null,r=s.child(t),i=o.operationForChild(t);i&&(c=c.concat(u.applyOperationDescendantsHelper_(i,e,n,r)))}),e&&(c=c.concat(e.applyOperation(o,s,a))),c},al.nextQueryTag_=1,al);function al(t){this.listenProvider_=t,this.syncPointTree_=_h.Empty,this.pendingWriteTree_=new el,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}var sl=(ul.prototype.getNode=function(t){return this.rootNode_.getChild(t)},ul.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},ul);function ul(){this.rootNode_=Vc.EMPTY_NODE}var cl=(hl.prototype.getToken=function(t){return this.auth_?this.auth_.getToken(t).catch(function(t){return t&&"auth/token-not-initialized"===t.code?(Hs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)}):Promise.resolve(null)},hl.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout(function(){return e(null)},0),this.authProvider_.get().then(function(t){return t.addAuthTokenListener(e)}))},hl.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then(function(t){return t.removeAuthTokenListener(e)})},hl.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Xs(t)},hl);function hl(t,e){var n=this;this.app_=t,this.authProvider_=e,this.auth_=null,this.auth_=e.getImmediate({optional:!0}),this.auth_||e.get().then(function(t){return n.auth_=t})}var ll=(pl.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Qa(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},pl.prototype.get=function(){return Aa(this.counters_)},pl);function pl(){this.counters_={}}var dl=(ml.getCollection=function(t){var e=t.toString();return this.collections_[e]||(this.collections_[e]=new ll),this.collections_[e]},ml.getOrCreateReporter=function(t,e){var n=t.toString();return this.reporters_[n]||(this.reporters_[n]=e()),this.reporters_[n]},ml.collections_={},ml.reporters_={},ml);function ml(){}var yl=(gl.prototype.get=function(){var t=this.collection_.get(),n=ma({},t);return this.last_&&pu(this.last_,function(t,e){n[t]=n[t]-e}),this.last_=t,n},gl);function gl(t){this.collection_=t,this.last_=null}var vl=(bl.prototype.includeStat=function(t){this.statsToReport_[t]=!0},bl.prototype.reportStats_=function(){var n=this,t=this.statsListener_.get(),r={},i=!1;pu(t,function(t,e){0<e&&Qa(n.statsToReport_,t)&&(r[t]=e,i=!0)}),i&&this.server_.reportStats(r),yu(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},bl);function bl(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new yl(t);var n=1e4+2e4*Math.random();yu(this.reportStats_.bind(this),Math.floor(n))}var wl=(_l.prototype.queueEvents=function(t){for(var e=null,n=0;n<t.length;n++){var r=t[n],i=r.getPath();null===e||i.equals(e.getPath())||(this.eventLists_.push(e),e=null),null===e&&(e=new Tl(i)),e.add(r)}e&&this.eventLists_.push(e)},_l.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},_l.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},_l.prototype.raiseQueuedEventsMatchingPredicate_=function(t){this.recursionDepth_++;for(var e=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];r&&(t(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):e=!1)}e&&(this.eventLists_=[]),this.recursionDepth_--},_l);function _l(){this.eventLists_=[],this.recursionDepth_=0}var Tl=(El.prototype.add=function(t){this.events_.push(t)},El.prototype.raise=function(){for(var t=0;t<this.events_.length;t++){var e=this.events_[t];if(null!==e){this.events_[t]=null;var n=e.getEventRunner();su&&Hs("event: "+e.toString()),mu(n)}}},El.prototype.getPath=function(){return this.path_},El);function El(t){this.path_=t,this.events_=[]}var Sl=(Il.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=wa(this.listeners_[t]),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},Il.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},Il.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},Il.prototype.validateEventType_=function(e){Ia(this.allowedEvents_.find(function(t){return t===e}),"Unknown event: "+e)},Il);function Il(t){this.allowedEvents_=t,this.listeners_={},Ia(Array.isArray(t)&&0<t.length,"Requires a non-empty array")}var Cl,Nl=(da(Al,Cl=Sl),Al.getInstance=function(){return new Al},Al.prototype.getInitialEvent=function(t){return Ia("visible"===t,"Unknown event type: "+t),[this.visible_]},Al);function Al(){var e,t,n=Cl.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))},!1),n}var kl,Dl=(da(Rl,kl=Sl),Rl.getInstance=function(){return new Rl},Rl.prototype.getInitialEvent=function(t){return Ia("online"===t,"Unknown event type: "+t),[this.online_]},Rl.prototype.currentlyOnline=function(){return this.online_},Rl);function Rl(){var t=kl.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Pa()||(window.addEventListener("online",function(){t.online_||(t.online_=!0,t.trigger("online",!0))},!1),window.addEventListener("offline",function(){t.online_&&(t.online_=!1,t.trigger("online",!1))},!1)),t}var Ol=(Pl.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},Pl.prototype.handleResponse=function(t,e){var r=this;this.pendingResponses[t]=e;for(var n=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&mu(function(){r.onMessage_(e[t])})},n=0;n<e.length;++n)t(n);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==n(););},Pl);function Pl(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var Ml=(xl.prototype.open=function(t,e){var a=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Ol(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){a.log_("Timed out trying to connect."),a.onClosed_(),a.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if("complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!a.isClosed_){a.scriptTagHolder=new Ll(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ba(t,5),r=n[0],i=n[1],o=n[2];if(n[3],n[4],a.incrementIncomingBytes_(t),a.scriptTagHolder)if(a.connectTimeoutTimer_&&(clearTimeout(a.connectTimeoutTimer_),a.connectTimeoutTimer_=null),a.everConnected_=!0,"start"===r)a.id=i,a.password=o;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(a.scriptTagHolder.sendNewPolls=!1,a.myPacketOrderer.closeAfter(i,function(){a.onClosed_()})):a.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=ba(t,2),r=n[0],i=n[1];a.incrementIncomingBytes_(t),a.myPacketOrderer.handleResponse(r,i)},function(){a.onClosed_()},a.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),a.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=a.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",a.transportSessionId&&(t.s=a.transportSessionId),a.lastSessionId&&(t.ls=a.lastSessionId),"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Eu)&&(t.r="f");var e=a.urlFn(t);a.log_("Connecting via long-poll to "+e),a.scriptTagHolder.addTag(e,function(){})}})},xl.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},xl.forceAllow=function(){xl.forceAllow_=!0},xl.forceDisallow=function(){xl.forceDisallow_=!0},xl.isAvailable=function(){return!!xl.forceAllow_||!(xl.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},xl.prototype.markConnectionHealthy=function(){},xl.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},xl.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},xl.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},xl.prototype.send=function(t){var e=Wa(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=function(t){var e=Ta(t);return Na.encodeByteArray(e,!0)}(e),r=tu(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},xl.prototype.addDisconnectPingFrame=function(t,e){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},xl.prototype.incrementIncomingBytes_=function(t){var e=Wa(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},xl);function xl(t,e,n,r){this.connId=t,this.repoInfo=e,this.transportSessionId=n,this.lastSessionId=r,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Gs(t),this.stats_=dl.getCollection(e),this.urlFn=function(t){return e.connectionURL(Iu,t)}}var Ll=(Fl.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Hs("No IE domain setting required")}catch(t){var n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},Fl.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},Fl.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},Fl.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return e+=n,this.addLongPollTag_(e,this.currentSerial),!0}return!1},Fl.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},Fl.prototype.addLongPollTag_=function(t,e){var n=this;function r(){n.outstandingRequests.delete(e),n.newRequest_()}this.outstandingRequests.add(e);var i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},Fl.prototype.addTag=function(t,n){var r=this;setTimeout(function(){try{if(!r.sendNewPolls)return;var e=r.myIFrame.doc.createElement("script");e.type="text/javascript",e.async=!0,e.src=t,e.onload=e.onreadystatechange=function(){var t=e.readyState;t&&"loaded"!==t&&"complete"!==t||(e.onload=e.onreadystatechange=null,e.parentNode&&e.parentNode.removeChild(e),n())},e.onerror=function(){Hs("Long-poll script failed to load: "+t),r.sendNewPolls=!1,r.close()},r.myIFrame.doc.body.appendChild(e)}catch(t){}},Math.floor(1))},Fl);function Fl(t,e,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=ou(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=e,this.myIFrame=Fl.createIFrame_();var i="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(i='<script>document.domain="'+document.domain+'";<\/script>');var o="<html><body>"+i+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(t){Hs("frame writing exception"),t.stack&&Hs(t.stack),Hs(t)}}var Ul="";var Vl=null;"undefined"!=typeof MozWebSocket?Vl=MozWebSocket:"undefined"!=typeof WebSocket&&(Vl=WebSocket);var ql=(Bl.connectionURL_=function(t,e,n){var r={v:"5"};return"undefined"!=typeof location&&location.href&&-1!==location.href.indexOf(Eu)&&(r.r="f"),e&&(r.s=e),n&&(r.ls=n),t.connectionURL(Su,r)},Bl.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,nu.set("previous_websocket_failure",!0);try{if(xa()){var r=Sa.NODE_ADMIN?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+Ul+"/"+process.platform+"/"+r}},o=process.env,a=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new Vl(this.connURL,[],i)}else this.mySock=new Vl(this.connURL)}catch(t){this.log_("Error instantiating WebSocket.");var s=t.message||t.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},Bl.prototype.start=function(){},Bl.forceDisallow=function(){Bl.forceDisallow_=!0},Bl.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);e&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0)}return!t&&null!==Vl&&!Bl.forceDisallow_},Bl.previouslyFailed=function(){return nu.isInMemoryStorage||!0===nu.get("previous_websocket_failure")},Bl.prototype.markConnectionHealthy=function(){nu.remove("previous_websocket_failure")},Bl.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=ja(e);this.onMessage(n)}},Bl.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},Bl.prototype.extractFrameCount_=function(t){if(Ia(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},Bl.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},Bl.prototype.send=function(t){this.resetKeepAlive();var e=Wa(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=tu(e,16384);1<n.length&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},Bl.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},Bl.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},Bl.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},Bl.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},Bl.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},Bl.responsesRequiredToBeHealthy=2,Bl.healthyTimeout=3e4,Bl);function Bl(t,e,n,r){this.connId=t,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Gs(this.connId),this.stats_=dl.getCollection(e),this.connURL=Bl.connectionURL_(e,n,r)}var jl=(Object.defineProperty(Wl,"ALL_TRANSPORTS",{get:function(){return[Ml,ql]},enumerable:!0,configurable:!0}),Wl.prototype.initTransports_=function(t){var e,n,r=ql&&ql.isAvailable(),i=r&&!ql.previouslyFailed();if(t.webSocketOnly&&(r||Xs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ql];else{var o=this.transports_=[];try{for(var a=va(Wl.ALL_TRANSPORTS),s=a.next();!s.done;s=a.next()){var u=s.value;u&&u.isAvailable()&&o.push(u)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(e)throw e.error}}}},Wl.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},Wl.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},Wl);function Wl(t){this.initTransports_(t)}var Kl=(Ql.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,void 0,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;0<i&&(this.healthyTimeout_=yu(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&102400<t.conn_.bytesReceived?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&10240<t.conn_.bytesSent?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},Ql.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},Ql.prototype.disconnReceiver_=function(e){var n=this;return function(t){e===n.conn_?n.onConnectionLost_(t):e===n.secondaryConn_?(n.log_("Secondary connection lost."),n.onSecondaryConnectionLost_()):n.log_("closing an old connection")}},Ql.prototype.connReceiver_=function(e){var n=this;return function(t){2!==n.state_&&(e===n.rx_?n.onPrimaryMessageReceived_(t):e===n.secondaryConn_?n.onSecondaryMessageReceived_(t):n.log_("message on old connection"))}},Ql.prototype.sendRequest=function(t){var e={t:"d",d:t};this.sendData_(e)},Ql.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},Ql.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},Ql.prototype.onSecondaryMessageReceived_=function(t){var e=Zs("t",t),n=Zs("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},Ql.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},Ql.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},Ql.prototype.onPrimaryMessageReceived_=function(t){var e=Zs("t",t),n=Zs("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},Ql.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},Ql.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},Ql.prototype.onControl_=function(t){var e=Zs("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?zs("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):zs("Unknown control packet command: "+e)}},Ql.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&Xs("Protocol version mismatch detected"),this.tryStartUpgrade_())},Ql.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},Ql.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),yu(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},Ql.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.updateHost(t),1===this.state_?this.close():(this.closeConnections_(),this.start_())},Ql.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):yu(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},Ql.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},Ql.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},Ql.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(nu.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},Ql.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},Ql.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},Ql.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},Ql.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},Ql);function Ql(t,e,n,r,i,o,a){this.id=t,this.repoInfo_=e,this.onMessage_=n,this.onReady_=r,this.onDisconnect_=i,this.onKill_=o,this.lastSessionId=a,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Gs("c:"+this.id+":"),this.transportManager_=new jl(e),this.log_("Connection created"),this.start_()}var Hl=(Gl.prototype.put=function(t,e,n,r){},Gl.prototype.merge=function(t,e,n,r){},Gl.prototype.refreshAuthToken=function(t){},Gl.prototype.onDisconnectPut=function(t,e,n){},Gl.prototype.onDisconnectMerge=function(t,e,n){},Gl.prototype.onDisconnectCancel=function(t,e){},Gl.prototype.reportStats=function(t){},Gl);function Gl(){}var zl,Yl=(da(Xl,zl=Hl),Xl.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,i={r:r,a:t,b:e};this.log_(Wa(i)),Ia(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},Xl.prototype.listen=function(t,e,n,r){var i=t.queryIdentifier(),o=t.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Ia(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Ia(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(o).set(i,a),this.connected_&&this.sendListen_(a)},Xl.prototype.sendListen_=function(r){var i=this,o=r.query,a=o.path.toString(),s=o.queryIdentifier();this.log_("Listen on "+a+" for "+s);var t={p:a};r.tag&&(t.q=o.queryObject(),t.t=r.tag),t.h=r.hashFn(),this.sendRequest("q",t,function(t){var e=t.d,n=t.s;Xl.warnOnListenWarnings_(e,o),(i.listens.get(a)&&i.listens.get(a).get(s))===r&&(i.log_("listen response",t),"ok"!==n&&i.removeListen_(a,s),r.onComplete&&r.onComplete(n,e))})},Xl.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Qa(t,"w")){var n=Ha(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e.getQueryParams().getIndex().toString()+'"',i=e.path.toString();Xs("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},Xl.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},Xl.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||function(t){var e=Ka(t).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Xl.prototype.tryAuth=function(){var r=this;if(this.connected_&&this.authToken_){var i=this.authToken_,t=function(t){var e=Ka(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")}(i)?"auth":"gauth",e={cred:i};null===this.authOverride_?e.noauth=!0:"object"==typeof this.authOverride_&&(e.authvar=this.authOverride_),this.sendRequest(t,e,function(t){var e=t.s,n=t.d||"error";r.authToken_===i&&("ok"===e?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(e,n))})}},Xl.prototype.unlisten=function(t,e){var n=t.path.toString(),r=t.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Ia(t.getQueryParams().isDefault()||!t.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t.queryObject(),e)},Xl.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},Xl.prototype.onDisconnectPut=function(t,e,n){this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},Xl.prototype.onDisconnectMerge=function(t,e,n){this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},Xl.prototype.onDisconnectCancel=function(t,e){this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},Xl.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},Xl.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},Xl.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},Xl.prototype.putInternal=function(t,e,n,r,i){var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+e)},Xl.prototype.sendPut_=function(e){var n=this,r=this.outstandingPuts_[e].action,t=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(r,t,function(t){n.log_(r+" response",t),delete n.outstandingPuts_[e],n.outstandingPutCount_--,0===n.outstandingPutCount_&&(n.outstandingPuts_=[]),i&&i(t.s,t.d)})},Xl.prototype.reportStats=function(t){var n=this;if(this.connected_){var e={c:t};this.log_("reportStats",e),this.sendRequest("s",e,function(t){if("ok"!==t.s){var e=t.d;n.log_("reportStats","Error sending stats: "+e)}})}},Xl.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Wa(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},Xl.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):zs("Unrecognized action received from server: "+Wa(t)+"\nAre you using the latest client?")},Xl.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Xl.prototype.scheduleConnect_=function(t){var e=this;Ia(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},Xl.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},Xl.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Xl.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},Xl.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Xl.nextConnectionId_++,o=this,a=this.lastSessionId,s=!1,u=null,c=function(){u?u.close():(s=!0,r())};this.realtime_={close:c,sendRequest:function(t){Ia(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(t)}};var t=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(t).then(function(t){s?Hs("getToken() completed but was canceled"):(Hs("getToken() completed. Creating connection."),o.authToken_=t&&t.accessToken,u=new Kl(i,o.repoInfo_,e,n,r,function(t){Xs(t+" ("+o.repoInfo_.toString()+")"),o.interrupt("server_kill")},a))}).then(null,function(t){o.log_("Failed to get token: "+t),s||c()})}},Xl.prototype.interrupt=function(t){Hs("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Xl.prototype.resume=function(t){Hs("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Ga(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))},Xl.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},Xl.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Xl.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return fu(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},Xl.prototype.removeListen_=function(t,e){var n,r=new bu(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},Xl.prototype.onAuthRevoked_=function(t,e){Hs("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Xl.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},Xl.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var i=va(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,va(a.values())),u=s.next();!u.done;u=s.next()){var c=u.value;this.sendListen_(c)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var l=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(l.action,l.pathString,l.data,l.onComplete)}},Xl.prototype.sendConnectStats_=function(){var t={};t["sdk.js."+Ul.replace(/\./g,"-")]=1,Pa()?t["framework.cordova"]=1:Ma()&&(t["framework.reactnative"]=1),this.reportStats(t)},Xl.prototype.shouldReconnect_=function(){var t=Dl.getInstance().currentlyOnline();return Ga(this.interruptReasons_)&&t},Xl.nextPersistentConnectionId_=0,Xl.nextConnectionId_=0,Xl);function Xl(t,e,n,r,i,o){var a=zl.call(this)||this;if(a.repoInfo_=t,a.onDataUpdate_=e,a.onConnectStatus_=n,a.onServerInfoUpdate_=r,a.authTokenProvider_=i,a.authOverride_=o,a.id=Xl.nextPersistentConnectionId_++,a.log_=Gs("p:"+a.id+":"),a.interruptReasons_={},a.listens=new Map,a.outstandingPuts_=[],a.outstandingPutCount_=0,a.onDisconnectRequestQueue_=[],a.connected_=!1,a.reconnectDelay_=1e3,a.maxReconnectDelay_=3e5,a.securityDebugCallback_=null,a.lastSessionId=null,a.establishConnectionTimer_=null,a.visible_=!1,a.requestCBHash_={},a.requestNumber_=0,a.realtime_=null,a.authToken_=null,a.forceTokenRefresh_=!1,a.invalidAuthTokenCount_=0,a.firstConnection_=!0,a.lastConnectionAttemptTime_=null,a.lastConnectionEstablishedTime_=null,o&&!xa())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return a.scheduleConnect_(0),Nl.getInstance().on("visible",a.onVisible_,a),-1===t.host.indexOf("fblocal")&&Dl.getInstance().on("online",a.onOnline_,a),a}var Jl,$l=(da(Zl,Jl=Hl),Zl.prototype.reportStats=function(t){throw new Error("Method not implemented.")},Zl.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(Ia(t.getQueryParams().isDefault(),"should have a tag if it's not a default query."),t.path.toString())},Zl.prototype.listen=function(t,e,r,i){var o=this,a=t.path.toString();this.log_("Listen called for "+a+" "+t.queryIdentifier());var s=Zl.getListenId_(t,r),u={};this.listens_[s]=u;var n=t.getQueryParams().toRestQueryStringParameters();this.restRequest_(a+".json",n,function(t,e){var n=e;404===t&&(t=n=null),null===t&&o.onDataUpdate_(a,n,!1,r),Ha(o.listens_,s)===u&&i(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)})},Zl.prototype.unlisten=function(t,e){var n=Zl.getListenId_(t,e);delete this.listens_[n]},Zl.prototype.refreshAuthToken=function(t){},Zl.prototype.restRequest_=function(i,o,a){var s=this;void 0===o&&(o={}),o.format="export",this.authTokenProvider_.getToken(!1).then(function(t){var e=t&&t.accessToken;e&&(o.auth=e);var n=(s.repoInfo_.secure?"https://":"http://")+s.repoInfo_.host+i+"?ns="+s.repoInfo_.namespace+function(t){for(var n=[],e=function(e,t){Array.isArray(t)?t.forEach(function(t){n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}):n.push(encodeURIComponent(e)+"="+encodeURIComponent(t))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];e(o[0],o[1])}return n.length?"&"+n.join("&"):""}(o);s.log_("Sending REST request for "+n);var r=new XMLHttpRequest;r.onreadystatechange=function(){if(a&&4===r.readyState){s.log_("REST Response for "+n+" received. status:",r.status,"response:",r.responseText);var t=null;if(200<=r.status&&r.status<300){try{t=ja(r.responseText)}catch(t){Xs("Failed to parse JSON response for "+n+": "+r.responseText)}a(null,t)}else 401!==r.status&&404!==r.status&&Xs("Got unsuccessful REST response for "+n+" Status: "+r.status),a(r.status);a=null}},r.open("GET",n,!0),r.send()})},Zl);function Zl(t,e,n){var r=Jl.call(this)||this;return r.repoInfo_=t,r.onDataUpdate_=e,r.authTokenProvider_=n,r.log_=Gs("p:rest:"),r.listens_={},r}var tf="repo_interrupt",ef=(nf.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},nf.prototype.name=function(){return this.repoInfo_.namespace},nf.prototype.serverTime=function(){var t=this.infoData_.getNode(new bu(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t},nf.prototype.generateServerValues=function(){return function(t){return(t=t||{}).timestamp=t.timestamp||(new Date).getTime(),t}({timestamp:this.serverTime()})},nf.prototype.onDataUpdate_=function(t,e,n,r){this.dataUpdateCount++;var i=new bu(t);e=this.interceptServerDataCallback_?this.interceptServerDataCallback_(t,e):e;var o=[];if(r)if(n){var a=za(e,function(t){return Qc(t)});o=this.serverSyncTree_.applyTaggedQueryMerge(i,a,r)}else{var s=Qc(e);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,s,r)}else if(n){var u=za(e,function(t){return Qc(t)});o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=Qc(e);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;0<o.length&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},nf.prototype.interceptServerData_=function(t){this.interceptServerDataCallback_=t},nf.prototype.onConnectStatus_=function(t){this.updateInfo_("connected",t),!1===t&&this.runOnDisconnectEvents_()},nf.prototype.onServerInfoUpdate_=function(t){var n=this;pu(t,function(t,e){n.updateInfo_(t,e)})},nf.prototype.updateInfo_=function(t,e){var n=new bu("/.info/"+t),r=Qc(e);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},nf.prototype.getNextWriteId_=function(){return this.nextWriteId_++},nf.prototype.setWithPriority=function(i,t,e,o){var a=this;this.log_("set",{path:i.toString(),value:t,priority:e});var n=this.generateServerValues(),r=Qc(t,e),s=mh(r,n),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(i,s,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(i.toString(),r.val(!0),function(t,e){var n="ok"===t;n||Xs("set at "+i+" failed: "+t);var r=a.serverSyncTree_.ackUserWrite(u,!n);a.eventQueue_.raiseEventsForChangedPath(i,r),a.callOnCompleteCallback(o,t,e)});var h=this.abortTransactions_(i);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},nf.prototype.update=function(o,t,a){var s=this;this.log_("update",{path:o.toString(),value:t});var r=!0,i=this.generateServerValues(),u={};if(pu(t,function(t,e){r=!1;var n=Qc(e);u[t]=mh(n,i)}),r)Hs("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(a,"ok");else{var c=this.getNextWriteId_(),e=this.serverSyncTree_.applyUserMerge(o,u,c);this.eventQueue_.queueEvents(e),this.server_.merge(o.toString(),t,function(t,e){var n="ok"===t;n||Xs("update at "+o+" failed: "+t);var r=s.serverSyncTree_.ackUserWrite(c,!n),i=0<r.length?s.rerunTransactions_(o):o;s.eventQueue_.raiseEventsForChangedPath(i,r),s.callOnCompleteCallback(a,t,e)}),pu(t,function(t){var e=s.abortTransactions_(o.child(t));s.rerunTransactions_(e)}),this.eventQueue_.raiseEventsForChangedPath(o,[])}},nf.prototype.runOnDisconnectEvents_=function(){var r=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),e=function(t,n){var r=new hh;return t.forEachTree(new bu(""),function(t,e){r.remember(t,mh(e,n))}),r}(this.onDisconnect_,t),i=[];e.forEachTree(bu.Empty,function(t,e){i=i.concat(r.serverSyncTree_.applyServerOverwrite(t,e));var n=r.abortTransactions_(t);r.rerunTransactions_(n)}),this.onDisconnect_=new hh,this.eventQueue_.raiseEventsForChangedPath(bu.Empty,i)},nf.prototype.onDisconnectCancel=function(n,r){var i=this;this.server_.onDisconnectCancel(n.toString(),function(t,e){"ok"===t&&i.onDisconnect_.forget(n),i.callOnCompleteCallback(r,t,e)})},nf.prototype.onDisconnectSet=function(n,t,r){var i=this,o=Qc(t);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},nf.prototype.onDisconnectSetWithPriority=function(n,t,e,r){var i=this,o=Qc(t,e);this.server_.onDisconnectPut(n.toString(),o.val(!0),function(t,e){"ok"===t&&i.onDisconnect_.remember(n,o),i.callOnCompleteCallback(r,t,e)})},nf.prototype.onDisconnectUpdate=function(r,n,i){var o=this;if(Ga(n))return Hs("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(i,"ok");this.server_.onDisconnectMerge(r.toString(),n,function(t,e){"ok"===t&&pu(n,function(t,e){var n=Qc(e);o.onDisconnect_.remember(r.child(t),n)}),o.callOnCompleteCallback(i,t,e)})},nf.prototype.addEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.addEventRegistration(t,e):this.serverSyncTree_.addEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},nf.prototype.removeEventCallbackForQuery=function(t,e){var n;n=".info"===t.path.getFront()?this.infoSyncTree_.removeEventRegistration(t,e):this.serverSyncTree_.removeEventRegistration(t,e),this.eventQueue_.raiseEventsAtPath(t.path,n)},nf.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(tf)},nf.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(tf)},nf.prototype.stats=function(t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var e;e=t?(this.statsListener_||(this.statsListener_=new yl(this.stats_)),this.statsListener_.get()):this.stats_.get();var i=Object.keys(e).reduce(function(t,e){return Math.max(e.length,t)},0);pu(e,function(t,e){for(var n=t,r=t.length;r<i+2;r++)n+=" ";console.log(n+e)})}},nf.prototype.statsIncrementCounter=function(t){this.stats_.incrementCounter(t),this.statsReporter_.includeStat(t)},nf.prototype.log_=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),Hs.apply(void 0,wa([n],t))},nf.prototype.callOnCompleteCallback=function(r,i,o){r&&mu(function(){if("ok"===i)r(null);else{var t=(i||"error").toUpperCase(),e=t;o&&(e+=": "+o);var n=new Error(e);n.code=t,r(n)}})},Object.defineProperty(nf.prototype,"database",{get:function(){return this.__database||(this.__database=new Tf(this))},enumerable:!0,configurable:!0}),nf);function nf(t,e,n,r){var a=this;this.repoInfo_=t,this.app=n,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new wl,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new hh,this.persistentConnection_=null;var i=new cl(n,r);if(this.stats_=dl.getCollection(t),e||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))this.server_=new $l(this.repoInfo_,this.onDataUpdate_.bind(this),i),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var o=n.options.databaseAuthVariableOverride;if(null!=o){if("object"!=typeof o)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Wa(o)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}this.persistentConnection_=new Yl(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),i,o),this.server_=this.persistentConnection_}i.addTokenChangeListener(function(t){a.server_.refreshAuthToken(t)}),this.statsReporter_=dl.getOrCreateReporter(t,function(){return new vl(a.stats_,a.server_)}),this.transactionsInit_(),this.infoData_=new sl,this.infoSyncTree_=new ol({startListening:function(t,e,n,r){var i=[],o=a.infoData_.getNode(t.path);return o.isEmpty()||(i=a.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout(function(){r("ok")},0)),i},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new ol({startListening:function(r,t,e,i){return a.server_.listen(r,e,t,function(t,e){var n=i(t,e);a.eventQueue_.raiseEventsForChangedPath(r.path,n)}),[]},stopListening:function(t,e){a.server_.unlisten(t,e)}})}var rf=(of.prototype.getStartPost=function(){return this.startPost_},of.prototype.getEndPost=function(){return this.endPost_},of.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},of.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Zu(e,n))||(n=Vc.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},of.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=Vc.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(Vc.EMPTY_NODE);var i=this;return e.forEachChild(vc,function(t,e){i.matches(new Zu(t,e))||(r=r.updateImmediateChild(t,Vc.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},of.prototype.updatePriority=function(t,e){return t},of.prototype.filtersNodes=function(){return!0},of.prototype.getIndexedFilter=function(){return this.indexedFilter_},of.prototype.getIndex=function(){return this.index_},of.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},of.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},of);function of(t){this.indexedFilter_=new xh(t.getIndex()),this.index_=t.getIndex(),this.startPost_=of.getStartPost_(t),this.endPost_=of.getEndPost_(t)}var af=(sf.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Zu(e,n))||(n=Vc.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},sf.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=Vc.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=Vc.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(Vc.EMPTY_NODE);var s=void 0,u=void 0,c=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var h=this.index_.getCompare();c=function(t,e){return h(e,t)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),c=this.index_.getCompare();o=0;for(var l=!1;i.hasNext();)a=i.getNext(),!l&&c(s,a)<=0&&(l=!0),l&&o<this.limit_&&c(a,u)<=0?o++:r=r.updateImmediateChild(a.name,Vc.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},sf.prototype.updatePriority=function(t,e){return t},sf.prototype.filtersNodes=function(){return!0},sf.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},sf.prototype.getIndex=function(){return this.index_},sf.prototype.fullLimitUpdateChild_=function(t,e,n,r,i){var o;if(this.reverse_){var a=this.index_.getCompare();o=function(t,e){return a(e,t)}}else o=this.index_.getCompare();var s=t;Ia(s.numChildren()===this.limit_,"");var u=new Zu(e,n),c=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(e)){for(var l=s.getImmediateChild(e),f=r.getChildAfterChild(this.index_,c,this.reverse_);null!=f&&(f.name===e||s.hasChild(f.name));)f=r.getChildAfterChild(this.index_,f,this.reverse_);var p=null==f?1:o(f,u);if(h&&!n.isEmpty()&&0<=p)return null!=i&&i.trackChildChange(Ph.childChangedChange(e,n,l)),s.updateImmediateChild(e,n);null!=i&&i.trackChildChange(Ph.childRemovedChange(e,l));var d=s.updateImmediateChild(e,Vc.EMPTY_NODE);return null!=f&&this.rangedFilter_.matches(f)?(null!=i&&i.trackChildChange(Ph.childAddedChange(f.name,f.node)),d.updateImmediateChild(f.name,f.node)):d}return n.isEmpty()?t:h&&0<=o(c,u)?(null!=i&&(i.trackChildChange(Ph.childRemovedChange(c.name,c.node)),i.trackChildChange(Ph.childAddedChange(e,n))),s.updateImmediateChild(e,n).updateImmediateChild(c.name,Vc.EMPTY_NODE)):t},sf);function sf(t){this.rangedFilter_=new rf(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}var uf=(cf.prototype.hasStart=function(){return this.startSet_},cf.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===cf.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},cf.prototype.getIndexStartValue=function(){return Ia(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},cf.prototype.getIndexStartName=function(){return Ia(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:cu},cf.prototype.hasEnd=function(){return this.endSet_},cf.prototype.getIndexEndValue=function(){return Ia(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},cf.prototype.getIndexEndName=function(){return Ia(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:hu},cf.prototype.hasLimit=function(){return this.limitSet_},cf.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},cf.prototype.getLimit=function(){return Ia(this.limitSet_,"Only valid if limit has been set"),this.limit_},cf.prototype.getIndex=function(){return this.index_},cf.prototype.copy_=function(){var t=new cf;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},cf.prototype.limit=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_="",e},cf.prototype.limitToFirst=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=cf.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,e},cf.prototype.limitToLast=function(t){var e=this.copy_();return e.limitSet_=!0,e.limit_=t,e.viewFrom_=cf.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,e},cf.prototype.startAt=function(t,e){var n=this.copy_();return n.startSet_=!0,void 0===t&&(t=null),n.indexStartValue_=t,null!=e?(n.startNameSet_=!0,n.indexStartName_=e):(n.startNameSet_=!1,n.indexStartName_=""),n},cf.prototype.endAt=function(t,e){var n=this.copy_();return n.endSet_=!0,void 0===t&&(t=null),n.indexEndValue_=t,void 0!==e?(n.endNameSet_=!0,n.indexEndName_=e):(n.endNameSet_=!1,n.indexEndName_=""),n},cf.prototype.orderBy=function(t){var e=this.copy_();return e.index_=t,e},cf.prototype.getQueryObject=function(){var t=cf.WIRE_PROTOCOL_CONSTANTS_,e={};if(this.startSet_&&(e[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(e[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(e[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(e[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){e[t.LIMIT]=this.limit_;var n=this.viewFrom_;""===n&&(n=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),e[t.VIEW_FROM]=n}return this.index_!==vc&&(e[t.INDEX]=this.index_.toString()),e},cf.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},cf.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===vc},cf.prototype.getNodeFilter=function(){return this.loadsAllData()?new xh(this.getIndex()):this.hasLimit()?new af(this):new rf(this)},cf.prototype.toRestQueryStringParameters=function(){var t,e=cf.REST_QUERY_CONSTANTS_,n={};return this.isDefault()||(t=this.index_===vc?e.PRIORITY_INDEX:this.index_===zc?e.VALUE_INDEX:this.index_===uc?e.KEY_INDEX:(Ia(this.index_ instanceof Yc,"Unrecognized index type!"),this.index_.toString()),n[e.ORDER_BY]=Wa(t),this.startSet_&&(n[e.START_AT]=Wa(this.indexStartValue_),this.startNameSet_&&(n[e.START_AT]+=","+Wa(this.indexStartName_))),this.endSet_&&(n[e.END_AT]=Wa(this.indexEndValue_),this.endNameSet_&&(n[e.END_AT]+=","+Wa(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?n[e.LIMIT_TO_FIRST]=this.limit_:n[e.LIMIT_TO_LAST]=this.limit_)),n},cf.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},cf.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},cf.DEFAULT=new cf,cf);function cf(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=vc}var hf,lf=(da(ff,hf=uh),ff.prototype.getKey=function(){return es("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},ff.prototype.child=function(t){return es("Reference.child",1,1,arguments.length),"number"==typeof t?t=String(t):t instanceof bu||(null===this.path.getFront()?function(t,e,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),Fu(t,e,n,r)}("Reference.child",1,t,!1):Fu("Reference.child",1,t,!1)),new ff(this.repo,this.path.child(t))},ff.prototype.getParent=function(){es("Reference.parent",0,0,arguments.length);var t=this.path.parent();return null===t?null:new ff(this.repo,t)},ff.prototype.getRoot=function(){es("Reference.root",0,0,arguments.length);for(var t=this;null!==t.getParent();)t=t.getParent();return t},ff.prototype.databaseProp=function(){return this.repo.database},ff.prototype.set=function(t,e){es("Reference.set",1,2,arguments.length),Uu("Reference.set",this.path),Ou("Reference.set",1,t,this.path,!1),rs("Reference.set",2,e,!0);var n=new Da;return this.repo.setWithPriority(this.path,t,null,n.wrapCallback(e)),n.promise},ff.prototype.update=function(t,e){if(es("Reference.update",1,2,arguments.length),Uu("Reference.update",this.path),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,Xs("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Pu("Reference.update",1,t,this.path,!1),rs("Reference.update",2,e,!0);var i=new Da;return this.repo.update(this.path,t,i.wrapCallback(e)),i.promise},ff.prototype.setWithPriority=function(t,e,n){if(es("Reference.setWithPriority",2,3,arguments.length),Uu("Reference.setWithPriority",this.path),Ou("Reference.setWithPriority",1,t,this.path,!1),Mu("Reference.setWithPriority",2,e,!1),rs("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new Da;return this.repo.setWithPriority(this.path,t,e,r.wrapCallback(n)),r.promise},ff.prototype.remove=function(t){return es("Reference.remove",0,1,arguments.length),Uu("Reference.remove",this.path),rs("Reference.remove",1,t,!0),this.set(null,t)},ff.prototype.transaction=function(t,r,e){if(es("Reference.transaction",1,3,arguments.length),Uu("Reference.transaction",this.path),rs("Reference.transaction",1,t,!1),rs("Reference.transaction",2,r,!0),function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(ns(t,e,r)+"must be a boolean.")}("Reference.transaction",3,e,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===e&&(e=!0);var i=new Da;return"function"==typeof r&&i.promise.catch(function(){}),this.repo.startTransaction(this.path,t,function(t,e,n){t?i.reject(t):i.resolve(new Gu(e,n)),"function"==typeof r&&r(t,e,n)},e),i.promise},ff.prototype.setPriority=function(t,e){es("Reference.setPriority",1,2,arguments.length),Uu("Reference.setPriority",this.path),Mu("Reference.setPriority",1,t,!1),rs("Reference.setPriority",2,e,!0);var n=new Da;return this.repo.setWithPriority(this.path.child(".priority"),t,null,n.wrapCallback(e)),n.promise},ff.prototype.push=function(t,e){es("Reference.push",0,2,arguments.length),Uu("Reference.push",this.path),Ou("Reference.push",1,t,this.path,!0),rs("Reference.push",2,e,!0);var n,r=this.repo.serverTime(),i=$u(r),o=this.child(i),a=this.child(i);return n=null!=t?o.set(t,e).then(function(){return a}):Promise.resolve(a),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"==typeof e&&n.catch(function(){}),o},ff.prototype.onDisconnect=function(){return Uu("Reference.onDisconnect",this.path),new Qu(this.repo,this.path)},Object.defineProperty(ff.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!0,configurable:!0}),Object.defineProperty(ff.prototype,"key",{get:function(){return this.getKey()},enumerable:!0,configurable:!0}),Object.defineProperty(ff.prototype,"parent",{get:function(){return this.getParent()},enumerable:!0,configurable:!0}),Object.defineProperty(ff.prototype,"root",{get:function(){return this.getRoot()},enumerable:!0,configurable:!0}),ff);function ff(t,e){if(!(t instanceof ef))throw new Error("new Reference() no longer supported - use app.database().");return hf.call(this,t,e,uf.DEFAULT,!1)||this}uh.__referenceConstructor=lf,Jh.__referenceConstructor=lf;var pf,df,mf=function(){this.children={},this.childCount=0,this.value=null},yf=(gf.prototype.subTree=function(t){for(var e=t instanceof bu?t:new bu(t),n=this,r=e.getFront();null!==r;)n=new gf(r,n,Ha(n.node_.children,r)||new mf),r=(e=e.popFront()).getFront();return n},gf.prototype.getValue=function(){return this.node_.value},gf.prototype.setValue=function(t){Ia(void 0!==t,"Cannot set value to undefined"),this.node_.value=t,this.updateParents_()},gf.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},gf.prototype.hasChildren=function(){return 0<this.node_.childCount},gf.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},gf.prototype.forEachChild=function(n){var r=this;pu(this.node_.children,function(t,e){n(new gf(t,r,e))})},gf.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,n)}),t&&n&&e(this)},gf.prototype.forEachAncestor=function(t,e){for(var n=e?this:this.parent();null!==n;){if(t(n))return!0;n=n.parent()}return!1},gf.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},gf.prototype.path=function(){return new bu(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},gf.prototype.name=function(){return this.name_},gf.prototype.parent=function(){return this.parent_},gf.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},gf.prototype.updateChild_=function(t,e){var n=e.isEmpty(),r=Qa(this.node_.children,t);n&&r?(delete this.node_.children[t],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[t]=e.node_,this.node_.childCount++,this.updateParents_())},gf);function gf(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n=new mf),this.name_=t,this.parent_=e,this.node_=n}(df=pf=pf||{})[df.RUN=0]="RUN",df[df.SENT=1]="SENT",df[df.COMPLETED=2]="COMPLETED",df[df.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",df[df.NEEDS_ABORT=4]="NEEDS_ABORT",ef.MAX_TRANSACTION_RETRIES_=25,ef.prototype.transactionsInit_=function(){this.transactionQueueTree_=new yf},ef.prototype.startTransaction=function(t,e,n,r){this.log_("transaction on "+t);function i(){}var o=new lf(this,t);o.on("value",i);var a={path:t,update:e,onComplete:n,status:null,order:ou(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},s=this.getLatestState_(t);a.currentInputSnapshot=s;var u=a.update(s.val());if(void 0===u){if(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete){var c=new Jc(a.currentInputSnapshot,new lf(this,a.path),vc);a.onComplete(null,!1,c)}}else{Ku("transaction failed: Data returned ",u,a.path),a.status=pf.RUN;var h=this.transactionQueueTree_.subTree(t),l=h.getValue()||[];l.push(a),h.setValue(l);var f=void 0;if("object"==typeof u&&null!==u&&Qa(u,".priority"))f=Ha(u,".priority"),Ia(Ru(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else f=(this.serverSyncTree_.calcCompleteEventCache(t)||Vc.EMPTY_NODE).getPriority().val();f=f;var p=this.generateServerValues(),d=Qc(u,f),m=mh(d,p);a.currentOutputSnapshotRaw=d,a.currentOutputSnapshotResolved=m,a.currentWriteId=this.getNextWriteId_();var y=this.serverSyncTree_.applyUserOverwrite(t,m,a.currentWriteId,a.applyLocally);this.eventQueue_.raiseEventsForChangedPath(t,y),this.sendReadyTransactions_()}},ef.prototype.getLatestState_=function(t,e){return this.serverSyncTree_.calcCompleteEventCache(t,e)||Vc.EMPTY_NODE},ef.prototype.sendReadyTransactions_=function(t){var e=this;if(void 0===t&&(t=this.transactionQueueTree_),t||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var n=this.buildTransactionQueue_(t);Ia(0<n.length,"Sending zero length transaction queue"),n.every(function(t){return t.status===pf.RUN})&&this.sendTransactionQueue_(t.path(),n)}else t.hasChildren()&&t.forEachChild(function(t){e.sendReadyTransactions_(t)})},ef.prototype.sendTransactionQueue_=function(s,u){for(var c=this,t=u.map(function(t){return t.currentWriteId}),e=this.getLatestState_(s,t),n=e,r=e.hash(),i=0;i<u.length;i++){var o=u[i];Ia(o.status===pf.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),o.status=pf.SENT,o.retryCount++;var a=bu.relativePath(s,o.path);n=n.updateChild(a,o.currentOutputSnapshotRaw)}var h=n.val(!0),l=s;this.server_.put(l.toString(),h,function(t){c.log_("transaction put response",{path:l.toString(),status:t});var e=[];if("ok"===t){for(var n=[],r=0;r<u.length;r++){if(u[r].status=pf.COMPLETED,e=e.concat(c.serverSyncTree_.ackUserWrite(u[r].currentWriteId)),u[r].onComplete){var i=u[r].currentOutputSnapshotResolved,o=new lf(c,u[r].path),a=new Jc(i,o,vc);n.push(u[r].onComplete.bind(null,null,!0,a))}u[r].unwatcher()}c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(s)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(s,e);for(r=0;r<n.length;r++)mu(n[r])}else{if("datastale"===t)for(r=0;r<u.length;r++)u[r].status===pf.SENT_NEEDS_ABORT?u[r].status=pf.NEEDS_ABORT:u[r].status=pf.RUN;else{Xs("transaction at "+l.toString()+" failed: "+t);for(r=0;r<u.length;r++)u[r].status=pf.NEEDS_ABORT,u[r].abortReason=t}c.rerunTransactions_(s)}},r)},ef.prototype.rerunTransactions_=function(t){var e=this.getAncestorTransactionNode_(t),n=e.path(),r=this.buildTransactionQueue_(e);return this.rerunTransactionQueue_(r,n),n},ef.prototype.rerunTransactionQueue_=function(t,e){if(0!==t.length){for(var n,r=[],i=[],o=t.filter(function(t){return t.status===pf.RUN}).map(function(t){return t.currentWriteId}),a=0;a<t.length;a++){var s=t[a],u=bu.relativePath(e,s.path),c=!1,h=void 0;if(Ia(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),s.status===pf.NEEDS_ABORT)c=!0,h=s.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else if(s.status===pf.RUN)if(s.retryCount>=ef.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0));else{var l=this.getLatestState_(s.path,o);s.currentInputSnapshot=l;var f=t[a].update(l.val());if(void 0!==f){Ku("transaction failed: Data returned ",f,s.path);var p=Qc(f);"object"==typeof f&&null!=f&&Qa(f,".priority")||(p=p.updatePriority(l.getPriority()));var d=s.currentWriteId,m=this.generateServerValues(),y=mh(p,m);s.currentOutputSnapshotRaw=p,s.currentOutputSnapshotResolved=y,s.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(d),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(s.path,y,s.currentWriteId,s.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(d,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(s.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(e,i),i=[],c&&(t[a].status=pf.COMPLETED,n=t[a].unwatcher,setTimeout(n,Math.floor(0)),t[a].onComplete))if("nodata"===h){var g=new lf(this,t[a].path),v=t[a].currentInputSnapshot,b=new Jc(v,g,vc);r.push(t[a].onComplete.bind(null,null,!1,b))}else r.push(t[a].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(a=0;a<r.length;a++)mu(r[a]);this.sendReadyTransactions_()}},ef.prototype.getAncestorTransactionNode_=function(t){var e,n=this.transactionQueueTree_;for(e=t.getFront();null!==e&&null===n.getValue();)n=n.subTree(e),e=(t=t.popFront()).getFront();return n},ef.prototype.buildTransactionQueue_=function(t){var e=[];return this.aggregateTransactionQueuesForNode_(t,e),e.sort(function(t,e){return t.order-e.order}),e},ef.prototype.aggregateTransactionQueuesForNode_=function(t,e){var n=this,r=t.getValue();if(null!==r)for(var i=0;i<r.length;i++)e.push(r[i]);t.forEachChild(function(t){n.aggregateTransactionQueuesForNode_(t,e)})},ef.prototype.pruneCompletedTransactionsBelowNode_=function(t){var e=this,n=t.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==pf.COMPLETED&&(n[r]=n[i],r++);n.length=r,t.setValue(0<n.length?n:null)}t.forEachChild(function(t){e.pruneCompletedTransactionsBelowNode_(t)})},ef.prototype.abortTransactions_=function(t){var e=this,n=this.getAncestorTransactionNode_(t).path(),r=this.transactionQueueTree_.subTree(t);return r.forEachAncestor(function(t){e.abortTransactionsOnNode_(t)}),this.abortTransactionsOnNode_(r),r.forEachDescendant(function(t){e.abortTransactionsOnNode_(t)}),n},ef.prototype.abortTransactionsOnNode_=function(t){var e=t.getValue();if(null!==e){for(var n=[],r=[],i=-1,o=0;o<e.length;o++)if(e[o].status===pf.SENT_NEEDS_ABORT);else if(e[o].status===pf.SENT)Ia(i===o-1,"All SENT items should be at beginning of queue."),e[i=o].status=pf.SENT_NEEDS_ABORT,e[o].abortReason="set";else if(Ia(e[o].status===pf.RUN,"Unexpected transaction status in abort"),e[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(e[o].currentWriteId,!0)),e[o].onComplete){n.push(e[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?t.setValue(null):e.length=i+1,this.eventQueue_.raiseEventsForChangedPath(t.path(),r);for(o=0;o<n.length;o++)mu(n[o])}};var vf,bf="databaseURL",wf=(_f.getInstance=function(){return vf=vf||new _f},_f.prototype.interrupt=function(){var e,t,n,r;try{for(var i=va(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,va(Object.keys(this.repos_[a]))),u=s.next();!u.done;u=s.next()){var c=u.value;this.repos_[a][c].interrupt()}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},_f.prototype.resume=function(){var e,t,n,r;try{for(var i=va(Object.keys(this.repos_)),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var s=(n=void 0,va(Object.keys(this.repos_[a]))),u=s.next();!u.done;u=s.next()){var c=u.value;this.repos_[a][c].resume()}}catch(t){n={error:t}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},_f.prototype.databaseFromApp=function(t,e,n){var r=n||t.options[bf];void 0===r&&Ys("Can't determine Firebase Database URL.  Be sure to include "+bf+" option when calling firebase.initializeApp().");var i=Au(r),o=i.repoInfo,a=void 0;return"undefined"!=typeof process&&(a=process.env.FIREBASE_DATABASE_EMULATOR_HOST),a&&(r="http://"+a+"?ns="+o.namespace,o=(i=Au(r)).repoInfo),Vu("Invalid Firebase Database URL",1,i),i.path.isEmpty()||Ys("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(o,t,e).database},_f.prototype.deleteRepo=function(t){var e=Ha(this.repos_,t.app.name);e&&Ha(e,t.repoInfo_.toURLString())===t||Ys("Database "+t.app.name+"("+t.repoInfo_+") has already been deleted."),t.interrupt(),delete e[t.repoInfo_.toURLString()]},_f.prototype.createRepo=function(t,e,n){var r=Ha(this.repos_,e.name);r||(r={},this.repos_[e.name]=r);var i=Ha(r,t.toURLString());return i&&Ys("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new ef(t,this.useRestClient_,e,n),r[t.toURLString()]=i},_f.prototype.forceRestClient=function(t){this.useRestClient_=t},_f);function _f(){this.repos_={},this.useRestClient_=!1}var Tf=(Object.defineProperty(Ef.prototype,"app",{get:function(){return this.repo_.app},enumerable:!0,configurable:!0}),Ef.prototype.ref=function(t){return this.checkDeleted_("ref"),es("database.ref",0,1,arguments.length),t instanceof lf?this.refFromURL(t.toString()):void 0!==t?this.root_.child(t):this.root_},Ef.prototype.refFromURL=function(t){var e="database.refFromURL";this.checkDeleted_(e),es(e,1,1,arguments.length);var n=Au(t);Vu(e,1,n);var r=n.repoInfo;return r.host!==this.repo_.repoInfo_.host&&Ys(e+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},Ef.prototype.checkDeleted_=function(t){null===this.repo_&&Ys("Cannot call "+t+" on a deleted database.")},Ef.prototype.goOffline=function(){es("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},Ef.prototype.goOnline=function(){es("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},Ef.ServerValue={TIMESTAMP:{".sv":"timestamp"}},Ef);function Ef(t){(this.repo_=t)instanceof ef||Ys("Don't call new Database() directly - please use firebase.database()."),this.root_=new lf(t,bu.Empty),this.INTERNAL=new Sf(this)}var Sf=(If.prototype.delete=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){return this.database.checkDeleted_("delete"),wf.getInstance().deleteRepo(this.database.repo_),this.database.repo_=null,this.database.root_=null,this.database.INTERNAL=null,this.database=null,[2]})})},If);function If(t){this.database=t}var Cf=Object.freeze({__proto__:null,forceLongPolling:function(){ql.forceDisallow(),Ml.forceAllow()},forceWebSockets:function(){Ml.forceDisallow()},isWebSocketsAvailable:function(){return ql.isAvailable()},setSecurityDebugCallback:function(t,e){t.repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){t.repo.stats(e)},statsIncrementCounter:function(t,e){t.repo.statsIncrementCounter(e)},dataUpdateCount:function(t){return t.repo.dataUpdateCount},interceptServerData:function(t,e){return t.repo.interceptServerData_(e)}}),Nf=Yl;Yl.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Yl.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var Af,kf,Df=Kl,Rf=Cu,Of=Object.freeze({__proto__:null,DataConnection:Nf,RealTimeConnection:Df,hijackHash:function(i){var o=Yl.prototype.put;return Yl.prototype.put=function(t,e,n,r){void 0!==r&&(r=i()),o.call(this,t,e,n,r)},function(){Yl.prototype.put=o}},ConnectionTarget:Rf,queryIdentifier:function(t){return t.queryIdentifier()},forceRestClient:function(t){wf.getInstance().forceRestClient(t)}}),Pf=Tf.ServerValue;Af=(kf=fl).SDK_VERSION,Ul=Af,kf.INTERNAL.registerComponent(new as("database",function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return wf.getInstance().databaseFromApp(n,r,e)},"PUBLIC").setServiceProps({Reference:lf,Query:uh,Database:Tf,DataSnapshot:Jc,enableLogging:Qs,INTERNAL:Cf,ServerValue:Pf,TEST_ACCESS:Of}).setMultipleInstances(!0)),kf.registerVersion("@firebase/database","0.5.18");var Mf,xf="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Lf=Lf||{},Ff=xf;function Uf(t){return"string"==typeof t}function Vf(t){return"number"==typeof t}function qf(t,e){t=t.split("."),e=e||Ff;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function Bf(){}function jf(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function Wf(t){return"array"==jf(t)}function Kf(t){var e=jf(t);return"array"==e||"object"==e&&"number"==typeof t.length}function Qf(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Hf="closure_uid_"+(1e9*Math.random()>>>0),Gf=0;function zf(t,e,n){return t.call.apply(t.bind,arguments)}function Yf(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function Xf(t,e,n){return(Xf=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?zf:Yf).apply(null,arguments)}function Jf(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var $f=Date.now||function(){return+new Date};function Zf(t,o){function e(){}e.prototype=o.prototype,t.N=o.prototype,t.prototype=new e,(t.prototype.constructor=t).xb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function tp(){this.j=this.j,this.i=this.i}tp.prototype.j=!1,tp.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[Hf]||(this[Hf]=++Gf)},tp.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var ep=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(Uf(t))return Uf(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},np=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=Uf(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function rp(){return Array.prototype.concat.apply([],arguments)}function ip(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function op(t){return/^[\s\xa0]*$/.test(t)}var ap,sp=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function up(t,e){return-1!=t.indexOf(e)}function cp(t,e){return t<e?-1:e<t?1:0}t:{var hp=Ff.navigator;if(hp){var lp=hp.userAgent;if(lp){ap=lp;break t}}ap=""}function fp(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function pp(t){var e,n={};for(e in t)n[e]=t[e];return n}var dp="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mp(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<dp.length;i++)e=dp[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function yp(t){return yp[" "](t),t}yp[" "]=Bf;var gp,vp,bp=up(ap,"Opera"),wp=up(ap,"Trident")||up(ap,"MSIE"),_p=up(ap,"Edge"),Tp=_p||wp,Ep=up(ap,"Gecko")&&!(up(ap.toLowerCase(),"webkit")&&!up(ap,"Edge"))&&!(up(ap,"Trident")||up(ap,"MSIE"))&&!up(ap,"Edge"),Sp=up(ap.toLowerCase(),"webkit")&&!up(ap,"Edge");function Ip(){var t=Ff.document;return t?t.documentMode:void 0}t:{var Cp="",Np=(vp=ap,Ep?/rv:([^\);]+)(\)|;)/.exec(vp):_p?/Edge\/([\d\.]+)/.exec(vp):wp?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(vp):Sp?/WebKit\/(\S+)/.exec(vp):bp?/(?:Version)[ \/]?(\S+)/.exec(vp):void 0);if(Np&&(Cp=Np?Np[1]:""),wp){var Ap=Ip();if(null!=Ap&&Ap>parseFloat(Cp)){gp=String(Ap);break t}}gp=Cp}var kp,Dp={};function Rp(s){return function(t,e){var n=Dp;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(s,function(){for(var t=0,e=sp(String(gp)).split("."),n=sp(String(s)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",a=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;t=cp(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||cp(0==o[2].length,0==a[2].length)||cp(o[2],a[2]),o=o[3],a=a[3]}while(0==t)}return 0<=t})}var Op=Ff.document;kp=Op&&wp?Ip()||("CSS1Compat"==Op.compatMode?parseInt(gp,10):5):void 0;var Pp=!wp||9<=Number(kp),Mp=wp&&!Rp("9"),xp=function(){if(!Ff.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{Ff.addEventListener("test",Bf,e),Ff.removeEventListener("test",Bf,e)}catch(t){}return t}();function Lp(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function Fp(t,e){if(Lp.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Ep){t:{try{yp(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=Uf(t.pointerType)?t.pointerType:Up[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Lp.prototype.b=function(){this.Ia=!1},Zf(Fp,Lp);var Up={2:"touch",3:"pen",4:"mouse"};Fp.prototype.b=function(){Fp.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Mp)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var Vp="closure_listenable_"+(1e6*Math.random()|0),qp=0;function Bp(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++qp,this.X=this.Z=!1}function jp(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Wp(t){this.src=t,this.a={},this.b=0}function Kp(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=ep(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(jp(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Qp(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Wp.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=Qp(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new Bp(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Hp="closure_lm_"+(1e6*Math.random()|0),Gp={};function zp(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Wf(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=nd(r);return e&&e[Vp]?e.Aa(n,r,Qf(i)?!!i.capture:!!i,o):Yp(e,n,r,!0,i,o)}(t,e,n,r,i);if(Wf(e)){for(var o=0;o<e.length;o++)zp(t,e[o],n,r,i);return null}return n=nd(n),t&&t[Vp]?t.za(e,n,Qf(r)?!!r.capture:!!r,i):Yp(t,e,n,!1,r,i)}function Yp(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=Qf(i)?!!i.capture:!!i;if(a&&!Pp)return null;var s=td(t);if(s||(t[Hp]=s=new Wp(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var e=Zp,n=Pp?function(t){return e.call(n.src,n.listener,t)}:function(t){if(!(t=e.call(n.src,n.listener,t)))return t};return n}(),(n.proxy=r).src=t,r.listener=n,t.addEventListener)xp||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Jp(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Xp(t){if(!Vf(t)&&t&&!t.X){var e=t.src;if(e&&e[Vp])Kp(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Jp(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=td(e))?(Kp(n,t),0==n.b&&(n.src=null,e[Hp]=null)):jp(t)}}}function Jp(t){return t in Gp?Gp[t]:Gp[t]="on"+t}function $p(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Xp(t),n.call(r,e)}function Zp(t,e){return!!t.X||(Pp?$p(t,new Fp(e,this)):$p(t,e=new Fp(e||qf("window.event"),this)))}function td(t){return(t=t[Hp])instanceof Wp?t:null}var ed="__closure_events_fn_"+(1e9*Math.random()>>>0);function nd(e){return"function"==jf(e)?e:(e[ed]||(e[ed]=function(t){return e.handleEvent(t)}),e[ed])}function rd(){tp.call(this),this.c=new Wp(this),(this.J=this).B=null}function id(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&Kp(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ia}Zf(rd,tp),rd.prototype[Vp]=!0,(Mf=rd.prototype).addEventListener=function(t,e,n,r){zp(this,t,e,n,r)},Mf.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Wf(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=Qf(i)?!!i.capture:!!i,r=nd(r),e&&e[Vp]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Qp(a=e.a[n],r,i,o))&&(jp(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):(e=e&&td(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Qp(n,r,i,o)),(r=-1<e?n[e]:null)&&Xp(r))}(this,t,e,n,r)},Mf.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(Uf(t))t=new Lp(t,n);else if(t instanceof Lp)t.target=t.target||n;else{var i=t;mp(t=new Lp(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=id(a,r,!0,t)&&i}if(i=id(a=t.a=n,r,!0,t)&&i,i=id(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=id(a=t.a=e[o],r,!1,t)&&i;return i},Mf.G=function(){if(rd.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)jp(n[r]);delete e.a[t],e.b--}}this.B=null},Mf.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},Mf.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var od=Ff.JSON.stringify;function ad(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function sd(){this.b=this.a=null}ad.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var ud,cd=new ad(function(){return new hd},function(t){t.reset()});function hd(){this.next=this.b=this.a=null}function ld(t){Ff.setTimeout(function(){throw t},0)}function fd(t,e){ud||function(){var t=Ff.Promise.resolve(void 0);ud=function(){t.then(md)}}(),pd||(ud(),pd=!0),dd.add(t,e)}sd.prototype.add=function(t,e){var n=cd.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},hd.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var pd=!(hd.prototype.reset=function(){this.next=this.b=this.a=null}),dd=new sd;function md(){for(var t;r=n=void 0,r=null,(n=dd).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){ld(t)}var e=cd;e.f(t),e.b<100&&(e.b++,t.next=e.a,e.a=t)}var n,r;pd=!1}function yd(t,e){rd.call(this),this.b=t||1,this.a=e||Ff,this.f=Xf(this.fb,this),this.g=$f()}function gd(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function vd(t,e,n){if("function"==jf(t))n&&(t=Xf(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Xf(t.handleEvent,t)}return 2147483647<Number(e)?-1:Ff.setTimeout(t,e||0)}function bd(t,e,n){tp.call(this),this.f=null!=n?Xf(t,n):t,this.c=e,this.b=Xf(this.$a,this),this.a=[]}function wd(t){t.U=vd(t.b,t.c),t.f.apply(null,t.a)}function _d(t){tp.call(this),this.b=t,this.a={}}Zf(yd,rd),(Mf=yd.prototype).ba=!1,Mf.L=null,Mf.fb=function(){if(this.ba){var t=$f()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(gd(this),this.start()))}},Mf.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=$f())},Mf.G=function(){yd.N.G.call(this),gd(this),delete this.a},Zf(bd,tp),(Mf=bd.prototype).ea=!1,Mf.U=null,Mf.Ta=function(t){this.a=arguments,this.U?this.ea=!0:wd(this)},Mf.G=function(){bd.N.G.call(this),this.U&&(Ff.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},Mf.$a=function(){this.U=null,this.ea&&(this.ea=!1,wd(this))},Zf(_d,tp);var Td=[];function Ed(t,e,n,r){Wf(n)||(n&&(Td[0]=n.toString()),n=Td);for(var i=0;i<n.length;i++){var o=zp(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Sd(t){fp(t.a,function(t,e){this.a.hasOwnProperty(e)&&Xp(t)},t),t.a={}}function Id(){}_d.prototype.G=function(){_d.N.G.call(this),Sd(this)},_d.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Cd=new rd;function Nd(t){Lp.call(this,"serverreachability",t)}function Ad(t){Cd.dispatchEvent(new Nd(Cd,t))}function kd(t){Lp.call(this,"statevent",t)}function Dd(t){Cd.dispatchEvent(new kd(Cd,t))}function Rd(t){Lp.call(this,"timingevent",t)}function Od(t,e){if("function"!=jf(t))throw Error("Fn must not be null and must be a function");return Ff.setTimeout(function(){t()},e)}Zf(Nd,Lp),Zf(kd,Lp),Zf(Rd,Lp);var Pd={NO_ERROR:0,gb:1,nb:2,mb:3,jb:4,lb:5,ob:6,La:7,TIMEOUT:8,rb:9},Md={ib:"complete",vb:"success",Ma:"error",La:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",kb:"downloadprogress",wb:"uploadprogress"};function xd(){}function Ld(t){var e;return(e=t.a)||(e=t.a={}),e}function Fd(){}xd.prototype.a=null;var Ud,Vd={OPEN:"a",hb:"b",Ma:"c",qb:"d"};function qd(){Lp.call(this,"d")}function Bd(){Lp.call(this,"c")}function jd(){}function Wd(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new _d(this),this.O=Kd,t=Tp?125:void 0,this.P=new yd(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}Zf(qd,Lp),Zf(Bd,Lp),Zf(jd,xd),Ud=new jd;var Kd=45e3,Qd={},Hd={};function Gd(t,e,n){t.F=1,t.f=vm(lm(e)),t.l=n,t.H=!0,Yd(t,null)}function zd(t,e,n,r){t.F=1,t.f=vm(lm(e)),t.l=null,t.H=n,Yd(t,r)}function Yd(t,e){t.v=$f(),$d(t),t.D=lm(t.f),gm(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new bd(Xf(t.Ja,t,t.a),t.J)),Ed(t.I,t.a,"readystatechange",t.cb),e=t.h?pp(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),Ad(1)}function Xd(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Jd(t,n);if(i==Hd){4==e&&(t.c=4,Dd(14),r=!1);break}if(i==Qd){t.c=4,Dd(15),r=!1;break}rm(t,i)}4==e&&0==n.length&&(t.c=1,Dd(16),r=!1),t.b=t.b&&r,r||(nm(t),em(t))}function Jd(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Hd:(n=Number(e.substring(n,r)),isNaN(n)?Qd:(r+=1)+n>e.length?Hd:(e=e.substr(r,n),t.A=r+n,e))}function $d(t){t.R=$f()+t.O,Zd(t,t.O)}function Zd(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=Od(Xf(t.ab,t),e)}function tm(t){t.i&&(Ff.clearTimeout(t.i),t.i=null)}function em(t){t.g.Ca()||t.m||t.g.na(t)}function nm(t){tm(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,gd(t.P),Sd(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function rm(t,e){try{t.g.Fa(t,e),Ad(4)}catch(t){}}function im(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Kf(t)||Uf(t))np(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(Kf(t)||Uf(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(Uf(t))return t.split("");if(Kf(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function om(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof om)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function am(t,e){um(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&sm(t))}function sm(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];um(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)um(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function um(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Mf=Wd.prototype).setTimeout=function(t){this.O=t},Mf.cb=function(t){t=t.target;var e=this.B;e&&3==hy(t)?e.Ta():this.Ja(t)},Mf.Ja=function(t){try{if(t==this.a)t:{var e=hy(this.a),n=this.a.ya(),r=this.a.T();if(!(e<3||3==e&&!Tp&&!this.a.aa())){this.m||4!=e||7==n||Ad(8==n||r<=0?3:2),tm(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=ly(this.a,"X-HTTP-Initial-Response");if(a&&!op(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,Dd(12),nm(this),em(this);break t}this.s=!0,rm(this,s)}this.H?(Xd(this,e,o),Tp&&this.b&&3==e&&(Ed(this.I,this.P,"tick",this.bb),this.P.start())):rm(this,o),4==e&&nm(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,$d(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,Dd(12)):(this.c=0,Dd(13)),nm(this),em(this)}}}catch(t){}},Mf.bb=function(){if(this.a){var t=hy(this.a),e=this.a.aa();this.A<e.length&&(tm(this),Xd(this,t,e),this.b&&4!=t&&$d(this))}},Mf.cancel=function(){this.m=!0,nm(this)},Mf.ab=function(){this.i=null;var t=$f();0<=t-this.R?(2!=this.F&&(Ad(3),Dd(17)),nm(this),this.c=2,em(this)):Zd(this,this.R-t)},(Mf=om.prototype).C=function(){sm(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},Mf.K=function(){return sm(this),this.a.concat()},Mf.get=function(t,e){return um(this.b,t)?this.b[t]:e},Mf.set=function(t,e){um(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},Mf.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var cm=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function hm(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof hm?(this.h=void 0!==e?e:t.h,fm(this,t.f),this.j=t.j,pm(this,t.b),dm(this,t.i),this.a=t.a,mm(this,Om(t.c)),this.g=t.g):t&&(n=String(t).match(cm))?(this.h=!!e,fm(this,n[1]||"",!0),this.j=bm(n[2]||""),pm(this,n[3]||"",!0),dm(this,n[4]),this.a=bm(n[5]||"",!0),mm(this,n[6]||"",!0),this.g=bm(n[7]||"")):(this.h=!!e,this.c=new Nm(null,this.h))}function lm(t){return new hm(t)}function fm(t,e,n){t.f=n?bm(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function pm(t,e,n){t.b=n?bm(e,!0):e}function dm(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.i=e}else t.i=null}function mm(t,e,n){e instanceof Nm?(t.c=e,function(t,e){e&&!t.f&&(Am(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(km(this,e),Rm(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=wm(e,Im)),t.c=new Nm(e,t.h))}function ym(t,e,n){t.c.set(e,n)}function gm(t,e,n){Wf(n)||(n=[String(n)]),Rm(t.c,e,n)}function vm(t){return ym(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^$f()).toString(36)),t}function bm(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function wm(t,e,n){return Uf(t)?(t=encodeURI(t).replace(e,_m),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function _m(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}hm.prototype.toString=function(){var t=[],e=this.f;e&&t.push(wm(e,Tm,!0),":");var n=this.b;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(wm(e,Tm,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(wm(n,"/"==n.charAt(0)?Sm:Em,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",wm(n,Cm)),t.join("")},hm.prototype.resolve=function(t){var e=lm(this),n=!!t.f;n?fm(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?pm(e,t.b):n=null!=t.i;var r=t.a;if(n)dm(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(up(i,"./")||up(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?mm(e,Om(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Tm=/[#\/\?@]/g,Em=/[#\?:]/g,Sm=/[#\?]/g,Im=/[#\?@]/g,Cm=/#/g;function Nm(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Am(n){n.a||(n.a=new om,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function km(t,e){Am(t),e=Pm(t,e),um(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,am(t.a,e))}function Dm(t,e){return Am(t),e=Pm(t,e),um(t.a.b,e)}function Rm(t,e,n){km(t,e),0<n.length&&(t.c=null,t.a.set(Pm(t,e),ip(n)),t.b+=n.length)}function Om(t){var e=new Nm;return e.c=t.c,t.a&&(e.a=new om(t.a),e.b=t.b),e}function Pm(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Mm(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function xm(t){var e=t.a.F.a;if(null!=e)Dd(4),e?(Dd(10),Ey(t.a,t,!1)):(Dd(11),Ey(t.a,t,!0));else{t.b=new Wd(t,void 0,void 0),t.b.h=t.h,e=Ay(e=t.a,e.Y()?t.f:null,t.i),Dd(4),gm(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&ym(e,n,r),zd(t.b,e,!1,t.f)}}function Lm(){this.a=this.b=null}function Fm(){this.a=new om}function Um(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Hf]||(t[Hf]=++Gf)):e.charAt(0)+t}function Vm(t,e){this.b=t,this.a=e}function qm(t){this.g=t||Bm,t=Ff.PerformanceNavigationTiming?0<(t=Ff.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Ff.ka&&Ff.ka.Da&&Ff.ka.Da()&&Ff.ka.Da().yb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Fm),this.b=null,this.c=[]}(Mf=Nm.prototype).add=function(t,e){Am(this),this.c=null,t=Pm(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},Mf.forEach=function(n,r){Am(this),this.a.forEach(function(t,e){np(t,function(t){n.call(r,t,e,this)},this)},this)},Mf.K=function(){Am(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},Mf.C=function(t){Am(this);var e=[];if(Uf(t))Dm(this,t)&&(e=rp(e,this.a.get(Pm(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=rp(e,t[n])}return e},Mf.set=function(t,e){return Am(this),this.c=null,Dm(this,t=Pm(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},Mf.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},Mf.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},Zf(function(){},function(){}),(Mf=Mm.prototype).M=null,Mf.$=function(t){return this.a.$(t)},Mf.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},Mf.Ca=function(){return!1},Mf.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=ly(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=ly(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void Cy(e,2)}this.f=r[0]}else(e=this.a).m=this.c,Cy(e,2)}else 1==this.M&&(this.g?Dd(6):"11111"==e?(Dd(5),this.g=!0,(!wp||10<=Number(kp))&&(this.c=200,this.b.cancel(),Dd(11),Ey(this.a,this,!0))):(Dd(7),this.g=!1))},Mf.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,xm(this)):1==this.M&&(this.g?(Dd(11),Ey(this.a,this,!0)):(Dd(10),Ey(this.a,this,!1)));else{0==this.M?Dd(8):1==this.M&&Dd(9);var t=this.a;t.m=this.c,Cy(t,2)}},Mf.Y=function(){return this.a.Y()},Mf.ma=function(){return this.a.ma()},Fm.prototype.add=function(t){this.a.set(Um(t),t)},Fm.prototype.C=function(){return this.a.C()};var Bm=10;function jm(t,e){!t.a&&(up(e,"spdy")||up(e,"quic")||up(e,"h2"))&&(t.f=t.g,t.a=new Fm,t.b&&(Hm(t,t.b),t.b=null))}function Wm(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Km(t){return t.b?1:t.a?t.a.a.c:0}function Qm(t,e){return t=t.b?t.b==e:!!t.a&&(e=Um(e),um(t.a.a.b,e))}function Hm(t,e){t.a?t.a.add(e):t.b=e}function Gm(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Um(e),n=um(t.a.a.b,n)),n&&am(t.a.a,Um(e)))}function zm(t){if(null!=t.b)return t.c.concat(t.b.j);if(null==t.a||0==t.a.a.c)return ip(t.c);var e=t.c;return np(t.a.C(),function(t){e=e.concat(t.j)}),e}function Ym(){}function Xm(){this.a=new Ym}function Jm(t,r,e){var i=e||"";try{im(t,function(t,e){var n=t;Qf(t)&&(n=od(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function $m(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}qm.prototype.cancel=function(){this.c=zm(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(np(this.a.C(),function(t){t.cancel()}),function(t){t.b={},t.a.length=0,t.c=0}(this.a.a))},Ym.prototype.stringify=function(t){return Ff.JSON.stringify(t,void 0)},Ym.prototype.parse=function(t){return Ff.JSON.parse(t,void 0)};var Zm=Ff.JSON.parse;function ty(t){rd.call(this),this.headers=new om,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=ey,this.D=this.F=!1}Zf(ty,rd);var ey="",ny=/^https?$/i,ry=["POST","PUT"];function iy(t){return"content-type"==t.toLowerCase()}function oy(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,ay(t),uy(t)}function ay(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function sy(t){if(t.b&&void 0!==Lf&&(!t.s[1]||4!=hy(t)||2!=t.T()))if(t.l&&4==hy(t))vd(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==hy(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(cm)[1]||null;if(!o&&Ff.self&&Ff.self.location){var a=Ff.self.location.protocol;o=a.substr(0,a.length-1)}i=!ny.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var s=2<hy(t)?t.a.statusText:""}catch(t){s=""}t.f=s+" ["+t.T()+"]",ay(t)}}finally{uy(t)}}}function uy(t,e){if(t.a){cy(t);var n=t.a,r=t.s[0]?Bf:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function cy(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(Ff.clearTimeout(t.m),t.m=null)}function hy(t){return t.a?t.a.readyState:0}function ly(t,e){return t.a?t.a.getResponseHeader(e):null}function fy(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var n="";return fp(t,function(t,e){n+=e,n+=":",n+=t,n+="\r\n"}),n}(n),Uf(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if((n=t.indexOf("#"))<0&&(n=t.length),(r=t.indexOf("?"))<0||n<r){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return ym(t,e,n),t}function py(t){this.f=[],this.F=new Lm,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!qf("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=qf("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=qf("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=qf("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=qf("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.zb||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new qm(t&&t.concurrentRequestLimit),this.ja=new Xm,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function dy(t){if(my(t),3==t.u){var e=t.P++,n=lm(t.B);ym(n,"SID",t.H),ym(n,"RID",e),ym(n,"TYPE","terminate"),by(t,n),(e=new Wd(t,e,void 0)).F=2,e.f=vm(lm(n)),n=!1,Ff.navigator&&Ff.navigator.sendBeacon&&(n=Ff.navigator.sendBeacon(e.f.toString(),"")),!n&&Ff.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=$f(),$d(e)}Ny(t)}function my(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(Ff.clearTimeout(t.l),t.l=null),Sy(t),t.b.cancel(),t.h&&(Vf(t.h)&&Ff.clearTimeout(t.h),t.h=null)}function yy(t,e){t.f.push(new Vm(t.Qa++,e)),3==t.u&&gy(t)}function gy(t){Wm(t.b)||t.h||(t.h=!0,fd(t.Ha,t),t.A=0)}function vy(t,e){var n;n=e?e.W:t.P++;var r=lm(t.B);ym(r,"SID",t.H),ym(r,"RID",n),ym(r,"AID",t.O),by(t,r),t.g&&t.i&&fy(r,t.g,t.i),n=new Wd(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=wy(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Hm(t.b,n),Gd(n,r,e)}function by(t,n){t.c&&im({},function(t,e){ym(n,e,t)})}function wy(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Xf(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),s=!1;else try{Jm(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function _y(t){t.a||t.l||(t.S=1,fd(t.Ga,t),t.v=0)}function Ty(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=Od(Xf(t.Ga,t),Iy(t,t.v)),t.v++,!0)}function Ey(t,e,n){var r=e.l;r&&jm(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Ay(t,null,t.ha),gy(t)}function Sy(t){null!=t.s&&(Ff.clearTimeout(t.s),t.s=null)}function Iy(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function Cy(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Xf(t.eb,t);n||(n=new hm("//www.google.com/images/cleardot.gif"),Ff.location&&"http"==Ff.location.protocol||fm(n,"https"),vm(n)),function(t,e){var n=new Id;if(Ff.Image){var r=new Image;r.onload=Jf($m,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Jf($m,n,r,"TestLoadImage: error",!1,e),r.onabort=Jf($m,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Jf($m,n,r,"TestLoadImage: timeout",!1,e),Ff.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Dd(2);t.u=0,t.c&&t.c.ta(e),Ny(t),my(t)}function Ny(t){t.u=0,t.m=-1,t.c&&(0==zm(t.b).length&&0==t.f.length||(t.b.c.length=0,ip(t.f),t.f.length=0),t.c.sa())}function Ay(t,e,n){var r=function(t){return t instanceof hm?lm(t):new hm(t,void 0)}(n);if(""!=r.b)e&&pm(r,e+"."+r.b),dm(r,r.i);else{var i,o=Ff.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new hm(null,void 0);return t&&fm(i,t),e&&pm(i,e),n&&dm(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&fp(t.V,function(t,e){ym(r,e,t)}),e=t.j,n=t.I,e&&n&&ym(r,e,n),ym(r,"VER",t.wa),by(t,r),r}function ky(){}function Dy(){if(wp&&!(10<=Number(kp)))throw Error("Environmental error: no available transport.")}function Ry(t,e){rd.call(this),this.a=new py(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=t,n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!op(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!op(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new My(this)}function Oy(t){qd.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Py(){Bd.call(this),this.status=1}function My(t){this.a=t}(Mf=ty.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ld(this.H):Ld(Ud),this.a.onreadystatechange=Xf(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void oy(this,t)}t=n||"";var i=new om(this.headers);r&&im(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=iy,n=t.length,r=Uf(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:Uf(t)?t.charAt(e):t[e]}(i.K()),n=Ff.FormData&&t instanceof Ff.FormData,0<=ep(ry,e)&&!r&&!n&&i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{cy(this),0<this.o&&((this.D=function(t){return wp&&Rp(9)&&Vf(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Xf(this.Ba,this)):this.m=vd(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){oy(this,t)}},Mf.Ba=function(){void 0!==Lf&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},Mf.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),uy(this))},Mf.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),uy(this,!0)),ty.N.G.call(this)},Mf.Ea=function(){this.j||(this.w||this.l||this.g?sy(this):this.Za())},Mf.Za=function(){sy(this)},Mf.T=function(){try{return 2<hy(this)?this.a.status:-1}catch(t){return-1}},Mf.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},Mf.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Zm(e)}},Mf.ya=function(){return this.h},Mf.Xa=function(){return Uf(this.f)?this.f:String(this.f)},(Mf=py.prototype).wa=8,Mf.u=1,Mf.Ca=function(){return 0==this.u},Mf.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random()),t=this.P++;var e,n=new Wd(this,t,void 0),r=this.i;if(this.J&&(r?mp(r=pp(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&Uf(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=wy(this,n,e),ym(i=lm(this.B),"RID",t),ym(i,"CVER",22),this.o&&this.j&&ym(i,"X-HTTP-Session-Id",this.j),by(this,i),this.g&&r&&fy(i,this.g,r),Hm(this.b,n),this.W?(ym(i,"$req",e),ym(i,"SID","null"),n.S=!0,Gd(n,i,null)):Gd(n,i,e),this.u=2}}else 3==this.u&&(t?vy(this,t):0==this.f.length||Wm(this.b)||vy(this))},Mf.Ga=function(){this.l=null,this.a=new Wd(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=lm(this.pa);ym(t,"RID","rpc"),ym(t,"SID",this.H),ym(t,"CI",this.ia?"0":"1"),ym(t,"AID",this.O),by(this,t),ym(t,"TYPE","xmlhttp"),this.g&&this.i&&fy(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),zd(this.a,t,!0,this.ga)},Mf.Fa=function(t,e){if(0!=this.u&&(this.a==t||Qm(this.b,t)))if(this.m=t.o,!t.s&&Qm(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(Wf(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Sy(this),this.a.cancel(),this.a=null}Ty(this),Dd(18)}}else this.ra=e[1],0<this.ra-this.O&&e[2]<37500&&this.ia&&0==this.v&&!this.s&&(this.s=Od(Xf(this.Ya,this),6e3));if(Km(this.b)<=1&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else Cy(this,11)}else if(!t.s&&this.a!=t||Sy(this),!op(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&Vf(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=ly(r,"X-Client-Wire-Protocol"))&&jm(this.b,i),this.j&&(r=ly(r,"X-HTTP-Session-Id")))&&(this.I=r,ym(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Ay(this,this.Y()?this.ga:null,this.ha),r.s?(Gm(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(tm(r),$d(r)),this.a=r):_y(this),0<this.f.length&&gy(this)}else"stop"!=r[0]&&"close"!=r[0]||Cy(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?Cy(this,7):dy(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},Mf.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Ty(this),Dd(19))},Mf.na=function(t){var e=null;if(this.a==t){Sy(this),this.a=null;var n=2}else{if(!Qm(this.b,t))return;e=t.j,Gm(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=$f()-t.v,Cd.dispatchEvent(new Rd(Cd,t.l?t.l.length:0,e,this.A)),gy(this)):_y(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Km(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=Od(Xf(t.Ha,t,e),Iy(t,t.A)),t.A++,!0))}(this,t)||2==n&&Ty(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:Cy(this,5);break;case 4:Cy(this,10);break;case 3:Cy(this,6);break;default:Cy(this,2)}}},Mf.eb=function(t){Dd(t?2:1)},Mf.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new ty(this.Ka)).F=this.R,t},Mf.ma=function(){return!!this.c&&!0},Mf.Y=function(){return this.R},(Mf=ky.prototype).va=function(){},Mf.ua=function(){},Mf.ta=function(){},Mf.sa=function(){},Mf.Sa=function(){},Dy.prototype.a=function(t,e){return new Ry(t,e)},Zf(Ry,rd),(Mf=Ry.prototype).addEventListener=function(t,e,n,r){Ry.N.addEventListener.call(this,t,e,n,r)},Mf.removeEventListener=function(t,e,n,r){Ry.N.removeEventListener.call(this,t,e,n,r)},Mf.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;Dd(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Mm(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=fy(e,t.g,t.i)),(t=t.w).i=n,e=Ay(t.a,null,t.i),Dd(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,xm(t)):(gm(e,"MODE","init"),!t.a.o&&t.a.j&&gm(e,"X-HTTP-Session-Id",t.a.j),t.b=new Wd(t,void 0,void 0),t.b.h=t.h,zd(t.b,e,!1,null),t.M=0)},Mf.close=function(){dy(this.a)},Mf.Wa=function(t){if(Uf(t)){var e={};e.__data__=t,yy(this.a,e)}else this.h?((e={}).__data__=od(t),yy(this.a,e)):yy(this.a,t)},Mf.G=function(){this.a.c=null,delete this.f,dy(this.a),delete this.a,Ry.N.G.call(this)},Zf(Oy,qd),Zf(Py,Bd),Zf(My,ky),My.prototype.va=function(){this.a.dispatchEvent("a")},My.prototype.ua=function(t){this.a.dispatchEvent(new Oy(t))},My.prototype.ta=function(t){this.a.dispatchEvent(new Py(t))},My.prototype.sa=function(){this.a.dispatchEvent("b")};var xy=Jf(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},Dy);Dy.prototype.createWebChannel=Dy.prototype.a,Ry.prototype.send=Ry.prototype.Wa,Ry.prototype.open=Ry.prototype.Va,Ry.prototype.close=Ry.prototype.close,Pd.NO_ERROR=0,Pd.TIMEOUT=8,Pd.HTTP_ERROR=6,Md.COMPLETE="complete",(Fd.EventType=Vd).OPEN="a",Vd.CLOSE="b",Vd.ERROR="c",Vd.MESSAGE="d",rd.prototype.listen=rd.prototype.za,ty.prototype.listenOnce=ty.prototype.Aa,ty.prototype.getLastError=ty.prototype.Xa,ty.prototype.getLastErrorCode=ty.prototype.ya,ty.prototype.getStatus=ty.prototype.T,ty.prototype.getResponseJson=ty.prototype.Ua,ty.prototype.getResponseText=ty.prototype.aa,ty.prototype.send=ty.prototype.ca;var Ly,Fy,Uy={createWebChannelTransport:xy,ErrorCode:Pd,EventType:Md,WebChannel:Fd,XhrIo:ty},Vy=Uy.createWebChannelTransport,qy=Uy.ErrorCode,By=Uy.EventType,jy=Uy.WebChannel,Wy=Uy.XhrIo,Ky=fl.SDK_VERSION,Qy=new bs("@firebase/firestore");function Hy(){return Qy.logLevel===ls.DEBUG?Ly.DEBUG:Qy.logLevel===ls.SILENT?Ly.SILENT:Ly.ERROR}function Gy(t){switch(t){case Ly.DEBUG:Qy.logLevel=ls.DEBUG;break;case Ly.ERROR:Qy.logLevel=ls.ERROR;break;case Ly.SILENT:Qy.logLevel=ls.SILENT;break;default:Qy.error("Firestore ("+Ky+"): Invalid value passed to `setLogLevel`")}}function zy(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Qy.logLevel<=ls.DEBUG){var i=n.map(Xy);Qy.debug.apply(Qy,_a(["Firestore ("+Ky+") ["+t+"]: "+e],i))}}function Yy(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Qy.logLevel<=ls.ERROR){var r=e.map(Xy);Qy.error.apply(Qy,_a(["Firestore ("+Ky+"): "+t],r))}}function Xy(e){if("string"==typeof e)return e;var t=Zy.getPlatform();try{return t.formatJSON(e)}catch(t){return e}}function Jy(t){var e="FIRESTORE ("+Ky+") INTERNAL ASSERTION FAILED: "+t;throw Yy(e),new Error(e)}function $y(t,e){t||Jy(e)}(Fy=Ly=Ly||{})[Fy.DEBUG=0]="DEBUG",Fy[Fy.ERROR=1]="ERROR",Fy[Fy.SILENT=2]="SILENT";var Zy=(tg.setPlatform=function(t){tg.platform&&Jy("Platform already defined"),tg.platform=t},tg.getPlatform=function(){return tg.platform||Jy("Platform not set"),tg.platform},tg);function tg(){}function eg(){return Zy.getPlatform().emptyByteString}var ng,rg={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ig=(da(og,ng=Error),og);function og(t,e){var n=ng.call(this,e)||this;return n.code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function ag(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new ig(rg.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function sg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ug(t,e){return void 0!==t?t:e}function cg(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function hg(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function lg(t){for(var e in $y(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function fg(t,e){if(0!==e.length)throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Dg(e.length,"argument")+".")}function pg(t,e,n){if(e.length!==n)throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires "+Dg(n,"argument")+", but was called with "+Dg(e.length,"argument")+".")}function dg(t,e,n){if(e.length<n)throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Dg(n,"argument")+", but was called with "+Dg(e.length,"argument")+".")}function mg(t,e,n,r){if(e.length<n||e.length>r)throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Dg(e.length,"argument")+".")}function yg(t,e,n,r){Tg(t,e,kg(n)+" argument",r)}function gg(t,e,n,r){void 0!==r&&yg(t,e,n,r)}function vg(t,e,n,r){Tg(t,e,n+" option",r)}function bg(t,e,n,r){void 0!==r&&vg(t,e,n,r)}function wg(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Sg(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Sg(r[o]))}(t,e,n,r,i)}function _g(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Sg(u))}var c=Sg(r);throw new ig(rg.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Tg(t,e,n,r){if(!("object"===e?Eg(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Sg(r);throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Eg(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Sg(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Jy("Unknown wrong type: "+typeof t);if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}function Ig(t,e,n){if(void 0===n)throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+kg(e)+" argument, but it was undefined.")}function Cg(n,t,r){hg(t,function(t,e){if(r.indexOf(t)<0)throw new ig(rg.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function Ng(t,e,n,r){var i=Sg(r);return new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires its "+kg(n)+" argument to be a "+e+", but it was: "+i)}function Ag(t,e,n){if(n<=0)throw new ig(rg.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+kg(e)+" argument to be a positive number, but it was: "+n+".")}function kg(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Dg(t,e){return t+" "+e+(1===t?"":"s")}var Rg=(Og.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return $y(20===e.length,"Invalid auto ID: "+e),e},Og);function Og(){}function Pg(t,e){return t<e?-1:e<t?1:0}function Mg(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function xg(t){return t+"\0"}function Lg(){if("undefined"==typeof Uint8Array)throw new ig(rg.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Fg(){if(!Zy.getPlatform().base64Available)throw new ig(rg.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ug=(Vg.fromBase64String=function(t){pg("Blob.fromBase64String",arguments,1),yg("Blob.fromBase64String","string",1,t),Fg();try{return new Vg(Zy.getPlatform().atob(t))}catch(t){throw new ig(rg.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Vg.fromUint8Array=function(t){if(pg("Blob.fromUint8Array",arguments,1),Lg(),!(t instanceof Uint8Array))throw Ng("Blob.fromUint8Array","Uint8Array",1,t);return new Vg(Array.prototype.map.call(t,function(t){return String.fromCharCode(t)}).join(""))},Vg.prototype.toBase64=function(){return pg("Blob.toBase64",arguments,0),Fg(),Zy.getPlatform().btoa(this._binaryString)},Vg.prototype.toUint8Array=function(){pg("Blob.toUint8Array",arguments,0),Lg();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},Vg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Vg.prototype.isEqual=function(t){return this._binaryString===t._binaryString},Vg.prototype._compareTo=function(t){return Pg(this._binaryString,t._binaryString)},Vg);function Vg(t){Fg(),this._binaryString=t}var qg=ag(Ug,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Bg=function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},jg="(default)",Wg=(Object.defineProperty(Kg.prototype,"isDefaultDatabase",{get:function(){return this.database===jg},enumerable:!0,configurable:!0}),Kg.prototype.isEqual=function(t){return t instanceof Kg&&t.projectId===this.projectId&&t.database===this.database},Kg.prototype.compareTo=function(t){return Pg(this.projectId,t.projectId)||Pg(this.database,t.database)},Kg);function Kg(t,e){this.projectId=t,this.database=e||jg}var Qg=(Hg.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Hg.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},Hg.INVALID=-1,Hg);function Hg(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}var Gg="__name__",zg=(Object.defineProperty(Yg.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),Yg.prototype.isEqual=function(t){return 0===Yg.comparator(this,t)},Yg.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Yg?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},Yg.prototype.limit=function(){return this.offset+this.length},Yg.prototype.popFirst=function(t){return t=void 0===t?1:t,$y(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},Yg.prototype.popLast=function(){return $y(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},Yg.prototype.firstSegment=function(){return $y(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},Yg.prototype.lastSegment=function(){return this.get(this.length-1)},Yg.prototype.get=function(t){return $y(t<this.length,"Index out of range"),this.segments[this.offset+t]},Yg.prototype.isEmpty=function(){return 0===this.length},Yg.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Yg.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Yg.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Yg.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},Yg.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Yg);function Yg(t,e,n){void 0===e?e=0:e>t.length&&Jy("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Jy("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}var Xg,Jg=(da($g,Xg=zg),$g.prototype.construct=function(t,e,n){return new $g(t,e,n)},$g.prototype.canonicalString=function(){return this.toArray().join("/")},$g.prototype.toString=function(){return this.canonicalString()},$g.fromString=function(t){if(0<=t.indexOf("//"))throw new ig(rg.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new $g(t.split("/").filter(function(t){return 0<t.length}))},$g.EMPTY_PATH=new $g([]),$g);function $g(){return null!==Xg&&Xg.apply(this,arguments)||this}var Zg,tv=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ev=(da(nv,Zg=zg),nv.prototype.construct=function(t,e,n){return new nv(t,e,n)},nv.isValidIdentifier=function(t){return tv.test(t)},nv.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),nv.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},nv.prototype.toString=function(){return this.canonicalString()},nv.prototype.isKeyField=function(){return 1===this.length&&this.get(0)===Gg},nv.keyField=function(){return new nv([Gg])},nv.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new ig(rg.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var a=t[r];if("\\"===a){if(r+1===t.length)throw new ig(rg.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var s=t[r+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new ig(rg.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=s,r+=2}else"`"===a?o=!o:"."!==a||o?n+=a:i(),r++}if(i(),o)throw new ig(rg.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new nv(e)},nv.EMPTY_PATH=new nv([]),nv);function nv(){return null!==Zg&&Zg.apply(this,arguments)||this}var rv=(iv.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},iv.prototype.isEqual=function(t){return null!==t&&0===Jg.comparator(this.path,t.path)},iv.prototype.toString=function(){return this.path.toString()},iv.comparator=function(t,e){return Jg.comparator(t.path,e.path)},iv.isDocumentKey=function(t){return t.length%2==0},iv.fromSegments=function(t){return new iv(new Jg(t.slice()))},iv.fromPathString=function(t){return new iv(Jg.fromString(t))},iv.EMPTY=new iv(new Jg([])),iv);function iv(t){this.path=t,$y(iv.isDocumentKey(t),"Invalid DocumentKey with an odd number of segments: "+t.toArray().join("/"))}var ov,av,sv=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})};(av=ov=ov||{}).All="all",av.ListenStreamIdle="listen_stream_idle",av.ListenStreamConnectionBackoff="listen_stream_connection_backoff",av.WriteStreamIdle="write_stream_idle",av.WriteStreamConnectionBackoff="write_stream_connection_backoff",av.OnlineStateTimeout="online_state_timeout",av.ClientMetadataRefresh="client_metadata_refresh",av.LruGarbageCollection="lru_garbage_collection",av.RetryTransaction="retry_transaction";var uv=(cv.createAndSchedule=function(t,e,n,r,i){var o=new cv(t,e,Date.now()+n,r,i);return o.start(n),o},cv.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},cv.prototype.skipDelay=function(){return this.handleDelayElapsed()},cv.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ig(rg.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},cv.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},cv.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},cv);function cv(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new sv,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}var hv=(Object.defineProperty(lv.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),lv.prototype.enqueueAndForget=function(t){this.enqueue(t)},lv.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},lv.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},lv.prototype.enqueueAndInitiateShutdown=function(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(e)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},lv.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},lv.prototype.enqueueInternal=function(t){var n=this,e=this.tail.then(function(){return n.operationInProgress=!0,t().catch(function(t){n.failure=t,n.operationInProgress=!1;var e=t.stack||t.message||"";throw Yy("INTERNAL UNHANDLED ERROR: ",e),e.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return n.operationInProgress=!1,t})});return this.tail=e},lv.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),$y(0<=e,"Attempted to schedule an operation with a negative delay of "+e),-1<this.timerIdsToSkip.indexOf(t)&&(e=0);var i=uv.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},lv.prototype.verifyNotFailed=function(){this.failure&&Jy("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},lv.prototype.verifyOperationInProgress=function(){$y(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},lv.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},lv.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},lv.prototype.runDelayedOperationsEarly=function(r){var i=this;return this.drain().then(function(){$y(r===ov.All||i.containsDelayedOperation(r),"Attempted to drain to missing operation "+r),i.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.delayedOperations;t<e.length;t++){var n=e[t];if(n.skipDelay(),r!==ov.All&&n.timerId===r)break}return i.drain()})},lv.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},lv.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);$y(0<=e,"Delayed operation not found."),this.delayedOperations.splice(e,1)},lv);function lv(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}var fv="",pv="",dv="",mv="";function yv(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=vv(e)),e=gv(t.get(n),e);return vv(e)}function gv(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=fv+dv;break;case fv:n+=fv+mv;break;default:n+=o}}return n}function vv(t){return t+fv+pv}function bv(t){var e=t.length;if($y(2<=e,"Invalid path "+t),2===e)return $y(t.charAt(0)===fv&&t.charAt(1)===pv,"Non-empty path "+t+" had length 2"),Jg.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(fv,o);switch((a<0||n<a)&&Jy('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case pv:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case dv:i+=t.substring(o,a),i+="\0";break;case mv:i+=t.substring(o,a+1);break;default:Jy('Invalid encoded resource path: "'+t+'"')}o=a+2}return new Jg(r)}var wv=(_v.now=function(){return _v.fromMillis(Date.now())},_v.fromDate=function(t){return _v.fromMillis(t.getTime())},_v.fromMillis=function(t){var e=Math.floor(t/1e3);return new _v(e,1e6*(t-1e3*e))},_v.prototype.toDate=function(){return new Date(this.toMillis())},_v.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},_v.prototype._compareTo=function(t){return this.seconds===t.seconds?Pg(this.nanoseconds,t.nanoseconds):Pg(this.seconds,t.seconds)},_v.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},_v.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},_v);function _v(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new ig(rg.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new ig(rg.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ig(rg.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new ig(rg.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}var Tv=(Ev.fromMicroseconds=function(t){var e=Math.floor(t/1e6);return new Ev(new wv(e,t%1e6*1e3))},Ev.fromTimestamp=function(t){return new Ev(t)},Ev.forDeletedDoc=function(){return Ev.MIN},Ev.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Ev.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Ev.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Ev.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Ev.prototype.toTimestamp=function(){return this.timestamp},Ev.MIN=new Ev(new wv(0,0)),Ev);function Ev(t){this.timestamp=t}var Sv=(Iv.prototype.insert=function(t,e){return new Iv(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Av.BLACK,null,null))},Iv.prototype.remove=function(t){return new Iv(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Av.BLACK,null,null))},Iv.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Iv.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Iv.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Iv.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),Iv.prototype.minKey=function(){return this.root.minKey()},Iv.prototype.maxKey=function(){return this.root.maxKey()},Iv.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Iv.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},Iv.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Iv.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Iv.prototype.getIterator=function(){return new Cv(this.root,null,this.comparator,!1)},Iv.prototype.getIteratorFrom=function(t){return new Cv(this.root,t,this.comparator,!1)},Iv.prototype.getReverseIterator=function(){return new Cv(this.root,null,this.comparator,!0)},Iv.prototype.getReverseIteratorFrom=function(t){return new Cv(this.root,t,this.comparator,!0)},Iv);function Iv(t,e){this.comparator=t,this.root=e||Av.EMPTY}var Cv=(Nv.prototype.getNext=function(){$y(0<this.nodeStack.length,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Nv.prototype.hasNext=function(){return 0<this.nodeStack.length},Nv.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Nv);function Nv(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}var Av=(kv.prototype.copy=function(t,e,n,r,i){return new kv(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},kv.prototype.isEmpty=function(){return!1},kv.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},kv.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},kv.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},kv.prototype.minKey=function(){return this.min().key},kv.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},kv.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},kv.prototype.removeMin=function(){if(this.left.isEmpty())return kv.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},kv.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return kv.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},kv.prototype.isRed=function(){return this.color},kv.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},kv.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},kv.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},kv.prototype.rotateLeft=function(){var t=this.copy(null,null,kv.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},kv.prototype.rotateRight=function(){var t=this.copy(null,null,kv.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},kv.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},kv.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},kv.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Jy("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Jy("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Jy("Black depths differ");return t+(this.isRed()?0:1)},kv.EMPTY=null,kv.RED=!0,kv.BLACK=!1,kv);function kv(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:kv.RED,this.left=null!=r?r:kv.EMPTY,this.right=null!=i?i:kv.EMPTY,this.size=this.left.size+1+this.right.size}var Dv=(Object.defineProperty(Rv.prototype,"key",{get:function(){throw Jy("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(Rv.prototype,"value",{get:function(){throw Jy("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(Rv.prototype,"color",{get:function(){throw Jy("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(Rv.prototype,"left",{get:function(){throw Jy("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(Rv.prototype,"right",{get:function(){throw Jy("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),Rv.prototype.copy=function(t,e,n,r,i){return this},Rv.prototype.insert=function(t,e,n){return new Av(t,e)},Rv.prototype.remove=function(t,e){return this},Rv.prototype.isEmpty=function(){return!0},Rv.prototype.inorderTraversal=function(t){return!1},Rv.prototype.reverseTraversal=function(t){return!1},Rv.prototype.minKey=function(){return null},Rv.prototype.maxKey=function(){return null},Rv.prototype.isRed=function(){return!1},Rv.prototype.checkMaxDepth=function(){return!0},Rv.prototype.check=function(){return 0},Rv);function Rv(){this.size=0}Av.EMPTY=new Dv;var Ov=(Pv.fromMapKeys=function(t){var e=new Pv(t.comparator);return t.forEach(function(t){e=e.add(t)}),e},Pv.prototype.has=function(t){return null!==this.data.get(t)},Pv.prototype.first=function(){return this.data.minKey()},Pv.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Pv.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),Pv.prototype.indexOf=function(t){return this.data.indexOf(t)},Pv.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Pv.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Pv.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Pv.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},Pv.prototype.getIterator=function(){return new Mv(this.data.getIterator())},Pv.prototype.getIteratorFrom=function(t){return new Mv(this.data.getIteratorFrom(t))},Pv.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Pv.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Pv.prototype.isEmpty=function(){return this.data.isEmpty()},Pv.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},Pv.prototype.isEqual=function(t){if(!(t instanceof Pv))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Pv.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Pv.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Pv.prototype.copy=function(t){var e=new Pv(this.comparator);return e.data=t,e},Pv);function Pv(t){this.comparator=t,this.data=new Sv(this.comparator)}var Mv=(xv.prototype.getNext=function(){return this.iter.getNext().key},xv.prototype.hasNext=function(){return this.iter.hasNext()},xv);function xv(t){this.iter=t}var Lv=new Sv(rv.comparator);function Fv(){return Lv}function Uv(){return Fv()}var Vv=new Sv(rv.comparator);function qv(){return Vv}var Bv=new Sv(rv.comparator);function jv(){return Bv}var Wv=new Ov(rv.comparator);function Kv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Wv,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Qv=new Ov(Pg);function Hv(){return Qv}var Gv=(zv.prototype.applyToRemoteDocument=function(t,e,n){e&&$y(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;$y(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},zv.prototype.applyToLocalView=function(t,e){e&&$y(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime));for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},zv.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},zv.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Kv())},zv.prototype.isEqual=function(t){return this.batchId===t.batchId&&Mg(this.mutations,t.mutations)&&Mg(this.baseMutations,t.baseMutations)},zv);function zv(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,$y(0<(this.mutations=r).length,"Cannot create an empty mutation batch")}var Yv=(Xv.from=function(t,e,n,r){$y(t.mutations.length===n.length,"Mutations sent "+t.mutations.length+" must equal results received "+n.length);for(var i=jv(),o=t.mutations,a=0;a<o.length;a++)i=i.insert(o[a].key,n[a].version);return new Xv(t,e,n,r,i)},Xv);function Xv(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}var Jv=($v.prototype.catch=function(t){return this.next(void 0,t)},$v.prototype.next=function(r,i){var o=this;return this.callbackAttached&&Jy("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new $v(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},$v.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},$v.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof $v?e:$v.resolve(e)}catch(t){return $v.reject(t)}},$v.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):$v.resolve(e)},$v.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):$v.reject(e)},$v.resolve=function(n){return new $v(function(t,e){t(n)})},$v.reject=function(n){return new $v(function(t,e){e(n)})},$v.waitFor=function(t){return new $v(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},$v.or=function(t){for(var n=$v.resolve(!1),e=function(e){n=n.next(function(t){return t?$v.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},$v.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},$v);function $v(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}var Zv="SimpleDb",tb=(eb.openOrCreate=function(o,t,a){return $y(eb.isAvailable(),"IndexedDB not supported in current environment."),zy(Zv,"Opening database:",o),new Jv(function(n,r){var i=window.indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new eb(e))},i.onblocked=function(){r(new ig(rg.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new ig(rg.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){zy(Zv,'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;a.createOrUpgrade(e,i.transaction,t.oldVersion,b_).next(function(){zy(Zv,"Database upgrade to version "+b_+" complete")})}}).toPromise()},eb.delete=function(t){return zy(Zv,"Removing database:",t),ub(window.indexedDB.deleteDatabase(t)).toPromise()},eb.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(eb.isMockPersistence())return!0;if(void 0===window.navigator)return!1;var t=Oa(),e=eb.getIOSVersion(t),n=0<e&&e<10,r=eb.getAndroidVersion(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},eb.isMockPersistence=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.USE_MOCK_PERSISTENCE)},eb.getStore=function(t,e){return t.store(e)},eb.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},eb.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},eb.prototype.setVersionChangeListener=function(e){this.db.onversionchange=function(t){return e(t)}},eb.prototype.runTransaction=function(r,c,h){return ya(this,void 0,void 0,function(){var o,a,s,e,u,n;return ga(this,function(t){switch(t.label){case 0:o=r.startsWith("readonly"),a=r.endsWith("idempotent"),s=0,e=function(){var e,n,r,i;return ga(this,function(t){switch(t.label){case 0:++s,e=ib.open(u.db,o?"readonly":"readwrite",c),t.label=1;case 1:return t.trys.push([1,3,,4]),(n=h(e).catch(function(t){return e.abort(t),Jv.reject(t)}).toPromise()).catch(function(){}),[4,e.completionPromise];case 2:return t.sent(),[2,{value:n}];case 3:return r=t.sent(),i=a&&"FirebaseError"!==r.name&&s<3,zy(Zv,"Transaction failed with error: %s. Retrying: %s.",r.message,i),i?[3,4]:[2,{value:Promise.reject(r)}];case 4:return[2]}})},u=this,t.label=1;case 1:return[5,e()];case 2:return"object"==typeof(n=t.sent())?[2,n.value]:[3,1];case 3:return[2]}})})},eb.prototype.close=function(){this.db.close()},eb);function eb(t){this.db=t,12.2===eb.getIOSVersion(Oa())&&Yy("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var nb=(Object.defineProperty(rb.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(rb.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(rb.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),rb.prototype.done=function(){this.shouldStop=!0},rb.prototype.skip=function(t){this.nextKey=t},rb.prototype.delete=function(){return ub(this.dbCursor.delete())},rb);function rb(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}var ib=(ob.open=function(t,e,n){return new ob(t.transaction(n,e))},Object.defineProperty(ob.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),ob.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(zy(Zv,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},ob.prototype.store=function(t){var e=this.transaction.objectStore(t);return $y(!!e,"Object store not part of transaction: "+t),new ab(e)},ob);function ob(t){var n=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new sv,this.transaction.oncomplete=function(){n.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?n.completionDeferred.reject(t.error):n.completionDeferred.resolve()},this.transaction.onerror=function(t){var e=hb(t.target.error);n.completionDeferred.reject(e)}}var ab=(sb.prototype.put=function(t,e){return ub(void 0!==e?(zy(Zv,"PUT",this.store.name,t,e),this.store.put(e,t)):(zy(Zv,"PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},sb.prototype.add=function(t){return zy(Zv,"ADD",this.store.name,t,t),ub(this.store.add(t))},sb.prototype.get=function(e){var n=this;return ub(this.store.get(e)).next(function(t){return void 0===t&&(t=null),zy(Zv,"GET",n.store.name,e,t),t})},sb.prototype.delete=function(t){return zy(Zv,"DELETE",this.store.name,t),ub(this.store.delete(t))},sb.prototype.count=function(){return zy(Zv,"COUNT",this.store.name),ub(this.store.count())},sb.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},sb.prototype.deleteAll=function(t,e){zy(Zv,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},sb.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},sb.prototype.iterateSerial=function(i){var t=this.cursor({});return new Jv(function(n,r){t.onerror=function(t){var e=hb(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},sb.prototype.iterateCursor=function(t,a){var s=[];return new Jv(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e=t.target.result;if(e){var n=new nb(e),r=a(e.primaryKey,e.value,n);if(r instanceof Jv){var i=r.catch(function(t){return n.done(),Jv.reject(t)});s.push(i)}n.isDone?o():null===n.skipToKey?e.continue():e.continue(n.skipToKey)}else o()}}).next(function(){return Jv.waitFor(s)})},sb.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:($y(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},sb.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},sb);function sb(t){this.store=t}function ub(t){return new Jv(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=hb(t.target.error);r(e)}})}var cb=!1;function hb(t){var e=tb.getIOSVersion(Oa());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new ig("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return cb||(cb=!0,setTimeout(function(){throw r},0)),r}}return t}var lb=(fb.forUser=function(t,e,n,r){return $y(""!==t.uid,"UserID must not be an empty string."),new fb(t.isAuthenticated()?t.uid:"",e,n,r)},fb.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return yb(t).iterate({index:N_.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},fb.prototype.acknowledgeBatch=function(e,t,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=mb(n),vb(e).put(t)})},fb.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},fb.prototype.setLastStreamToken=function(e,n){return this.getMutationQueueMetadata(e).next(function(t){return t.lastStreamToken=mb(n),vb(e).put(t)})},fb.prototype.addMutationBatch=function(c,h,l,f){var p=this,d=gb(c),m=yb(c);return m.add({}).next(function(t){$y("number"==typeof t,"Auto-generated key is not a number");for(var e=new Gv(t,h,l,f),n=p.serializer.toDbMutationBatch(p.userId,e),r=[],i=new Ov(function(t,e){return Pg(t.canonicalString(),e.canonicalString())}),o=0,a=f;o<a.length;o++){var s=a[o],u=k_.key(p.userId,s.key.path,t);i=i.add(s.key.path.popLast()),r.push(m.put(n)),r.push(d.put(u,k_.PLACEHOLDER))}return i.forEach(function(t){r.push(p.indexManager.addToCollectionParentIndex(c,t))}),c.addOnCommittedListener(function(){p.documentKeysByBatchId[t]=e.keys()}),Jv.waitFor(r).next(function(){return e})})},fb.prototype.lookupMutationBatch=function(t,e){var n=this;return yb(t).get(e).next(function(t){return t?($y(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},fb.prototype.lookupMutationKeys=function(t,n){var r=this;return this.documentKeysByBatchId[n]?Jv.resolve(this.documentKeysByBatchId[n]):this.lookupMutationBatch(t,n).next(function(t){if(t){var e=t.keys();return r.documentKeysByBatchId[n]=e}return null})},fb.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return yb(t).iterate({index:N_.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&($y(e.batchId>=i,"Should have found mutation after "+i),o=r.serializer.fromDbMutationBatch(e)),n.done()}).next(function(){return o})},fb.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return yb(t).iterate({index:N_.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},fb.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return yb(t).loadAll(N_.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},fb.prototype.getAllMutationBatchesAffectingDocumentKey=function(s,u){var c=this,t=k_.prefixForPath(this.userId,u.path),e=IDBKeyRange.lowerBound(t),h=[];return gb(s).iterate({range:e},function(e,t,n){var r=e[0],i=e[1],o=e[2],a=bv(i);if(r===c.userId&&u.path.isEqual(a))return yb(s).get(o).next(function(t){if(!t)throw Jy("Dangling document-mutation reference found: "+e+" which points to "+o);$y(t.userId===c.userId,"Unexpected user '"+t.userId+"' for mutation batch "+o),h.push(c.serializer.fromDbMutationBatch(t))});n.done()}).next(function(){return h})},fb.prototype.getAllMutationBatchesAffectingDocumentKeys=function(r,t){var u=this,c=new Ov(Pg),i=[];return t.forEach(function(s){var t=k_.prefixForPath(u.userId,s.path),e=IDBKeyRange.lowerBound(t),n=gb(r).iterate({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=bv(i);r===u.userId&&s.path.isEqual(a)?c=c.add(o):n.done()});i.push(n)}),Jv.waitFor(i).next(function(){return u.lookupMutationBatches(r,c)})},fb.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var s=this;$y(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),$y(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var u=e.path,c=u.length+1,n=k_.prefixForPath(this.userId,u),r=IDBKeyRange.lowerBound(n),h=new Ov(Pg);return gb(t).iterate({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],a=bv(i);r===s.userId&&u.isPrefixOf(a)?a.length===c&&(h=h.add(o)):n.done()}).next(function(){return s.lookupMutationBatches(t,h)})},fb.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(yb(t).get(e).next(function(t){if(null===t)throw Jy("Dangling document-mutation reference found, which points to "+e);$y(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),Jv.waitFor(i).next(function(){return r})},fb.prototype.removeMutationBatch=function(e,n){var r=this;return db(e.simpleDbTransaction,this.userId,n).next(function(t){return e.addOnCommittedListener(function(){r.removeCachedMutationKeys(n.batchId)}),Jv.forEach(t,function(t){return r.referenceDelegate.removeMutationReference(e,t)})})},fb.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},fb.prototype.performConsistencyCheck=function(n){var o=this;return this.checkEmpty(n).next(function(t){if(!t)return Jv.resolve();var e=IDBKeyRange.lowerBound(k_.prefixForUser(o.userId)),i=[];return gb(n).iterate({range:e},function(t,e,n){if(t[0]===o.userId){var r=bv(t[1]);i.push(r)}else n.done()}).next(function(){$y(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},fb.prototype.containsKey=function(t,e){return pb(t,this.userId,e)},fb.prototype.getMutationQueueMetadata=function(t){var e=this;return vb(t).get(this.userId).next(function(t){return t||new I_(e.userId,-1,"")})},fb);function fb(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}function pb(t,o,e){var n=k_.prefixForPath(o,e.path),a=n[1],r=IDBKeyRange.lowerBound(n),s=!1;return gb(t).iterate({range:r,keysOnly:!0},function(t,e,n){var r=t[0],i=t[1];t[2];r===o&&i===a&&(s=!0),n.done()}).next(function(){return s})}function db(t,e,n){var r=t.store(N_.store),i=t.store(k_.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){$y(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=k_.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Jv.waitFor(o).next(function(){return c})}function mb(t){return t instanceof Uint8Array?($y(tb.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function yb(t){return TT.getStore(t,N_.store)}function gb(t){return TT.getStore(t,k_.store)}function vb(t){return TT.getStore(t,I_.store)}var bb,wb;(wb=bb=bb||{})[wb.QueryCache=0]="QueryCache",wb[wb.SyncEngine=1]="SyncEngine";var _b=(Tb.prototype.next=function(){var t=this.nextId;return this.nextId+=2,t},Tb.prototype.after=function(t){return this.seek(t+2),this.next()},Tb.prototype.seek=function(t){$y((1&t)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},Tb.forTargetCache=function(){return new Tb(bb.QueryCache,2)},Tb.forSyncEngine=function(){return new Tb(bb.SyncEngine)},Tb);function Tb(t,e){$y((1&(this.generatorId=t))===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.seek(void 0!==e?e:this.generatorId)}var Eb=(Sb.prototype.allocateTargetId=function(e){var n=this;return this.retrieveMetadata(e).next(function(t){return t.highestTargetId=n.targetIdGenerator.after(t.highestTargetId),n.saveMetadata(e,t).next(function(){return t.highestTargetId})})},Sb.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Tv.fromTimestamp(new wv(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Sb.prototype.getHighestSequenceNumber=function(t){return Nb(t.simpleDbTransaction)},Sb.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.retrieveMetadata(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.saveMetadata(e,t)})},Sb.prototype.addTargetData=function(e,n){var r=this;return this.saveTargetData(e,n).next(function(){return r.retrieveMetadata(e).next(function(t){return t.targetCount+=1,r.updateMetadataFromTargetData(n,t),r.saveMetadata(e,t)})})},Sb.prototype.updateTargetData=function(t,e){return this.saveTargetData(t,e)},Sb.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return Ib(e).delete(t.targetId)}).next(function(){return n.retrieveMetadata(e)}).next(function(t){return $y(0<t.targetCount,"Removing from an empty target cache"),t.targetCount-=1,n.saveMetadata(e,t)})},Sb.prototype.removeTargets=function(r,i,o){var a=this,s=0,u=[];return Ib(r).iterate(function(t,e){var n=a.serializer.fromDbTarget(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(s++,u.push(a.removeTargetData(r,n)))}).next(function(){return Jv.waitFor(u)}).next(function(){return s})},Sb.prototype.forEachTarget=function(t,r){var i=this;return Ib(t).iterate(function(t,e){var n=i.serializer.fromDbTarget(e);r(n)})},Sb.prototype.retrieveMetadata=function(t){return Cb(t.simpleDbTransaction)},Sb.prototype.saveMetadata=function(t,e){return function(t){return TT.getStore(t,B_.store)}(t).put(B_.key,e)},Sb.prototype.saveTargetData=function(t,e){return Ib(t).put(this.serializer.toDbTarget(e))},Sb.prototype.updateMetadataFromTargetData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Sb.prototype.getTargetCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},Sb.prototype.getTargetData=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),a=null;return Ib(t).iterate({range:n,index:F_.queryTargetsIndexName},function(t,e,n){var r=o.serializer.fromDbTarget(e);i.isEqual(r.target)&&(a=r,n.done())}).next(function(){return a})},Sb.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],a=Ab(n);return t.forEach(function(t){var e=yv(t.path);o.push(a.put(new V_(r,e))),o.push(i.referenceDelegate.addReference(n,t))}),Jv.waitFor(o)},Sb.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=Ab(n);return Jv.forEach(t,function(t){var e=yv(t.path);return Jv.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,t)])})},Sb.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Ab(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Sb.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ab(t),o=Kv();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=bv(t[1]),i=new rv(r);o=o.add(i)}).next(function(){return o})},Sb.prototype.containsKey=function(t,e){var n=yv(e.path),r=IDBKeyRange.bound([n],[xg(n)],!1,!0),i=0;return Ab(t).iterate({index:V_.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Sb.prototype.getTargetDataForTarget=function(t,e){var n=this;return Ib(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},Sb);function Sb(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=_b.forTargetCache()}function Ib(t){return TT.getStore(t,F_.store)}function Cb(t){return tb.getStore(t,B_.store).get(B_.key).next(function(t){return $y(null!==t,"Missing metadata row."),t})}function Nb(t){return Cb(t).next(function(t){return t.highestListenSequenceNumber})}function Ab(t){return TT.getStore(t,V_.store)}var kb=(Db.fromSet=function(t){return new Db(t)},Db.fromArray=function(t){var e=new Ov(ev.comparator);return t.forEach(function(t){return e=e.add(t)}),new Db(e)},Db.prototype.covers=function(e){var n=!1;return this.fields.forEach(function(t){t.isPrefixOf(e)&&(n=!0)}),n},Db.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},Db);function Db(t){this.fields=t}var Rb=(Ob.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},Ob);function Ob(t,e){this.field=t,this.transform=e}var Pb,Mb,xb=function(t,e){this.version=t,this.transformResults=e};(Mb=Pb=Pb||{})[Mb.Set=0]="Set",Mb[Mb.Patch=1]="Patch",Mb[Mb.Transform=2]="Transform",Mb[Mb.Delete=3]="Delete";var Lb=(Fb.exists=function(t){return new Fb(void 0,t)},Fb.updateTime=function(t){return new Fb(t)},Object.defineProperty(Fb.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),Fb.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Yw&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Yw:($y(this.isNone,"Precondition should be empty"),!0)},Fb.prototype.isEqual=function(t){return function(t,e){return null!=t?!(!e||!t.isEqual(e)):t===e}(this.updateTime,t.updateTime)&&this.exists===t.exists},Fb.NONE=new Fb,Fb);function Fb(t,e){this.updateTime=t,this.exists=e,$y(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}var Ub=(Vb.prototype.verifyKeyMatches=function(t){null!=t&&$y(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},Vb.getPostMutationVersion=function(t){return t instanceof Yw?t.version:Tv.MIN},Vb);function Vb(){}var qb,Bb=(da(jb,qb=Ub),jb.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),$y(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Yw(this.key,n,{hasCommittedMutations:!0},this.value)},jb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Ub.getPostMutationVersion(t);return new Yw(this.key,r,{hasLocalMutations:!0},this.value)},jb.prototype.extractBaseValue=function(t){return null},jb.prototype.isEqual=function(t){return t instanceof jb&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},jb);function jb(t,e,n){var r=qb.call(this)||this;return r.key=t,r.value=e,r.precondition=n,r.type=Pb.Set,r}var Wb,Kb=(da(Qb,Wb=Ub),Qb.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),$y(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new e_(this.key,e.version);var n=this.patchDocument(t);return new Yw(this.key,e.version,{hasCommittedMutations:!0},n)},Qb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Ub.getPostMutationVersion(t),i=this.patchDocument(t);return new Yw(this.key,r,{hasLocalMutations:!0},i)},Qb.prototype.extractBaseValue=function(t){return null},Qb.prototype.isEqual=function(t){return t instanceof Qb&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},Qb.prototype.patchDocument=function(t){var e;return e=t instanceof Yw?t.data():Bw.EMPTY,this.patchObject(e)},Qb.prototype.patchObject=function(n){var r=this;return this.fieldMask.fields.forEach(function(t){if(!t.isEmpty()){var e=r.data.field(t);n=null!==e?n.set(t,e):n.delete(t)}}),n},Qb);function Qb(t,e,n,r){var i=Wb.call(this)||this;return i.key=t,i.data=e,i.fieldMask=n,i.precondition=r,i.type=Pb.Patch,i}var Hb,Gb=(da(zb,Hb=Ub),zb.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),$y(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new e_(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new Yw(this.key,i,{hasCommittedMutations:!0},o)},zb.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new Yw(this.key,r.version,{hasLocalMutations:!0},o)},zb.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Yw?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Bw.EMPTY.set(i.field,a):e.set(i.field,a))}return e},zb.prototype.isEqual=function(t){return t instanceof zb&&this.key.isEqual(t.key)&&Mg(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},zb.prototype.requireDocument=function(t){return $y(t instanceof Yw,"Unknown MaybeDocument type "+t),$y(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},zb.prototype.serverTransformResults=function(t,e){var n=[];$y(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Yw&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},zb.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Yw&&(u=e.field(a.field)),null===u&&n instanceof Yw&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},zb.prototype.transformObject=function(t,e){$y(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},zb);function zb(t,e){var n=Hb.call(this)||this;return n.key=t,n.fieldTransforms=e,n.type=Pb.Transform,n.precondition=Lb.exists(!0),n}var Yb,Xb,Jb,$b,Zb,tw=(da(ew,Yb=Ub),ew.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),$y(null==e.transformResults,"Transform results received by DeleteMutation."),new $w(this.key,e.version,{hasCommittedMutations:!0})},ew.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&$y(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new $w(this.key,Tv.forDeletedDoc())):t},ew.prototype.extractBaseValue=function(t){return null},ew.prototype.isEqual=function(t){return t instanceof ew&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},ew);function ew(t,e){var n=Yb.call(this)||this;return n.key=t,n.precondition=e,n.type=Pb.Delete,n}(Jb=Xb=Xb||{})[Jb.NullValue=0]="NullValue",Jb[Jb.BooleanValue=1]="BooleanValue",Jb[Jb.NumberValue=2]="NumberValue",Jb[Jb.TimestampValue=3]="TimestampValue",Jb[Jb.StringValue=4]="StringValue",Jb[Jb.BlobValue=5]="BlobValue",Jb[Jb.RefValue=6]="RefValue",Jb[Jb.GeoPointValue=7]="GeoPointValue",Jb[Jb.ArrayValue=8]="ArrayValue",Jb[Jb.ObjectValue=9]="ObjectValue",(Zb=$b=$b||{})[Zb.Default=0]="Default",Zb[Zb.Estimate=1]="Estimate",Zb[Zb.Previous=2]="Previous";var nw=(rw.fromSnapshotOptions=function(t,e){switch(t.serverTimestamps){case"estimate":return new rw($b.Estimate,e);case"previous":return new rw($b.Previous,e);case"none":case void 0:return new rw($b.Default,e);default:return Jy("fromSnapshotOptions() called with invalid options.")}},rw);function rw(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}var iw=(ow.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},ow.prototype.defaultCompareTo=function(t){return $y(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),Pg(this.typeOrder,t.typeOrder)},ow);function ow(){}var aw,sw=(da(uw,aw=iw),uw.prototype.value=function(t){return null},uw.prototype.isEqual=function(t){return t instanceof uw},uw.prototype.compareTo=function(t){return t instanceof uw?0:this.defaultCompareTo(t)},uw.INSTANCE=new uw,uw);function uw(){var t=aw.call(this)||this;return t.typeOrder=Xb.NullValue,t.internalValue=null,t}var cw,hw=(da(lw,cw=iw),lw.prototype.value=function(t){return this.internalValue},lw.prototype.isEqual=function(t){return t instanceof lw&&this.internalValue===t.internalValue},lw.prototype.compareTo=function(t){return t instanceof lw?Pg(this,t):this.defaultCompareTo(t)},lw.of=function(t){return t?lw.TRUE:lw.FALSE},lw.TRUE=new lw(!0),lw.FALSE=new lw(!1),lw);function lw(t){var e=cw.call(this)||this;return e.internalValue=t,e.typeOrder=Xb.BooleanValue,e}var fw,pw=(da(dw,fw=iw),dw.prototype.value=function(t){return this.internalValue},dw.prototype.compareTo=function(t){return t instanceof dw?function(t,e){return t<e?-1:e<t?1:t===e?0:isNaN(t)?isNaN(e)?0:-1:1}(this.internalValue,t.internalValue):this.defaultCompareTo(t)},dw);function dw(t){var e=fw.call(this)||this;return e.internalValue=t,e.typeOrder=Xb.NumberValue,e}function mw(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var yw,gw=(da(vw,yw=pw),vw.prototype.isEqual=function(t){return t instanceof vw&&mw(this.internalValue,t.internalValue)},vw);function vw(){return null!==yw&&yw.apply(this,arguments)||this}var bw,ww=(da(_w,bw=pw),_w.prototype.isEqual=function(t){return t instanceof _w&&mw(this.internalValue,t.internalValue)},_w.NAN=new _w(NaN),_w.POSITIVE_INFINITY=new _w(1/0),_w.NEGATIVE_INFINITY=new _w(-1/0),_w);function _w(){return null!==bw&&bw.apply(this,arguments)||this}var Tw,Ew=(da(Sw,Tw=iw),Sw.prototype.value=function(t){return this.internalValue},Sw.prototype.isEqual=function(t){return t instanceof Sw&&this.internalValue===t.internalValue},Sw.prototype.compareTo=function(t){return t instanceof Sw?Pg(this.internalValue,t.internalValue):this.defaultCompareTo(t)},Sw);function Sw(t){var e=Tw.call(this)||this;return e.internalValue=t,e.typeOrder=Xb.StringValue,e}var Iw,Cw=(da(Nw,Iw=iw),Nw.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},Nw.prototype.isEqual=function(t){return t instanceof Nw&&this.internalValue.isEqual(t.internalValue)},Nw.prototype.compareTo=function(t){return t instanceof Nw?this.internalValue._compareTo(t.internalValue):t instanceof kw?-1:this.defaultCompareTo(t)},Nw);function Nw(t){var e=Iw.call(this)||this;return e.internalValue=t,e.typeOrder=Xb.TimestampValue,e}var Aw,kw=(da(Dw,Aw=iw),Dw.prototype.value=function(t){return t&&t.serverTimestampBehavior===$b.Estimate?new Cw(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===$b.Previous&&this.previousValue?this.previousValue.value(t):null},Dw.prototype.isEqual=function(t){return t instanceof Dw&&this.localWriteTime.isEqual(t.localWriteTime)},Dw.prototype.compareTo=function(t){return t instanceof Dw?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Cw?1:this.defaultCompareTo(t)},Dw.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},Dw);function Dw(t,e){var n=Aw.call(this)||this;return n.localWriteTime=t,n.previousValue=e,n.typeOrder=Xb.TimestampValue,n}var Rw,Ow=(da(Pw,Rw=iw),Pw.prototype.value=function(t){return this.internalValue},Pw.prototype.isEqual=function(t){return t instanceof Pw&&this.internalValue.isEqual(t.internalValue)},Pw.prototype.compareTo=function(t){return t instanceof Pw?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Pw);function Pw(t){var e=Rw.call(this)||this;return e.internalValue=t,e.typeOrder=Xb.BlobValue,e}var Mw,xw=(da(Lw,Mw=iw),Lw.prototype.value=function(t){return this.key},Lw.prototype.isEqual=function(t){return t instanceof Lw&&this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId)},Lw.prototype.compareTo=function(t){if(t instanceof Lw){var e=this.databaseId.compareTo(t.databaseId);return 0!==e?e:rv.comparator(this.key,t.key)}return this.defaultCompareTo(t)},Lw);function Lw(t,e){var n=Mw.call(this)||this;return n.databaseId=t,n.key=e,n.typeOrder=Xb.RefValue,n}var Fw,Uw=(da(Vw,Fw=iw),Vw.prototype.value=function(t){return this.internalValue},Vw.prototype.isEqual=function(t){return t instanceof Vw&&this.internalValue.isEqual(t.internalValue)},Vw.prototype.compareTo=function(t){return t instanceof Vw?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},Vw);function Vw(t){var e=Fw.call(this)||this;return e.internalValue=t,e.typeOrder=Xb.GeoPointValue,e}var qw,Bw=(da(jw,qw=iw),jw.prototype.value=function(n){var r={};return this.internalValue.inorderTraversal(function(t,e){r[t]=e.value(n)}),r},jw.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},jw.prototype.isEqual=function(t){if(t instanceof jw){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext();if(r.key!==i.key||!r.value.isEqual(i.value))return!1}return!e.hasNext()&&!n.hasNext()}return!1},jw.prototype.compareTo=function(t){if(t instanceof jw){for(var e=this.internalValue.getIterator(),n=t.internalValue.getIterator();e.hasNext()&&n.hasNext();){var r=e.getNext(),i=n.getNext(),o=Pg(r.key,i.key)||r.value.compareTo(i.value);if(o)return o}return Pg(e.hasNext(),n.hasNext())}return this.defaultCompareTo(t)},jw.prototype.set=function(t,e){if($y(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),e);var n=this.child(t.firstSegment());n instanceof jw||(n=jw.EMPTY);var r=n.set(t.popFirst(),e);return this.setChild(t.firstSegment(),r)},jw.prototype.delete=function(t){if($y(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new jw(this.internalValue.remove(t.firstSegment()));var e=this.child(t.firstSegment());if(e instanceof jw){var n=e.delete(t.popFirst());return new jw(this.internalValue.insert(t.firstSegment(),n))}return this},jw.prototype.contains=function(t){return null!==this.field(t)},jw.prototype.field=function(t){$y(!t.isEmpty(),"Can't get field of empty path");var e=this;return t.forEach(function(t){e=e instanceof jw?e.internalValue.get(t):null}),e},jw.prototype.fieldMask=function(){var i=new Ov(ev.comparator);return this.internalValue.forEach(function(t,e){var n=new ev([t]);if(e instanceof jw){var r=e.fieldMask().fields;r.isEmpty()?i=i.add(n):r.forEach(function(t){i=i.add(n.child(t))})}else i=i.add(n)}),kb.fromSet(i)},jw.prototype.toString=function(){return this.internalValue.toString()},jw.prototype.child=function(t){return this.internalValue.get(t)||void 0},jw.prototype.setChild=function(t,e){return new jw(this.internalValue.insert(t,e))},jw.EMPTY=new jw(new Sv(Pg)),jw);function jw(t){var e=qw.call(this)||this;return e.internalValue=t,e.typeOrder=Xb.ObjectValue,e}var Ww,Kw=(da(Qw,Ww=iw),Qw.prototype.value=function(e){return this.internalValue.map(function(t){return t.value(e)})},Qw.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++)if(n[e].isEqual(t))return!0;return!1},Qw.prototype.forEach=function(t){this.internalValue.forEach(t)},Qw.prototype.isEqual=function(t){if(t instanceof Qw){if(this.internalValue.length!==t.internalValue.length)return!1;for(var e=0;e<this.internalValue.length;e++)if(!this.internalValue[e].isEqual(t.internalValue[e]))return!1;return!0}return!1},Qw.prototype.compareTo=function(t){if(t instanceof Qw){for(var e=Math.min(this.internalValue.length,t.internalValue.length),n=0;n<e;n++){var r=this.internalValue[n].compareTo(t.internalValue[n]);if(r)return r}return Pg(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},Qw.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},Qw);function Qw(t){var e=Ww.call(this)||this;return e.internalValue=t,e.typeOrder=Xb.ArrayValue,e}var Hw=(Gw.compareByKey=function(t,e){return rv.comparator(t.key,e.key)},Gw);function Gw(t,e){this.key=t,this.version=e}var zw,Yw=(da(Xw,zw=Hw),Xw.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},Xw.prototype.data=function(){var n=this;if(!this.objectValue){var r=Bw.EMPTY;hg(this.proto.fields||{},function(t,e){r=r.set(new ev([t]),n.converter(e))}),this.objectValue=r,this.fieldValueCache=void 0}return this.objectValue},Xw.prototype.value=function(){return this.data().value()},Xw.prototype.isEqual=function(t){return t instanceof Xw&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},Xw.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Xw.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Xw.prototype.getProtoField=function(t){$y(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields?this.proto.fields[t.firstSegment()]:void 0,n=1;n<t.length;++n){if(!e||!e.mapValue||!e.mapValue.fields)return;e=e.mapValue.fields[t.get(n)]}return e},Xw.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Jy("Trying to compare documents on fields that don't exist")},Xw);function Xw(t,e,n,r,i,o){var a=zw.call(this,t,e)||this;return a.objectValue=r,a.proto=i,a.converter=o,$y(void 0!==a.objectValue||void 0!==a.proto&&void 0!==a.converter,"If objectValue is not defined, proto and converter need to be set."),a.hasLocalMutations=!!n.hasLocalMutations,a.hasCommittedMutations=!!n.hasCommittedMutations,a}var Jw,$w=(da(Zw,Jw=Hw),Zw.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Zw.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Zw.prototype.isEqual=function(t){return t instanceof Zw&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Zw);function Zw(t,e,n){var r=Jw.call(this,t,e)||this;return r.hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}var t_,e_=(da(n_,t_=Hw),n_.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(n_.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),n_.prototype.isEqual=function(t){return t instanceof n_&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},n_);function n_(){return null!==t_&&t_.apply(this,arguments)||this}var r_=(i_.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},i_.prototype.has=function(t){return void 0!==this.get(t)},i_.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},i_.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},i_.prototype.forEach=function(s){hg(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],a=i[1];s(o,a)}})},i_.prototype.isEmpty=function(){return lg(this.inner)},i_);function i_(t){this.mapKeyFn=t,this.inner={}}var o_=(Object.defineProperty(a_.prototype,"readTime",{get:function(){return $y(void 0!==this._readTime,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this._readTime},set:function(t){$y(void 0===this._readTime||this._readTime.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this._readTime=t},enumerable:!0,configurable:!0}),a_.prototype.addEntry=function(t,e){this.assertNotApplied(),this.readTime=e,this.changes.set(t.key,t)},a_.prototype.removeEntry=function(t,e){this.assertNotApplied(),e&&(this.readTime=e),this.changes.set(t,null)},a_.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Jv.resolve(n):this.getFromCache(t,e)},a_.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},a_.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},a_.prototype.assertNotApplied=function(){$y(!this.changesApplied,"Changes have already been applied.")},a_);function a_(){this.changes=new r_(function(t){return t.toString()}),this.changesApplied=!1}var s_,u_=(c_.prototype.addEntry=function(t,e,n){return f_(t).put(p_(e),n)},c_.prototype.removeEntry=function(t,e){var n=f_(t),r=p_(e);return n.delete(r)},c_.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.setMetadata(e,t)})},c_.prototype.getEntry=function(t,e){var n=this;return f_(t).get(p_(e)).next(function(t){return n.maybeDecodeDocument(t)})},c_.prototype.getSizedEntry=function(t,e){var n=this;return f_(t).get(p_(e)).next(function(t){var e=n.maybeDecodeDocument(t);return e?{maybeDocument:e,size:d_(t)}:null})},c_.prototype.getEntries=function(t,e){var r=this,i=Uv();return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);i=i.insert(t,n)}).next(function(){return i})},c_.prototype.getSizedEntries=function(t,e){var r=this,i=Uv(),o=new Sv(rv.comparator);return this.forEachDbEntry(t,e,function(t,e){var n=r.maybeDecodeDocument(e);o=n?(i=i.insert(t,n),o.insert(t,d_(e))):(i=i.insert(t,null),o.insert(t,0))}).next(function(){return{maybeDocuments:i,sizeMap:o}})},c_.prototype.forEachDbEntry=function(t,e,i){if(e.isEmpty())return Jv.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),a=o.getNext();return f_(t).iterate({range:n},function(t,e,n){for(var r=rv.fromSegments(t);a&&rv.comparator(a,r)<0;)i(a,null),a=o.getNext();a&&a.isEqual(r)&&(i(a,e),a=o.hasNext()?o.getNext():null),a?n.skip(a.path.toArray()):n.done()}).next(function(){for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})},c_.prototype.getDocumentsMatchingQuery=function(t,i,e){var o=this;$y(!i.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var a=qv(),s=i.path.length+1,n={};if(e.isEqual(Tv.MIN)){var r=i.path.toArray();n.range=IDBKeyRange.lowerBound(r)}else{var u=i.path.toArray(),c=this.serializer.toDbTimestampKey(e);n.range=IDBKeyRange.lowerBound([u,c],!0),n.index=P_.collectionReadTimeIndex}return f_(t).iterate(n,function(t,e,n){if(t.length===s){var r=o.serializer.fromDbRemoteDocument(e);i.path.isPrefixOf(r.key.path)?r instanceof Yw&&i.matches(r)&&(a=a.insert(r.key,r)):n.done()}}).next(function(){return a})},c_.prototype.getNewDocumentChanges=function(t,e){var r=this,i=Fv(),o=this.serializer.toDbTimestampKey(e),n=f_(t),a=IDBKeyRange.lowerBound(o,!0);return n.iterate({index:P_.readTimeIndex,range:a},function(t,e){var n=r.serializer.fromDbRemoteDocument(e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{changedDocs:i,readTime:r.serializer.fromDbTimestampKey(o)}})},c_.prototype.getLastDocumentChange=function(t){var r,i=this,e=f_(t),o=Tv.MIN;return e.iterate({index:P_.readTimeIndex,reverse:!0},function(t,e,n){r=i.serializer.fromDbRemoteDocument(e),e.readTime&&(o=i.serializer.fromDbTimestampKey(e.readTime)),n.done()}).next(function(){return{changedDoc:r,readTime:o}})},c_.prototype.newChangeBuffer=function(t){return new c_.RemoteDocumentChangeBuffer(this,!!t&&t.trackRemovals)},c_.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},c_.prototype.getMetadata=function(t){return l_(t).get(x_.key).next(function(t){return $y(!!t,"Missing document cache metadata"),t})},c_.prototype.setMetadata=function(t,e){return l_(t).put(x_.key,e)},c_.prototype.maybeDecodeDocument=function(t){if(t){var e=this.serializer.fromDbRemoteDocument(t);return e instanceof $w&&e.version.isEqual(Tv.forDeletedDoc())?null:e}return null},c_.RemoteDocumentChangeBuffer=(da(h_,s_=o_),h_.prototype.applyChanges=function(a){var s=this,u=[],c=0,h=new Ov(function(t,e){return Pg(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(t,e){var n=s.documentSizes.get(t);if($y(void 0!==n,"Cannot modify a document that wasn't read (for "+t+")"),e){$y(!s.readTime.isEqual(Tv.MIN),"Cannot add a document with a read time of zero");var r=s.documentCache.serializer.toDbRemoteDocument(e,s.readTime);h=h.add(t.path.popLast());var i=d_(r);c+=i-n,u.push(s.documentCache.addEntry(a,t,r))}else if(c-=n,s.trackRemovals){var o=s.documentCache.serializer.toDbRemoteDocument(new $w(t,Tv.forDeletedDoc()),s.readTime);u.push(s.documentCache.addEntry(a,t,o))}else u.push(s.documentCache.removeEntry(a,t))}),h.forEach(function(t){u.push(s.documentCache.indexManager.addToCollectionParentIndex(a,t))}),u.push(this.documentCache.updateMetadata(a,c)),Jv.waitFor(u)},h_.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},h_.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},h_),c_);function c_(t,e){this.serializer=t,this.indexManager=e}function h_(t,e){var n=s_.call(this)||this;return n.documentCache=t,n.trackRemovals=e,n.documentSizes=new r_(function(t){return t.toString()}),n}function l_(t){return TT.getStore(t,x_.store)}function f_(t){return TT.getStore(t,P_.store)}function p_(t){return t.path.toArray()}function d_(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Jy("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var m_=(y_.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),Jv.resolve()},y_.prototype.getCollectionParents=function(t,e){return Jv.resolve(this.collectionParentIndex.getEntries(e))},y_);function y_(){this.collectionParentIndex=new g_}var g_=(v_.prototype.add=function(t){$y(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ov(Jg.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},v_.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},v_.prototype.getEntries=function(t){return(this.index[t]||new Ov(Jg.comparator)).toArray()},v_);function v_(){this.index={}}var b_=9,w_=(__.prototype.createOrUpgrade=function(t,e,n,r){var i=this;$y(n<r&&0<=n&&r<=b_,"Unexpected schema upgrade from v"+n+" to v{toVersion}.");var o=new ib(e);n<1&&1<=r&&(function(t){t.createObjectStore(E_.store)}(t),function(t){t.createObjectStore(I_.store,{keyPath:I_.keyPath}),t.createObjectStore(N_.store,{keyPath:N_.keyPath,autoIncrement:!0}).createIndex(N_.userMutationsIndex,N_.userMutationsKeyPath,{unique:!0}),t.createObjectStore(k_.store)}(t),Q_(t),function(t){t.createObjectStore(P_.store)}(t));var a=Jv.resolve();return n<3&&3<=r&&(0!==n&&(function(t){t.deleteObjectStore(V_.store),t.deleteObjectStore(F_.store),t.deleteObjectStore(B_.store)}(t),Q_(t)),a=a.next(function(){return function(t){var e=t.store(B_.store),n=new B_(0,0,Tv.MIN.toTimestamp(),0);return e.put(B_.key,n)}(o)})),n<4&&4<=r&&(0!==n&&(a=a.next(function(){return function(r,i){return i.store(N_.store).loadAll().next(function(t){r.deleteObjectStore(N_.store),r.createObjectStore(N_.store,{keyPath:N_.keyPath,autoIncrement:!0}).createIndex(N_.userMutationsIndex,N_.userMutationsKeyPath,{unique:!0});var e=i.store(N_.store),n=t.map(function(t){return e.put(t)});return Jv.waitFor(n)})}(t,o)})),a=a.next(function(){!function(t){t.createObjectStore(H_.store,{keyPath:H_.keyPath})}(t)})),n<5&&5<=r&&(a=a.next(function(){return i.removeAcknowledgedMutations(o)})),n<6&&6<=r&&(a=a.next(function(){return function(t){t.createObjectStore(x_.store)}(t),i.addDocumentGlobal(o)})),n<7&&7<=r&&(a=a.next(function(){return i.ensureSequenceNumbers(o)})),n<8&&8<=r&&(a=a.next(function(){return i.createCollectionParentIndex(t,o)})),n<9&&9<=r&&(a=a.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(P_.store);e.createIndex(P_.readTimeIndex,P_.readTimeIndexPath,{unique:!1}),e.createIndex(P_.collectionReadTimeIndex,P_.collectionReadTimeIndexPath,{unique:!1})}(e)})),a},__.prototype.addDocumentGlobal=function(e){var n=0;return e.store(P_.store).iterate(function(t,e){n+=d_(e)}).next(function(){var t=new x_(n);return e.store(x_.store).put(x_.key,t)})},__.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(I_.store),e=r.store(N_.store);return t.loadAll().next(function(t){return Jv.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.loadAll(N_.userMutationsIndex,t).next(function(t){return Jv.forEach(t,function(t){$y(t.userId===n.userId,"Cannot process batch "+t.batchId+" from unexpected user");var e=i.serializer.fromDbMutationBatch(t);return db(r,n.userId,e).next(function(){})})})})})},__.prototype.ensureSequenceNumbers=function(t){var a=t.store(V_.store),e=t.store(P_.store);return Nb(t).next(function(i){var o=[];return e.iterate(function(t,e){var n=new Jg(t),r=function(t){return[0,yv(t)]}(n);o.push(a.get(r).next(function(t){return t?Jv.resolve():function(t){return a.put(new V_(0,yv(t),i))}(n)}))}).next(function(){return Jv.waitFor(o)})})},__.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.lastSegment(),n=t.popLast();return r.put({collectionId:e,parent:yv(n)})}}t.createObjectStore(W_.store,{keyPath:W_.keyPath});var r=e.store(W_.store),o=new g_;return e.store(P_.store).iterate({keysOnly:!0},function(t,e){var n=new Jg(t);return i(n.popLast())}).next(function(){return e.store(k_.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],bv(n));return i(r.popLast())})})},__);function __(t){this.serializer=t}var T_=function(t,e){this.seconds=t,this.nanoseconds=e},E_=(S_.store="owner",S_.key="owner",S_);function S_(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var I_=(C_.store="mutationQueues",C_.keyPath="userId",C_);function C_(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}var N_=(A_.store="mutations",A_.keyPath="batchId",A_.userMutationsIndex="userMutationsIndex",A_.userMutationsKeyPath=["userId","batchId"],A_);function A_(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}var k_=(D_.prefixForUser=function(t){return[t]},D_.prefixForPath=function(t,e){return[t,yv(e)]},D_.key=function(t,e,n){return[t,yv(e),n]},D_.store="documentMutations",D_.PLACEHOLDER=new D_,D_);function D_(){}var R_=function(t,e){this.path=t,this.readTime=e},O_=function(t,e){this.path=t,this.version=e},P_=(M_.store="remoteDocuments",M_.readTimeIndex="readTimeIndex",M_.readTimeIndexPath="readTime",M_.collectionReadTimeIndex="collectionReadTimeIndex",M_.collectionReadTimeIndexPath=["parentPath","readTime"],M_);function M_(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}var x_=(L_.store="remoteDocumentGlobal",L_.key="remoteDocumentGlobalKey",L_);function L_(t){this.byteSize=t}var F_=(U_.store="targets",U_.keyPath="targetId",U_.queryTargetsIndexName="queryTargetsIndex",U_.queryTargetsKeyPath=["canonicalId","targetId"],U_);function U_(t,e,n,r,i,o,a){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=a}var V_=(q_.store="targetDocuments",q_.keyPath=["targetId","path"],q_.documentTargetsIndex="documentTargetsIndex",q_.documentTargetsKeyPath=["path","targetId"],q_);function q_(t,e,n){this.targetId=t,this.path=e,$y(0===t==(void 0!==(this.sequenceNumber=n)),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}var B_=(j_.key="targetGlobalKey",j_.store="targetGlobal",j_);function j_(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}var W_=(K_.store="collectionParents",K_.keyPath=["collectionId","parent"],K_);function K_(t,e){this.collectionId=t,this.parent=e}function Q_(t){t.createObjectStore(V_.store,{keyPath:V_.keyPath}).createIndex(V_.documentTargetsIndex,V_.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(F_.store,{keyPath:F_.keyPath}).createIndex(F_.queryTargetsIndexName,F_.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(B_.store)}var H_=(G_.store="clientMetadata",G_.keyPath="clientId",G_);function G_(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}var z_,Y_,X_=_a(_a(_a([I_.store,N_.store,k_.store,P_.store,F_.store,E_.store,B_.store,V_.store],[H_.store]),[x_.store]),[W_.store]),J_=($_.prototype.addToCollectionParentIndex=function(t,e){var n=this;if($y(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.has(e))return Jv.resolve();var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.collectionParentsCache.add(e)});var o={collectionId:r,parent:yv(i)};return Z_(t).put(o)},$_.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[xg(i),""],!1,!0);return Z_(t).loadAll(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(bv(r.parent))}return o})},$_);function $_(){this.collectionParentsCache=new g_}function Z_(t){return TT.getStore(t,W_.store)}(Y_=z_=z_||{})[Y_.Listen=0]="Listen",Y_[Y_.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",Y_[Y_.LimboResolution=2]="LimboResolution";var tT=(eT.prototype.withSequenceNumber=function(t){return new eT(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},eT.prototype.withResumeToken=function(t,e){return new eT(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},eT.prototype.withLastLimboFreeSnapshotVersion=function(t){return new eT(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},eT.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken===t.resumeToken&&this.target.isEqual(t.target)},eT);function eT(t,e,n,r,i,o,a){void 0===i&&(i=Tv.MIN),void 0===o&&(o=Tv.MIN),void 0===a&&(a=eg()),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}var nT=(rT.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=rv.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new $w(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=rv.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version),new e_(e,n)):Jy("Unexpected DbRemoteDocument")},rT.prototype.toDbRemoteDocument=function(t,e){var n=this.toDbTimestampKey(e),r=t.key.path.popLast().toArray();if(t instanceof Yw){var i=t.proto?t.proto:this.remoteSerializer.toDocument(t),o=t.hasCommittedMutations;return new P_(null,null,i,o,n,r)}if(t instanceof $w){var a=t.key.path.toArray(),s=this.toDbTimestamp(t.version);return o=t.hasCommittedMutations,new P_(null,new R_(a,s),null,o,n,r)}if(t instanceof e_){a=t.key.path.toArray();var u=this.toDbTimestamp(t.version);return new P_(new O_(a,u),null,null,!0,n,r)}return Jy("Unexpected MaybeDocument")},rT.prototype.toDbTimestampKey=function(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]},rT.prototype.fromDbTimestampKey=function(t){var e=new wv(t[0],t[1]);return Tv.fromTimestamp(e)},rT.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new T_(e.seconds,e.nanoseconds)},rT.prototype.fromDbTimestamp=function(t){var e=new wv(t.seconds,t.nanoseconds);return Tv.fromTimestamp(e)},rT.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new N_(t,e.batchId,e.localWriteTime.toMillis(),r,i)},rT.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=wv.fromMillis(t.localWriteTimeMs);return new Gv(t.batchId,i,n,r)},rT.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(yv(t.path))}),e},rT.prototype.fromDbResourcePaths=function(t){for(var e=Kv(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new rv(bv(i)))}return e},rT.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.fromDbTimestamp(t.lastLimboFreeSnapshotVersion):Tv.MIN,i=t.resumeToken;return e=function(t){return void 0!==t.documents}(t.query)?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new tT(e,t.targetId,z_.Listen,t.lastListenSequenceNumber,n,r,i)},rT.prototype.toDbTarget=function(t){$y(z_.Listen===t.purpose,"Only queries with purpose "+z_.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion),i=this.toDbTimestamp(t.lastLimboFreeSnapshotVersion);return e=t.target.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.target):this.remoteSerializer.toQueryTarget(t.target),n=t.resumeToken instanceof Uint8Array?($y(tb.isMockPersistence(),"Persisting non-string stream tokens is only supported with mock persistence ."),t.resumeToken.toString()):t.resumeToken,new F_(t.targetId,t.target.canonicalId(),r,n,t.sequenceNumber,i,e)},rT);function rT(t){this.remoteSerializer=t}function iT(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Pg(n,i);return 0===a?Pg(r,o):a}var oT=(aT.prototype.nextIndex=function(){return++this.previousIndex},aT.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();iT(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(aT.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),aT);function aT(t){this.maxElements=t,this.buffer=new Ov(iT),this.previousIndex=0}var sT={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},uT=(cT.withCacheSize=function(t){return new cT(t,cT.DEFAULT_COLLECTION_PERCENTILE,cT.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},cT.COLLECTION_DISABLED=-1,cT.MINIMUM_CACHE_SIZE_BYTES=1048576,cT.DEFAULT=new cT(cT.DEFAULT_CACHE_SIZE_BYTES=41943040,cT.DEFAULT_COLLECTION_PERCENTILE=10,cT.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3),cT.DISABLED=new cT(cT.COLLECTION_DISABLED,0,0),cT);function cT(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}var hT=(lT.prototype.start=function(){$y(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==uT.COLLECTION_DISABLED&&this.scheduleGC()},lT.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(lT.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),lT.prototype.scheduleGC=function(){var t=this;$y(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;zy("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(ov.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(ST)})},lT);function lT(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}var fT=(pT.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},pT.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Jv.resolve(Qg.INVALID);var r=new oT(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},pT.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},pT.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},pT.prototype.collect=function(e,n){var r=this;return this.params.cacheSizeCollectionThreshold===uT.COLLECTION_DISABLED?(zy("LruGarbageCollector","Garbage collection skipped; disabled"),Jv.resolve(sT)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(zy("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),sT):r.runGarbageCollection(e,n)})},pT.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},pT.prototype.runGarbageCollection=function(e,n){var r,i,o,a,s,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(zy("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,a=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,s=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),Hy()<=Ly.DEBUG&&zy("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(a-l)+"ms\n\tDetermined least recently used "+i+" in "+(s-a)+"ms\n\tRemoved "+o+" targets in "+(u-s)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),Jv.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},pT);function pT(t,e){this.delegate=t,this.params=e}var dT=(mT.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},mT.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},mT);function mT(){this.onCommittedListeners=[]}var yT,gT="IndexedDbPersistence",vT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",bT="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",wT=(da(_T,yT=dT),_T);function _T(t,e){var n=yT.call(this)||this;return n.simpleDbTransaction=t,n.currentSequenceNumber=e,n}var TT=(ET.getStore=function(t,e){if(t instanceof wT)return tb.getStore(t.simpleDbTransaction,e);throw Jy("IndexedDbPersistence must use instances of IndexedDbTransaction")},ET.createIndexedDbPersistence=function(n){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:if(!ET.isAvailable())throw new ig(rg.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(e=new ET(n.allowTabSynchronization,n.persistenceKey,n.clientId,n.platform,n.lruParams,n.queue,n.serializer,n.sequenceNumberSyncer)).start()];case 1:return t.sent(),[2,e]}})})},ET.prototype.start=function(){var e=this;return $y(!this.started,"IndexedDbPersistence double-started!"),$y(null!==this.window,"Expected 'window' to be defined"),tb.openOrCreate(this.dbName,b_,new w_(this.serializer)).then(function(t){return e.simpleDb=t,e.updateClientMetadataAndTryBecomePrimary()}).then(function(){return e.attachVisibilityHandler(),e.attachWindowUnloadHook(),e.scheduleClientMetadataAndPrimaryLeaseRefreshes(),e.simpleDb.runTransaction("readonly-idempotent",[B_.store],function(t){return Nb(t)})}).then(function(t){e.listenSequence=new Qg(t,e.sequenceNumberSyncer)}).then(function(){e._started=!0}).catch(function(t){return e.simpleDb&&e.simpleDb.close(),Promise.reject(t)})},ET.prototype.setPrimaryStateListener=function(n){var t=this;return this.primaryStateListener=function(e){return ya(t,void 0,void 0,function(){return ga(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},ET.prototype.setDatabaseDeletedListener=function(n){var t=this;this.simpleDb.setVersionChangeListener(function(e){return ya(t,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return null!==e.newVersion?[3,2]:[4,n()];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},ET.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return ya(e,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},ET.prototype.updateClientMetadataAndTryBecomePrimary=function(){var n=this;return this.simpleDb.runTransaction("readwrite-idempotent",X_,function(e){return CT(e).put(new H_(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.verifyPrimaryLease(e).next(function(t){t||(n.isPrimary=!1,n.queue.enqueueAndForget(function(){return n.primaryStateListener(!1)}))})}).next(function(){return n.canActAsPrimary(e)}).next(function(t){return n.isPrimary&&!t?n.releasePrimaryLeaseIfHeld(e).next(function(){return!1}):!!t&&n.acquireOrExtendPrimaryLease(e).next(function(){return!0})})}).catch(function(t){if(!n.allowTabSynchronization)throw t;return zy(gT,"Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.queue.enqueueAndForget(function(){return n.primaryStateListener(t)}),n.isPrimary=t})},ET.prototype.verifyPrimaryLease=function(t){var e=this;return IT(t).get(E_.key).next(function(t){return Jv.resolve(e.isLocalClient(t))})},ET.prototype.removeClientMetadata=function(t){return CT(t).delete(this.clientId)},ET.prototype.maybeGarbageCollectMultiClientState=function(){return ya(this,void 0,void 0,function(){var i=this;return ga(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary-idempotent",function(t){var r=ET.getStore(t,H_.store);return r.loadAll().next(function(t){var e=i.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Jv.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})})]);case 1:t.sent().forEach(function(t){i.window.localStorage.removeItem(i.zombiedClientLocalStorageKey(t.clientId))}),t.label=2;case 2:return[2]}})})},ET.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(ov.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},ET.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},ET.prototype.canActAsPrimary=function(e){var i=this;return IT(e).get(E_.key).next(function(t){if(null!==t&&i.isWithinAge(t.leaseTimestampMs,5e3)&&!i.isClientZombied(t.ownerId)){if(i.isLocalClient(t)&&i.networkEnabled)return!0;if(!i.isLocalClient(t)){if(!t.allowTabSynchronization)throw new ig(rg.FAILED_PRECONDITION,bT);return!1}}return!(!i.networkEnabled||!i.inForeground)||CT(e).loadAll().next(function(t){return void 0===i.filterActiveClients(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&zy(gT,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},ET.prototype.shutdown=function(){return ya(this,void 0,void 0,function(){var e=this;return ga(this,function(t){switch(t.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite-idempotent",[E_.store,H_.store],function(t){return e.releasePrimaryLeaseIfHeld(t).next(function(){return e.removeClientMetadata(t)})})];case 1:return t.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},ET.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},ET.prototype.getActiveClients=function(){var e=this;return this.simpleDb.runTransaction("readonly-idempotent",[H_.store],function(t){return CT(t).loadAll().next(function(t){return e.filterActiveClients(t,18e5).map(function(t){return t.clientId})})})},ET.clearPersistence=function(n){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return ET.isAvailable()?(e=n+ET.MAIN_DATABASE,[4,tb.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(ET.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),ET.prototype.getMutationQueue=function(t){return $y(this.started,"Cannot initialize MutationQueue before persistence is started."),lb.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},ET.prototype.getTargetCache=function(){return $y(this.started,"Cannot initialize TargetCache before persistence is started."),this.targetCache},ET.prototype.getRemoteDocumentCache=function(){return $y(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},ET.prototype.getIndexManager=function(){return $y(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},ET.prototype.runTransaction=function(n,t,r){var i=this;zy(gT,"Starting transaction:",n);var o,e=t.endsWith("idempotent"),a=t.startsWith("readonly")?e?"readonly-idempotent":"readonly":e?"readwrite-idempotent":"readwrite";return this.simpleDb.runTransaction(a,X_,function(e){return o=new wT(e,i.listenSequence.next()),"readwrite-primary"===t||"readwrite-primary-idempotent"===t?i.verifyPrimaryLease(e).next(function(t){return!!t||i.canActAsPrimary(e)}).next(function(t){if(!t)throw Yy("Failed to obtain primary lease for action '"+n+"'."),i.isPrimary=!1,i.queue.enqueueAndForget(function(){return i.primaryStateListener(!1)}),new ig(rg.FAILED_PRECONDITION,vT);return r(o)}).next(function(t){return i.acquireOrExtendPrimaryLease(e).next(function(){return t})}):i.verifyAllowTabSynchronization(e).next(function(){return r(o)})}).then(function(t){return o.raiseOnCommittedEvent(),t})},ET.prototype.verifyAllowTabSynchronization=function(t){var e=this;return IT(t).get(E_.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new ig(rg.FAILED_PRECONDITION,bT)})},ET.prototype.acquireOrExtendPrimaryLease=function(t){var e=new E_(this.clientId,this.allowTabSynchronization,Date.now());return IT(t).put(E_.key,e)},ET.isAvailable=function(){return tb.isAvailable()},ET.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},ET.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=IT(t);return n.get(E_.key).next(function(t){return e.isLocalClient(t)?(zy(gT,"Releasing primary lease."),n.delete(E_.key)):Jv.resolve()})},ET.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Yy("Detected an update time that is in the future: "+t+" > "+n),1))},ET.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},ET.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&($y(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},ET.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},ET.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&($y("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},ET.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return zy(gT,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Yy(gT,"Failed to get zombied client id.",t),!1}},ET.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Yy("Failed to set zombie client id.",t)}},ET.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},ET.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},ET.MAIN_DATABASE="main",ET);function ET(t,e,n,r,i,o,a,s){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.queue=o,this.sequenceNumberSyncer=s,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new NT(this,i),this.dbName=e+ET.MAIN_DATABASE,this.serializer=new nT(a),this.document=r.document,this.targetCache=new Eb(this.referenceDelegate,this.serializer),this.indexManager=new J_,this.remoteDocumentCache=new u_(this.serializer,this.indexManager),!r.window||!r.window.localStorage)throw new ig(rg.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.webStorage=this.window.localStorage}function ST(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){if(!function(t){return t.code===rg.FAILED_PRECONDITION&&t.message===vT}(e))throw e;return zy(gT,"Unexpectedly lost primary lease"),[2]})})}function IT(t){return t.store(E_.store)}function CT(t){return t.store(H_.store)}var NT=(AT.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocmentCount(t);return this.db.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},AT.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},AT.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},AT.prototype.forEachOrphanedDocumentSequenceNumber=function(t,n){return this.forEachOrphanedDocument(t,function(t,e){return n(e)})},AT.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},AT.prototype.addReference=function(t,e){return kT(t,e)},AT.prototype.removeReference=function(t,e){return kT(t,e)},AT.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},AT.prototype.removeMutationReference=function(t,e){return kT(t,e)},AT.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?Jv.resolve(!0):function(e,n){var r=!1;return vb(e).iterateSerial(function(t){return pb(e,t,n).next(function(t){return t&&(r=!0),Jv.resolve(!t)})}).next(function(){return r})}(t,e)},AT.prototype.removeOrphanedDocuments=function(r,i){var o=this,a=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],u=0;return this.forEachOrphanedDocument(r,function(e,t){if(t<=i){var n=o.isPinned(r,e).next(function(t){if(!t)return u++,a.getEntry(r,e).next(function(){return a.removeEntry(e),Ab(r).delete(function(t){return[0,yv(t.path)]}(e))})});s.push(n)}}).next(function(){return Jv.waitFor(s)}).next(function(){return a.apply(r)}).next(function(){return u})},AT.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},AT.prototype.updateLimboDocument=function(t,e){return kT(t,e)},AT.prototype.forEachOrphanedDocument=function(t,o){var a,e=Ab(t),s=Qg.INVALID;return e.iterate({index:V_.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(s!==Qg.INVALID&&o(new rv(bv(a)),s),s=i,a=r):s=Qg.INVALID}).next(function(){s!==Qg.INVALID&&o(new rv(bv(a)),s)})},AT.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},AT);function AT(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new fT(this,e)}function kT(t,e){return Ab(t).put(function(t,e){return new V_(0,yv(t.path),e)}(e,t.currentSequenceNumber))}var DT=Number,RT=DT.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),OT=DT.MAX_SAFE_INTEGER||Math.pow(2,53)-1,PT=DT.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function MT(t){return null==t}function xT(t){return PT(t)&&t<=OT&&RT<=t}var LT,FT,UT=(VT.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++)t+=n[e].canonicalId(),t+=",";t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++)t+=i[r].canonicalId(),t+=",";MT(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},VT.prototype.toString=function(){var t=this.path.canonicalString();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),MT(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},VT.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},VT.prototype.isDocumentQuery=function(){return rv.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},VT);function VT(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}(FT=LT=LT||{}).First="F",FT.Last="L";var qT=(BT.atPath=function(t){return new BT(t)},Object.defineProperty(BT.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[mE]:this.memoizedOrderBy=[new pE(t),mE];else{$y(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field.");for(var n=!(this.memoizedOrderBy=[]),r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=0<this.explicitOrderBy.length?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:cE.ASCENDING;this.memoizedOrderBy.push(a===cE.ASCENDING?mE:yE)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),BT.prototype.addFilter=function(t){$y(null==this.getInequalityFilterField()||!(t instanceof HT)||!t.isInequality()||t.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),$y(!this.isDocumentQuery(),"No filtering allowed for document query");var e=this.filters.concat([t]);return new BT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),e,this.limit,this.limitType,this.startAt,this.endAt)},BT.prototype.addOrderBy=function(t){$y(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var e=this.explicitOrderBy.concat([t]);return new BT(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},BT.prototype.withLimitToFirst=function(t){return new BT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,LT.First,this.startAt,this.endAt)},BT.prototype.withLimitToLast=function(t){return new BT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),t,LT.Last,this.startAt,this.endAt)},BT.prototype.withStartAt=function(t){return new BT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,t,this.endAt)},BT.prototype.withEndAt=function(t){return new BT(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,t)},BT.prototype.asCollectionQueryAtPath=function(t){return new BT(t,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.limitType,this.startAt,this.endAt)},BT.prototype.matchesAllDocuments=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.explicitOrderBy.length||1===this.explicitOrderBy.length&&this.explicitOrderBy[0].field.isKeyField())},BT.prototype.canonicalId=function(){return this.toTarget().canonicalId()+"|lt:"+this.limitType},BT.prototype.toString=function(){return"Query(target="+this.toTarget().toString()+"; limitType="+this.limitType+")"},BT.prototype.isEqual=function(t){return this.toTarget().isEqual(t.toTarget())&&this.limitType===t.limitType},BT.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return $y(n,"orderBy used that doesn't compare on key field"),0},BT.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},BT.prototype.hasLimitToFirst=function(){return!MT(this.limit)&&this.limitType===LT.First},BT.prototype.hasLimitToLast=function(){return!MT(this.limit)&&this.limitType===LT.Last},BT.prototype.getFirstOrderByField=function(){return 0<this.explicitOrderBy.length?this.explicitOrderBy[0].field:null},BT.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof HT&&n.isInequality())return n.field}return null},BT.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof HT&&0<=t.indexOf(r.op))return r.op}return null},BT.prototype.isDocumentQuery=function(){return this.toTarget().isDocumentQuery()},BT.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},BT.prototype.toTarget=function(){if(!this.memoizedTarget)if(this.limitType===LT.First)this.memoizedTarget=new UT(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===cE.DESCENDING?cE.ASCENDING:cE.DESCENDING;t.push(new pE(r.field,i))}var o=this.endAt?new lE(this.endAt.position,!this.endAt.before):null,a=this.startAt?new lE(this.startAt.position,!this.startAt.before):null;this.memoizedTarget=new UT(this.path,this.collectionGroup,t,this.filters,this.limit,o,a)}return this.memoizedTarget},BT.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):rv.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},BT.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},BT.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},BT.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t)||this.endAt&&this.endAt.sortsBeforeDocument(this.orderBy,t))},BT.prototype.assertValidBound=function(t){$y(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},BT);function BT(t,e,n,r,i,o,a,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=LT.First),void 0===a&&(a=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=s,this.memoizedOrderBy=null,this.memoizedTarget=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}function jT(){}var WT=(KT.fromString=function(t){switch(t){case"<":return KT.LESS_THAN;case"<=":return KT.LESS_THAN_OR_EQUAL;case"==":return KT.EQUAL;case">=":return KT.GREATER_THAN_OR_EQUAL;case">":return KT.GREATER_THAN;case"array-contains":return KT.ARRAY_CONTAINS;case"in":return KT.IN;case"array-contains-any":return KT.ARRAY_CONTAINS_ANY;default:return Jy("Unknown FieldFilter operator: "+t)}},KT.prototype.toString=function(){return this.name},KT.prototype.isEqual=function(t){return this.name===t.name},KT.LESS_THAN=new KT("<"),KT.LESS_THAN_OR_EQUAL=new KT("<="),KT.EQUAL=new KT("=="),KT.GREATER_THAN=new KT(">"),KT.GREATER_THAN_OR_EQUAL=new KT(">="),KT.ARRAY_CONTAINS=new KT("array-contains"),KT.IN=new KT("in"),KT.ARRAY_CONTAINS_ANY=new KT("array-contains-any"),KT);function KT(t){this.name=t}var QT,HT=(da(GT,QT=jT),GT.create=function(t,e,n){if(t.isKeyField())return e===WT.IN?($y(n instanceof Kw,"Comparing on key with IN, but filter value not an ArrayValue"),$y(n.internalValue.every(function(t){return t instanceof xw}),"Comparing on key with IN, but an array value was not a RefValue"),new $T(t,n)):($y(n instanceof xw,"Comparing on key, but filter value not a RefValue"),$y(e!==WT.ARRAY_CONTAINS&&e!==WT.ARRAY_CONTAINS_ANY,"'"+e.toString()+"' queries don't make sense on document keys."),new YT(t,e,n));if(n.isEqual(sw.INSTANCE)){if(e!==WT.EQUAL)throw new ig(rg.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new GT(t,e,n)}if(n.isEqual(ww.NAN)){if(e!==WT.EQUAL)throw new ig(rg.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new GT(t,e,n)}return e===WT.ARRAY_CONTAINS?new eE(t,n):e===WT.IN?($y(n instanceof Kw,"IN filter has invalid value: "+n.toString()),new iE(t,n)):e===WT.ARRAY_CONTAINS_ANY?($y(n instanceof Kw,"ARRAY_CONTAINS_ANY filter has invalid value: "+n.toString()),new sE(t,n)):new GT(t,e,n)},GT.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},GT.prototype.matchesComparison=function(t){switch(this.op){case WT.LESS_THAN:return t<0;case WT.LESS_THAN_OR_EQUAL:return t<=0;case WT.EQUAL:return 0===t;case WT.GREATER_THAN:return 0<t;case WT.GREATER_THAN_OR_EQUAL:return 0<=t;default:return Jy("Unknown FieldFilter operator: "+this.op)}},GT.prototype.isInequality=function(){return 0<=[WT.LESS_THAN,WT.LESS_THAN_OR_EQUAL,WT.GREATER_THAN,WT.GREATER_THAN_OR_EQUAL].indexOf(this.op)},GT.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},GT.prototype.isEqual=function(t){return t instanceof GT&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value)},GT.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},GT);function GT(t,e,n){var r=QT.call(this)||this;return r.field=t,r.op=e,r.value=n,r}var zT,YT=(da(XT,zT=HT),XT.prototype.matches=function(t){var e=this.value,n=rv.comparator(t.key,e.key);return this.matchesComparison(n)},XT);function XT(){return null!==zT&&zT.apply(this,arguments)||this}var JT,$T=(da(ZT,JT=HT),ZT.prototype.matches=function(e){return this.value.internalValue.some(function(t){return e.key.isEqual(t.key)})},ZT);function ZT(t,e){var n=JT.call(this,t,WT.IN,e)||this;return n.value=e,n}var tE,eE=(da(nE,tE=HT),nE.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Kw&&e.contains(this.value)},nE);function nE(t,e){return tE.call(this,t,WT.ARRAY_CONTAINS,e)||this}var rE,iE=(da(oE,rE=HT),oE.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},oE);function oE(t,e){var n=rE.call(this,t,WT.IN,e)||this;return n.value=e,n}var aE,sE=(da(uE,aE=HT),uE.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Kw&&n.internalValue.some(function(t){return e.value.contains(t)})},uE);function uE(t,e){var n=aE.call(this,t,WT.ARRAY_CONTAINS_ANY,e)||this;return n.value=e,n}var cE=(hE.prototype.toString=function(){return this.name},hE.ASCENDING=new hE("asc"),hE.DESCENDING=new hE("desc"),hE);function hE(t){this.name=t}var lE=(fE.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++)t+=n[e].toString();return t},fE.prototype.sortsBeforeDocument=function(t,e){$y(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())$y(o instanceof xw,"Bound has a non-key value where the key path is being used."),n=rv.comparator(o.key,e.key);else{var a=e.field(i.field);$y(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===cE.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},fE.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},fE);function fE(t,e){this.position=t,this.before=e}var pE=(dE.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Yw.compareByKey(t,e):Yw.compareByField(this.field,t,e);switch(this.dir){case cE.ASCENDING:return n;case cE.DESCENDING:return-1*n;default:return Jy("Unknown direction: "+this.dir)}},dE.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},dE.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},dE.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},dE);function dE(t,e){this.field=t,void 0===e&&(e=cE.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}var mE=new pE(ev.keyField(),cE.ASCENDING),yE=new pE(ev.keyField(),cE.DESCENDING),gE=(vE.prototype.setLocalDocumentsView=function(t){this.localDocumentsView=t},vE.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var a=this;return $y(void 0!==this.localDocumentsView,"setLocalDocumentsView() not called"),r.matchesAllDocuments()?this.executeFullCollectionScan(e,r):i.isEqual(Tv.MIN)?this.executeFullCollectionScan(e,r):this.localDocumentsView.getDocuments(e,o).next(function(t){var n=a.applyQuery(r,t);return(r.hasLimitToFirst()||r.hasLimitToLast())&&a.needsRefill(r.limitType,n,o,i)?a.executeFullCollectionScan(e,r):(Hy()<=Ly.DEBUG&&zy("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),a.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},vE.prototype.applyQuery=function(n,t){var r=new Ov(function(t,e){return n.docComparator(t,e)});return t.forEach(function(t,e){e instanceof Yw&&n.matches(e)&&(r=r.add(e))}),r},vE.prototype.needsRefill=function(t,e,n,r){if(n.size!==e.size)return!0;var i=t===LT.First?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))},vE.prototype.executeFullCollectionScan=function(t,e){return Hy()<=Ly.DEBUG&&zy("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.localDocumentsView.getDocumentsMatchingQuery(t,e,Tv.MIN)},vE);function vE(){}var bE=(wE.prototype.getDocument=function(e,n){var r=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.getDocumentInternal(e,n,t)})},wE.prototype.getDocumentInternal=function(t,r,i){return this.remoteDocumentCache.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},wE.prototype.applyLocalMutationsToDocuments=function(t,e,i){var o=Uv();return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},wE.prototype.getDocuments=function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next(function(t){return n.getLocalViewOfDocuments(e,t)})},wE.prototype.getLocalViewOfDocuments=function(r,i){var o=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,i).next(function(t){var e=o.applyLocalMutationsToDocuments(r,i,t),n=Fv();return e.forEach(function(t,e){e=e||new $w(t,Tv.forDeletedDoc()),n=n.insert(t,e)}),n})},wE.prototype.getDocumentsMatchingQuery=function(t,e,n){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)},wE.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new rv(e)).next(function(t){var e=qv();return t instanceof Yw&&(e=e.insert(t.key,t)),e})},wE.prototype.getDocumentsMatchingCollectionGroupQuery=function(n,r,i){var o=this;$y(r.path.isEmpty(),"Currently we only support collection group queries at the root.");var a=r.collectionGroup,s=qv();return this.indexManager.getCollectionParents(n,a).next(function(t){return Jv.forEach(t,function(t){var e=r.asCollectionQueryAtPath(t.child(a));return o.getDocumentsMatchingCollectionQuery(n,e,i).next(function(t){t.forEach(function(t,e){s=s.insert(t,e)})})}).next(function(){return s})})},wE.prototype.getDocumentsMatchingCollectionQuery=function(e,n,t){var h,l,r=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,t).next(function(t){return h=t,r.mutationQueue.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return l=t,r.addMissingBaseDocuments(e,l,h).next(function(t){h=t;for(var e=0,n=l;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var a=o[i],s=a.key,u=h.get(s),c=a.applyToLocalView(u,u,r.localWriteTime);h=c instanceof Yw?h.insert(s,c):h.remove(s)}})}).next(function(){return h.forEach(function(t,e){n.matches(e)||(h=h.remove(t))}),h})},wE.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Kv(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Kb&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Yw&&(c=c.insert(t,e))}),c})},wE);function wE(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}var _E=(TE.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},TE.prototype.addReference=function(t,e){var n=new EE(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},TE.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},TE.prototype.removeReference=function(t,e){this.removeRef(new EE(t,e))},TE.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},TE.prototype.removeReferencesForId=function(t){var e=this,n=rv.EMPTY,r=new EE(n,t),i=new EE(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},TE.prototype.removeAllReferences=function(){var e=this;this.refsByKey.forEach(function(t){return e.removeRef(t)})},TE.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},TE.prototype.referencesForId=function(t){var e=rv.EMPTY,n=new EE(e,t),r=new EE(e,t+1),i=Kv();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},TE.prototype.containsKey=function(t){var e=new EE(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},TE);function TE(){this.refsByKey=new Ov(EE.compareByKey),this.refsByTarget=new Ov(EE.compareByTargetId)}var EE=(SE.compareByKey=function(t,e){return rv.comparator(t.key,e.key)||Pg(t.targetOrBatchId,e.targetOrBatchId)},SE.compareByTargetId=function(t,e){return Pg(t.targetOrBatchId,e.targetOrBatchId)||rv.comparator(t.key,e.key)},SE);function SE(t,e){this.key=t,this.targetOrBatchId=e}var IE=(CE.prototype.start=function(){return this.synchronizeLastDocumentChangeReadTime()},CE.prototype.handleUserChange=function(i){return ya(this,void 0,void 0,function(){var e,y,n,r=this;return ga(this,function(t){switch(t.label){case 0:return e=this.mutationQueue,y=this.localDocuments,[4,this.persistence.runTransaction("Handle user change","readonly-idempotent",function(d){var m;return r.mutationQueue.getAllMutationBatches(d).next(function(t){return m=t,e=r.persistence.getMutationQueue(i),y=new bE(r.remoteDocuments,e,r.persistence.getIndexManager()),e.getAllMutationBatches(d)}).next(function(t){for(var e=[],n=[],r=Kv(),i=0,o=m;i<o.length;i++){var a=o[i];e.push(a.batchId);for(var s=0,u=a.mutations;s<u.length;s++){var c=u[s];r=r.add(c.key)}}for(var h=0,l=t;h<l.length;h++){a=l[h],n.push(a.batchId);for(var f=0,p=a.mutations;f<p.length;f++)c=p[f],r=r.add(c.key)}return y.getDocuments(d,r).next(function(t){return{affectedDocuments:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return n=t.sent(),this.mutationQueue=e,this.localDocuments=y,this.queryEngine.setLocalDocumentsView(this.localDocuments),[2,n]}})})},CE.prototype.localWrite=function(s){var u,c=this,h=wv.now(),t=s.reduce(function(t,e){return t.add(e.key)},Kv());return this.persistence.runTransaction("Locally write mutations","readwrite-idempotent",function(a){return c.localDocuments.getDocuments(a,t).next(function(t){u=t;for(var e=[],n=0,r=s;n<r.length;n++){var i=r[n],o=i.extractBaseValue(u.get(i.key));null!=o&&e.push(new Kb(i.key,o,o.fieldMask(),Lb.exists(!0)))}return c.mutationQueue.addMutationBatch(a,h,e,s)})}).then(function(t){var e=t.applyToLocalDocumentSet(u);return{batchId:t.batchId,changes:e}})},CE.prototype.lookupMutationDocuments=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly-idempotent",function(e){return n.mutationQueue.lookupMutationKeys(e,t).next(function(t){return t?n.localDocuments.getDocuments(e,t):Jv.resolve(null)})})},CE.prototype.acknowledgeBatch=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary-idempotent",function(t){var e=r.batch.keys(),n=i.remoteDocuments.newChangeBuffer({trackRemovals:!0});return i.mutationQueue.acknowledgeBatch(t,r.batch,r.streamToken).next(function(){return i.applyWriteToRemoteDocuments(t,r,n)}).next(function(){return n.apply(t)}).next(function(){return i.mutationQueue.performConsistencyCheck(t)}).next(function(){return i.localDocuments.getDocuments(t,e)})})},CE.prototype.rejectBatch=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary-idempotent",function(e){var n;return r.mutationQueue.lookupMutationBatch(e,t).next(function(t){return $y(null!==t,"Attempt to reject nonexistent batch!"),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t)}).next(function(){return r.mutationQueue.performConsistencyCheck(e)}).next(function(){return r.localDocuments.getDocuments(e,n)})})},CE.prototype.getHighestUnacknowledgedBatchId=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly-idempotent",function(t){return e.mutationQueue.getHighestUnacknowledgedBatchId(t)})},CE.prototype.getLastStreamToken=function(){var e=this;return this.persistence.runTransaction("Get last stream token","readonly-idempotent",function(t){return e.mutationQueue.getLastStreamToken(t)})},CE.prototype.setLastStreamToken=function(e){var n=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary-idempotent",function(t){return n.mutationQueue.setLastStreamToken(t,e)})},CE.prototype.getLastRemoteSnapshotVersion=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly-idempotent",function(t){return e.targetCache.getLastRemoteSnapshotVersion(t)})},CE.prototype.applyRemoteEvent=function(u){var c=this,h=u.snapshotVersion,l=this.targetDataByTarget;return this.persistence.runTransaction("Apply remote event","readwrite-primary-idempotent",function(o){var i=c.remoteDocuments.newChangeBuffer({trackRemovals:!0});l=c.targetDataByTarget;var a=[];cg(u.targetChanges,function(t,e){var n=l.get(t);if(n){a.push(c.targetCache.removeMatchingKeys(o,e.removedDocuments,t).next(function(){return c.targetCache.addMatchingKeys(o,e.addedDocuments,t)}));var r=e.resumeToken;if(0<r.length){var i=n.withResumeToken(r,h).withSequenceNumber(o.currentSequenceNumber);l=l.insert(t,i),CE.shouldPersistTargetData(n,i,e)&&a.push(c.targetCache.updateTargetData(o,i))}}});var s=Fv(),n=Kv();if(u.documentUpdates.forEach(function(t,e){n=n.add(t)}),a.push(i.getEntries(o,n).next(function(r){u.documentUpdates.forEach(function(t,e){var n=r.get(t);e instanceof $w&&e.version.isEqual(Tv.MIN)?(i.removeEntry(t,h),s=s.insert(t,e)):null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?($y(!Tv.MIN.isEqual(h),"Cannot add a document when the remote version is zero"),i.addEntry(e,h),s=s.insert(t,e)):zy("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),u.resolvedLimboDocuments.has(t)&&a.push(c.persistence.referenceDelegate.updateLimboDocument(o,t))})})),!h.isEqual(Tv.MIN)){var t=c.targetCache.getLastRemoteSnapshotVersion(o).next(function(t){return $y(0<=h.compareTo(t),"Watch stream reverted to previous snapshot?? "+h+" < "+t),c.targetCache.setTargetsMetadata(o,o.currentSequenceNumber,h)});a.push(t)}return Jv.waitFor(a).next(function(){return i.apply(o)}).next(function(){return c.localDocuments.getLocalViewOfDocuments(o,s)})}).then(function(t){return c.targetDataByTarget=l,t})},CE.shouldPersistTargetData=function(t,e,n){return $y(0<e.resumeToken.length,"Attempted to persist target data with no resume token"),0===t.resumeToken.length||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||0<n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size},CE.prototype.notifyLocalViewChanges=function(t){for(var n=this,e=0,r=t;e<r.length;e++){var i=r[e],o=i.targetId;if(this.localViewReferences.addReferences(i.addedKeys,o),this.localViewReferences.removeReferences(i.removedKeys,o),!i.fromCache){var a=this.targetDataByTarget.get(o);$y(null!==a,"Can't set limbo-free snapshot version for unknown target: "+o);var s=a.snapshotVersion,u=a.withLastLimboFreeSnapshotVersion(s);this.targetDataByTarget=this.targetDataByTarget.insert(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite-idempotent",function(e){return Jv.forEach(t,function(t){return Jv.forEach(t.removedKeys,function(t){return n.persistence.referenceDelegate.removeReference(e,t)})})})},CE.prototype.nextMutationBatch=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly-idempotent",function(t){return void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)})},CE.prototype.readDocument=function(e){var n=this;return this.persistence.runTransaction("read document","readonly-idempotent",function(t){return n.localDocuments.getDocument(t,e)})},CE.prototype.allocateTarget=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite-idempotent",function(e){var n;return i.targetCache.getTargetData(e,r).next(function(t){return t?(n=t,Jv.resolve(n)):i.targetCache.allocateTargetId(e).next(function(t){return n=new tT(r,t,z_.Listen,e.currentSequenceNumber),i.targetCache.addTargetData(e,n).next(function(){return n})})})}).then(function(t){return null===i.targetDataByTarget.get(t.targetId)&&(i.targetDataByTarget=i.targetDataByTarget.insert(t.targetId,t),i.targetIdByTarget.set(r,t.targetId)),t})},CE.prototype.getTargetData=function(t,e){var n=this.targetIdByTarget.get(e);return void 0!==n?Jv.resolve(this.targetDataByTarget.get(n)):this.targetCache.getTargetData(t,e)},CE.prototype.releaseTarget=function(n,r){var i=this,o=this.targetDataByTarget.get(n);$y(null!==o,"Tried to release nonexistent target: "+n);var t=r?"readwrite-idempotent":"readwrite-primary-idempotent";return this.persistence.runTransaction("Release target",t,function(e){var t=i.localViewReferences.removeReferencesForId(n);return r?Jv.resolve():Jv.forEach(t,function(t){return i.persistence.referenceDelegate.removeReference(e,t)}).next(function(){i.persistence.referenceDelegate.removeTarget(e,o)})}).then(function(){i.targetDataByTarget=i.targetDataByTarget.remove(n),i.targetIdByTarget.delete(o.target)})},CE.prototype.executeQuery=function(t,n){var r=this,i=Tv.MIN,o=Kv();return this.persistence.runTransaction("Execute query","readonly-idempotent",function(e){return r.getTargetData(e,t.toTarget()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(function(t){o=t})}).next(function(){return r.queryEngine.getDocumentsMatchingQuery(e,t,n?i:Tv.MIN,n?o:Kv())}).next(function(t){return{documents:t,remoteKeys:o}})})},CE.prototype.remoteDocumentKeys=function(e){var n=this;return this.persistence.runTransaction("Remote document keys","readonly-idempotent",function(t){return n.targetCache.getMatchingKeysForTargetId(t,e)})},CE.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},CE.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},CE.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},CE.prototype.applyWriteToRemoteDocuments=function(t,i,o){var e=this,a=i.batch,n=a.keys(),s=Jv.resolve();return n.forEach(function(r){s=s.next(function(){return o.getEntry(t,r)}).next(function(t){var e=t,n=i.docVersions.get(r);$y(null!==n,"ackVersions should contain every doc in the write."),(!e||e.version.compareTo(n)<0)&&((e=a.applyToRemoteDocument(r,e,i))?o.addEntry(e,i.commitVersion):$y(!t,"Mutation batch "+a+" applied to document "+t+" resulted in null"))})}),s.next(function(){return e.mutationQueue.removeMutationBatch(t,a)})},CE.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary-idempotent",function(t){return e.collect(t,n.targetDataByTarget)})},CE.prototype.getTarget=function(e){var n=this,t=this.targetDataByTarget.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly-idempotent",function(t){return n.targetCache.getTargetDataForTarget(t,e).next(function(t){return t?t.target:null})})},CE.prototype.getNewDocumentChanges=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly-idempotent",function(t){return r.remoteDocuments.getNewDocumentChanges(t,r.lastDocumentChangeReadTime)}).then(function(t){var e=t.changedDocs,n=t.readTime;return r.lastDocumentChangeReadTime=n,e})},CE.prototype.synchronizeLastDocumentChangeReadTime=function(){return ya(this,void 0,void 0,function(){var e,n=this;return ga(this,function(t){return this.remoteDocuments instanceof u_?(e=this.remoteDocuments,[2,this.persistence.runTransaction("Synchronize last document change read time","readonly-idempotent",function(t){return e.getLastDocumentChange(t)}).then(function(t){var e=t.readTime;n.lastDocumentChangeReadTime=e})]):[2]})})},CE.RESUME_TOKEN_MAX_AGE_MICROS=3e8,CE);function CE(t,e,n){this.persistence=t,this.queryEngine=e,this.localViewReferences=new _E,this.targetDataByTarget=new Sv(Pg),this.targetIdByTarget=new r_(function(t){return t.canonicalId()}),this.lastDocumentChangeReadTime=Tv.MIN,$y(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(n),this.remoteDocuments=t.getRemoteDocumentCache(),this.targetCache=t.getTargetCache(),this.localDocuments=new bE(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager()),this.queryEngine.setLocalDocumentsView(this.localDocuments)}var NE=(AE.prototype.checkEmpty=function(t){return Jv.resolve(0===this.mutationQueue.length)},AE.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");$y(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return $y(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Jv.resolve()},AE.prototype.getLastStreamToken=function(t){return Jv.resolve(this.lastStreamToken)},AE.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,Jv.resolve()},AE.prototype.addMutationBatch=function(t,e,n,r){$y(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;this.nextBatchId++,0<this.mutationQueue.length&&$y(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Gv(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new EE(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return Jv.resolve(o)},AE.prototype.lookupMutationBatch=function(t,e){return Jv.resolve(this.findMutationBatch(e))},AE.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return $y(null!=n,"Failed to find local mutation batch."),Jv.resolve(n.keys())},AE.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return Jv.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},AE.prototype.getHighestUnacknowledgedBatchId=function(){return Jv.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},AE.prototype.getAllMutationBatches=function(t){return Jv.resolve(this.mutationQueue.slice())},AE.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,e=new EE(n,0),i=new EE(n,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([e,i],function(t){$y(n.isEqual(t.key),"Should only iterate over a single key's batches");var e=r.findMutationBatch(t.targetOrBatchId);$y(null!==e,"Batches in the index must exist in the main table"),o.push(e)}),Jv.resolve(o)},AE.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var r=this,i=new Ov(Pg);return e.forEach(function(e){var t=new EE(e,0),n=new EE(e,Number.POSITIVE_INFINITY);r.batchesByDocumentKey.forEachInRange([t,n],function(t){$y(e.isEqual(t.key),"For each key, should only iterate over a single key's batches"),i=i.add(t.targetOrBatchId)})}),Jv.resolve(this.findMutationBatches(i))},AE.prototype.getAllMutationBatchesAffectingQuery=function(t,e){$y(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;rv.isDocumentKey(i)||(i=i.child(""));var o=new EE(new rv(i),0),a=new Ov(Pg);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),Jv.resolve(this.findMutationBatches(a))},AE.prototype.findMutationBatches=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.findMutationBatch(t);null!==e&&r.push(e)}),r},AE.prototype.removeMutationBatch=function(n,r){var i=this;$y(0===this.indexOfExistingBatchId(r.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var o=this.batchesByDocumentKey;return Jv.forEach(r.mutations,function(t){var e=new EE(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.removeMutationReference(n,t.key)}).next(function(){i.batchesByDocumentKey=o})},AE.prototype.removeCachedMutationKeys=function(t){},AE.prototype.containsKey=function(t,e){var n=new EE(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return Jv.resolve(e.isEqual(r&&r.key))},AE.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&$y(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),Jv.resolve()},AE.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return $y(0<=n&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},AE.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},AE.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return $y(n.batchId===t,"If found batch must match"),n},AE);function AE(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=eg(),this.batchesByDocumentKey=new Ov(EE.compareByKey)}var kE,DE=(RE.prototype.addEntry=function(t,e,n){$y(!n.isEqual(Tv.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,a=this.sizer(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:a,readTime:n}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())},RE.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},RE.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Jv.resolve(n?n.maybeDocument:null)},RE.prototype.getEntries=function(t,e){var n=this,r=Uv();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Jv.resolve(r)},RE.prototype.getDocumentsMatchingQuery=function(t,e,n){$y(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=qv(),i=new rv(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var a=o.getNext(),s=a.key,u=a.value,c=u.maybeDocument,h=u.readTime;if(!e.path.isPrefixOf(s.path))break;h.compareTo(n)<=0||c instanceof Yw&&e.matches(c)&&(r=r.insert(c.key,c))}return Jv.resolve(r)},RE.prototype.forEachDocumentKey=function(t,e){return Jv.forEach(this.docs,function(t){return e(t)})},RE.prototype.getNewDocumentChanges=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},RE.prototype.newChangeBuffer=function(t){return new RE.RemoteDocumentChangeBuffer(this)},RE.prototype.getSize=function(t){return Jv.resolve(this.size)},RE.RemoteDocumentChangeBuffer=(da(OE,kE=o_),OE.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e?i.push(r.documentCache.addEntry(n,e,r.readTime)):r.documentCache.removeEntry(t)}),Jv.waitFor(i)},OE.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},OE.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},OE),RE);function RE(t,e){this.indexManager=t,this.sizer=e,this.docs=new Sv(rv.comparator),this.size=0}function OE(t){var e=kE.call(this)||this;return e.documentCache=t,e}var PE=(ME.prototype.forEachTarget=function(t,n){return this.targets.forEach(function(t,e){return n(e)}),Jv.resolve()},ME.prototype.getLastRemoteSnapshotVersion=function(t){return Jv.resolve(this.lastRemoteSnapshotVersion)},ME.prototype.getHighestSequenceNumber=function(t){return Jv.resolve(this.highestSequenceNumber)},ME.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,Jv.resolve(e)},ME.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),Jv.resolve()},ME.prototype.saveTargetData=function(t){this.targets.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},ME.prototype.addTargetData=function(t,e){return $y(!this.targets.has(e.target),"Adding a target that already exists"),this.saveTargetData(e),this.targetCount+=1,Jv.resolve()},ME.prototype.updateTargetData=function(t,e){return $y(this.targets.has(e.target),"Updating a non-existent target"),this.saveTargetData(e),Jv.resolve()},ME.prototype.removeTargetData=function(t,e){return $y(0<this.targetCount,"Removing a target from an empty cache"),$y(this.targets.has(e.target),"Removing a non-existent target from the cache"),this.targets.delete(e.target),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,Jv.resolve()},ME.prototype.removeTargets=function(n,r,i){var o=this,a=0,s=[];return this.targets.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.targets.delete(t),s.push(o.removeMatchingKeysForTargetId(n,e.targetId)),a++)}),Jv.waitFor(s).next(function(){return a})},ME.prototype.getTargetCount=function(t){return Jv.resolve(this.targetCount)},ME.prototype.getTargetData=function(t,e){var n=this.targets.get(e)||null;return Jv.resolve(n)},ME.prototype.getTargetDataForTarget=function(t,e){return Jy("Not yet implemented.")},ME.prototype.addMatchingKeys=function(e,t,n){this.references.addReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.addReference(e,t))}),Jv.waitFor(i)},ME.prototype.removeMatchingKeys=function(e,t,n){this.references.removeReferences(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.removeReference(e,t))}),Jv.waitFor(i)},ME.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),Jv.resolve()},ME.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return Jv.resolve(n)},ME.prototype.containsKey=function(t,e){return Jv.resolve(this.references.containsKey(e))},ME);function ME(t){this.persistence=t,this.targets=new r_(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Tv.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new _E,this.targetCount=0,this.targetIdGenerator=_b.forTargetCache()}var xE=(LE.createLruPersistence=function(t,e,n){return new LE(t,function(t){return new jE(t,new nT(e),n)})},LE.createEagerPersistence=function(t){return new LE(t,function(t){return new qE(t)})},LE.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(LE.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),LE.prototype.getActiveClients=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){return[2,[this.clientId]]})})},LE.prototype.setPrimaryStateListener=function(t){return t(!0)},LE.prototype.setDatabaseDeletedListener=function(){},LE.prototype.setNetworkEnabled=function(t){},LE.prototype.getIndexManager=function(){return this.indexManager},LE.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new NE(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},LE.prototype.getTargetCache=function(){return this.targetCache},LE.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},LE.prototype.runTransaction=function(t,e,n){var r=this;zy("MemoryPersistence","Starting transaction:",t);var i=new UE(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},LE.prototype.mutationQueuesContainKey=function(e,n){return Jv.or(function(t){var n=[];return hg(t,function(t,e){return n.push(e)}),n}(this.mutationQueues).map(function(t){return function(){return t.containsKey(e,n)}}))},LE);function LE(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new Qg(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new PE(this);this.indexManager=new m_,this.remoteDocumentCache=new DE(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}var FE,UE=(da(VE,FE=dT),VE);function VE(t){var e=FE.call(this)||this;return e.currentSequenceNumber=t,e}var qE=(Object.defineProperty(BE.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Jy("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),BE.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},BE.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),Jv.resolve()},BE.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),Jv.resolve()},BE.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),Jv.resolve()},BE.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeTargetData(t,e)})},BE.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},BE.prototype.onTransactionCommitted=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Jv.forEach(this.orphanedDocuments,function(e){return n.isReferenced(t,e).next(function(t){t||r.removeEntry(e)})}).next(function(){return n._orphanedDocuments=null,r.apply(t)})},BE.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},BE.prototype.documentSize=function(t){return 0},BE.prototype.isReferenced=function(t,e){var n=this;return Jv.or([function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return Jv.resolve(n.inMemoryPins.containsKey(e))}])},BE);function BE(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}var jE=(WE.prototype.onTransactionStarted=function(){},WE.prototype.onTransactionCommitted=function(t){return Jv.resolve()},WE.prototype.forEachTarget=function(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)},WE.prototype.getSequenceNumberCount=function(t){var n=this.orphanedDocumentCount(t);return this.persistence.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},WE.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},WE.prototype.forEachOrphanedDocumentSequenceNumber=function(n,r){var i=this;return Jv.forEach(this.orphanedSequenceNumbers,function(t,e){return i.isPinned(n,t,e).next(function(t){return t?Jv.resolve():r(e)})})},WE.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},WE.prototype.removeTargets=function(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)},WE.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=0,e=this.persistence.getRemoteDocumentCache(),o=e.newChangeBuffer();return e.forEachDocumentKey(t,function(e){return r.isPinned(t,e,n).next(function(t){t||(i++,o.removeEntry(e))})}).next(function(){return o.apply(t)}).next(function(){return i})},WE.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Jv.resolve()},WE.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)},WE.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Jv.resolve()},WE.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Jv.resolve()},WE.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),Jv.resolve()},WE.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t,t.version);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Jy("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},WE.prototype.isPinned=function(t,e,n){var r=this;return Jv.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return Jv.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getTargetCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return Jv.resolve(void 0!==t&&n<t)}])},WE.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},WE);function WE(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new r_(function(t){return yv(t.path)}),this.garbageCollector=new fT(this,n)}var KE=(QE.prototype.reset=function(){this.currentBaseMs=0},QE.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},QE.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);0<this.currentBaseMs&&zy("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},QE.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},QE.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},QE);function QE(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}var HE,GE,zE="PersistentStream";(GE=HE=HE||{})[GE.Initial=0]="Initial",GE[GE.Starting=1]="Starting",GE[GE.Open=2]="Open",GE[GE.Error=3]="Error",GE[GE.Backoff=4]="Backoff";var YE=(XE.prototype.isStarted=function(){return this.state===HE.Starting||this.state===HE.Open||this.state===HE.Backoff},XE.prototype.isOpen=function(){return this.state===HE.Open},XE.prototype.start=function(){this.state!==HE.Error?($y(this.state===HE.Initial,"Already started"),this.auth()):this.performBackoff()},XE.prototype.stop=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(HE.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},XE.prototype.inhibitBackoff=function(){$y(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=HE.Initial,this.backoff.reset()},XE.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},XE.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},XE.prototype.handleIdleCloseTimer=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){return this.isOpen()?[2,this.close(HE.Initial)]:[2]})})},XE.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},XE.prototype.close=function(e,n){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return $y(this.isStarted(),"Only started streams should be closed."),$y(e===HE.Error||MT(n),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,e!==HE.Error?this.backoff.reset():n&&n.code===rg.RESOURCE_EXHAUSTED?(Yy(n.toString()),Yy("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):n&&n.code===rg.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.onClose(n)];case 1:return t.sent(),[2]}})})},XE.prototype.tearDown=function(){},XE.prototype.auth=function(){var n=this;$y(this.state===HE.Initial,"Must be in initial state to auth"),this.state=HE.Starting;var t=this.getCloseGuardedDispatcher(this.closeCount),e=this.closeCount;this.credentialsProvider.getToken().then(function(t){n.closeCount===e&&n.startStream(t)},function(e){t(function(){var t=new ig(rg.UNKNOWN,"Fetching auth token failed: "+e.message);return n.handleStreamClose(t)})})},XE.prototype.startStream=function(t){var e=this;$y(this.state===HE.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return $y(e.state===HE.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=HE.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},XE.prototype.performBackoff=function(){var t=this;$y(this.state===HE.Error,"Should only perform backoff when in Error state"),this.state=HE.Backoff,this.backoff.backoffAndRun(function(){return ya(t,void 0,void 0,function(){return ga(this,function(t){return $y(this.state===HE.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=HE.Initial,this.start(),$y(this.isStarted(),"PersistentStream should have started"),[2]})})})},XE.prototype.handleStreamClose=function(t){return $y(this.isStarted(),"Can't handle server close on non-started stream"),zy(zE,"close with error: "+t),this.stream=null,this.close(HE.Error,t)},XE.prototype.getCloseGuardedDispatcher=function(e){var n=this;return function(t){n.queue.enqueueAndForget(function(){return n.closeCount===e?t():(zy(zE,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},XE);function XE(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=HE.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new KE(t,e)}var JE,$E=(da(ZE,JE=YE),ZE.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},ZE.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},ZE.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},ZE.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},ZE);function ZE(t,e,n,r,i){var o=JE.call(this,t,ov.ListenStreamConnectionBackoff,ov.ListenStreamIdle,e,n,i)||this;return o.serializer=r,o}var tS,eS=(da(nS,tS=YE),Object.defineProperty(nS.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),nS.prototype.start=function(){this.handshakeComplete_=!1,tS.prototype.start.call(this)},nS.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},nS.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},nS.prototype.onMessage=function(t){if($y(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return $y(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},nS.prototype.writeHandshake=function(){$y(this.isOpen(),"Writing handshake requires an opened stream"),$y(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},nS.prototype.writeMutations=function(t){var e=this;$y(this.isOpen(),"Writing mutations requires an opened stream"),$y(this.handshakeComplete_,"Handshake must be complete before writing mutations"),$y(0<this.lastStreamToken.length,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},nS);function nS(t,e,n,r,i){var o=tS.call(this,t,ov.WriteStreamConnectionBackoff,ov.WriteStreamIdle,e,n,i)||this;return o.serializer=r,o.handshakeComplete_=!1,o.lastStreamToken=eg(),o}var rS=(iS.prototype.newPersistentWriteStream=function(t){return new eS(this.queue,this.connection,this.credentials,this.serializer,t)},iS.prototype.newPersistentWatchStream=function(t){return new $E(this.queue,this.connection,this.credentials,this.serializer,t)},iS.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},iS.prototype.lookup=function(e){var i=this,t={database:this.serializer.encodedDatabaseId,documents:e.map(function(t){return i.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",t).then(function(t){var n=Fv();t.forEach(function(t){var e=i.serializer.fromMaybeDocument(t);n=n.insert(e.key,e)});var r=[];return e.forEach(function(t){var e=n.get(t);$y(!!e,"Missing entity in write response for "+t),r.push(e)}),r})},iS.prototype.invokeRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeRPC(e,n,t)}).catch(function(t){throw t.code===rg.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},iS.prototype.invokeStreamingRPC=function(e,n){var r=this;return this.credentials.getToken().then(function(t){return r.connection.invokeStreamingRPC(e,n,t)}).catch(function(t){throw t.code===rg.UNAUTHENTICATED&&r.credentials.invalidateToken(),t})},iS);function iS(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}var oS,aS,sS,uS,cS=(hS.prototype.lookup=function(r){return ya(this,void 0,void 0,function(){var e,n=this;return ga(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new ig(rg.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(r)];case 1:return(e=t.sent()).forEach(function(t){t instanceof $w||t instanceof Yw?n.recordVersion(t):Jy("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},hS.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},hS.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},hS.prototype.delete=function(t){this.write([new tw(t,this.precondition(t))]),this.writtenDocs.add(t)},hS.prototype.commit=function(){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(e=this.readVersions,this.mutations.forEach(function(t){e=e.remove(t.key)}),!e.isEmpty())throw new ig(rg.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},hS.prototype.recordVersion=function(t){var e;if(t instanceof Yw)e=t.version;else{if(!(t instanceof $w))throw Jy("Document in a transaction was a "+t.constructor.name);e=Tv.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new ig(rg.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},hS.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?Lb.updateTime(e):Lb.NONE},hS.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(this.writtenDocs.has(t)||!e)return Lb.exists(!0);if(e.isEqual(Tv.forDeletedDoc()))throw new ig(rg.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Lb.updateTime(e)},hS.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},hS.prototype.ensureCommitNotCalled=function(){$y(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},hS);function hS(t){this.datastore=t,this.readVersions=jv(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}(aS=oS=oS||{})[aS.Unknown=0]="Unknown",aS[aS.Online=1]="Online",aS[aS.Offline=2]="Offline",(uS=sS=sS||{})[uS.RemoteStore=0]="RemoteStore",uS[uS.SharedClientState=1]="SharedClientState";var lS,fS,pS=(dS.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(oS.Unknown),$y(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(ov.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,$y(t.state===oS.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(oS.Offline),Promise.resolve()}))},dS.prototype.handleWatchStreamFailure=function(t){this.state===oS.Online?(this.setAndBroadcast(oS.Unknown),$y(0===this.watchStreamFailures,"watchStreamFailures must be 0"),$y(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,1<=this.watchStreamFailures&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(oS.Offline)))},dS.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===oS.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},dS.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},dS.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Yy(e),this.shouldWarnClientIsOffline=!1):zy("OnlineStateTracker",e)},dS.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},dS);function dS(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=oS.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}function mS(t){switch(t){case rg.OK:return Jy("Treated status OK as error");case rg.CANCELLED:case rg.UNKNOWN:case rg.DEADLINE_EXCEEDED:case rg.RESOURCE_EXHAUSTED:case rg.INTERNAL:case rg.UNAVAILABLE:case rg.UNAUTHENTICATED:return!1;case rg.INVALID_ARGUMENT:case rg.NOT_FOUND:case rg.ALREADY_EXISTS:case rg.PERMISSION_DENIED:case rg.FAILED_PRECONDITION:case rg.ABORTED:case rg.OUT_OF_RANGE:case rg.UNIMPLEMENTED:case rg.DATA_LOSS:return!0;default:return Jy("Unknown status code: "+t)}}function yS(t){if(void 0===t)return Yy("GRPC error has no .code"),rg.UNKNOWN;switch(t){case lS.OK:return rg.OK;case lS.CANCELLED:return rg.CANCELLED;case lS.UNKNOWN:return rg.UNKNOWN;case lS.DEADLINE_EXCEEDED:return rg.DEADLINE_EXCEEDED;case lS.RESOURCE_EXHAUSTED:return rg.RESOURCE_EXHAUSTED;case lS.INTERNAL:return rg.INTERNAL;case lS.UNAVAILABLE:return rg.UNAVAILABLE;case lS.UNAUTHENTICATED:return rg.UNAUTHENTICATED;case lS.INVALID_ARGUMENT:return rg.INVALID_ARGUMENT;case lS.NOT_FOUND:return rg.NOT_FOUND;case lS.ALREADY_EXISTS:return rg.ALREADY_EXISTS;case lS.PERMISSION_DENIED:return rg.PERMISSION_DENIED;case lS.FAILED_PRECONDITION:return rg.FAILED_PRECONDITION;case lS.ABORTED:return rg.ABORTED;case lS.OUT_OF_RANGE:return rg.OUT_OF_RANGE;case lS.UNIMPLEMENTED:return rg.UNIMPLEMENTED;case lS.DATA_LOSS:return rg.DATA_LOSS;default:return Jy("Unknown status code: "+t)}}(fS=lS=lS||{})[fS.OK=0]="OK",fS[fS.CANCELLED=1]="CANCELLED",fS[fS.UNKNOWN=2]="UNKNOWN",fS[fS.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fS[fS.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fS[fS.NOT_FOUND=5]="NOT_FOUND",fS[fS.ALREADY_EXISTS=6]="ALREADY_EXISTS",fS[fS.PERMISSION_DENIED=7]="PERMISSION_DENIED",fS[fS.UNAUTHENTICATED=16]="UNAUTHENTICATED",fS[fS.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fS[fS.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fS[fS.ABORTED=10]="ABORTED",fS[fS.OUT_OF_RANGE=11]="OUT_OF_RANGE",fS[fS.UNIMPLEMENTED=12]="UNIMPLEMENTED",fS[fS.INTERNAL=13]="INTERNAL",fS[fS.UNAVAILABLE=14]="UNAVAILABLE",fS[fS.DATA_LOSS=15]="DATA_LOSS";var gS,vS,bS,wS,_S=(TS.emptySet=function(t){return new TS(t.comparator)},TS.prototype.has=function(t){return null!=this.keyedMap.get(t)},TS.prototype.get=function(t){return this.keyedMap.get(t)},TS.prototype.first=function(){return this.sortedSet.minKey()},TS.prototype.last=function(){return this.sortedSet.maxKey()},TS.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},TS.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(TS.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),TS.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},TS.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},TS.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},TS.prototype.isEqual=function(t){if(!(t instanceof TS))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},TS.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},TS.prototype.copy=function(t,e){var n=new TS;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},TS);function TS(n){this.comparator=n?function(t,e){return n(t,e)||rv.comparator(t.key,e.key)}:function(t,e){return rv.comparator(t.key,e.key)},this.keyedMap=qv(),this.sortedSet=new Sv(this.comparator)}(vS=gS=gS||{})[vS.Added=0]="Added",vS[vS.Removed=1]="Removed",vS[vS.Modified=2]="Modified",vS[vS.Metadata=3]="Metadata",(wS=bS=bS||{})[wS.Local=0]="Local",wS[wS.Synced=1]="Synced";var ES=(SS.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==gS.Added&&n.type===gS.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===gS.Metadata&&n.type!==gS.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===gS.Modified&&n.type===gS.Modified?this.changeMap=this.changeMap.insert(e,{type:gS.Modified,doc:t.doc}):t.type===gS.Modified&&n.type===gS.Added?this.changeMap=this.changeMap.insert(e,{type:gS.Added,doc:t.doc}):t.type===gS.Removed&&n.type===gS.Added?this.changeMap=this.changeMap.remove(e):t.type===gS.Removed&&n.type===gS.Modified?this.changeMap=this.changeMap.insert(e,{type:gS.Removed,doc:n.doc}):t.type===gS.Added&&n.type===gS.Removed?this.changeMap=this.changeMap.insert(e,{type:gS.Modified,doc:t.doc}):Jy("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},SS.prototype.getChanges=function(){var n=[];return this.changeMap.inorderTraversal(function(t,e){n.push(e)}),n},SS);function SS(){this.changeMap=new Sv(rv.comparator)}var IS=(CS.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:gS.Added,doc:t})}),new CS(t,e,_S.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(CS.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),CS.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},CS);function CS(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}var NS=(AS.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n,r=((n={})[t]=kS.createSynthesizedTargetChangeForCurrentChange(t,e),n);return new AS(Tv.MIN,r,Hv(),Fv(),Kv())},AS);function AS(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}var kS=(DS.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new DS(eg(),e,Kv(),Kv(),Kv())},DS);function DS(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}var RS,OS,PS=function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r},MS=function(t,e){this.targetId=t,this.existenceFilter=e};(OS=RS=RS||{})[OS.NoChange=0]="NoChange",OS[OS.Added=1]="Added",OS[OS.Removed=2]="Removed",OS[OS.Current=3]="Current",OS[OS.Reset=4]="Reset";var xS=function(t,e,n,r){void 0===n&&(n=eg()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},LS=(Object.defineProperty(FS.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(FS.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(FS.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(FS.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),FS.prototype.updateResumeToken=function(t){0<t.length&&(this._hasPendingChanges=!0,this._resumeToken=t)},FS.prototype.toTargetChange=function(){var n=Kv(),r=Kv(),i=Kv();return this.documentChanges.forEach(function(t,e){switch(e){case gS.Added:n=n.add(t);break;case gS.Modified:r=r.add(t);break;case gS.Removed:i=i.add(t);break;default:Jy("Encountered invalid change type: "+e)}}),new kS(this._resumeToken,this._current,n,r,i)},FS.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=BS()},FS.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},FS.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},FS.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},FS.prototype.recordTargetResponse=function(){this.pendingResponses-=1},FS.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},FS);function FS(){this.pendingResponses=0,this.documentChanges=BS(),this._resumeToken=eg(),this._current=!1,this._hasPendingChanges=!0}var US=(VS.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Yw?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof $w&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.removeDocumentFromTarget(r,t.key,t.newDoc)},VS.prototype.handleTargetChange=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ensureTargetState(t);switch(n.state){case RS.NoChange:r.isActiveTarget(t)&&e.updateResumeToken(n.resumeToken);break;case RS.Added:e.recordTargetResponse(),e.isPending||e.clearPendingChanges(),e.updateResumeToken(n.resumeToken);break;case RS.Removed:e.recordTargetResponse(),e.isPending||r.removeTarget(t),$y(!n.cause,"WatchChangeAggregator does not handle errored targets");break;case RS.Current:r.isActiveTarget(t)&&(e.markCurrent(),e.updateResumeToken(n.resumeToken));break;case RS.Reset:r.isActiveTarget(t)&&(r.resetTarget(t),e.updateResumeToken(n.resumeToken));break;default:Jy("Unknown target watch change state: "+n.state)}})},VS.prototype.forEachTarget=function(t,e){0<t.targetIds.length?t.targetIds.forEach(e):cg(this.targetStates,e)},VS.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.targetDataForActiveTarget(e);if(r){var i=r.target;if(i.isDocumentQuery())if(0===n){var o=new rv(i.path);this.removeDocumentFromTarget(e,o,new $w(o,Tv.forDeletedDoc()))}else $y(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},VS.prototype.createRemoteEvent=function(i){var o=this,a={};cg(this.targetStates,function(t,e){var n=o.targetDataForActiveTarget(t);if(n){if(e.current&&n.target.isDocumentQuery()){var r=new rv(n.target.path);null!==o.pendingDocumentUpdates.get(r)||o.targetContainsDocument(t,r)||o.removeDocumentFromTarget(t,r,new $w(r,i))}e.hasPendingChanges&&(a[t]=e.toTargetChange(),e.clearPendingChanges())}});var r=Kv();this.pendingDocumentTargetMapping.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){var e=o.targetDataForActiveTarget(t);return!e||e.purpose===z_.LimboResolution||(n=!1)}),n&&(r=r.add(t))});var t=new NS(i,a,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Fv(),this.pendingDocumentTargetMapping=qS(),this.pendingTargetResets=new Ov(Pg),t},VS.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?gS.Modified:gS.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},VS.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,gS.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},VS.prototype.removeTarget=function(t){delete this.targetStates[t]},VS.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},VS.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},VS.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new LS),this.targetStates[t]},VS.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Ov(Pg),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},VS.prototype.isActiveTarget=function(t){var e=null!==this.targetDataForActiveTarget(t);return e||zy("WatchChangeAggregator","Detected inactive target",t),e},VS.prototype.targetDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getTargetDataForTarget(t)},VS.prototype.resetTarget=function(e){var n=this;$y(!this.targetStates[e].isPending,"Should only reset active targets"),this.targetStates[e]=new LS,this.metadataProvider.getRemoteKeysForTarget(e).forEach(function(t){n.removeDocumentFromTarget(e,t,null)})},VS.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},VS);function VS(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=Fv(),this.pendingDocumentTargetMapping=qS(),this.pendingTargetResets=new Ov(Pg)}function qS(){return new Sv(rv.comparator)}function BS(){return new Sv(rv.comparator)}var jS="RemoteStore",WS=(KS.prototype.start=function(){return this.enableNetwork()},KS.prototype.enableNetwork=function(){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(e=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return e.lastStreamToken=t.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(oS.Unknown),[4,this.fillWritePipeline()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},KS.prototype.disableNetwork=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(oS.Offline),[2]}})})},KS.prototype.disableNetworkInternal=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),0<this.writePipeline.length&&(zy(jS,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},KS.prototype.shutdown=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return zy(jS,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(oS.Unknown),[2]}})})},KS.prototype.listen=function(t){sg(this.listenTargets,t.targetId)||(this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t))},KS.prototype.unlisten=function(t){$y(sg(this.listenTargets,t),"unlisten called on target no currently watched: "+t),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),lg(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(oS.Unknown))},KS.prototype.getTargetDataForTarget=function(t){return this.listenTargets[t]||null},KS.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},KS.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},KS.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},KS.prototype.startWatchStream=function(){$y(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new US(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},KS.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!lg(this.listenTargets)},KS.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},KS.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},KS.prototype.onWatchStreamOpen=function(){return ya(this,void 0,void 0,function(){var n=this;return ga(this,function(t){return cg(this.listenTargets,function(t,e){n.sendWatchRequest(e)}),[2]})})},KS.prototype.onWatchStreamClose=function(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){return void 0===e&&$y(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(e),this.startWatchStream()):this.onlineStateTracker.set(oS.Unknown),[2]})})},KS.prototype.onWatchStreamChange=function(n,r){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return this.onlineStateTracker.set(oS.Online),n instanceof xS&&n.state===RS.Removed&&n.cause?[2,this.handleTargetError(n)]:(n instanceof PS?this.watchChangeAggregator.handleDocumentChange(n):n instanceof MS?this.watchChangeAggregator.handleExistenceFilter(n):($y(n instanceof xS,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(n)),r.isEqual(Tv.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return e=t.sent(),0<=r.compareTo(e)?[4,this.raiseWatchSnapshot(r)]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})},KS.prototype.raiseWatchSnapshot=function(r){var i=this;$y(!r.isEqual(Tv.MIN),"Can't raise event for unknown SnapshotVersion");var t=this.watchChangeAggregator.createRemoteEvent(r);return cg(t.targetChanges,function(t,e){if(0<e.resumeToken.length){var n=i.listenTargets[t];n&&(i.listenTargets[t]=n.withResumeToken(e.resumeToken,r))}}),t.targetMismatches.forEach(function(t){var e=i.listenTargets[t];if(e){i.listenTargets[t]=e.withResumeToken(eg(),e.snapshotVersion),i.sendUnwatchRequest(t);var n=new tT(e.target,t,z_.ExistenceFilterMismatch,e.sequenceNumber);i.sendWatchRequest(n)}}),this.syncEngine.applyRemoteEvent(t)},KS.prototype.handleTargetError=function(t){var n=this;$y(!!t.cause,"Handling target error without a cause");var r=t.cause,i=Promise.resolve();return t.targetIds.forEach(function(e){i=i.then(function(){return ya(n,void 0,void 0,function(){return ga(this,function(t){return sg(this.listenTargets,e)?(delete this.listenTargets[e],this.watchChangeAggregator.removeTarget(e),[2,this.syncEngine.rejectListen(e,r)]):[2]})})})}),i},KS.prototype.fillWritePipeline=function(){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return this.canAddToWritePipeline()?(e=0<this.writePipeline.length?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(e)]):[3,4];case 1:return null!==(n=t.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(n),[4,this.fillWritePipeline()];case 3:t.sent(),t.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},KS.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},KS.prototype.outstandingWrites=function(){return this.writePipeline.length},KS.prototype.addToWritePipeline=function(t){$y(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},KS.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&0<this.writePipeline.length},KS.prototype.startWriteStream=function(){$y(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},KS.prototype.onWriteStreamOpen=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){return this.writeStream.writeHandshake(),[2]})})},KS.prototype.onWriteHandshakeComplete=function(){var r=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var t=0,e=r.writePipeline;t<e.length;t++){var n=e[t];r.writeStream.writeMutations(n.mutations)}}).catch(ST)},KS.prototype.onMutationResult=function(t,e){var n=this;$y(0<this.writePipeline.length,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Yv.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},KS.prototype.onWriteStreamClose=function(n){return ya(this,void 0,void 0,function(){var e=this;return ga(this,function(t){return void 0===n&&$y(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),n&&0<this.writePipeline.length?[2,(this.writeStream.handshakeComplete?this.handleWriteError(n):this.handleHandshakeError(n)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]:[2]})})},KS.prototype.handleHandshakeError=function(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){return mS(e.code)?(zy(jS,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=eg(),[2,this.localStore.setLastStreamToken(eg()).catch(ST)]):[2]})})},KS.prototype.handleWriteError=function(r){return ya(this,void 0,void 0,function(){var e,n=this;return ga(this,function(t){return function(t){return mS(t)&&t!==rg.ABORTED}(r.code)?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,r).then(function(){return n.fillWritePipeline()})]):[2]})})},KS.prototype.createTransaction=function(){return new cS(this.datastore)},KS.prototype.restartNetwork=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(oS.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},KS.prototype.handleCredentialChange=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(zy(jS,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},KS.prototype.applyPrimaryState=function(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,4];case 2:return e?[3,4]:[4,this.disableNetworkInternal()];case 3:t.sent(),this.onlineStateTracker.set(oS.Unknown),t.label=4;case 4:return[2]}})})},KS);function KS(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return ya(o,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(zy(jS,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new pS(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}var QS=(Object.defineProperty(HS.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(HS.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),HS.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},HS.prototype._compareTo=function(t){return Pg(this._lat,t._lat)||Pg(this._long,t._long)},HS);function HS(t,e){if(pg("GeoPoint",arguments,2),yg("GeoPoint","number",1,t),yg("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new ig(rg.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new ig(rg.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}var GS=(zS.prototype.applyToLocalView=function(t,e){return new kw(e,t)},zS.prototype.applyToRemoteDocument=function(t,e){return e},zS.prototype.computeBaseValue=function(t){return null},zS.prototype.isEqual=function(t){return t instanceof zS},zS.instance=new zS,zS);function zS(){}var YS=(XS.prototype.applyToLocalView=function(t,e){return this.apply(t)},XS.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},XS.prototype.apply=function(t){for(var n=eI(t),e=function(e){n.find(function(t){return t.isEqual(e)})||n.push(e)},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Kw(n)},XS.prototype.computeBaseValue=function(t){return null},XS.prototype.isEqual=function(t){return t instanceof XS&&Mg(t.elements,this.elements)},XS);function XS(t){this.elements=t}var JS=($S.prototype.applyToLocalView=function(t,e){return this.apply(t)},$S.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},$S.prototype.apply=function(t){for(var n=eI(t),e=function(e){n=n.filter(function(t){return!t.isEqual(e)})},r=0,i=this.elements;r<i.length;r++)e(i[r]);return new Kw(n)},$S.prototype.computeBaseValue=function(t){return null},$S.prototype.isEqual=function(t){return t instanceof $S&&Mg(t.elements,this.elements)},$S);function $S(t){this.elements=t}var ZS=(tI.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof gw&&this.operand instanceof gw){var r=n.internalValue+this.operand.internalValue;return new gw(r)}return r=n.internalValue+this.operand.internalValue,new ww(r)},tI.prototype.applyToRemoteDocument=function(t,e){return $y(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},tI.prototype.computeBaseValue=function(t){return t instanceof pw?t:new gw(0)},tI.prototype.isEqual=function(t){return t instanceof tI&&this.operand.isEqual(t.operand)},tI);function tI(t){this.operand=t}function eI(t){return t instanceof Kw?t.internalValue.slice():[]}var nI=(rI.prototype.isEqual=function(t){return t&&t.count===this.count},rI);function rI(t){this.count=t}var iI,oI,aI=((iI={})[cE.ASCENDING.name]="ASCENDING",iI[cE.DESCENDING.name]="DESCENDING",iI),sI=((oI={})[WT.LESS_THAN.name]="LESS_THAN",oI[WT.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",oI[WT.GREATER_THAN.name]="GREATER_THAN",oI[WT.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",oI[WT.EQUAL.name]="EQUAL",oI[WT.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",oI[WT.IN.name]="IN",oI[WT.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",oI),uI=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function cI(t,e){$y(!MT(t),e+" is missing")}function hI(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Jy("can't parse "+t)}var lI=(fI.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},fI.prototype.unsafeCastProtoByteString=function(t){return t},fI.prototype.fromRpcStatus=function(t){var e=void 0===t.code?rg.UNKNOWN:yS(t.code);return new ig(e,t.message||"")},fI.prototype.toInt32Value=function(t){return this.options.useProto3Json||MT(t)?t:{value:t}},fI.prototype.fromInt32Value=function(t){var e;return MT(e="object"==typeof t?t.value:t)?null:e},fI.prototype.toTimestamp=function(t){return this.options.useProto3Json?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},fI.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);$y(!!t,"Cannot deserialize null or undefined timestamp.");var e=hI(t.seconds||"0"),n=t.nanos||0;return new wv(e,n)},fI.prototype.fromIso8601String=function(t){var e=0,n=uI.exec(t);if($y(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new wv(o,e)},fI.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},fI.prototype.fromBlob=function(t){return"string"==typeof t?($y(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ug.fromBase64String(t)):($y(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),Ug.fromUint8Array(t))},fI.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},fI.prototype.fromVersion=function(t){return $y(!!t,"Trying to deserialize version that isn't set"),Tv.fromTimestamp(this.fromTimestamp(t))},fI.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},fI.prototype.fromResourceName=function(t){var e=Jg.fromString(t);return $y(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},fI.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},fI.prototype.fromName=function(t){var e=this.fromResourceName(t);return $y(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),$y(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new rv(this.extractLocalPathFromResourceName(e))},fI.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},fI.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?Jg.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(fI.prototype,"encodedDatabaseId",{get:function(){return new Jg(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),fI.prototype.fullyQualifiedPrefixPath=function(t){return new Jg(["projects",t.projectId,"databases",t.database])},fI.prototype.extractLocalPathFromResourceName=function(t){return $y(4<t.length&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},fI.prototype.isValidResourceName=function(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)},fI.prototype.toValue=function(t){if(t instanceof sw)return{nullValue:"NULL_VALUE"};if(t instanceof hw)return{booleanValue:t.value()};if(t instanceof gw)return{integerValue:""+t.value()};if(t instanceof ww){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof Ew?{stringValue:t.value()}:t instanceof Bw?{mapValue:this.toMapValue(t)}:t instanceof Kw?{arrayValue:this.toArrayValue(t)}:t instanceof Cw?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Uw?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Ow?{bytesValue:this.toBytes(t.value())}:t instanceof xw?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Jy("Unknown FieldValue "+JSON.stringify(t))},fI.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return sw.INSTANCE;if("booleanValue"in t)return hw.of(t.booleanValue);if("integerValue"in t)return new gw(hI(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return ww.NAN;if("Infinity"===t.doubleValue)return ww.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return ww.NEGATIVE_INFINITY}return new ww(t.doubleValue)}if("stringValue"in t)return new Ew(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){cI(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Kw(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return cI(t.timestampValue,"timestampValue"),new Cw(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){cI(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Uw(new QS(r,i))}if("bytesValue"in t){cI(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Ow(o)}if("referenceValue"in t){cI(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new Wg(a.get(1),a.get(3)),u=new rv(this.extractLocalPathFromResourceName(a));return new xw(s,u)}return Jy("Unknown Value proto "+JSON.stringify(t))},fI.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},fI.prototype.toDocument=function(t){return $y(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},fI.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new Yw(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.fromValue(t)})},fI.prototype.toFields=function(t){var n=this,r={};return t.forEach(function(t,e){r[t]=n.toValue(e)}),r},fI.prototype.fromFields=function(t){var n=this,e=t,r=Bw.EMPTY;return hg(e,function(t,e){r=r.set(new ev([t]),n.fromValue(e))}),r},fI.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},fI.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},fI.prototype.fromFound=function(t){var e=this;$y(!!t.found,"Tried to deserialize a found document from a missing document."),cI(t.found.name,"doc.found.name"),cI(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new Yw(n,r,{},void 0,t.found,function(t){return e.fromValue(t)})},fI.prototype.fromMissing=function(t){$y(!!t.missing,"Tried to deserialize a missing document from a found document."),$y(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new $w(e,n)},fI.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Jy("invalid batch get response: "+JSON.stringify(t))},fI.prototype.toWatchTargetChangeState=function(t){switch(t){case RS.Added:return"ADD";case RS.Current:return"CURRENT";case RS.NoChange:return"NO_CHANGE";case RS.Removed:return"REMOVE";case RS.Reset:return"RESET";default:return Jy("Unknown WatchTargetChangeState: "+t)}},fI.prototype.toTestWatchChange=function(t){if(t instanceof MS)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof PS){if(t.newDoc instanceof Yw){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof $w)return e=t.newDoc,{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}};if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof xS){var n=void 0;return t.cause&&(n={code:function(t){if(void 0===t)return lS.OK;switch(t){case rg.OK:return lS.OK;case rg.CANCELLED:return lS.CANCELLED;case rg.UNKNOWN:return lS.UNKNOWN;case rg.DEADLINE_EXCEEDED:return lS.DEADLINE_EXCEEDED;case rg.RESOURCE_EXHAUSTED:return lS.RESOURCE_EXHAUSTED;case rg.INTERNAL:return lS.INTERNAL;case rg.UNAVAILABLE:return lS.UNAVAILABLE;case rg.UNAUTHENTICATED:return lS.UNAUTHENTICATED;case rg.INVALID_ARGUMENT:return lS.INVALID_ARGUMENT;case rg.NOT_FOUND:return lS.NOT_FOUND;case rg.ALREADY_EXISTS:return lS.ALREADY_EXISTS;case rg.PERMISSION_DENIED:return lS.PERMISSION_DENIED;case rg.FAILED_PRECONDITION:return lS.FAILED_PRECONDITION;case rg.ABORTED:return lS.ABORTED;case rg.OUT_OF_RANGE:return lS.OUT_OF_RANGE;case rg.UNIMPLEMENTED:return lS.UNIMPLEMENTED;case rg.DATA_LOSS:return lS.DATA_LOSS;default:return Jy("Unknown status code: "+t)}}(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Jy("Unrecognized watch change: "+JSON.stringify(t))},fI.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){cI(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new xS(r,i,o,s||null)}else if("documentChange"in t){cI(t.documentChange,"documentChange");var u=t.documentChange;cI(u.document,"documentChange.name"),cI(u.document.name,"documentChange.document.name"),cI(u.document.updateTime,"documentChange.document.updateTime");var c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new Yw(c,h,{},void 0,u.document,function(t){return n.fromValue(t)}),f=u.targetIds||[],p=u.removedTargetIds||[];e=new PS(f,p,l.key,l)}else if("documentDelete"in t){cI(t.documentDelete,"documentDelete");var d=t.documentDelete;cI(d.document,"documentDelete.document"),c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):Tv.forDeletedDoc(),l=new $w(c,h),p=d.removedTargetIds||[],e=new PS([],p,l.key,l)}else if("documentRemove"in t){cI(t.documentRemove,"documentRemove");var m=t.documentRemove;cI(m.document,"documentRemove"),c=this.fromName(m.document),p=m.removedTargetIds||[],e=new PS([],p,c,null)}else{if(!("filter"in t))return Jy("Unknown change type "+JSON.stringify(t));cI(t.filter,"filter");var y=t.filter;cI(y.targetId,"filter.targetId");var g=y.count||0,v=new nI(g),b=y.targetId;e=new MS(b,v)}return e},fI.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?RS.NoChange:"ADD"===t?RS.Added:"REMOVE"===t?RS.Removed:"CURRENT"===t?RS.Current:"RESET"===t?RS.Reset:Jy("Got unexpected TargetChange.state: "+t)},fI.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Tv.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Tv.MIN:e.readTime?this.fromVersion(e.readTime):Tv.MIN},fI.prototype.toMutation=function(t){var e,n=this;if(t instanceof Bb)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof tw)e={delete:this.toName(t.key)};else if(t instanceof Kb)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Gb))return Jy("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},fI.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):Lb.NONE;if(t.update){cI(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Kb(r,i,o,n)}return new Bb(r,i,n)}if(t.delete)return r=this.fromName(t.delete),new tw(r,n);if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return $y(!0===n.exists,'Transforms only support precondition "exists == true"'),new Gb(r,a)}return Jy("unknown mutation proto: "+JSON.stringify(t))},fI.prototype.toPrecondition=function(t){return $y(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Jy("Unknown precondition")},fI.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?Lb.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Lb.exists(t.exists):Lb.NONE},fI.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);r.isEqual(Tv.MIN)&&(r=this.fromVersion(e));var i=null;return t.transformResults&&0<t.transformResults.length&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new xb(r,i)},fI.prototype.fromWriteResults=function(t,e){var n=this;return t&&0<t.length?($y(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},fI.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof GS)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof YS)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof JS)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof ZS)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Jy("Unknown transform: "+t.transform)},fI.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)$y("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=GS.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new YS(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t)r=t.removeAllFromArray.values||[],n=new JS(r.map(function(t){return e.fromValue(t)}));else if("increment"in t){var i=this.fromValue(t.increment);$y(i instanceof pw,"NUMERIC_ADD transform requires a NumberValue"),n=new ZS(i)}else Jy("Unknown transform proto: "+JSON.stringify(t));var o=ev.fromServerFormat(t.fieldPath);return new Rb(o,n)},fI.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},fI.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;$y(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return qT.atPath(this.fromQueryPath(n)).toTarget()},fI.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?($y(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):($y(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},fI.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){$y(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new qT(e,i,s,a,u,LT.First,c,h).toTarget()},fI.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},fI.prototype.toLabel=function(t){switch(t){case z_.Listen:return null;case z_.ExistenceFilterMismatch:return"existence-filter-mismatch";case z_.LimboResolution:return"limbo-document";default:return Jy("Unrecognized query purpose: "+t)}},fI.prototype.toTarget=function(t){var e,n=t.target;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,0<t.resumeToken.length&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},fI.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof HT?e.toUnaryOrFieldFilter(t):Jy("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},fI.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Jy("Unknown filter: "+JSON.stringify(t)):[]},fI.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},fI.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},fI.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},fI.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new lE(r,n)},fI.prototype.toDirection=function(t){return aI[t.name]},fI.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return cE.ASCENDING;case"DESCENDING":return cE.DESCENDING;default:return}},fI.prototype.toOperatorName=function(t){return sI[t.name]},fI.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return WT.EQUAL;case"GREATER_THAN":return WT.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return WT.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return WT.LESS_THAN;case"LESS_THAN_OR_EQUAL":return WT.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return WT.ARRAY_CONTAINS;case"IN":return WT.IN;case"ARRAY_CONTAINS_ANY":return WT.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Jy("Unspecified operator");default:return Jy("Unknown operator")}},fI.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},fI.prototype.fromFieldPathReference=function(t){return ev.fromServerFormat(t.fieldPath)},fI.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},fI.prototype.fromPropertyOrder=function(t){return new pE(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},fI.prototype.fromFieldFilter=function(t){return HT.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},fI.prototype.toUnaryOrFieldFilter=function(t){if(t.op===WT.EQUAL){if(t.value.isEqual(ww.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(sw.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},fI.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return HT.create(e,WT.EQUAL,ww.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return HT.create(n,WT.EQUAL,sw.INSTANCE);case"OPERATOR_UNSPECIFIED":return Jy("Unspecified filter");default:return Jy("Unknown filter")}},fI.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},fI.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return ev.fromServerFormat(t)});return kb.fromArray(e)},fI);function fI(t,e){this.databaseId=t,this.options=e}var pI=function(){this.viewSnap=null,this.targetId=0,this.listeners=[]},dI=(mI.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);return r||(n=!0,r=new pI,this.queries.set(e,r)),r.listeners.push(t),$y(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),!r.viewSnap||t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent(),n?this.syncEngine.listen(e).then(function(t){return r.targetId=t}):Promise.resolve(r.targetId)},mI.prototype.unlisten=function(o){return ya(this,void 0,void 0,function(){var e,n,r,i;return ga(this,function(t){return e=o.query,n=!1,(r=this.queries.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},mI.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++)u[s].onViewSnapshot(i)&&(e=!0);a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},mI.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.queries.delete(t)},mI.prototype.onOnlineStateChange=function(i){this.onlineState=i;var o=!1;this.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].applyOnlineStateChange(i)&&(o=!0)}),o&&this.raiseSnapshotsInSyncEvent()},mI.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},mI.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},mI.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(t){t.next()})},mI);function mI(t){this.syncEngine=t,this.queries=new r_(function(t){return t.canonicalId()}),this.onlineState=oS.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}var yI=(gI.prototype.onViewSnapshot=function(t){if($y(0<t.docChanges.length||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==gS.Metadata&&e.push(i)}t=new IS(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},gI.prototype.onError=function(t){this.queryObserver.error(t)},gI.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},gI.prototype.shouldRaiseInitialEvent=function(t,e){if($y(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==oS.Offline;return this.options.waitForSyncWhenOnline&&n?($y(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===oS.Offline},gI.prototype.shouldRaiseEvent=function(t){if(0<t.docChanges.length)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},gI.prototype.raiseInitialEvent=function(t){$y(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=IS.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},gI);function gI(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=oS.Unknown,this.options=n||{}}var vI=(bI.fromSnapshot=function(t,e){for(var n=Kv(),r=Kv(),i=0,o=e.docChanges;i<o.length;i++){var a=o[i];switch(a.type){case gS.Added:n=n.add(a.doc.key);break;case gS.Removed:r=r.add(a.doc.key)}}return new bI(t,e.fromCache,n,r)},bI);function bI(t,e,n,r){this.targetId=t,this.fromCache=e,this.addedKeys=n,this.removedKeys=r}var wI=function(t){this.key=t},_I=function(t){this.key=t},TI=(Object.defineProperty(EI.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),EI.prototype.computeDocChanges=function(t,e){var s=this,u=e?e.changeSet:new ES,c=e?e.documentSet:this.documentSet,h=e?e.mutatedKeys:this.mutatedKeys,l=c,f=!1,p=this.query.hasLimitToFirst()&&c.size===this.query.limit?c.last():null,d=this.query.hasLimitToLast()&&c.size===this.query.limit?c.first():null;if(t.inorderTraversal(function(t,e){var n=c.get(t),r=e instanceof Yw?e:null;r&&($y(t.isEqual(r.key),"Mismatching keys found in document changes: "+t+" != "+r.key),r=s.query.matches(r)?r:null);var i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),a=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(u.track({type:gS.Metadata,doc:r}),a=!0):s.shouldWaitForSyncedDocument(n,r)||(u.track({type:gS.Modified,doc:r}),a=!0,(p&&0<s.query.docComparator(r,p)||d&&s.query.docComparator(r,d)<0)&&(f=!0)):!n&&r?(u.track({type:gS.Added,doc:r}),a=!0):n&&!r&&(u.track({type:gS.Removed,doc:n}),a=!0,(p||d)&&(f=!0)),a&&(h=r?(l=l.add(r),o?h.add(t):h.delete(t)):(l=l.delete(t),h.delete(t)))}),this.query.hasLimitToFirst()||this.query.hasLimitToLast())for(;l.size>this.query.limit;){var n=this.query.hasLimitToFirst()?l.last():l.first();l=l.delete(n.key),h=h.delete(n.key),u.track({type:gS.Removed,doc:n})}return $y(!f||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:l,changeSet:u,needsRefill:f,mutatedKeys:h}},EI.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},EI.prototype.applyChanges=function(t,e,n){var r=this;$y(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){function n(t){switch(t){case gS.Added:return 1;case gS.Modified:case gS.Metadata:return 2;case gS.Removed:return 0;default:return Jy("Unknown ChangeType: "+t)}}return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?bS.Synced:bS.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new IS(this.query,t.documentSet,i,o,t.mutatedKeys,s===bS.Local,u,!1),limboChanges:a}:{limboChanges:a}},EI.prototype.applyOnlineStateChange=function(t){return this.current&&t===oS.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new ES,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},EI.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations},EI.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return $y(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},EI.prototype.updateLimboDocuments=function(){var e=this;if(!this.current)return[];var n=this.limboDocuments;this.limboDocuments=Kv(),this.documentSet.forEach(function(t){e.shouldBeInLimbo(t.key)&&(e.limboDocuments=e.limboDocuments.add(t.key))});var r=[];return n.forEach(function(t){e.limboDocuments.has(t)||r.push(new _I(t))}),this.limboDocuments.forEach(function(t){n.has(t)||r.push(new wI(t))}),r},EI.prototype.synchronizeWithPersistedState=function(t){this._syncedDocuments=t.remoteKeys,this.limboDocuments=Kv();var e=this.computeDocChanges(t.documents);return this.applyChanges(e,!0)},EI.prototype.computeInitialSnapshot=function(){return IS.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===bS.Local)},EI);function EI(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Kv(),this.mutatedKeys=Kv(),this.documentSet=new _S(t.docComparator.bind(t))}var SI=(II.prototype.run=function(){this.runWithBackOff()},II.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return ya(t,void 0,void 0,function(){var e,n,r=this;return ga(this,function(t){return e=this.remoteStore.createTransaction(),(n=this.tryRunUpdateFunction(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.handleTransactionError(t)})})}).catch(function(t){r.handleTransactionError(t)}),[2]})})})},II.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!MT(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},II.prototype.handleTransactionError=function(t){var e=this;0<this.retries&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},II.prototype.isRetryableTransactionError=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!mS(e)},II);function II(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=5,this.backoff=new KE(this.asyncQueue,ov.RetryTransaction)}var CI="SyncEngine",NI=function(t,e,n){this.query=t,this.targetId=e,this.view=n},AI=function(t){this.key=t,this.receivedDocument=!1},kI=(Object.defineProperty(DI.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),DI.prototype.subscribe=function(t){$y(null!==t,"SyncEngine listener cannot be null"),$y(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},DI.prototype.listen=function(a){return ya(this,void 0,void 0,function(){var e,n,r,i,o;return ga(this,function(t){switch(t.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(a))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateTarget(a.toTarget())];case 2:return i=t.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(a,e,"current"===o)];case 3:n=t.sent(),this.isPrimary&&this.remoteStore.listen(i),t.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},DI.prototype.initializeViewAndComputeSnapshot=function(s,u,c){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a;return ga(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(s,!0)];case 1:return e=t.sent(),n=new TI(s,e.remoteKeys),r=n.computeDocChanges(e.documents),i=kS.createSynthesizedTargetChangeForCurrentChange(u,c&&this.onlineState!==oS.Offline),$y(0===(o=n.applyChanges(r,!0===this.isPrimary,i)).limboChanges.length,"View returned limbo docs before target ack from the server."),$y(!!o.snapshot,"applyChanges for new view should always return a snapshot"),a=new NI(s,u,n),this.queryViewsByQuery.set(s,a),this.queriesByTarget[u]||(this.queriesByTarget[u]=[]),this.queriesByTarget[u].push(s),[2,o.snapshot]}})})},DI.prototype.synchronizeViewAndComputeSnapshot=function(r){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(r.query,!0)];case 1:return e=t.sent(),n=r.view.synchronizeWithPersistedState(e),this.isPrimary&&this.updateTrackedLimbos(r.targetId,n.limboChanges),[2,n]}})})},DI.prototype.unlisten=function(i){return ya(this,void 0,void 0,function(){var e,n,r=this;return ga(this,function(t){switch(t.label){case 0:return this.assertSubscribed("unlisten()"),$y(!!(e=this.queryViewsByQuery.get(i)),"Trying to unlisten on query not found:"+i),1<(n=this.queriesByTarget[e.targetId]).length?(this.queriesByTarget[e.targetId]=n.filter(function(t){return!t.isEqual(i)}),this.queryViewsByQuery.delete(i),[2]):this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseTarget(e.targetId,!1).then(function(){r.sharedClientState.clearQueryState(e.targetId),r.remoteStore.unlisten(e.targetId),r.removeAndCleanupTarget(e.targetId)}).catch(ST)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupTarget(e.targetId),[4,this.localStore.releaseTarget(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},DI.prototype.write=function(n,r){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(n)];case 1:return e=t.sent(),this.sharedClientState.addPendingMutation(e.batchId),this.addMutationCallback(e.batchId,r),[4,this.emitNewSnapsAndNotifyLocalStore(e.changes)];case 2:return t.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return t.sent(),[2]}})})},DI.prototype.runTransaction=function(t,e,n){new SI(t,this.remoteStore,e,n).run()},DI.prototype.applyRemoteEvent=function(n){return ya(this,void 0,void 0,function(){var e,r=this;return ga(this,function(t){switch(t.label){case 0:this.assertSubscribed("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(n)];case 2:return e=t.sent(),hg(n.targetChanges,function(t,e){var n=r.limboResolutionsByTarget[Number(t)];n&&($y(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),0<e.addedDocuments.size?n.receivedDocument=!0:0<e.modifiedDocuments.size?$y(n.receivedDocument,"Received change for limbo target document without add."):0<e.removedDocuments.size&&($y(n.receivedDocument,"Received remove for limbo target document without add."),n.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,ST(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},DI.prototype.applyOnlineStateChange=function(r,t){if(this.isPrimary&&t===sS.RemoteStore||!this.isPrimary&&t===sS.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var i=[];this.queryViewsByQuery.forEach(function(t,e){var n=e.view.applyOnlineStateChange(r);$y(0===n.limboChanges.length,"OnlineState should not affect limbo documents."),n.snapshot&&i.push(n.snapshot)}),this.syncEngineListener.onOnlineStateChange(r),this.syncEngineListener.onWatchChange(i),this.onlineState=r,this.isPrimary&&this.sharedClientState.setOnlineState(r)}},DI.prototype.rejectListen=function(s,u){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a=this;return ga(this,function(t){switch(t.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(s,"rejected",u),e=this.limboResolutionsByTarget[s],(n=e&&e.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(n),delete this.limboResolutionsByTarget[s],r=(r=new Sv(rv.comparator)).insert(n,new $w(n,Tv.forDeletedDoc())),i=Kv().add(n),o=new NS(Tv.MIN,{},new Ov(Pg),r,i),[2,this.applyRemoteEvent(o)]):[3,1];case 1:return[4,this.localStore.releaseTarget(s,!1).then(function(){return a.removeAndCleanupTarget(s,u)}).catch(ST)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},DI.prototype.applyBatchState=function(n,r,i){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(n)];case 1:return null===(e=t.sent())?(zy(CI,"Cannot apply mutation batch with id: "+n),[2]):"pending"!==r?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.processUserCallback(n,i||null),this.localStore.removeCachedMutationBatchMetadata(n)):Jy("Unknown batchState: "+r),t.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 5:return t.sent(),[2]}})})},DI.prototype.applySuccessfulWrite=function(r){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=r.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(r)];case 2:return n=t.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return t.sent(),[3,6];case 4:return[4,ST(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},DI.prototype.rejectFailedWrite=function(n,r){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(n,r),this.triggerPendingWritesCallbacks(n),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(n)];case 2:return e=t.sent(),this.sharedClientState.updateMutationState(n,"rejected",r),[4,this.emitNewSnapsAndNotifyLocalStore(e)];case 3:return t.sent(),[3,6];case 4:return[4,ST(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},DI.prototype.registerPendingWritesCallback=function(r){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return this.remoteStore.canUseNetwork()||zy(CI,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=t.sent())?r.resolve():((n=this.pendingWritesCallbacks.get(e)||[]).push(r),this.pendingWritesCallbacks.set(e,n)),[2]}})})},DI.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},DI.prototype.rejectOutstandingPendingWritesCallbacks=function(e){this.pendingWritesCallbacks.forEach(function(t){t.forEach(function(t){t.reject(new ig(rg.CANCELLED,e))})}),this.pendingWritesCallbacks.clear()},DI.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n=(n=n||new Sv(Pg)).insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},DI.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&($y(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},DI.prototype.removeAndCleanupTarget=function(t,e){var n=this;void 0===e&&(e=null),this.sharedClientState.removeLocalQueryTarget(t),$y(this.queriesByTarget[t]&&0!==this.queriesByTarget[t].length,"There are no queries mapped to target id "+t);for(var r=0,i=this.queriesByTarget[t];r<i.length;r++){var o=i[r];this.queryViewsByQuery.delete(o),e&&this.syncEngineListener.onWatchError(o,e)}if(delete this.queriesByTarget[t],this.isPrimary){var a=this.limboDocumentRefs.referencesForId(t);this.limboDocumentRefs.removeReferencesForId(t),a.forEach(function(t){n.limboDocumentRefs.containsKey(t)||n.removeLimboTarget(t)})}},DI.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},DI.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof wI?(this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i)):i instanceof _I?(zy(CI,"Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)):Jy("Unknown limbo change: "+JSON.stringify(i))}},DI.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){zy(CI,"New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=qT.atPath(e.path);this.limboResolutionsByTarget[n]=new AI(e),this.remoteStore.listen(new tT(r.toTarget(),n,z_.LimboResolution,Qg.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},DI.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},DI.prototype.emitNewSnapsAndNotifyLocalStore=function(r,u){return ya(this,void 0,void 0,function(){var o,a,e,s=this;return ga(this,function(t){switch(t.label){case 0:return o=[],a=[],e=[],this.queryViewsByQuery.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.computeDocChanges(r);return n.needsRefill?s.localStore.executeQuery(i.query,!1).then(function(t){var e=t.documents;return i.view.computeDocChanges(e,n)}):n}).then(function(t){var e=u&&u.targetChanges[i.targetId],n=i.view.applyChanges(t,!0===s.isPrimary,e);if(s.updateTrackedLimbos(i.targetId,n.limboChanges),n.snapshot){s.isPrimary&&s.sharedClientState.updateQueryState(i.targetId,n.snapshot.fromCache?"not-current":"current"),o.push(n.snapshot);var r=vI.fromSnapshot(i.targetId,n.snapshot);a.push(r)}}))}),[4,Promise.all(e)];case 1:return t.sent(),this.syncEngineListener.onWatchChange(o),[4,this.localStore.notifyLocalViewChanges(a)];case 2:return t.sent(),[2]}})})},DI.prototype.assertSubscribed=function(t){$y(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},DI.prototype.handleCredentialChange=function(r){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return e=!this.currentUser.isEqual(r),this.currentUser=r,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(r)]):[3,3];case 1:return n=t.sent(),this.sharedClientState.handleUserChange(r,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:t.sent(),t.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return t.sent(),[2]}})})},DI.prototype.applyPrimaryState=function(c){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return ga(this,function(t){switch(t.label){case 0:return!0!==c||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return t.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==c||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),cg(this.queriesByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.removeAndCleanupTarget(t),u.localStore.releaseTarget(t,!0)}),u.remoteStore.unlisten(t)}),[4,s]);case 4:return t.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return t.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},DI.prototype.resetLimboDocuments=function(){var e=this;cg(this.limboResolutionsByTarget,function(t){e.remoteStore.unlisten(t)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new Sv(rv.comparator)},DI.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(d){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p;return ga(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queriesByTarget[o])&&0!==s.length?[4,this.localStore.releaseTarget(o,!0)]:[3,8]):[3,14];case 2:return t.sent(),[4,this.localStore.allocateTarget(s[0].toTarget())];case 3:a=t.sent(),u=0,c=s,t.label=4;case 4:return u<c.length?(h=c[u],$y(!!(l=this.queryViewsByQuery.get(h)),"No query view found for "+h),[4,this.synchronizeViewAndComputeSnapshot(l)]):[3,7];case 5:(f=t.sent()).snapshot&&n.push(f.snapshot),t.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return $y(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.localStore.getTarget(o)];case 9:return $y(!!(p=t.sent()),"Target for id "+o+" not found"),[4,this.localStore.allocateTarget(p)];case 10:return a=t.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(p),o,!1)];case 11:t.sent(),t.label=12;case 12:e.push(a),t.label=13;case 13:return r++,[3,1];case 14:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},DI.prototype.synthesizeTargetToQuery=function(t){return new qT(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,LT.First,t.startAt,t.endAt)},DI.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},DI.prototype.applyTargetState=function(r,i,o){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:if(this.isPrimary)return zy(CI,"Ignoring unexpected query state notification."),[2];if(!this.queriesByTarget[r])return[3,7];switch(i){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.localStore.getNewDocumentChanges()];case 2:return e=t.sent(),n=NS.createSynthesizedRemoteEventForCurrentChange(r,"current"===i),[4,this.emitNewSnapsAndNotifyLocalStore(e,n)];case 3:return t.sent(),[3,7];case 4:return[4,this.localStore.releaseTarget(r,!0)];case 5:return t.sent(),this.removeAndCleanupTarget(r,o),[3,7];case 6:Jy("Unexpected target state: "+i),t.label=7;case 7:return[2]}})})},DI.prototype.applyActiveTargetsChange=function(l,f){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h=this;return ga(this,function(t){switch(t.label){case 0:if(!this.isPrimary)return[2];e=0,n=l,t.label=1;case 1:return e<n.length?(c=n[e],$y(!this.queriesByTarget[c],"Trying to add an already active target"),[4,this.localStore.getTarget(c)]):[3,6];case 2:return $y(!!(r=t.sent()),"Query data for active target "+c+" not found"),[4,this.localStore.allocateTarget(r)];case 3:return i=t.sent(),[4,this.initializeViewAndComputeSnapshot(this.synthesizeTargetToQuery(r),i.targetId,!1)];case 4:t.sent(),this.remoteStore.listen(i),t.label=5;case 5:return e++,[3,1];case 6:o=function(e){return ga(this,function(t){switch(t.label){case 0:return a.queriesByTarget[e]?[4,a.localStore.releaseTarget(e,!1).then(function(){h.remoteStore.unlisten(e),h.removeAndCleanupTarget(e)}).catch(ST)]:[2,"continue"];case 1:return t.sent(),[2]}})},a=this,s=0,u=f,t.label=7;case 7:return s<u.length?(c=u[s],[5,o(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return s++,[3,7];case 10:return[2]}})})},DI.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},DI.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},DI.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];if(e&&e.receivedDocument)return Kv().add(e.key);var n=Kv(),r=this.queriesByTarget[t];if(!r)return n;for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.queryViewsByQuery.get(a);$y(!!s,"No query view found for "+a),n=n.unionWith(s.view.syncedDocuments)}return n},DI);function DI(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new r_(function(t){return t.canonicalId()}),this.queriesByTarget={},this.limboTargetsByKey=new Sv(rv.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new _E,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=_b.forSyncEngine(),this.isPrimary=void 0,this.onlineState=oS.Unknown}var RI=(OI.prototype.isAuthenticated=function(){return null!=this.uid},OI.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},OI.prototype.isEqual=function(t){return t.uid===this.uid},OI.UNAUTHENTICATED=new OI(null),OI.GOOGLE_CREDENTIALS=new OI("google-credentials-uid"),OI.FIRST_PARTY=new OI("first-party-uid"),OI);function OI(t){this.uid=t}var PI="firestore_clients";function MI(t,e){return $y(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),PI+"_"+t+"_"+e}var xI="firestore_mutations";function LI(t,e,n){var r=xI+"_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}var FI="firestore_targets";function UI(t,e){return FI+"_"+t+"_"+e}var VI="firestore_online_state";var qI="firestore_sequence_number";var BI="SharedClientState",jI=(WI.fromWebStorageEntry=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new ig(r.error.code,r.error.message)),i?new WI(t,e,r.state,o):(Yy(BI,"Failed to parse mutation state for ID '"+e+"': "+n),null)},WI.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},WI);function WI(t,e,n,r){this.user=t,this.batchId=e,this.state=n,$y(void 0!==(this.error=r)==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}var KI=(QI.fromWebStorageEntry=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new ig(n.error.code,n.error.message)),r?new QI(t,n.state,i):(Yy(BI,"Failed to parse target state for ID '"+t+"': "+e),null)},QI.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},QI);function QI(t,e,n){this.targetId=t,this.state=e,$y(void 0!==(this.error=n)==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}var HI=(GI.fromWebStorageEntry=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Hv(),o=0;r&&o<n.activeTargetIds.length;++o)r=xT(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new GI(t,i):(Yy(BI,"Failed to parse client data for instance '"+t+"': "+e),null)},GI);function GI(t,e){this.clientId=t,this.activeTargetIds=e}var zI=(YI.fromWebStorageEntry=function(t){var e=JSON.parse(t);return"object"==typeof e&&e.onlineState in oS&&"string"==typeof e.clientId?new YI(e.clientId,oS[e.onlineState]):(Yy(BI,"Failed to parse online state: "+t),null)},YI);function YI(t,e){this.clientId=t,this.onlineState=e}var XI=(JI.prototype.addQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},JI.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},JI.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},JI);function JI(){this.activeTargetIds=Hv()}var $I=(ZI.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},ZI.prototype.start=function(){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f=this;return ga(this,function(t){switch(t.label){case 0:return $y(!this.started,"WebStorageSharedClientState already started"),$y(null!==this.syncEngine,"syncEngine property must be set before calling start()"),$y(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.localClientId&&(o=this.getItem(MI(this.persistenceKey,i)))&&(a=HI.fromWebStorageEntry(i,o))&&(this.activeClients[a.clientId]=a);for(this.persistClientState(),(s=this.storage.getItem(this.onlineStateKey))&&(u=this.fromWebStorageOnlineState(s))&&this.handleOnlineStateEvent(u),c=0,h=this.earlyEvents;c<h.length;c++)l=h[c],this.handleWebStorageEvent(l);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return f.shutdown()}),this.started=!0,[2]}})})},ZI.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},ZI.prototype.getAllActiveQueryTargets=function(){var n=Hv();return hg(this.activeClients,function(t,e){n=n.unionWith(e.activeTargetIds)}),n},ZI.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},ZI.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},ZI.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},ZI.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(UI(this.persistenceKey,t));if(n){var r=KI.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},ZI.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},ZI.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},ZI.prototype.clearQueryState=function(t){this.removeItem(UI(this.persistenceKey,t))},ZI.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},ZI.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},ZI.prototype.setOnlineState=function(t){this.persistOnlineState(t)},ZI.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},ZI.prototype.getItem=function(t){var e=this.storage.getItem(t);return zy(BI,"READ",t,e),e},ZI.prototype.setItem=function(t,e){zy(BI,"SET",t,e),this.storage.setItem(t,e)},ZI.prototype.removeItem=function(t){zy(BI,"REMOVE",t),this.storage.removeItem(t)},ZI.prototype.handleWebStorageEvent=function(s){var t=this;if(s.storageArea===this.storage){if(zy(BI,"EVENT",s.key,s.newValue),s.key===this.localClientStorageKey)return void Yy("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return ya(t,void 0,void 0,function(){var e,n,r,i,o,a;return ga(this,function(t){if(!this.started)return this.earlyEvents.push(s),[2];if(null===s.key)return[2];if(this.clientStateKeyRe.test(s.key)){if(null==s.newValue)return n=this.fromWebStorageClientStateKey(s.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(s.key,s.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(s.key)){if(null!==s.newValue&&(r=this.fromWebStorageMutationMetadata(s.key,s.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(s.key)){if(null!==s.newValue&&(i=this.fromWebStorageQueryTargetMetadata(s.key,s.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(s.key===this.onlineStateKey){if(null!==s.newValue&&(o=this.fromWebStorageOnlineState(s.newValue)))return[2,this.handleOnlineStateEvent(o)]}else s.key===this.sequenceNumberKey&&($y(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=Qg.INVALID;if(null!=t)try{var n=JSON.parse(t);$y("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Yy(BI,"Failed to read sequence number from WebStorage",t)}return e}(s.newValue))!==Qg.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(ZI.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),ZI.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},ZI.prototype.persistMutationState=function(t,e,n){var r=new jI(this.currentUser,t,e,n),i=LI(this.persistenceKey,this.currentUser,t);this.setItem(i,r.toWebStorageJSON())},ZI.prototype.removeMutationState=function(t){var e=LI(this.persistenceKey,this.currentUser,t);this.removeItem(e)},ZI.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:oS[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},ZI.prototype.persistQueryTargetState=function(t,e,n){var r=UI(this.persistenceKey,t),i=new KI(t,e,n);this.setItem(r,i.toWebStorageJSON())},ZI.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},ZI.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return $y(null!==n,"Cannot parse client state key '"+t+"'"),HI.fromWebStorageEntry(n,e)},ZI.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);$y(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return jI.fromWebStorageEntry(new RI(i),r,e)},ZI.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);$y(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return KI.fromWebStorageEntry(r,e)},ZI.prototype.fromWebStorageOnlineState=function(t){return zI.fromWebStorageEntry(t)},ZI.prototype.handleMutationBatchEvent=function(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){return e.user.uid!==this.currentUser.uid?(zy(BI,"Ignoring mutation for non-active user "+e.user.uid),[2]):[2,this.syncEngine.applyBatchState(e.batchId,e.state,e.error)]})})},ZI.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},ZI.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(e){return ya(n,void 0,void 0,function(){return ga(this,function(t){return r.has(e)||o.push(e),[2]})})}),r.forEach(function(e){return ya(n,void 0,void 0,function(){return ga(this,function(t){return i.has(e)||a.push(e),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},ZI.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},ZI);function ZI(t,e,n,r,i){if(this.queue=t,this.platform=e,this.persistenceKey=n,this.localClientId=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!ZI.isAvailable(this.platform))throw new ig(rg.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.localClientStorageKey=MI(this.persistenceKey,this.localClientId),this.sequenceNumberKey=function(t){return qI+"_"+t}(this.persistenceKey),this.activeClients[this.localClientId]=new XI,this.clientStateKeyRe=new RegExp("^"+PI+"_"+o+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+xI+"_"+o+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+FI+"_"+o+"_(\\d+)$"),this.onlineStateKey=function(t){return VI+"_"+t}(this.persistenceKey),this.platform.window.addEventListener("storage",this.storageListener)}var tC=(eC.prototype.addPendingMutation=function(t){},eC.prototype.updateMutationState=function(t,e,n){},eC.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},eC.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},eC.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},eC.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},eC.prototype.clearQueryState=function(t){delete this.queryState[t]},eC.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},eC.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},eC.prototype.start=function(){return this.localState=new XI,Promise.resolve()},eC.prototype.handleUserChange=function(t,e,n){},eC.prototype.setOnlineState=function(t){},eC.prototype.shutdown=function(){},eC.prototype.writeSequenceNumber=function(t){},eC);function eC(){this.localState=new XI,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}var nC="FirestoreClient",rC=(iC.prototype.lruParams=function(){return uT.withCacheSize(this.cacheSizeBytes)},iC);function iC(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}var oC=function(){},aC=(sC.prototype.start=function(t){var n=this;this.verifyNotTerminated();var r=new sv,i=new sv,o=!1;return this.credentials.setChangeListener(function(e){o?n.asyncQueue.enqueueAndForget(function(){return n.handleCredentialChange(e)}):(o=!0,n.initializePersistence(t,i,e).then(function(t){return n.initializeRest(e,t)}).then(r.resolve,r.reject))}),this.asyncQueue.enqueueAndForget(function(){return r.promise}),i.promise},sC.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},sC.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof rC?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},sC.prototype.canFallback=function(t){return t instanceof ig?t.code===rg.FAILED_PRECONDITION||t.code===rg.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},sC.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new ig(rg.FAILED_PRECONDITION,"The client has already been terminated.")},sC.prototype.startIndexedDbPersistence=function(r,i){var t=this,o=TT.buildStoragePrefix(this.databaseInfo),a=new lI(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return ya(t,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:if(i.synchronizeTabs&&!$I.isAvailable(this.platform))throw new ig(rg.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return e=i.lruParams(),this.sharedClientState=i.synchronizeTabs?new $I(this.asyncQueue,this.platform,o,this.clientId,r):new tC,[4,TT.createIndexedDbPersistence({allowTabSynchronization:i.synchronizeTabs,persistenceKey:o,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:a,lruParams:e,sequenceNumberSyncer:this.sharedClientState})];case 1:return n=t.sent(),[2,(this.persistence=n).referenceDelegate.garbageCollector]}})})})},sC.prototype.startMemoryPersistence=function(){return this.persistence=xE.createEagerPersistence(this.clientId),this.sharedClientState=new tC,Promise.resolve(null)},sC.prototype.initializeRest=function(c,h){var t=this;return zy(nC,"Initializing. user=",c.uid),this.platform.loadConnection(this.databaseInfo).then(function(u){return ya(t,void 0,void 0,function(){var e,n,r,i,o,a,s=this;return ga(this,function(t){switch(t.label){case 0:return e=new gE,this.localStore=new IE(this.persistence,e,c),[4,this.localStore.start()];case 1:return t.sent(),h&&(this.lruScheduler=new hT(h,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),r=this.platform.newSerializer(this.databaseInfo.databaseId),i=new rS(this.asyncQueue,u,this.credentials,r),o=function(t){return s.syncEngine.applyOnlineStateChange(t,sS.RemoteStore)},a=function(t){return s.syncEngine.applyOnlineStateChange(t,sS.SharedClientState)},this.remoteStore=new WS(this.localStore,i,this.asyncQueue,o,n),this.syncEngine=new kI(this.localStore,this.remoteStore,this.sharedClientState,c),this.sharedClientState.onlineStateHandler=a,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new dI(this.syncEngine),[4,this.sharedClientState.start()];case 2:return t.sent(),[4,this.remoteStore.start()];case 3:return t.sent(),[4,this.persistence.setPrimaryStateListener(function(e){return ya(s,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.applyPrimaryState(e)];case 1:return t.sent(),this.lruScheduler&&(e&&!this.lruScheduler.started?this.lruScheduler.start():e||this.lruScheduler.stop()),[2]}})})})];case 4:return t.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return ya(s,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 5:return t.sent(),[2]}})})})},sC.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),zy(nC,"Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},sC.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},sC.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return ya(t,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},sC.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new sv;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},sC.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new yI(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},sC.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},sC.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Yw)return t;if(t instanceof $w)return null;throw new ig(rg.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},sC.prototype.getDocumentsFromLocalCache=function(i){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return ya(t,void 0,void 0,function(){var e,n,r;return ga(this,function(t){switch(t.label){case 0:return[4,this.localStore.executeQuery(i,!0)];case 1:return e=t.sent(),n=new TI(i,e.remoteKeys),r=n.computeDocChanges(e.documents),[2,n.applyChanges(r,!1).snapshot]}})})})},sC.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new sv;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},sC.prototype.databaseId=function(){return this.databaseInfo.databaseId},sC.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()})},sC.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(sC.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),sC.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new sv;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},sC);function sC(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=Rg.newId()}var uC=(cC.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},cC.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},cC.prototype.mute=function(){this.muted=!0},cC.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},cC);function cC(t){this.observer=t,this.muted=!1}var hC=(lC.documentId=function(){return lC._DOCUMENT_ID},lC.prototype.isEqual=function(t){if(!(t instanceof lC))throw Ng("isEqual","FieldPath",1,t);return this._internalPath.isEqual(t._internalPath)},lC._DOCUMENT_ID=new lC(ev.keyField().canonicalString()),lC);function lC(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+Dg(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(yg("FieldPath","string",n,t[n]),0===t[n].length)throw new ig(rg.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ev(t)}var fC=new RegExp("[~\\*/\\[\\]]");var pC=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},dC=(mC.prototype.getToken=function(){return Promise.resolve(null)},mC.prototype.invalidateToken=function(){},mC.prototype.setChangeListener=function(t){$y(!this.changeListener,"Can only call setChangeListener() once."),(this.changeListener=t)(RI.UNAUTHENTICATED)},mC.prototype.removeChangeListener=function(){$y(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},mC);function mC(){this.changeListener=null}var yC=(gC.prototype.getToken=function(){var e=this;$y(null!=this.tokenListener,"getToken cannot be called after listener removed.");var n=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){if(e.tokenCounter!==n)throw new ig(rg.ABORTED,"getToken aborted due to token change.");return t?($y("string"==typeof t.accessToken,"Invalid tokenData returned from getToken():"+t),new pC(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},gC.prototype.invalidateToken=function(){this.forceRefresh=!0},gC.prototype.setChangeListener=function(t){$y(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},gC.prototype.removeChangeListener=function(){$y(null!=this.tokenListener,"removeChangeListener() called twice"),$y(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},gC.prototype.getUser=function(){var t=this.auth&&this.auth.getUid();return $y(null===t||"string"==typeof t,"Received invalid UID: "+t),new RI(t)},gC);function gC(t){var e=this;this.tokenListener=null,this.currentUser=RI.UNAUTHENTICATED,this.receivedInitialUser=!1,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.tokenCounter=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.tokenListener):(this.tokenListener(null),t.get().then(function(t){e.auth=t,e.tokenListener&&e.auth.addAuthTokenListener(e.tokenListener)},function(){}))}var vC=(Object.defineProperty(bC.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),bC);function bC(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=RI.FIRST_PARTY}var wC=(_C.prototype.getToken=function(){return Promise.resolve(new vC(this.gapi,this.sessionIndex))},_C.prototype.setChangeListener=function(t){t(RI.FIRST_PARTY)},_C.prototype.removeChangeListener=function(){},_C.prototype.invalidateToken=function(){},_C);function _C(t,e){this.gapi=t,this.sessionIndex=e}function TC(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var EC=(SC.delete=function(){return fg("FieldValue.delete",arguments),CC.instance},SC.serverTimestamp=function(){return fg("FieldValue.serverTimestamp",arguments),kC.instance},SC.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return dg("FieldValue.arrayUnion",arguments,1),new OC(t)},SC.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return dg("FieldValue.arrayRemove",arguments,1),new xC(t)},SC.increment=function(t){return yg("FieldValue.increment","number",1,t),pg("FieldValue.increment",arguments,1),new UC(t)},SC.prototype.isEqual=function(t){return this===t},SC);function SC(t){this._methodName=t}var IC,CC=(da(NC,IC=EC),NC.instance=new NC,NC);function NC(){return IC.call(this,"FieldValue.delete")||this}var AC,kC=(da(DC,AC=EC),DC.instance=new DC,DC);function DC(){return AC.call(this,"FieldValue.serverTimestamp")||this}var RC,OC=(da(PC,RC=EC),PC);function PC(t){var e=RC.call(this,"FieldValue.arrayUnion")||this;return e._elements=t,e}var MC,xC=(da(LC,MC=EC),LC);function LC(t){var e=MC.call(this,"FieldValue.arrayRemove")||this;return e._elements=t,e}var FC,UC=(da(VC,FC=EC),VC);function VC(t){var e=FC.call(this,"FieldValue.increment")||this;return e._operand=t,e}var qC=ag(EC,"Use FieldValue.<field>() instead."),BC=/^__.*__$/,jC=(WC.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Kb(t,this.data,this.fieldMask,e)):n.push(new Bb(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Gb(t,this.fieldTransforms)),n},WC);function WC(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}var KC,QC,HC=(GC.prototype.toMutations=function(t,e){var n=[new Kb(t,this.data,this.fieldMask,e)];return 0<this.fieldTransforms.length&&n.push(new Gb(t,this.fieldTransforms)),n},GC);function GC(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function zC(t){switch(t){case KC.Set:case KC.MergeSet:case KC.Update:return!0;case KC.Argument:case KC.ArrayArgument:return!1;default:throw Jy("Unexpected case for UserDataSource: "+t)}}(QC=KC=KC||{})[QC.Set=0]="Set",QC[QC.Update=1]="Update",QC[QC.MergeSet=2]="MergeSet",QC[QC.Argument=3]="Argument",QC[QC.ArrayArgument=4]="ArrayArgument";var YC=(XC.prototype.childContextForField=function(t){var e=null==this.path?null:this.path.child(t),n=new XC(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePathSegment(t),n},XC.prototype.childContextForFieldPath=function(t){var e=null==this.path?null:this.path.child(t),n=new XC(this.dataSource,this.methodName,e,!1,this.fieldTransforms,this.fieldMask);return n.validatePath(),n},XC.prototype.childContextForArray=function(t){return new XC(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},XC.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new ig(rg.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},XC.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},XC.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},XC.prototype.validatePathSegment=function(t){if(0===t.length)throw this.createError("Document fields must not be empty");if(zC(this.dataSource)&&BC.test(t))throw this.createError('Document fields cannot begin and end with "__"')},XC);function XC(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}var JC=function(t,e){this.databaseId=t,this.key=e},$C=(ZC.prototype.parseSetData=function(t,e){var n=new YC(KC.Set,t,ev.EMPTY_PATH);eN("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new jC(r,null,n.fieldTransforms)},ZC.prototype.parseMergeData=function(t,e,n){var r=new YC(KC.MergeSet,t,ev.EMPTY_PATH);eN("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new Ov(ev.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof hC)l=h._internalPath;else{if("string"!=typeof h)throw Jy("Expected stringOrFieldPath to be a string or a FieldPath");l=rN(t,h)}if(!r.contains(l))throw new ig(rg.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=kb.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=kb.fromArray(r.fieldMask),o=r.fieldTransforms;return new jC(a,i,o)},ZC.prototype.parseUpdateData=function(o,t){var a=this,s=new YC(KC.Update,o,ev.EMPTY_PATH);eN("Data must be an object, but it was:",s,t);var u=new Ov(ev.comparator),c=Bw.EMPTY;hg(t,function(t,e){var n=rN(o,t),r=s.childContextForFieldPath(n);if((e=a.runPreConverter(e,r))instanceof CC)u=u.add(n);else{var i=a.parseData(e,r);null!=i&&(u=u.add(n),c=c.set(n,i))}});var e=kb.fromSet(u);return new HC(c,e,s.fieldTransforms)},ZC.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new YC(KC.Update,t,ev.EMPTY_PATH),o=[nN(t,e)],a=[n];if(r.length%2!=0)throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(nN(t,r[s])),a.push(r[s+1]);var u=new Ov(ev.comparator),c=Bw.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof CC)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=kb.fromSet(u);return new HC(c,d,i.fieldTransforms)},ZC.prototype.parseQueryValue=function(t,e,n){void 0===n&&(n=!1);var r=new YC(n?KC.ArrayArgument:KC.Argument,t,ev.EMPTY_PATH),i=this.parseData(e,r);return $y(null!=i,"Parsed data should not be null."),$y(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},ZC.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=iN(t);throw e.createError(n)}},ZC.prototype.parseData=function(t,e){if(tN(t=this.runPreConverter(t,e)))return eN("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof EC)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement&&e.dataSource!==KC.ArrayArgument)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},ZC.prototype.parseObject=function(t,r){var i=this,o=new Sv(Pg);return lg(t)?r.path&&0<r.path.length&&r.fieldMask.push(r.path):hg(t,function(t,e){var n=i.parseData(e,r.childContextForField(t));null!=n&&(o=o.insert(t,n))}),new Bw(o)},ZC.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=sw.INSTANCE),n.push(s),r++}return new Kw(n)},ZC.prototype.parseSentinelFieldValue=function(t,e){if(!zC(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof CC){if(e.dataSource!==KC.MergeSet)throw e.dataSource===KC.Update?($y(0<e.path.length,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof kC)e.fieldTransforms.push(new Rb(e.path,GS.instance));else if(t instanceof OC){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new YS(n);e.fieldTransforms.push(new Rb(e.path,r))}else if(t instanceof xC){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new JS(n);e.fieldTransforms.push(new Rb(e.path,i))}else if(t instanceof UC){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new ZS(o);e.fieldTransforms.push(new Rb(e.path,a))}else Jy("Unknown FieldValue type: "+t)},ZC.prototype.parseScalarValue=function(t,e){if(null===t)return sw.INSTANCE;if("number"==typeof t)return xT(t)?new gw(t):new ww(t);if("boolean"==typeof t)return hw.of(t);if("string"==typeof t)return new Ew(t);if(t instanceof Date)return new Cw(wv.fromDate(t));if(t instanceof wv)return new Cw(new wv(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof QS)return new Uw(t);if(t instanceof Ug)return new Ow(t);if(t instanceof JC)return new xw(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Sg(t))},ZC.prototype.parseArrayTransformElements=function(r,t){var i=this;return t.map(function(t,e){var n=new YC(KC.Argument,r,ev.EMPTY_PATH);return i.parseData(t,n.childContextForArray(e))})},ZC);function ZC(t){this.preConverter=t}function tN(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof wv||t instanceof QS||t instanceof Ug||t instanceof JC||t instanceof EC)}function eN(t,e,n){if(!tN(n)||!Eg(n)){var r=Sg(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function nN(t,e){if(e instanceof hC)return e._internalPath;if("string"==typeof e)return rN(t,e);throw new ig(rg.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function rN(e,t){try{return function(e){if(0<=e.search(fC))throw new ig(rg.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(hC.bind.apply(hC,_a([void 0],e.split("."))))}catch(t){throw new ig(rg.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(t)._internalPath}catch(t){var n=iN(t);throw new ig(rg.INVALID_ARGUMENT,"Function "+e+"() called with invalid data. "+n)}}function iN(t){return t instanceof Error?t.message:t.toString()}var oN=uT.COLLECTION_DISABLED,aN=(sN.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},sN);function sN(t){if(void 0===t.host){if(void 0!==t.ssl)throw new ig(rg.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else vg("settings","non-empty string","host",t.host),this.host=t.host,bg("settings","boolean","ssl",t.ssl),this.ssl=ug(t.ssl,!0);if(Cg("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),bg("settings","object","credentials",t.credentials),this.credentials=t.credentials,bg("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Yy("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Yy("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=ug(t.timestampsInSnapshots,!0),bg("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=uT.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==oN&&t.cacheSizeBytes<uT.MINIMUM_CACHE_SIZE_BYTES)throw new ig(rg.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+uT.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}bg("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}var uN=(cN.prototype.settings=function(t){if(pg("Firestore.settings",arguments,1),yg("Firestore.settings","object",1,t),sg(t,"persistence"))throw new ig(rg.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new aN(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new ig(rg.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this._settings=e).credentials&&(this._credentials=function(t){if(!t)return new dC;switch(t.type){case"gapi":var e=t.client;return $y(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new wC(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new ig(rg.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},cN.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},cN.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},cN.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new ig(rg.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Yy("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=ug(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new rC(this._settings.cacheSizeBytes,e))},cN.prototype.clearPersistence=function(){var t=this,n=TT.buildStoragePrefix(this.makeDatabaseInfo()),r=new sv;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return ya(t,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:if(t.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new ig(rg.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,TT.clearPersistence(n)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise},cN.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(cN.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),cN.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},cN.prototype.onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),TC(t))return this.onSnapshotsInSyncInternal(t);yg("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},cN.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new uC({next:function(){t.next&&t.next()},error:function(t){throw Jy("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},cN.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new oC),this._firestoreClient},cN.prototype.makeDatabaseInfo=function(){return new Bg(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},cN.prototype.configureClient=function(t){$y(!!this._settings.host,"FirestoreSettings.host is not set"),$y(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new aC(Zy.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},cN.prototype.createDataConverter=function(r){return new $C(function(t){if(t instanceof dN){var e=r,n=t.firestore._databaseId;if(!n.isEqual(e))throw new ig(rg.INVALID_ARGUMENT,"Document reference is for database "+n.projectId+"/"+n.database+" but should be for database "+e.projectId+"/"+e.database);return new JC(r,t._key)}return t})},cN.databaseIdFromApp=function(t){var e=t.options;if(!sg(e,"projectId"))throw new ig(rg.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new ig(rg.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Wg(n)},Object.defineProperty(cN.prototype,"app",{get:function(){if(!this._firebaseApp)throw new ig(rg.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),cN.prototype.collection=function(t){return pg("Firestore.collection",arguments,1),yg("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new AN(Jg.fromString(t),this)},cN.prototype.doc=function(t){return pg("Firestore.doc",arguments,1),yg("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),dN.forPath(Jg.fromString(t),this)},cN.prototype.collectionGroup=function(t){if(pg("Firestore.collectionGroup",arguments,1),yg("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new ig(rg.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new EN(new qT(Jg.EMPTY_PATH,t),this)},cN.prototype.runTransaction=function(e){var n=this;return pg("Firestore.runTransaction",arguments,1),yg("Firestore.runTransaction","function",1,e),this.ensureClientConfigured().transaction(function(t){return e(new hN(n,t))})},cN.prototype.batch=function(){return this.ensureClientConfigured(),new fN(this)},Object.defineProperty(cN,"logLevel",{get:function(){switch(Hy()){case Ly.DEBUG:return"debug";case Ly.ERROR:return"error";case Ly.SILENT:return"silent";default:return Jy("Unknown log level: "+Hy())}},enumerable:!0,configurable:!0}),cN.setLogLevel=function(t){switch(pg("Firestore.setLogLevel",arguments,1),yg("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Gy(Ly.DEBUG);break;case"error":Gy(Ly.ERROR);break;case"silent":Gy(Ly.SILENT);break;default:throw new ig(rg.INVALID_ARGUMENT,"Invalid log level: "+t)}},cN.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},cN);function cN(t,e){var n=this;if(this._firebaseApp=null,this._queue=new hv,this.INTERNAL={delete:function(){return ya(n,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var r=t;this._firebaseApp=r,this._databaseId=cN.databaseIdFromApp(r),this._persistenceKey=r.name,this._credentials=new yC(e)}else{var i=t;if(!i.projectId)throw new ig(rg.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new Wg(i.projectId,i.database),this._persistenceKey="[DEFAULT]",this._credentials=new dC}this._settings=new aN({}),this._dataConverter=this.createDataConverter(this._databaseId)}var hN=(lN.prototype.get=function(t){var n=this;pg("Transaction.get",arguments,1);var r=PN("Transaction.get",t,this._firestore);return this._transaction.lookup([r._key]).then(function(t){if(!t||1!==t.length)return Jy("Mismatch in docs returned from document lookup.");var e=t[0];if(e instanceof $w)return new vN(n._firestore,r._key,null,!1,!1,r._converter);if(e instanceof Yw)return new vN(n._firestore,r._key,e,!1,!1,r._converter);throw Jy("BatchGetDocumentsRequest returned unexpected document type: "+e.constructor.name)})},lN.prototype.set=function(t,e,n){mg("Transaction.set",arguments,2,3);var r=PN("Transaction.set",t,this._firestore);n=DN("Transaction.set",n);var i=MN(r._converter,e,"Transaction.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._transaction.set(r._key,s),this},lN.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return i="string"==typeof e||e instanceof hC?(dg("Transaction.update",arguments,3),r=PN("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(pg("Transaction.update",arguments,2),r=PN("Transaction.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},lN.prototype.delete=function(t){pg("Transaction.delete",arguments,1);var e=PN("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},lN);function lN(t,e){this._firestore=t,this._transaction=e}var fN=(pN.prototype.set=function(t,e,n){mg("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=PN("WriteBatch.set",t,this._firestore);n=DN("WriteBatch.set",n);var i=MN(r._converter,e,"WriteBatch.set"),o=i[0],a=i[1],s=n.merge||n.mergeFields?this._firestore._dataConverter.parseMergeData(a,o,n.mergeFields):this._firestore._dataConverter.parseSetData(a,o);return this._mutations=this._mutations.concat(s.toMutations(r._key,Lb.NONE)),this},pN.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),i="string"==typeof e||e instanceof hC?(dg("WriteBatch.update",arguments,3),r=PN("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(pg("WriteBatch.update",arguments,2),r=PN("WriteBatch.update",t,this._firestore),this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,Lb.exists(!0))),this},pN.prototype.delete=function(t){pg("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=PN("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new tw(e._key,Lb.NONE)),this},pN.prototype.commit=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){return this.verifyNotCommitted(),this._committed=!0,0<this._mutations.length?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},pN.prototype.verifyNotCommitted=function(){if(this._committed)throw new ig(rg.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},pN);function pN(t){this._firestore=t,this._mutations=[],this._committed=!1}var dN=(mN.forPath=function(t,e,n){if(t.length%2!=0)throw new ig(rg.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new mN(new rv(t),e,n)},Object.defineProperty(mN.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(mN.prototype,"parent",{get:function(){return new AN(this._key.path.popLast(),this.firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(mN.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),mN.prototype.collection=function(t){if(pg("DocumentReference.collection",arguments,1),yg("DocumentReference.collection","non-empty string",1,t),!t)throw new ig(rg.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Jg.fromString(t);return new AN(this._key.path.child(e),this.firestore)},mN.prototype.isEqual=function(t){if(!(t instanceof mN))throw Ng("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this._key.isEqual(t._key)&&this._converter===t._converter},mN.prototype.set=function(t,e){mg("DocumentReference.set",arguments,1,2),e=DN("DocumentReference.set",e);var n=MN(this._converter,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore._dataConverter.parseMergeData(i,r,e.mergeFields):this.firestore._dataConverter.parseSetData(i,r);return this._firestoreClient.write(o.toMutations(this._key,Lb.NONE))},mN.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof hC?(dg("DocumentReference.update",arguments,2),this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(pg("DocumentReference.update",arguments,1),this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,Lb.exists(!0)))},mN.prototype.delete=function(){return pg("DocumentReference.delete",arguments,0),this._firestoreClient.write([new tw(this._key,Lb.NONE)])},mN.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];mg("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||TC(t[i])||(Cg("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),bg("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=TC(t[i])?t[i]:(yg("DocumentReference.onSnapshot","function",i,t[i]),gg("DocumentReference.onSnapshot","function",i+1,t[i+1]),gg("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},mN.prototype.onSnapshotInternal=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new uC({next:function(t){if(n.next){$y(t.docs.size<=1,"Too many documents returned on a document query");var e=t.docs.get(r._key);n.next(new vN(r.firestore,r._key,e,t.fromCache,t.hasPendingWrites,r._converter))}},error:e}),o=this._firestoreClient.listen(qT.atPath(this._key.path),i,t);return function(){i.mute(),r._firestoreClient.unlisten(o)}},mN.prototype.get=function(n){var r=this;return mg("DocumentReference.get",arguments,0,1),ON("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentFromLocalCache(r._key).then(function(t){e(new vN(r.firestore,r._key,t,!0,t instanceof Yw&&t.hasLocalMutations,r._converter))},t):r.getViaSnapshotListener(e,t,n)})},mN.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new ig(rg.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new ig(rg.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},mN.prototype.withConverter=function(t){return new mN(this._key,this.firestore,t)},mN);function mN(t,e,n){this._key=t,this.firestore=e,this._converter=n,this._firestoreClient=this.firestore.ensureClientConfigured()}var yN=(gN.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},gN);function gN(t,e){this.hasPendingWrites=t,this.fromCache=e}var vN=(bN.prototype.data=function(t){if(mg("DocumentSnapshot.data",arguments,0,1),t=RN("DocumentSnapshot.data",t),this._document){if(this._converter){var e=new _N(this._firestore,this._key,this._document,this._fromCache,this._hasPendingWrites);return this._converter.fromFirestore(e,t)}return this.toJSObject(this._document.data(),nw.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled()))}},bN.prototype.get=function(t,e){if(mg("DocumentSnapshot.get",arguments,1,2),e=RN("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(nN("DocumentSnapshot.get",t));if(null!==n)return this.toJSValue(n,nw.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(bN.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(bN.prototype,"ref",{get:function(){return new dN(this._key,this._firestore,this._converter)},enumerable:!0,configurable:!0}),Object.defineProperty(bN.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(bN.prototype,"metadata",{get:function(){return new yN(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),bN.prototype.isEqual=function(t){if(!(t instanceof bN))throw Ng("isEqual","DocumentSnapshot",1,t);return this._firestore===t._firestore&&this._fromCache===t._fromCache&&this._key.isEqual(t._key)&&(null===this._document?null===t._document:this._document.isEqual(t._document))&&this._converter===t._converter},bN.prototype.toJSObject=function(t,n){var r=this,i={};return t.forEach(function(t,e){i[t]=r.toJSValue(e,n)}),i},bN.prototype.toJSValue=function(t,e){if(t instanceof Bw)return this.toJSObject(t,e);if(t instanceof Kw)return this.toJSArray(t,e);if(t instanceof xw){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Yy("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new dN(n,this._firestore,this._converter)}return t.value(e)},bN.prototype.toJSArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.toJSValue(t,e)})},bN);function bN(t,e,n,r,i,o){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i,this._converter=o}var wN,_N=(da(TN,wN=vN),TN.prototype.data=function(t){var e=wN.prototype.data.call(this,t);return $y(void 0!==e,"Document in a QueryDocumentSnapshot should exist"),e},TN);function TN(){return null!==wN&&wN.apply(this,arguments)||this}var EN=(SN.prototype.where=function(t,e,n){var r;pg("Query.where",arguments,3),Ig("Query.where",3,n),function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new ig(rg.INVALID_ARGUMENT,"Invalid value "+Sg(r)+" provided to function "+t+"() for its "+kg(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i=nN("Query.where",t),o=WT.fromString(e);if(i.isKeyField()){if(o===WT.ARRAY_CONTAINS||o===WT.ARRAY_CONTAINS_ANY)throw new ig(rg.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o.toString()+"' queries on FieldPath.documentId().");if(o===WT.IN){this.validateDisjunctiveFilterElements(n,o);for(var a=[],s=0,u=n;s<u.length;s++){var c=u[s];a.push(this.parseDocumentIdValue(c))}r=new Kw(a)}else r=this.parseDocumentIdValue(n)}else o!==WT.IN&&o!==WT.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(n,o),r=this.firestore._dataConverter.parseQueryValue("Query.where",n,o===WT.IN);var h=HT.create(i,o,r);return this.validateNewFilter(h),new SN(this._query.addFilter(h),this.firestore,this._converter)},SN.prototype.orderBy=function(t,e){var n;if(mg("Query.orderBy",arguments,1,2),gg("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n=cE.ASCENDING;else{if("desc"!==e)throw new ig(rg.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n=cE.DESCENDING}if(null!==this._query.startAt)throw new ig(rg.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new ig(rg.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=nN("Query.orderBy",t),i=new pE(r,n);return this.validateNewOrderBy(i),new SN(this._query.addOrderBy(i),this.firestore,this._converter)},SN.prototype.limit=function(t){return pg("Query.limit",arguments,1),yg("Query.limit","number",1,t),Ag("Query.limit",1,t),new SN(this._query.withLimitToFirst(t),this.firestore,this._converter)},SN.prototype.limitToLast=function(t){return pg("Query.limitToLast",arguments,1),yg("Query.limitToLast","number",1,t),Ag("Query.limitToLast",1,t),new SN(this._query.withLimitToLast(t),this.firestore,this._converter)},SN.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];dg("Query.startAt",arguments,1);var r=this.boundFromDocOrFields("Query.startAt",t,e,!0);return new SN(this._query.withStartAt(r),this.firestore,this._converter)},SN.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];dg("Query.startAfter",arguments,1);var r=this.boundFromDocOrFields("Query.startAfter",t,e,!1);return new SN(this._query.withStartAt(r),this.firestore,this._converter)},SN.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];dg("Query.endBefore",arguments,1);var r=this.boundFromDocOrFields("Query.endBefore",t,e,!0);return new SN(this._query.withEndAt(r),this.firestore,this._converter)},SN.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];dg("Query.endAt",arguments,1);var r=this.boundFromDocOrFields("Query.endAt",t,e,!1);return new SN(this._query.withEndAt(r),this.firestore,this._converter)},SN.prototype.isEqual=function(t){if(!(t instanceof SN))throw Ng("isEqual","Query",1,t);return this.firestore===t.firestore&&this._query.isEqual(t._query)},SN.prototype.withConverter=function(t){return new SN(this._query,this.firestore,t)},SN.prototype.boundFromDocOrFields=function(t,e,n,r){if(Ig(t,1,e),e instanceof vN){if(0<n.length)throw new ig(rg.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new ig(rg.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},SN.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new xw(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof kw)throw new ig(rg.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new ig(rg.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new lE(r,n)},SN.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new ig(rg.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new ig(rg.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new ig(rg.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(Jg.fromString(a));if(!rv.isDocumentKey(s))throw new ig(rg.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new rv(s);i.push(new xw(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new lE(i,n)},SN.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];mg("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||TC(t[i])||(Cg("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),bg("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=TC(t[i])?t[i]:(yg("Query.onSnapshot","function",i,t[i]),gg("Query.onSnapshot","function",i+1,t[i+1]),gg("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.validateHasExplicitOrderByForLimitToLast(this._query),this.onSnapshotInternal(r,n)},SN.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new uC({next:function(t){e.next&&e.next(new IN(n.firestore,n._query,t,n._converter))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},SN.prototype.validateHasExplicitOrderByForLimitToLast=function(t){if(t.hasLimitToLast()&&0===t.explicitOrderBy.length)throw new ig(rg.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},SN.prototype.get=function(n){var r=this;return mg("Query.get",arguments,0,1),ON("Query.get",n),this.validateHasExplicitOrderByForLimitToLast(this._query),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.ensureClientConfigured().getDocumentsFromLocalCache(r._query).then(function(t){e(new IN(r.firestore,r._query,t,r._converter))},t):r.getViaSnapshotListener(e,t,n)})},SN.prototype.getViaSnapshotListener=function(e,n,r){var i=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new ig(rg.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},SN.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new ig(rg.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new ig(rg.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(Jg.fromString(t));if(!rv.isDocumentKey(e))throw new ig(rg.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new xw(this.firestore._databaseId,new rv(e))}if(t instanceof dN){var n=t;return new xw(this.firestore._databaseId,n._key)}throw new ig(rg.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Sg(t)+".")},SN.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new ig(rg.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new ig(rg.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new ig(rg.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new ig(rg.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},SN.prototype.validateNewFilter=function(t){if(t instanceof HT){var e=[WT.ARRAY_CONTAINS,WT.ARRAY_CONTAINS_ANY],n=[WT.IN,WT.ARRAY_CONTAINS_ANY],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new ig(rg.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new ig(rg.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new ig(rg.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},SN.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},SN.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new ig(rg.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},SN);function SN(t,e,n){this._query=t,this.firestore=e,this._converter=n}var IN=(Object.defineProperty(CN.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(CN.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(CN.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),CN.prototype.forEach=function(e,n){var r=this;mg("QuerySnapshot.forEach",arguments,1,2),yg("QuerySnapshot.forEach","function",1,e),this._snapshot.docs.forEach(function(t){e.call(n,r.convertToDocumentImpl(t))})},Object.defineProperty(CN.prototype,"query",{get:function(){return new EN(this._originalQuery,this._firestore,this._converter)},enumerable:!0,configurable:!0}),CN.prototype.docChanges=function(t){t&&(Cg("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),bg("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new ig(rg.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,e,o,a){if(o.oldDocs.isEmpty()){var n,r=0;return o.docChanges.map(function(t){var e=new _N(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key),a);return $y(t.type===gS.Added,"Invalid event type for first snapshot"),$y(!n||o.query.docComparator(n,t.doc)<0,"Got added events in wrong order"),n=t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:r++}})}var s=o.oldDocs;return o.docChanges.filter(function(t){return e||t.type!==gS.Metadata}).map(function(t){var e=new _N(i,t.doc.key,t.doc,o.fromCache,o.mutatedKeys.has(t.doc.key),a),n=-1,r=-1;return t.type!==gS.Added&&($y(0<=(n=s.indexOf(t.doc.key)),"Index for document not found"),s=s.delete(t.doc.key)),t.type!==gS.Removed&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case gS.Added:return"added";case gS.Modified:case gS.Metadata:return"modified";case gS.Removed:return"removed";default:return Jy("Unknown change type: "+t)}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this._firestore,e,this._snapshot,this._converter),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},CN.prototype.isEqual=function(t){if(!(t instanceof CN))throw Ng("isEqual","QuerySnapshot",1,t);return this._firestore===t._firestore&&this._originalQuery.isEqual(t._originalQuery)&&this._snapshot.isEqual(t._snapshot)&&this._converter===t._converter},CN.prototype.convertToDocumentImpl=function(t){return new _N(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key),this._converter)},CN);function CN(t,e,n,r){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._converter=r,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new yN(n.hasPendingWrites,n.fromCache)}_a(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty(IN.prototype.docChanges,t,{get:function(){return function(){throw new ig(rg.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var NN,AN=(da(kN,NN=EN),Object.defineProperty(kN.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(kN.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new dN(new rv(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(kN.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),kN.prototype.doc=function(t){if(mg("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Rg.newId()),yg("CollectionReference.doc","non-empty string",1,t),""===t)throw new ig(rg.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Jg.fromString(t);return dN.forPath(this._query.path.child(e),this.firestore,this._converter)},kN.prototype.add=function(t){pg("CollectionReference.add",arguments,1),yg("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},kN.prototype.withConverter=function(t){return new kN(this._path,this.firestore,t)},kN);function kN(t,e,n){var r=NN.call(this,qT.atPath(t),e,n)||this;if((r._path=t).length%2!=1)throw new ig(rg.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.canonicalString()+" has "+t.length);return r}function DN(t,e){if(void 0===e)return{merge:!1};if(Cg(t,e,["merge","mergeFields"]),bg(t,"boolean","merge",e.merge),wg(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof hC}),void 0!==e.mergeFields&&void 0!==e.merge)throw new ig(rg.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function RN(t,e){return void 0===e?{}:(Cg(t,e,["serverTimestamps"]),_g(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function ON(t,e){gg(t,"object",1,e),e&&(Cg(t,e,["source"]),_g(t,0,"source",e.source,["default","server","cache"]))}function PN(t,e,n){if(e instanceof dN){if(e.firestore!==n)throw new ig(rg.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Ng(t,"DocumentReference",1,e)}function MN(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}var xN=ag(uN,"Use firebase.firestore() instead."),LN=ag(hN,"Use firebase.firestore().runTransaction() instead."),FN=ag(fN,"Use firebase.firestore().batch() instead."),UN=ag(dN,"Use firebase.firestore().doc() instead."),VN=ag(vN),qN=ag(_N),BN=ag(EN),jN=ag(IN),WN=ag(AN,"Use firebase.firestore().collection() instead."),KN={Firestore:xN,GeoPoint:QS,Timestamp:wv,Blob:qg,Transaction:LN,WriteBatch:FN,DocumentReference:UN,DocumentSnapshot:VN,Query:BN,QueryDocumentSnapshot:qN,QuerySnapshot:jN,CollectionReference:WN,FieldPath:hC,FieldValue:qC,setLogLevel:uN.setLogLevel,CACHE_SIZE_UNLIMITED:oN};function QN(t){t.INTERNAL.registerComponent(new as("firestore",function(t){var e=t.getProvider("app").getImmediate();return new uN(e,t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(function(t){$y(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(KN)))}var HN=(GN.prototype.addCallback=function(t){},GN.prototype.shutdown=function(){},GN);function GN(){}var zN="ConnectivityMonitor",YN=(XN.prototype.addCallback=function(t){this.callbacks.push(t)},XN.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},XN.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},XN.prototype.onNetworkAvailable=function(){zy(zN,"Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(0)},XN.prototype.onNetworkUnavailable=function(){zy(zN,"Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++)(0,e[t])(1)},XN.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},XN);function XN(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}var JN=($N.prototype.onOpen=function(t){$y(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},$N.prototype.onClose=function(t){$y(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},$N.prototype.onMessage=function(t){$y(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},$N.prototype.close=function(){this.closeFn()},$N.prototype.send=function(t){this.sendFn(t)},$N.prototype.callOnOpen=function(){$y(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},$N.prototype.callOnClose=function(t){$y(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},$N.prototype.callOnMessage=function(t){$y(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},$N);function $N(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}var ZN="Connection",tA={BatchGetDocuments:"batchGet",Commit:"commit"},eA="gl-js/ fire/"+Ky,nA=(rA.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=eA},rA.prototype.invokeRPC=function(s,r,u){var c=this,h=this.makeUrl(s);return new Promise(function(i,o){var a=new Wy;a.listenOnce(By.COMPLETE,function(){try{switch(a.getLastErrorCode()){case qy.NO_ERROR:var t=a.getResponseJson();zy(ZN,"XHR received:",JSON.stringify(t)),i(t);break;case qy.TIMEOUT:zy(ZN,'RPC "'+s+'" timed out'),o(new ig(rg.DEADLINE_EXCEEDED,"Request time out"));break;case qy.HTTP_ERROR:var e=a.getStatus();if(zy(ZN,'RPC "'+s+'" failed with status:',e,"response text:",a.getResponseText()),0<e){var n=a.getResponseJson().error;if(n&&n.status&&n.message){var r=function(t){var e=t.toLowerCase().replace("_","-");return 0<=Object.values(rg).indexOf(e)?e:rg.UNKNOWN}(n.status);o(new ig(r,n.message))}else o(new ig(rg.UNKNOWN,"Server responded with status "+a.getStatus()))}else zy(ZN,'RPC "'+s+'" failed'),o(new ig(rg.UNAVAILABLE,"Connection failed."));break;default:Jy('RPC "'+s+'" failed with unanticipated webchannel error '+a.getLastErrorCode()+": "+a.getLastError()+", giving up.")}}finally{zy(ZN,'RPC "'+s+'" completed.')}});var t=ma({},r);delete t.database;var e=JSON.stringify(t);zy(ZN,"XHR sending: ",h+" "+e);var n={"Content-Type":"text/plain"};c.modifyHeadersForRequest(n,u),a.send(h,"POST",e,n,15)})},rA.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},rA.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Vy(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),Ma()||0<=Oa().indexOf("Electron/")||function(){var t=Oa();return 0<=t.indexOf("MSIE ")||0<=t.indexOf("Trident/")}()||0<=Oa().indexOf("MSAppHost/")||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");function a(t,e){u.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}zy(ZN,"Creating WebChannel: "+o+" "+i);var u=r.createWebChannel(o,i),s=!1,c=!1,h=new JN({sendFn:function(t){c?zy(ZN,"Not sending because WebChannel is closed:",t):(s||(zy(ZN,"Opening WebChannel transport."),u.open(),s=!0),zy(ZN,"WebChannel sending:",t),u.send(t))},closeFn:function(){return u.close()}});return a(jy.EventType.OPEN,function(){c||zy(ZN,"WebChannel transport opened.")}),a(jy.EventType.CLOSE,function(){c||(c=!0,zy(ZN,"WebChannel transport closed"),h.callOnClose())}),a(jy.EventType.ERROR,function(t){c||(c=!0,zy(ZN,"WebChannel transport errored:",t),h.callOnClose(new ig(rg.UNAVAILABLE,"The operation could not be completed")))}),a(jy.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];$y(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){zy(ZN,"WebChannel received error:",i);var o=i.status,a=function(t){var e=lS[t];if(void 0!==e)return yS(e)}(o),s=i.message;void 0===a&&(a=rg.INTERNAL,s="Unknown error status: "+o+" with message "+i.message),c=!0,h.callOnClose(new ig(a,s)),u.close()}else zy(ZN,"WebChannel received:",n),h.callOnMessage(n)}}),setTimeout(function(){h.callOnOpen()},0),h},rA.prototype.makeUrl=function(t){var e=tA[t];return $y(void 0!==e,"Unknown REST mapping for: "+t),this.baseUrl+"/v1/projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents:"+e},rA);function rA(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}var iA=(Object.defineProperty(oA.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(oA.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),oA.prototype.loadConnection=function(t){return Promise.resolve(new nA(t))},oA.prototype.newConnectivityMonitor=function(){return YN.isAvailable()?new YN:new HN},oA.prototype.newSerializer=function(t){return new lI(t,{useProto3Json:!0})},oA.prototype.formatJSON=function(t){return JSON.stringify(t)},oA.prototype.atob=function(t){return atob(t)},oA.prototype.btoa=function(t){return btoa(t)},oA);function oA(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}Zy.setPlatform(new iA);var aA;QN(aA=fl),aA.registerVersion("@firebase/firestore","1.9.2");var sA,uA={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},cA=(da(hA,sA=Error),hA);function hA(t,e,n){var r=sA.call(this,e)||this;return Object.setPrototypeOf(r,hA.prototype),r.code=t,r.details=n,r}function lA(t,e,n){var r=function(t){if(200<=t&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),i=r,o=void 0;try{var a=e&&e.error;if(a){var s=a.status;if("string"==typeof s){if(!uA[s])return new cA("internal","internal");r=uA[s],i=s}var u=a.message;"string"==typeof u&&(i=u),void 0!==(o=a.details)&&(o=n.decode(o))}}catch(t){}return"ok"===r?null:new cA(r,i,o)}var fA=(pA.prototype.getAuthToken=function(){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:if(!this.auth)return[2,void 0];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 3:return t.sent(),[2,void 0];case 4:return[2]}})})},pA.prototype.getInstanceIdToken=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]})})},pA.prototype.getContext=function(){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,this.getAuthToken()];case 1:return e=t.sent(),[4,this.getInstanceIdToken()];case 2:return n=t.sent(),[2,{authToken:e,instanceIdToken:n}]}})})},pA);function pA(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then(function(t){return n.auth=t},function(){}),this.messaging||e.get().then(function(t){return n.messaging=t},function(){})}function dA(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}var mA=(yA.prototype.encode=function(t){var e=this;if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(Array.isArray(t))return t.map(function(t){return e.encode(t)});if("function"==typeof t||"object"==typeof t)return dA(t,function(t){return e.encode(t)});throw new Error("Data cannot be encoded in JSON: "+t)},yA.prototype.decode=function(t){var e=this;if(null==t)return t;if(t["@type"])switch(t["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(t.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+t);return n;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return e.decode(t)}):"function"==typeof t||"object"==typeof t?dA(t,function(t){return e.decode(t)}):t},yA);function yA(){}var gA=(Object.defineProperty(vA.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),vA.prototype._url=function(t){var e=this.app_.options.projectId,n=this.region_;return null===this.emulatorOrigin?"https://"+n+"-"+e+".cloudfunctions.net/"+t:this.emulatorOrigin+"/"+e+"/"+n+"/"+t},vA.prototype.useFunctionsEmulator=function(t){this.emulatorOrigin=t},vA.prototype.httpsCallable=function(e,n){var r=this;return function(t){return r.call(e,t,n||{})}},vA.prototype.postJSON=function(r,i,o){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:o.append("Content-Type","application/json"),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,fetch(r,{method:"POST",body:JSON.stringify(i),headers:o})];case 2:return e=t.sent(),[3,4];case 3:return t.sent(),[2,{status:0,json:null}];case 4:n=null,t.label=5;case 5:return t.trys.push([5,7,,8]),[4,e.json()];case 6:return n=t.sent(),[3,8];case 7:return t.sent(),[3,8];case 8:return[2,{status:e.status,json:n}]}})})},vA.prototype.call=function(c,h,l){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u;return ga(this,function(t){switch(t.label){case 0:return e=this._url(c),h=this.serializer.encode(h),n={data:h},r=new Headers,[4,this.contextProvider.getContext()];case 1:return(i=t.sent()).authToken&&r.append("Authorization","Bearer "+i.authToken),i.instanceIdToken&&r.append("Firebase-Instance-ID-Token",i.instanceIdToken),o=l.timeout||7e4,[4,Promise.race([this.postJSON(e,n,r),function(n){return new Promise(function(t,e){setTimeout(function(){e(new cA("deadline-exceeded","deadline-exceeded"))},n)})}(o),this.cancelAllRequests])];case 2:if(!(a=t.sent()))throw new cA("cancelled","Firebase Functions instance was deleted.");if(s=lA(a.status,a.json,this.serializer))throw s;if(!a.json)throw new cA("internal","Response is not valid JSON object.");if(void 0===(u=a.json.data)&&(u=a.json.result),void 0===u)throw new cA("internal","Response is missing data field.");return[2,{data:this.serializer.decode(u)}]}})})},vA);function vA(t,e,n,r){var i=this;void 0===r&&(r="us-central1"),this.app_=t,this.region_=r,this.serializer=new mA,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return i.deleteService()}},this.contextProvider=new fA(e,n),this.cancelAllRequests=new Promise(function(t){i.deleteService=function(){return t()}})}function bA(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("messaging");return new gA(n,r,i,e)}var wA;function _A(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}function TA(n,r,i){var o,t=new Promise(function(t,e){_A(o=n[r].apply(n,i)).then(t,e)});return t.request=o,t}function EA(t,n,e){e.forEach(function(e){Object.defineProperty(t.prototype,e,{get:function(){return this[n][e]},set:function(t){this[n][e]=t}})})}function SA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return TA(this[n],t,arguments)})})}function IA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return this[n][t].apply(this[n],arguments)})})}function CA(e,n,r,t){t.forEach(function(t){t in r.prototype&&(e.prototype[t]=function(){return function(t,e,n){var r=TA(t,e,n);return r.then(function(t){if(t)return new AA(t,r.request)})}(this[n],t,arguments)})})}function NA(t){this._index=t}function AA(t,e){this._cursor=t,this._request=e}function kA(t){this._store=t}function DA(n){this._tx=n,this.complete=new Promise(function(t,e){n.oncomplete=function(){t()},n.onerror=function(){e(n.error)},n.onabort=function(){e(n.error)}})}function RA(t,e,n){this._db=t,this.oldVersion=e,this.transaction=new DA(n)}function OA(t){this._db=t}wA={Functions:gA},fl.INTERNAL.registerComponent(new as("functions",bA,"PUBLIC").setServiceProps(wA).setMultipleInstances(!0)),fl.registerVersion("@firebase/functions","0.4.29"),EA(NA,"_index",["name","keyPath","multiEntry","unique"]),SA(NA,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),CA(NA,"_index",IDBIndex,["openCursor","openKeyCursor"]),EA(AA,"_cursor",["direction","key","primaryKey","value"]),SA(AA,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(AA.prototype[n]=function(){var e=this,t=arguments;return Promise.resolve().then(function(){return e._cursor[n].apply(e._cursor,t),_A(e._request).then(function(t){if(t)return new AA(t,e._request)})})})}),kA.prototype.createIndex=function(){return new NA(this._store.createIndex.apply(this._store,arguments))},kA.prototype.index=function(){return new NA(this._store.index.apply(this._store,arguments))},EA(kA,"_store",["name","keyPath","indexNames","autoIncrement"]),SA(kA,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),CA(kA,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),IA(kA,"_store",IDBObjectStore,["deleteIndex"]),DA.prototype.objectStore=function(){return new kA(this._tx.objectStore.apply(this._tx,arguments))},EA(DA,"_tx",["objectStoreNames","mode"]),IA(DA,"_tx",IDBTransaction,["abort"]),RA.prototype.createObjectStore=function(){return new kA(this._db.createObjectStore.apply(this._db,arguments))},EA(RA,"_db",["name","version","objectStoreNames"]),IA(RA,"_db",IDBDatabase,["deleteObjectStore","close"]),OA.prototype.transaction=function(){return new DA(this._db.transaction.apply(this._db,arguments))},EA(OA,"_db",["name","version","objectStoreNames"]),IA(OA,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(i){[kA,NA].forEach(function(t){i in t.prototype&&(t.prototype[i.replace("open","iterate")]=function(){var t=function(t){return Array.prototype.slice.call(t)}(arguments),e=t[t.length-1],n=this._store||this._index,r=n[i].apply(n,t.slice(0,-1));r.onsuccess=function(){e(r.result)}})})}),[NA,kA].forEach(function(t){t.prototype.getAll||(t.prototype.getAll=function(t,n){var r=this,i=[];return new Promise(function(e){r.iterateCursor(t,function(t){t?(i.push(t.value),void 0===n||i.length!=n?t.continue():e(i)):e(i)})})})});var PA,MA=1e4,xA="w:0.3.9",LA="FIS_v2",FA="https://firebaseinstallations.googleapis.com/v1",UA=36e5,VA=((PA={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',PA["not-registered"]="Firebase Installation is not registered.",PA["installation-not-found"]="Firebase Installation not found.",PA["request-failed"]='{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',PA["app-offline"]="Could not process request. Application offline.",PA["delete-pending-registration"]="Can't delete installation while there is a pending registration request.",PA),qA=new Va("installations","Installations",VA);function BA(t){return t instanceof Fa&&t.code.includes("request-failed")}function jA(t){var e=t.projectId;return FA+"/projects/"+e+"/installations"}function WA(t){return{token:t.token,requestStatus:2,expiresIn:function(t){return Number(t.replace("s","000"))}(t.expiresIn),creationTime:Date.now()}}function KA(r,i){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,i.json()];case 1:return e=t.sent(),n=e.error,[2,qA.create("request-failed",{requestName:r,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})]}})})}function QA(t){var e=t.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function HA(t,e){var n=e.refreshToken,r=QA(t);return r.append("Authorization",function(t){return LA+" "+t}(n)),r}function GA(n){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return[4,n()];case 1:return 500<=(e=t.sent()).status&&e.status<600?[2,n()]:[2,e]}})})}function zA(e){return new Promise(function(t){setTimeout(t,e)})}var YA=/^[cdef][\w-]{21}$/,XA="";function JA(){try{var t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;var e=function(t){return function(t){return btoa(String.fromCharCode.apply(String,wa(t))).replace(/\+/g,"-").replace(/\//g,"_")}(t).substr(0,22)}(t);return YA.test(e)?e:XA}catch(t){return XA}}var $A,ZA,tk="firebase-installations-database",ek=1,nk="firebase-installations-store",rk=null;function ik(){return rk=rk||function(t,e,n){var r=TA(indexedDB,"open",[t,e]),i=r.request;return i&&(i.onupgradeneeded=function(t){n&&n(new RA(i.result,t.oldVersion,i.transaction))}),r.then(function(t){return new OA(t)})}(tk,ek,function(t){switch(t.oldVersion){case 0:t.createObjectStore(nk)}})}function ok(i,o){return ya(this,void 0,void 0,function(){var e,n,r;return ga(this,function(t){switch(t.label){case 0:return e=uk(i),[4,ik()];case 1:return n=t.sent(),[4,(r=n.transaction(nk,"readwrite")).objectStore(nk).put(o,e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2,o]}})})}function ak(i){return ya(this,void 0,void 0,function(){var e,n,r;return ga(this,function(t){switch(t.label){case 0:return e=uk(i),[4,ik()];case 1:return n=t.sent(),[4,(r=n.transaction(nk,"readwrite")).objectStore(nk).delete(e)];case 2:return t.sent(),[4,r.complete];case 3:return t.sent(),[2]}})})}function sk(s,u){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a;return ga(this,function(t){switch(t.label){case 0:return e=uk(s),[4,ik()];case 1:return n=t.sent(),r=n.transaction(nk,"readwrite"),[4,(i=r.objectStore(nk)).get(e)];case 2:return o=t.sent(),void 0!==(a=u(o))?[3,4]:[4,i.delete(e)];case 3:return t.sent(),[3,6];case 4:return[4,i.put(a,e)];case 5:t.sent(),t.label=6;case 6:return[4,r.complete];case 7:return t.sent(),[2,a]}})})}function uk(t){return t.appName+"!"+t.appId}function ck(i){return ya(this,void 0,void 0,function(){var r,e,n;return ga(this,function(t){switch(t.label){case 0:return[4,sk(i,function(t){var e=function(t){return lk(t||{fid:JA(),registrationStatus:0})}(t),n=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:function(o){return ya(this,void 0,void 0,function(){var e,n,r,i;return ga(this,function(t){switch(t.label){case 0:return[4,hk(o)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.registrationStatus?[3,5]:[4,zA(100)];case 3:return t.sent(),[4,hk(o)];case 4:return e=t.sent(),[3,2];case 5:return 0!==e.registrationStatus?[3,7]:[4,ck(o)];case 6:return n=t.sent(),r=n.installationEntry,(i=n.registrationPromise)?[2,i]:[2,r];case 7:return[2,e]}})})}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(qA.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function(r,i){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,7]),[4,function(s,t){var u=t.fid;return ya(this,void 0,void 0,function(){var e,n,r,i,o,a;return ga(this,function(t){switch(t.label){case 0:return e=jA(s),n=QA(s),r={fid:u,authVersion:LA,appId:s.appId,sdkVersion:xA},i={method:"POST",headers:n,body:JSON.stringify(r)},[4,GA(function(){return fetch(e,i)})];case 1:return(o=t.sent()).ok?[4,o.json()]:[3,3];case 2:return a=t.sent(),[2,{fid:a.fid||u,registrationStatus:2,refreshToken:a.refreshToken,authToken:WA(a.authToken)}];case 3:return[4,KA("Create Installation",o)];case 4:throw t.sent()}})})}(r,i)];case 1:return e=t.sent(),[2,ok(r,e)];case 2:return BA(n=t.sent())&&409===n.serverCode?[4,ak(r)]:[3,4];case 3:return t.sent(),[3,6];case 4:return[4,ok(r,{fid:i.fid,registrationStatus:0})];case 5:t.sent(),t.label=6;case 6:throw n;case 7:return[2]}})})}(t,r);return{installationEntry:r,registrationPromise:i}}}(i,e);return r=n.registrationPromise,n.installationEntry})];case 1:return(e=t.sent()).fid!==XA?[3,3]:(n={},[4,r]);case 2:return[2,(n.installationEntry=t.sent(),n)];case 3:return[2,{installationEntry:e,registrationPromise:r}]}})})}function hk(t){return sk(t,function(t){if(!t)throw qA.create("installation-not-found");return lk(t)})}function lk(t){return function(t){return 1===t.registrationStatus&&t.registrationTime+MA<Date.now()}(t)?{fid:t.fid,registrationStatus:0}:t}function fk(t,u){var c=t.appConfig,h=t.platformLoggerProvider;return ya(this,void 0,void 0,function(){var e,n,r,i,o,a,s;return ga(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return jA(t)+"/"+n+"/authTokens:generate"}(c,u),n=HA(c,u),(r=h.getImmediate({optional:!0}))&&n.append("x-firebase-client",r.getPlatformInfoString()),i={installation:{sdkVersion:xA}},o={method:"POST",headers:n,body:JSON.stringify(i)},[4,GA(function(){return fetch(e,o)})];case 1:return(a=t.sent()).ok?[4,a.json()]:[3,3];case 2:return s=t.sent(),[2,WA(s)];case 3:return[4,KA("Generate Auth Token",a)];case 4:throw t.sent()}})})}function pk(i,o){return void 0===o&&(o=!1),ya(this,void 0,void 0,function(){var r,e,n;return ga(this,function(t){switch(t.label){case 0:return[4,sk(i.appConfig,function(t){if(!mk(t))throw qA.create("not-registered");var e=t.authToken;if(!o&&function(t){return 2===t.requestStatus&&!function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+UA}(t)}(e))return t;if(1===e.requestStatus)return r=function(r,i){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,dk(r.appConfig)];case 1:e=t.sent(),t.label=2;case 2:return 1!==e.authToken.requestStatus?[3,5]:[4,zA(100)];case 3:return t.sent(),[4,dk(r.appConfig)];case 4:return e=t.sent(),[3,2];case 5:return 0===(n=e.authToken).requestStatus?[2,pk(r,i)]:[2,n]}})})}(i,o),t;if(!navigator.onLine)throw qA.create("app-offline");var n=function(t){var e={requestStatus:1,requestTime:Date.now()};return ma(ma({},t),{authToken:e})}(t);return r=function(i,o){return ya(this,void 0,void 0,function(){var e,n,r;return ga(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,8]),[4,fk(i,o)];case 1:return e=t.sent(),r=ma(ma({},o),{authToken:e}),[4,ok(i.appConfig,r)];case 2:return t.sent(),[2,e];case 3:return!BA(n=t.sent())||401!==n.serverCode&&404!==n.serverCode?[3,5]:[4,ak(i.appConfig)];case 4:return t.sent(),[3,7];case 5:return r=ma(ma({},o),{authToken:{requestStatus:0}}),[4,ok(i.appConfig,r)];case 6:t.sent(),t.label=7;case 7:throw n;case 8:return[2]}})})}(i,n),n})];case 1:return e=t.sent(),r?[4,r]:[3,3];case 2:return n=t.sent(),[3,4];case 3:n=e.authToken,t.label=4;case 4:return[2,n]}})})}function dk(t){return sk(t,function(t){if(!mk(t))throw qA.create("not-registered");return function(t){return 1===t.requestStatus&&t.requestTime+MA<Date.now()}(t.authToken)?ma(ma({},t),{authToken:{requestStatus:0}}):t})}function mk(t){return void 0!==t&&2===t.registrationStatus}function yk(e,n){return void 0===n&&(n=!1),ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,function(n){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return[4,ck(n)];case 1:return(e=t.sent().registrationPromise)?[4,e]:[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e.appConfig)];case 1:return t.sent(),[4,pk(e,n)];case 2:return[2,t.sent().token]}})})}function gk(o,a){return ya(this,void 0,void 0,function(){var e,n,r,i;return ga(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=e.fid;return jA(t)+"/"+n}(o,a),n=HA(o,a),r={method:"DELETE",headers:n},[4,GA(function(){return fetch(e,r)})];case 1:return(i=t.sent()).ok?[3,3]:[4,KA("Delete Installation",i)];case 2:throw t.sent();case 3:return[2]}})})}function vk(t){return qA.create("missing-app-config-values",{valueName:t})}($A=fl).INTERNAL.registerComponent(new as("installations",function(t){var e=t.getProvider("app").getImmediate(),n={appConfig:function(t){var e,n;if(!t||!t.options)throw vk("App Configuration");if(!t.name)throw vk("App Name");try{for(var r=va(["projectId","apiKey","appId"]),i=r.next();!i.done;i=r.next()){var o=i.value;if(!t.options[o])throw vk(o)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),platformLoggerProvider:t.getProvider("platform-logger")};return{app:e,getId:function(){return function(i){return ya(this,void 0,void 0,function(){var e,n,r;return ga(this,function(t){switch(t.label){case 0:return[4,ck(i.appConfig)];case 1:return e=t.sent(),n=e.installationEntry,(r=e.registrationPromise)?r.catch(console.error):pk(i).catch(console.error),[2,n.fid]}})})}(n)},getToken:function(t){return yk(n,t)},delete:function(){return function(r){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,sk(e=r.appConfig,function(t){if(!t||0!==t.registrationStatus)return t})];case 1:if(!(n=t.sent()))return[3,6];if(1!==n.registrationStatus)return[3,2];throw qA.create("delete-pending-registration");case 2:if(2!==n.registrationStatus)return[3,6];if(navigator.onLine)return[3,3];throw qA.create("app-offline");case 3:return[4,gk(e,n)];case 4:return t.sent(),[4,ak(e)];case 5:t.sent(),t.label=6;case 6:return[2]}})})}(n)}}},"PUBLIC")),$A.registerVersion("@firebase/installations","0.3.9");var bk,wk,_k=((ZA={})["only-available-in-window"]="This method is available in a Window context.",ZA["only-available-in-sw"]="This method is available in a service worker context.",ZA["should-be-overriden"]="This method should be overriden by extended classes.",ZA["bad-sender-id"]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",ZA["permission-default"]="The required permissions were not granted and dismissed instead.",ZA["permission-blocked"]="The required permissions were not granted and blocked instead.",ZA["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",ZA["notifications-blocked"]="Notifications have been blocked.",ZA["failed-serviceworker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",ZA["sw-registration-expected"]="A service worker registration was the expected input.",ZA["get-subscription-failed"]="There was an error when trying to get any existing Push Subscriptions.",ZA["invalid-saved-token"]="Unable to access details of the saved token.",ZA["sw-reg-redundant"]="The service worker being used for push was made redundant.",ZA["token-subscribe-failed"]="A problem occured while subscribing the user to FCM: {$errorInfo}",ZA["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",ZA["token-unsubscribe-failed"]="A problem occured while unsubscribing the user from FCM: {$errorInfo}",ZA["token-update-failed"]="A problem occured while updating the user from FCM: {$errorInfo}",ZA["token-update-no-token"]="FCM returned no token when updating the user to push.",ZA["use-sw-before-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",ZA["invalid-delete-token"]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",ZA["delete-token-not-found"]="The deletion attempt for token could not be performed as the token was not found.",ZA["delete-scope-not-found"]="The deletion attempt for service worker scope could not be performed as the scope was not found.",ZA["bg-handler-function-expected"]="The input to setBackgroundMessageHandler() must be a function.",ZA["no-window-client-to-msg"]="An attempt was made to message a non-existant window client.",ZA["unable-to-resubscribe"]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$errorInfo}",ZA["no-fcm-token-for-resubscribe"]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",ZA["failed-to-delete-token"]="Unable to delete the currently saved token.",ZA["no-sw-in-reg"]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",ZA["bad-scope"]="The service worker scope must be a string with at least one character.",ZA["bad-vapid-key"]="The public VAPID key is not a Uint8Array with 65 bytes.",ZA["bad-subscription"]="The subscription must be a valid PushSubscription.",ZA["bad-token"]="The FCM Token used for storage / lookup was not a valid token string.",ZA["failed-delete-vapid-key"]="The VAPID key could not be deleted.",ZA["invalid-public-vapid-key"]="The public VAPID key must be a string.",ZA["use-public-key-before-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",ZA["public-vapid-key-decryption-failed"]="The public VAPID key did not equal 65 bytes when decrypted.",ZA),Tk=new Va("messaging","Messaging",_k),Ek=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),Sk="google.c.a.c_id";function Ik(t,e){if(null==t||null==e)return!1;if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(var n=new DataView(t),r=new DataView(e),i=0;i<t.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function Ck(t){return function(t){var e=new Uint8Array(t);return btoa(String.fromCharCode.apply(String,wa(e)))}(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(wk=bk=bk||{}).PUSH_MSG_RECEIVED="push-msg-received",wk.NOTIFICATION_CLICKED="notification-clicked";var Nk=(Ak.prototype.getToken=function(s,u,c){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a;return ga(this,function(t){switch(t.label){case 0:return[4,Dk(s)];case 1:e=t.sent(),n=Rk(u,c),r={method:"POST",headers:e,body:JSON.stringify(n)},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(kk(s.app),r)];case 3:return[4,t.sent().json()];case 4:return i=t.sent(),[3,6];case 5:throw o=t.sent(),Tk.create("token-subscribe-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,Tk.create("token-subscribe-failed",{errorInfo:a});if(!i.token)throw Tk.create("token-subscribe-no-token");return[2,i.token]}})})},Ak.prototype.updateToken=function(s,u,c,h){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a;return ga(this,function(t){switch(t.label){case 0:return[4,Dk(u)];case 1:e=t.sent(),n=Rk(c,h),r={method:"PATCH",headers:e,body:JSON.stringify(n)},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(kk(u.app)+"/"+s.fcmToken,r)];case 3:return[4,t.sent().json()];case 4:return i=t.sent(),[3,6];case 5:throw o=t.sent(),Tk.create("token-update-failed",{errorInfo:o});case 6:if(i.error)throw a=i.error.message,Tk.create("token-update-failed",{errorInfo:a});if(!i.token)throw Tk.create("token-update-no-token");return[2,i.token]}})})},Ak.prototype.deleteToken=function(a,s){return ya(this,void 0,void 0,function(){var e,n,r,i,o;return ga(this,function(t){switch(t.label){case 0:return[4,Dk(a)];case 1:e=t.sent(),n={method:"DELETE",headers:e},t.label=2;case 2:return t.trys.push([2,5,,6]),[4,fetch(kk(a.app)+"/"+s.fcmToken,n)];case 3:return[4,t.sent().json()];case 4:if((r=t.sent()).error)throw i=r.error.message,Tk.create("token-unsubscribe-failed",{errorInfo:i});return[3,6];case 5:throw o=t.sent(),Tk.create("token-unsubscribe-failed",{errorInfo:o});case 6:return[2]}})})},Ak);function Ak(){}function kk(t){return"https://fcmregistrations.googleapis.com/v1/projects/"+t.options.projectId+"/registrations"}function Dk(t){var n=t.app,r=t.installations;return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return[4,r.getToken()];case 1:return e=t.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.options.apiKey,"x-goog-firebase-installations-auth":"FIS "+e})]}})})}function Rk(t,e){var n=Ck(t.getKey("p256dh")),r=Ck(t.getKey("auth")),i={web:{endpoint:t.endpoint,p256dh:n,auth:r}};return Ik(e.buffer,Ek.buffer)||(i.web.applicationPubKey=Ck(e)),i}function Ok(t){for(var e=(t+"=".repeat((4-t.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var Pk="undefined",Mk="fcm_token_object_Store";function xk(e){var n=indexedDB.open(Pk);n.onerror=function(t){},n.onsuccess=function(t){!function(n,r){if(n.objectStoreNames.contains(Mk)){var t=n.transaction(Mk).objectStore(Mk),i=new Nk,o=t.openCursor();o.onerror=function(t){console.warn("Unable to cleanup old IDB.",t)},o.onsuccess=function(){var t=o.result;if(t){var e=t.value;i.deleteToken(r,e),t.continue()}else n.close(),indexedDB.deleteDatabase(Pk)}}}(n.result,e)}}var Lk=(Fk.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},Fk.prototype.getIndex=function(e,n){return this.createTransaction(function(t){return t.index(e).get(n)})},Fk.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},Fk.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},Fk.prototype.closeDatabase=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:t.sent().close(),this.dbPromise=null,t.label=2;case 2:return[2]}})})},Fk.prototype.createTransaction=function(o,a){return void 0===a&&(a="readonly"),ya(this,void 0,void 0,function(){var e,n,r,i;return ga(this,function(t){switch(t.label){case 0:return[4,this.getDb()];case 1:return e=t.sent(),n=e.transaction(this.objectStoreName,a),r=n.objectStore(this.objectStoreName),[4,function(n){return new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(){e(n.error)}})}(o(r))];case 2:return i=t.sent(),[2,new Promise(function(t,e){n.oncomplete=function(){t(i)},n.onerror=function(){e(n.error)}})]}})})},Fk.prototype.getDb=function(){var r=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,e){var n=indexedDB.open(r.dbName,r.dbVersion);n.onsuccess=function(){t(n.result)},n.onerror=function(){r.dbPromise=null,e(n.error)},n.onupgradeneeded=function(t){return r.onDbUpgrade(n,t)}})),this.dbPromise},Fk);function Fk(){this.dbPromise=null}var Uk,Vk=(da(qk,Uk=Lk),qk.prototype.onDbUpgrade=function(t,e){var n=t.result;switch(e.oldVersion){case 0:(i=n.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),i.createIndex("fcmToken","fcmToken",{unique:!0});case 1:xk(this.services);case 2:var r=(i=t.transaction.objectStore(this.objectStoreName)).openCursor();r.onsuccess=function(){var t=r.result;if(t){var e=t.value,n=ma({},e);e.createTime||(n.createTime=Date.now()),"string"==typeof e.vapidKey&&(n.vapidKey=Ok(e.vapidKey)),"string"==typeof e.auth&&(n.auth=Ok(e.auth).buffer),"string"==typeof e.auth&&(n.p256dh=Ok(e.p256dh).buffer),"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}};break;case 3:var i,o=(i=t.transaction.objectStore(this.objectStoreName)).openCursor();o.onsuccess=function(){var t=o.result;if(t){var e=t.value,n=ma({},e);"string"==typeof e.fcmPushSet&&delete n.fcmPushSet,t.update(n),t.continue()}}}},qk.prototype.getTokenDetailsFromToken=function(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){if(!e)throw Tk.create("bad-token");return Bk({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},qk.prototype.getTokenDetailsFromSWScope=function(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){if(!e)throw Tk.create("bad-scope");return Bk({swScope:e}),[2,this.get(e)]})})},qk.prototype.saveTokenDetails=function(e){return ya(this,void 0,void 0,function(){return ga(this,function(t){if(!e.swScope)throw Tk.create("bad-scope");if(!e.vapidKey)throw Tk.create("bad-vapid-key");if(!e.endpoint||!e.auth||!e.p256dh)throw Tk.create("bad-subscription");if(!e.fcmSenderId)throw Tk.create("bad-sender-id");if(!e.fcmToken)throw Tk.create("bad-token");return Bk(e),[2,this.put(e)]})})},qk.prototype.deleteToken=function(n){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return"string"!=typeof n||0===n.length?[2,Promise.reject(Tk.create("invalid-delete-token"))]:[4,this.getTokenDetailsFromToken(n)];case 1:if(!(e=t.sent()))throw Tk.create("delete-token-not-found");return[4,this.delete(e.swScope)];case 2:return t.sent(),[2,e]}})})},qk);function qk(t){var e=Uk.call(this)||this;return e.services=t,e.dbName="fcm_token_details_db",e.dbVersion=4,e.objectStoreName="fcm_token_object_Store",e}function Bk(t){if(t.fcmToken&&("string"!=typeof t.fcmToken||0===t.fcmToken.length))throw Tk.create("bad-token");if(t.swScope&&("string"!=typeof t.swScope||0===t.swScope.length))throw Tk.create("bad-scope");if(t.vapidKey&&(!(t.vapidKey instanceof Uint8Array)||65!==t.vapidKey.length))throw Tk.create("bad-vapid-key");if(t.endpoint&&("string"!=typeof t.endpoint||0===t.endpoint.length))throw Tk.create("bad-subscription");if(t.auth&&!(t.auth instanceof ArrayBuffer))throw Tk.create("bad-subscription");if(t.p256dh&&!(t.p256dh instanceof ArrayBuffer))throw Tk.create("bad-subscription");if(t.fcmSenderId&&("string"!=typeof t.fcmSenderId||0===t.fcmSenderId.length))throw Tk.create("bad-sender-id")}var jk,Wk=(da(Kk,jk=Lk),Kk.prototype.onDbUpgrade=function(t){t.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},Kk.prototype.getVapidFromSWScope=function(n){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:if("string"!=typeof n||0===n.length)throw Tk.create("bad-scope");return[4,this.get(n)];case 1:return[2,(e=t.sent())?e.vapidKey:void 0]}})})},Kk.prototype.saveVapidDetails=function(n,r){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){if("string"!=typeof n||0===n.length)throw Tk.create("bad-scope");if(null===r||65!==r.length)throw Tk.create("bad-vapid-key");return e={swScope:n,vapidKey:r},[2,this.put(e)]})})},Kk.prototype.deleteVapidDetails=function(n){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return[4,this.getVapidFromSWScope(n)];case 1:if(!(e=t.sent()))throw Tk.create("delete-scope-not-found");return[4,this.delete(n)];case 2:return t.sent(),[2,e]}})})},Kk);function Kk(){var t=null!==jk&&jk.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}var Qk=(Hk.prototype.getToken=function(){return ya(this,void 0,void 0,function(){var e,n,r,i,o;return ga(this,function(t){switch(t.label){case 0:return"default"!==(e=this.getNotificationPermission())?[3,2]:[4,this.requestNotificationPermission()];case 1:e=t.sent(),t.label=2;case 2:if("granted"!==e)throw Tk.create("notifications-blocked");return[4,this.getSWRegistration_()];case 3:return n=t.sent(),[4,this.getPublicVapidKey_()];case 4:return r=t.sent(),[4,this.getPushSubscription(n,r)];case 5:return i=t.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(n.scope)];case 6:return(o=t.sent())?[2,this.manageExistingToken(n,i,r,o)]:[2,this.getNewToken(n,i,r)]}})})},Hk.prototype.manageExistingToken=function(e,n,r,i){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return function(t,e,n){if(!n.vapidKey||!Ik(e.buffer,n.vapidKey.buffer))return!1;var r=t.endpoint===n.endpoint,i=Ik(t.getKey("auth"),n.auth),o=Ik(t.getKey("p256dh"),n.p256dh);return r&&i&&o}(n,r,i)?Date.now()<i.createTime+6048e5?[2,i.fcmToken]:[2,this.updateToken(e,n,r,i)]:[3,1];case 1:return[4,this.deleteTokenFromDB(i.fcmToken)];case 2:return t.sent(),[2,this.getNewToken(e,n,r)];case 3:return[2]}})})},Hk.prototype.updateToken=function(i,o,a,s){return ya(this,void 0,void 0,function(){var e,n,r;return ga(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,6]),[4,this.subscriptionManager.updateToken(s,this.services,o,a)];case 1:return e=t.sent(),n={swScope:i.scope,vapidKey:a,fcmSenderId:this.services.app.options.messagingSenderId,fcmToken:e,createTime:Date.now(),endpoint:o.endpoint,auth:o.getKey("auth"),p256dh:o.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(i.scope,a)];case 3:return t.sent(),[2,e];case 4:return r=t.sent(),[4,this.deleteToken(s.fcmToken)];case 5:throw t.sent(),r;case 6:return[2]}})})},Hk.prototype.getNewToken=function(r,i,o){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,this.subscriptionManager.getToken(this.services,i,o)];case 1:return e=t.sent(),n={swScope:r.scope,vapidKey:o,fcmSenderId:this.app.options.messagingSenderId,fcmToken:e,createTime:Date.now(),endpoint:i.endpoint,auth:i.getKey("auth"),p256dh:i.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(n)];case 2:return t.sent(),[4,this.vapidDetailsModel.saveVapidDetails(r.scope,o)];case 3:return t.sent(),[2,e]}})})},Hk.prototype.deleteToken=function(r){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,this.deleteTokenFromDB(r)];case 1:return t.sent(),[4,this.getSWRegistration_()];case 2:return(e=t.sent())?[4,e.pushManager.getSubscription()]:[3,4];case 3:if(n=t.sent())return[2,n.unsubscribe()];t.label=4;case 4:return[2,!0]}})})},Hk.prototype.deleteTokenFromDB=function(r){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,this.tokenDetailsModel.deleteToken(r)];case 1:e=t.sent(),t.label=2;case 2:return t.trys.push([2,4,,5]),[4,this.subscriptionManager.deleteToken(this.services,e)];case 3:return t.sent(),[3,5];case 4:return n=t.sent(),console.error(n),[3,5];case 5:return[2]}})})},Hk.prototype.getPushSubscription=function(n,r){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return[4,n.pushManager.getSubscription()];case 1:return(e=t.sent())?[2,e]:[2,n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:r})]}})})},Hk.prototype.requestPermission=function(){throw Tk.create("only-available-in-window")},Hk.prototype.useServiceWorker=function(t){throw Tk.create("only-available-in-window")},Hk.prototype.usePublicVapidKey=function(t){throw Tk.create("only-available-in-window")},Hk.prototype.onMessage=function(t,e,n){throw Tk.create("only-available-in-window")},Hk.prototype.onTokenRefresh=function(t,e,n){throw Tk.create("only-available-in-window")},Hk.prototype.setBackgroundMessageHandler=function(t){throw Tk.create("only-available-in-sw")},Hk.prototype.delete=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return t.sent(),[2]}})})},Hk.prototype.getNotificationPermission=function(){return Notification.permission},Hk.prototype.requestNotificationPermission=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){return Notification.requestPermission?[2,Notification.requestPermission()]:[2,Notification.permission]})})},Hk.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},Hk.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},Hk.prototype.getSubscriptionManager=function(){return this.subscriptionManager},Hk);function Hk(t){var e=this;this.services=t,this.vapidDetailsModel=new Wk,this.subscriptionManager=new Nk;var n=t.app;if(!(this.app=n).options.messagingSenderId||"string"!=typeof n.options.messagingSenderId)throw Tk.create("bad-sender-id");this.INTERNAL={delete:function(){return e.delete()}},this.tokenDetailsModel=new Vk(t)}var Gk,zk="FCM_MSG",Yk=(da(Xk,Gk=Qk),Xk.prototype.onPush=function(t){t.waitUntil(this.onPush_(t))},Xk.prototype.onSubChange=function(t){t.waitUntil(this.onSubChange_(t))},Xk.prototype.onNotificationClick=function(t){t.waitUntil(this.onNotificationClick_(t))},Xk.prototype.onPush_=function(s){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a;return ga(this,function(t){switch(t.label){case 0:if(!s.data)return[2];try{e=s.data.json()}catch(t){return[2]}return[4,this.hasVisibleClients_()];case 1:return t.sent()?[2,this.sendMessageToWindowClients_(e)]:(n=this.getNotificationData_(e))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=t.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(e)]:[3,5];case 4:return t.sent(),[2];case 5:return[2]}})})},Xk.prototype.onSubChange_=function(t){return ya(this,void 0,void 0,function(){var e,n,r,i;return ga(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=t.sent(),[3,3];case 2:throw n=t.sent(),Tk.create("unable-to-resubscribe",{errorInfo:n});case 3:return t.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return t.sent(),[3,8];case 5:return r=t.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(i=t.sent()))throw r;return[4,this.deleteToken(i.fcmToken)];case 7:throw t.sent(),r;case 8:return[2]}})})},Xk.prototype.onNotificationClick_=function(o){return ya(this,void 0,void 0,function(){var e,n,r,i;return ga(this,function(t){switch(t.label){case 0:if(!(o.notification&&o.notification.data&&o.notification.data[zk]))return[2];if(o.action)return[2];if(o.stopImmediatePropagation(),o.notification.close(),!(e=o.notification.data[zk]).notification)return[2];if(!(n=e.fcmOptions&&e.fcmOptions.link||e.notification.click_action)){if(!(e.data&&Sk in e.data))return[2];n=self.location.origin}return[4,this.getWindowClient_(n)];case 1:return(r=t.sent())?[3,4]:[4,self.clients.openWindow(n)];case 2:return r=t.sent(),[4,function(e){return new Promise(function(t){setTimeout(t,e)})}(3e3)];case 3:return t.sent(),[3,6];case 4:return[4,r.focus()];case 5:r=t.sent(),t.label=6;case 6:return r?(delete e.notification,delete e.fcmOptions,i=$k(bk.NOTIFICATION_CLICKED,e),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},Xk.prototype.getNotificationData_=function(t){var e;if(t&&"object"==typeof t.notification){var n=ma({},t.notification);return n.data=ma(ma({},t.notification.data),((e={})[zk]=t,e)),n}},Xk.prototype.setBackgroundMessageHandler=function(t){if(!t||"function"!=typeof t)throw Tk.create("bg-handler-function-expected");this.bgMessageHandler=t},Xk.prototype.getWindowClient_=function(o){return ya(this,void 0,void 0,function(){var e,n,r,i;return ga(this,function(t){switch(t.label){case 0:return e=new URL(o,self.location.href).href,[4,Jk()];case 1:for(n=t.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===e){r=n[i];break}return[2,r]}})})},Xk.prototype.attemptToMessageClient_=function(e,n){return ya(this,void 0,void 0,function(){return ga(this,function(t){if(!e)throw Tk.create("no-window-client-to-msg");return e.postMessage(n),[2]})})},Xk.prototype.hasVisibleClients_=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,Jk()];case 1:return[2,t.sent().some(function(t){return"visible"===t.visibilityState&&!t.url.startsWith("chrome-extension://")})]}})})},Xk.prototype.sendMessageToWindowClients_=function(i){return ya(this,void 0,void 0,function(){var e,n,r=this;return ga(this,function(t){switch(t.label){case 0:return[4,Jk()];case 1:return e=t.sent(),n=$k(bk.PUSH_MSG_RECEIVED,i),[4,Promise.all(e.map(function(t){return r.attemptToMessageClient_(t,n)}))];case 2:return t.sent(),[2]}})})},Xk.prototype.getSWRegistration_=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){return[2,self.registration]})})},Xk.prototype.getPublicVapidKey_=function(){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=t.sent()))throw Tk.create("sw-registration-expected");return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(n=t.sent())?[2,Ek]:[2,n]}})})},Xk);function Xk(t){var e=Gk.call(this,t)||this;return e.bgMessageHandler=null,self.addEventListener("push",function(t){e.onPush(t)}),self.addEventListener("pushsubscriptionchange",function(t){e.onSubChange(t)}),self.addEventListener("notificationclick",function(t){e.onNotificationClick(t)}),e}function Jk(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function $k(t,e){return{firebaseMessagingType:t,firebaseMessagingData:e}}var Zk,tD=(da(eD,Zk=Qk),eD.prototype.requestPermission=function(){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?Tk.create("permission-blocked"):Tk.create("permission-default")}})})},eD.prototype.useServiceWorker=function(t){if(!(t instanceof ServiceWorkerRegistration))throw Tk.create("sw-registration-expected");if(null!=this.registrationToUse)throw Tk.create("use-sw-before-get-token");this.registrationToUse=t},eD.prototype.usePublicVapidKey=function(t){if("string"!=typeof t)throw Tk.create("invalid-public-vapid-key");if(null!=this.publicVapidKeyToUse)throw Tk.create("use-public-key-before-get-token");var e=Ok(t);if(65!==e.length)throw Tk.create("public-vapid-key-decryption-failed");this.publicVapidKeyToUse=e},eD.prototype.onMessage=function(t,e,n){return"function"==typeof t?this.onMessageInternal(t,e,n):this.onMessageInternal(t)},eD.prototype.onTokenRefresh=function(t,e,n){return"function"==typeof t?this.onTokenRefreshInternal(t,e,n):this.onTokenRefreshInternal(t)},eD.prototype.waitForRegistrationToActivate_=function(r){var i=r.installing||r.waiting||r.active;return new Promise(function(t,e){if(i)if("activated"!==i.state)if("redundant"!==i.state){var n=function(){if("activated"===i.state)t(r);else{if("redundant"!==i.state)return;e(Tk.create("sw-reg-redundant"))}i.removeEventListener("statechange",n)};i.addEventListener("statechange",n)}else e(Tk.create("sw-reg-redundant"));else t(r);else e(Tk.create("no-sw-in-reg"))})},eD.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(t){throw Tk.create("failed-serviceworker-registration",{browserErrorMessage:t.message})}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return(e.registrationToUse=t).update(),t})}))},eD.prototype.getPublicVapidKey_=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,Ek]})})},eD.prototype.setupSWMessageListener_=function(){var t=this;navigator.serviceWorker.addEventListener("message",function(a){return ya(t,void 0,void 0,function(){var e,n,r,i,o;return ga(this,function(t){switch(t.label){case 0:return a.data&&a.data.firebaseMessagingType&&a.data.firebaseMessagingData?(e=a.data,n=e.firebaseMessagingType,r=e.firebaseMessagingData,this.messageObserver&&this.messageObserver.next(r),(i=r.data)&&Sk in i&&"1"===i["google.c.a.e"]?(o=function(t){switch(t){case bk.NOTIFICATION_CLICKED:return"notification_open";case bk.PUSH_MSG_RECEIVED:return"notification_foreground";default:throw new Error}}(n),[4,this.services.analyticsProvider.get()]):[3,2]):[2];case 1:t.sent().logEvent(o,{message_name:i["google.c.a.c_l"],message_id:i[Sk],message_time:i["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),t.label=2;case 2:return[2]}})})},!1)},eD);function eD(t){var e=Zk.call(this,t)||this;return e.registrationToUse=null,e.publicVapidKeyToUse=null,e.messageObserver=null,e.tokenRefreshObserver=null,e.onMessageInternal=Ja(function(t){e.messageObserver=t}),e.onTokenRefreshInternal=Ja(function(t){e.tokenRefreshObserver=t}),e.setupSWMessageListener_(),e}var nD,rD;function iD(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}rD={isSupported:iD},(nD=fl).INTERNAL.registerComponent(new as("messaging",function(t){var e={app:t.getProvider("app").getImmediate(),installations:t.getProvider("installations").getImmediate(),analyticsProvider:t.getProvider("analytics-internal")};if(!iD())throw Tk.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new Yk(e):new tD(e)},"PUBLIC").setServiceProps(rD)),nD.registerVersion("@firebase/messaging","0.6.1");var oD="firebasestorage.googleapis.com",aD="storageBucket",sD=(uD.prototype.codeProp=function(){return this.code},uD.prototype.codeEquals=function(t){return hD(t)===this.codeProp()},uD.prototype.serverResponseProp=function(){return this.serverResponse_},uD.prototype.setServerResponseProp=function(t){this.serverResponse_=t},Object.defineProperty(uD.prototype,"name",{get:function(){return this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(uD.prototype,"code",{get:function(){return this.code_},enumerable:!0,configurable:!0}),Object.defineProperty(uD.prototype,"message",{get:function(){return this.message_},enumerable:!0,configurable:!0}),Object.defineProperty(uD.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:!0,configurable:!0}),uD);function uD(t,e){this.code_=hD(t),this.message_="Firebase Storage: "+e,this.serverResponse_=null,this.name_="FirebaseError"}var cD={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function hD(t){return"storage/"+t}function lD(){return new sD(cD.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function fD(){return new sD(cD.CANCELED,"User canceled the upload/download.")}function pD(){return new sD(cD.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function dD(t,e,n){return new sD(cD.INVALID_ARGUMENT,"Invalid argument in `"+e+"` at index "+t+": "+n)}function mD(){return new sD(cD.APP_DELETED,"The Firebase app was deleted.")}function yD(t,e){return new sD(cD.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function gD(t){throw new sD(cD.INTERNAL_ERROR,"Internal error: "+t)}var vD={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function bD(t){switch(t){case vD.RAW:case vD.BASE64:case vD.BASE64URL:case vD.DATA_URL:return;default:throw"Expected one of the event types: ["+vD.RAW+", "+vD.BASE64+", "+vD.BASE64URL+", "+vD.DATA_URL+"]."}}var wD=function(t,e){this.data=t,this.contentType=e||null};function _D(t,e){switch(t){case vD.RAW:return new wD(TD(e));case vD.BASE64:case vD.BASE64URL:return new wD(ED(t,e));case vD.DATA_URL:return new wD(function(t){var e=new SD(t);return e.base64?ED(vD.BASE64,e.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(t){throw yD(vD.DATA_URL,"Malformed data URL.")}return TD(e)}(e.rest)}(e),function(t){return new SD(t).contentType}(e))}throw lD()}function TD(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1)))r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r);else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function ED(e,t){switch(e){case vD.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw yD(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case vD.BASE64URL:var i=-1!==t.indexOf("+"),o=-1!==t.indexOf("/");if(i||o)throw yD(e,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var a;try{a=atob(t)}catch(t){throw yD(e,"Invalid character found")}for(var s=new Uint8Array(a.length),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return s}var SD=function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw yD(vD.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=e[1]||null;null!=n&&(this.base64=function(t,e){return t.length>=e.length&&t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=t.substring(t.indexOf(",")+1)};var ID,CD,ND={STATE_CHANGED:"state_changed"},AD="running",kD="pausing",DD="paused",RD="success",OD="canceling",PD="canceled",MD="error",xD={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function LD(t){switch(t){case AD:case kD:case OD:return xD.RUNNING;case DD:return xD.PAUSED;case RD:return xD.SUCCESS;case PD:return xD.CANCELED;case MD:default:return xD.ERROR}}function FD(t){return null!=t}function UD(t){return void 0!==t}function VD(t){return"function"==typeof t}function qD(t){return"object"==typeof t}function BD(t){return"string"==typeof t||t instanceof String}function jD(t){return"number"==typeof t||t instanceof Number}function WD(t){return KD()&&t instanceof Blob}function KD(){return"undefined"!=typeof Blob}(CD=ID=ID||{})[CD.NO_ERROR=0]="NO_ERROR",CD[CD.NETWORK_ERROR=1]="NETWORK_ERROR",CD[CD.ABORT=2]="ABORT";var QD=(HD.prototype.send=function(t,e,n,r){if(this.sent_)throw gD("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),FD(r))for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return FD(n)?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},HD.prototype.getErrorCode=function(){if(!this.sent_)throw gD("cannot .getErrorCode() before sending");return this.errorCode_},HD.prototype.getStatus=function(){if(!this.sent_)throw gD("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}},HD.prototype.getResponseText=function(){if(!this.sent_)throw gD("cannot .getResponseText() before sending");return this.xhr_.responseText},HD.prototype.abort=function(){this.xhr_.abort()},HD.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},HD.prototype.addUploadProgressListener=function(t){FD(this.xhr_.upload)&&this.xhr_.upload.addEventListener("progress",t)},HD.prototype.removeUploadProgressListener=function(t){FD(this.xhr_.upload)&&this.xhr_.upload.removeEventListener("progress",t)},HD);function HD(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=ID.NO_ERROR,this.sendPromise_=new Promise(function(t){e.xhr_.addEventListener("abort",function(){e.errorCode_=ID.ABORT,t(e)}),e.xhr_.addEventListener("error",function(){e.errorCode_=ID.NETWORK_ERROR,t(e)}),e.xhr_.addEventListener("load",function(){t(e)})})}var GD=(zD.prototype.createXhrIo=function(){return new QD},zD);function zD(){}function YD(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(KD())return new Blob(t);throw Error("This browser doesn't seem to support creating Blobs")}var XD=(JD.prototype.size=function(){return this.size_},JD.prototype.type=function(){return this.type_},JD.prototype.slice=function(t,e){if(WD(this.data_)){var n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new JD(n)}return new JD(new Uint8Array(this.data_.buffer,t,e-t),!0)},JD.getBlob=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(KD()){var n=t.map(function(t){return t instanceof JD?t.data_:t});return new JD(YD.apply(null,n))}var r=t.map(function(t){return BD(t)?_D(vD.RAW,t).data:t.data_}),i=0;r.forEach(function(t){i+=t.byteLength});var o=new Uint8Array(i),a=0;return r.forEach(function(t){for(var e=0;e<t.length;e++)o[a++]=t[e]}),new JD(o,!0)},JD.prototype.uploadData=function(){return this.data_},JD);function JD(t,e){var n=0,r="";WD(t)?(n=(this.data_=t).size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}var $D=(Object.defineProperty(ZD.prototype,"path",{get:function(){return this.path_},enumerable:!0,configurable:!0}),Object.defineProperty(ZD.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!0,configurable:!0}),ZD.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},ZD.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},ZD.makeFromBucketSpec=function(e){var t;try{t=ZD.makeFromUrl(e)}catch(t){return new ZD(e,"")}if(""===t.path)return t;throw function(t){return new sD(cD.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}(e)},ZD.makeFromUrl=function(t){for(var e=null,n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i"),i=oD.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+i+"/v[A-Za-z0-9_]+/b/"+n+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:function(t){t.path_=decodeURIComponent(t.path)}}],a=0;a<o.length;a++){var s=o[a],u=s.regex.exec(t);if(u){var c=u[s.indices.bucket],h=u[s.indices.path];e=new ZD(c,h=h||""),s.postModify(e);break}}if(null==e)throw function(t){return new sD(cD.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return e},ZD);function ZD(t,e){this.bucket=t,this.path_=e}function tR(t){var e;try{e=JSON.parse(t)}catch(t){return null}return function(t){return qD(t)&&!Array.isArray(t)}(e)?e:null}function eR(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function nR(t){return"https://"+oD+"/v0"+t}function rR(t){var e=encodeURIComponent,n="?";for(var r in t){if(t.hasOwnProperty(r))n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1)}function iR(t,e){return e}var oR=function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||iR},aR=null;function sR(){if(aR)return aR;var t=[];t.push(new oR("bucket")),t.push(new oR("generation")),t.push(new oR("metageneration")),t.push(new oR("name","fullPath",!0));var e=new oR("name");e.xform=function(t,e){return function(t){return!BD(t)||t.length<2?t:eR(t)}(e)},t.push(e);var n=new oR("size");return n.xform=function(t,e){return FD(e)?Number(e):e},t.push(n),t.push(new oR("timeCreated")),t.push(new oR("updated")),t.push(new oR("md5Hash",null,!0)),t.push(new oR("cacheControl",null,!0)),t.push(new oR("contentDisposition",null,!0)),t.push(new oR("contentEncoding",null,!0)),t.push(new oR("contentLanguage",null,!0)),t.push(new oR("contentType",null,!0)),t.push(new oR("metadata","customMetadata",!0)),aR=t}function uR(r,i){Object.defineProperty(r,"ref",{get:function(){var t=r.bucket,e=r.fullPath,n=new $D(t,e);return i.makeStorageReference(n)}})}function cR(t,e,n){var r=tR(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var a=n[o];r[a.local]=a.xform(r,e[a.server])}return uR(r,t),r}(t,r,n)}function hR(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}function lR(t){if(!qD(t)||!t)throw"Expected Metadata object.";for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if("customMetadata"===e){if(!qD(n))throw"Expected object for 'customMetadata' mapping."}else if(qD(r=n)&&null!==r)throw"Mapping for '"+e+"' cannot be an object."}var r}var fR="maxResults",pR=1e3,dR="pageToken",mR="prefixes",yR="items";function gR(t,e){var n={prefixes:[],items:[],nextPageToken:e.nextPageToken},r=t.bucket();if(null===r)throw new sD(cD.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+aD+"' property when initializing the app?");if(e[mR])for(var i=0,o=e[mR];i<o.length;i++){var a=o[i].replace(/\/$/,""),s=t.makeStorageReference(new $D(r,a));n.prefixes.push(s)}if(e[yR])for(var u=0,c=e[yR];u<c.length;u++){var h=c[u];s=t.makeStorageReference(new $D(r,h.name));n.items.push(s)}return n}function vR(t){if(!qD(t)||!t)throw"Expected ListOptions object.";for(var e in t)if(e===fR){if(!jD(n=t[fR])||!Number.isInteger(n)||t[fR]<=0)throw"Expected maxResults to be a positive number.";if(1e3<t[fR])throw"Expected maxResults to be less than or equal to "+pR+"."}else{if(e!==dR)throw"Unknown option: "+e;if(t[dR]&&!BD(t[dR]))throw"Expected pageToken to be string."}var n}var bR=function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function wR(t){if(!t)throw lD()}function _R(r,i){return function(t,e){var n=cR(r,e,i);return wR(null!==n),n}}function TR(r){return function(t,e){var n=function(t,e){var n=tR(e);return null===n?null:gR(t,n)}(r,e);return wR(null!==n),n}}function ER(r,i){return function(t,e){var n=cR(r,e,i);return wR(null!==n),function(r,t){var e=tR(t);if(null===e)return null;if(!BD(e.downloadTokens))return null;var n=e.downloadTokens;if(0===n.length)return null;var i=encodeURIComponent;return n.split(",").map(function(t){var e=r.bucket,n=r.fullPath;return nR("/b/"+i(e)+"/o/"+i(n))+rR({alt:"media",token:t})})[0]}(n,e)}}function SR(r){return function(t,e){var n;return(n=401===t.getStatus()?new sD(cD.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?function(t){return new sD(cD.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(r.bucket):403===t.getStatus()?function(t){return new sD(cD.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}(r.path):e).setServerResponseProp(e.serverResponseProp()),n}}function IR(r){var i=SR(r);return function(t,e){var n=i(t,e);return 404===t.getStatus()&&(n=function(t){return new sD(cD.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}(r.path)),n.setServerResponseProp(e.serverResponseProp()),n}}function CR(t,e,n){var r=nR(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new bR(r,"GET",_R(t,n),i);return o.errorHandler=IR(e),o}function NR(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}function AR(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"};var s=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();a["Content-Type"]="multipart/related; boundary="+s;var u=NR(e,r,i),c="--"+s+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+hR(u,n)+"\r\n--"+s+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",h="\r\n--"+s+"--",l=XD.getBlob(c,r,h);if(null===l)throw pD();var f={name:u.fullPath},p=nR(o),d=t.maxUploadRetryTime(),m=new bR(p,"POST",_R(t,n),d);return m.urlParams=f,m.headers=a,m.body=l.uploadData(),m.errorHandler=SR(e),m}var kR=function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null};function DR(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){wR(!1)}return wR(!!n&&-1!==(e||["active"]).indexOf(n)),n}function RR(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),a=NR(e,r,i),s={name:a.fullPath},u=nR(o),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":r.size(),"X-Goog-Upload-Header-Content-Type":a.contentType,"Content-Type":"application/json; charset=utf-8"},h=hR(a,n),l=t.maxUploadRetryTime();var f=new bR(u,"POST",function(t){var e;DR(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){wR(!1)}return wR(BD(e)),e},l);return f.urlParams=s,f.headers=c,f.body=h,f.errorHandler=SR(e),f}function OR(t,e,n,i){var r=t.maxUploadRetryTime(),o=new bR(n,"POST",function(t){var e=DR(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){wR(!1)}n||wR(!1);var r=Number(n);return wR(!isNaN(r)),new kR(r,i.size(),"final"===e)},r);return o.headers={"X-Goog-Upload-Command":"query"},o.errorHandler=SR(e),o}function PR(t,a,e,s,n,u,r,i){var c=new kR(0,0);if(r?(c.current=r.current,c.total=r.total):(c.current=0,c.total=s.size()),s.size()!==c.total)throw new sD(cD.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var o=c.total-c.current,h=o;0<n&&(h=Math.min(h,n));var l=c.current,f=l+h,p={"X-Goog-Upload-Command":h===o?"upload, finalize":"upload","X-Goog-Upload-Offset":c.current},d=s.slice(l,f);if(null===d)throw pD();var m=a.maxUploadRetryTime(),y=new bR(e,"POST",function(t,e){var n,r=DR(t,["active","final"]),i=c.current+h,o=s.size();return n="final"===r?_R(a,u)(t,e):null,new kR(i,o,"final"===r,n)},m);return y.headers=p,y.body=d.uploadData(),y.progressCallback=i||null,y.errorHandler=SR(t),y}var MR=function(t,e,n){if(VD(t)||FD(e)||FD(n))this.next=t,this.error=e||null,this.complete=n||null;else{var r=t;this.next=r.next||null,this.error=r.error||null,this.complete=r.complete||null}},xR=function(t,e,n,r,i,o){this.bytesTransferred=t,this.totalBytes=e,this.state=n,this.metadata=r,this.task=i,this.ref=o};function LR(e,t,n){for(var r=t.length,i=t.length,o=0;o<t.length;o++)if(t[o].optional){r=o;break}if(!(r<=n.length&&n.length<=i))throw function(t,e,n,r){var i,o;return o=t===e?1===(i=t)?"argument":"arguments":(i="between "+t+" and "+e,"arguments"),new sD(cD.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+n+"`: Expected "+i+" "+o+", received "+r+".")}(r,i,e,n.length);for(o=0;o<n.length;o++)try{t[o].validator(n[o])}catch(t){throw t instanceof Error?dD(o,e,t.message):dD(o,e,t)}}var FR=function(e,t){var n=this;this.validator=function(t){n.optional&&!UD(t)||e(t)},this.optional=!!t};function UR(t,e){function n(t){if(!BD(t))throw"Expected string."}var r;return r=t?function(e,n){return function(t){e(t),n(t)}}(n,t):n,new FR(r,e)}function VR(){return new FR(function(t){if(!(t instanceof Uint8Array||t instanceof ArrayBuffer||KD()&&t instanceof Blob))throw"Expected Blob or File."})}function qR(t){return new FR(lR,t)}function BR(){return new FR(function(t){if(!(jD(t)&&0<=t))throw"Expected a number 0 or greater."})}function jR(e,t){return new FR(function(t){if(!(null===t||FD(t)&&t instanceof Object))throw"Expected an Object.";null!=e&&e(t)},t)}function WR(t){return new FR(function(t){if(!(null===t||VD(t)))throw"Expected a Function."},t)}function KR(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Promise.resolve().then(function(){return n.apply(void 0,t)})}}var QR=(HR.prototype.makeProgressCallback_=function(){var e=this,n=this.transferred_;return function(t){return e.updateProgress_(n+t)}},HR.prototype.shouldDoResumable_=function(t){return 262144<t.size()},HR.prototype.start_=function(){this.state_===AD&&null===this.request_&&(this.resumable_?null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_():this.oneShotUpload_())},HR.prototype.resolveToken_=function(e){var n=this;this.authWrapper_.getAuthToken().then(function(t){switch(n.state_){case AD:e(t);break;case OD:n.transition_(PD);break;case kD:n.transition_(DD)}})},HR.prototype.createResumable_=function(){var r=this;this.resolveToken_(function(t){var e=RR(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.uploadUrl_=t,r.needToFetchStatus_=!1,r.completeTransitions_()},r.errorHandler_)})},HR.prototype.fetchStatus_=function(){var r=this,i=this.uploadUrl_;this.resolveToken_(function(t){var e=OR(r.authWrapper_,r.location_,i,r.blob_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){t=t,r.request_=null,r.updateProgress_(t.current),r.needToFetchStatus_=!1,t.finalized&&(r.needToFetchMetadata_=!0),r.completeTransitions_()},r.errorHandler_)})},HR.prototype.continueUpload_=function(){var r=this,i=262144*this.chunkMultiplier_,o=new kR(this.transferred_,this.blob_.size()),a=this.uploadUrl_;this.resolveToken_(function(t){var e;try{e=PR(r.location_,r.authWrapper_,a,r.blob_,i,r.mappings_,o,r.makeProgressCallback_())}catch(t){return r.error_=t,void r.transition_(MD)}var n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.increaseMultiplier_(),r.request_=null,r.updateProgress_(t.current),t.finalized?(r.metadata_=t.metadata,r.transition_(RD)):r.completeTransitions_()},r.errorHandler_)})},HR.prototype.increaseMultiplier_=function(){262144*this.chunkMultiplier_<33554432&&(this.chunkMultiplier_*=2)},HR.prototype.fetchMetadata_=function(){var r=this;this.resolveToken_(function(t){var e=CR(r.authWrapper_,r.location_,r.mappings_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.transition_(RD)},r.metadataErrorHandler_)})},HR.prototype.oneShotUpload_=function(){var r=this;this.resolveToken_(function(t){var e=AR(r.authWrapper_,r.location_,r.mappings_,r.blob_,r.metadata_),n=r.authWrapper_.makeRequest(e,t);(r.request_=n).getPromise().then(function(t){r.request_=null,r.metadata_=t,r.updateProgress_(r.blob_.size()),r.transition_(RD)},r.errorHandler_)})},HR.prototype.updateProgress_=function(t){var e=this.transferred_;this.transferred_=t,this.transferred_!==e&&this.notifyObservers_()},HR.prototype.transition_=function(t){if(this.state_!==t)switch(t){case OD:case kD:this.state_=t,null!==this.request_&&this.request_.cancel();break;case AD:var e=this.state_===DD;this.state_=t,e&&(this.notifyObservers_(),this.start_());break;case DD:this.state_=t,this.notifyObservers_();break;case PD:this.error_=fD(),this.state_=t,this.notifyObservers_();break;case MD:case RD:this.state_=t,this.notifyObservers_()}},HR.prototype.completeTransitions_=function(){switch(this.state_){case kD:this.transition_(DD);break;case OD:this.transition_(PD);break;case AD:this.start_()}},Object.defineProperty(HR.prototype,"snapshot",{get:function(){var t=LD(this.state_);return new xR(this.transferred_,this.blob_.size(),t,this.metadata_,this,this.ref_)},enumerable:!0,configurable:!0}),HR.prototype.on=function(t,e,n,o){var r="Expected a function or an Object with one of `next`, `error`, `complete` properties.",i=WR(!0).validator,a=jR(null,!0).validator;function s(t){try{return void i(t)}catch(t){}try{if(a(t),!(UD(t.next)||UD(t.error)||UD(t.complete)))throw"";return}catch(t){throw r}}LR("on",[UR(function(){if(t!==ND.STATE_CHANGED)throw"Expected one of the event types: ["+ND.STATE_CHANGED+"]."}),jR(s,!0),WR(!0),WR(!0)],arguments);var u=this;function c(i){return function(t,e,n){null!==i&&LR("on",i,arguments);var r=new MR(t,e,o);return u.addObserver_(r),function(){u.removeObserver_(r)}}}var h=[jR(function(t){if(null===t)throw r;s(t)}),WR(!0),WR(!0)];return UD(e)||UD(n)||UD(o)?c(null)(e,n,o):c(h)},HR.prototype.then=function(t,e){return this.promise_.then(t,e)},HR.prototype.catch=function(t){return this.then(null,t)},HR.prototype.addObserver_=function(t){this.observers_.push(t),this.notifyObserver_(t)},HR.prototype.removeObserver_=function(t){var e=this.observers_.indexOf(t);-1!==e&&this.observers_.splice(e,1)},HR.prototype.notifyObservers_=function(){var e=this;this.finishPromise_(),this.observers_.slice().forEach(function(t){e.notifyObserver_(t)})},HR.prototype.finishPromise_=function(){if(null!==this.resolve_){var t=!0;switch(LD(this.state_)){case xD.SUCCESS:KR(this.resolve_.bind(null,this.snapshot))();break;case xD.CANCELED:case xD.ERROR:KR(this.reject_.bind(null,this.error_))();break;default:t=!1}t&&(this.resolve_=null,this.reject_=null)}},HR.prototype.notifyObserver_=function(t){switch(LD(this.state_)){case xD.RUNNING:case xD.PAUSED:t.next&&KR(t.next.bind(t,this.snapshot))();break;case xD.SUCCESS:t.complete&&KR(t.complete.bind(t))();break;case xD.CANCELED:case xD.ERROR:t.error&&KR(t.error.bind(t,this.error_))();break;default:t.error&&KR(t.error.bind(t,this.error_))()}},HR.prototype.resume=function(){LR("resume",[],arguments);var t=this.state_===DD||this.state_===kD;return t&&this.transition_(AD),t},HR.prototype.pause=function(){LR("pause",[],arguments);var t=this.state_===AD;return t&&this.transition_(kD),t},HR.prototype.cancel=function(){LR("cancel",[],arguments);var t=this.state_===AD||this.state_===kD;return t&&this.transition_(OD),t},HR);function HR(t,e,n,r,i,o){var a=this;void 0===o&&(o=null),this.transferred_=0,this.needToFetchStatus_=!1,this.needToFetchMetadata_=!1,this.observers_=[],this.error_=null,this.uploadUrl_=null,this.request_=null,this.chunkMultiplier_=1,this.resolve_=null,this.reject_=null,this.ref_=t,this.authWrapper_=e,this.location_=n,this.blob_=i,this.metadata_=o,this.mappings_=r,this.resumable_=this.shouldDoResumable_(this.blob_),this.state_=AD,this.errorHandler_=function(t){a.request_=null,a.chunkMultiplier_=1,t.codeEquals(cD.CANCELED)?(a.needToFetchStatus_=!0,a.completeTransitions_()):(a.error_=t,a.transition_(MD))},this.metadataErrorHandler_=function(t){a.request_=null,t.codeEquals(cD.CANCELED)?a.completeTransitions_():(a.error_=t,a.transition_(MD))},this.promise_=new Promise(function(t,e){a.resolve_=t,a.reject_=e,a.start_()}),this.promise_.then(null,function(){})}var GR=(zR.prototype.toString=function(){return LR("toString",[],arguments),"gs://"+this.location.bucket+"/"+this.location.path},zR.prototype.newRef=function(t,e){return new zR(t,e)},zR.prototype.mappings=function(){return sR()},zR.prototype.child=function(t){LR("child",[UR()],arguments);var e=function(t,e){var n=e.split("/").filter(function(t){return 0<t.length}).join("/");return 0===t.length?n:t+"/"+n}(this.location.path,t),n=new $D(this.location.bucket,e);return this.newRef(this.authWrapper,n)},Object.defineProperty(zR.prototype,"parent",{get:function(){var t=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this.location.path);if(null===t)return null;var e=new $D(this.location.bucket,t);return this.newRef(this.authWrapper,e)},enumerable:!0,configurable:!0}),Object.defineProperty(zR.prototype,"root",{get:function(){var t=new $D(this.location.bucket,"");return this.newRef(this.authWrapper,t)},enumerable:!0,configurable:!0}),Object.defineProperty(zR.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!0,configurable:!0}),Object.defineProperty(zR.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!0,configurable:!0}),Object.defineProperty(zR.prototype,"name",{get:function(){return eR(this.location.path)},enumerable:!0,configurable:!0}),Object.defineProperty(zR.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:!0,configurable:!0}),zR.prototype.put=function(t,e){return void 0===e&&(e=null),LR("put",[VR(),qR(!0)],arguments),this.throwIfRoot_("put"),new QR(this,this.authWrapper,this.location,this.mappings(),new XD(t),e)},zR.prototype.putString=function(t,e,n){void 0===e&&(e=vD.RAW),LR("putString",[UR(),UR(bD,!0),qR(!0)],arguments),this.throwIfRoot_("putString");var r=_D(e,t),i=Object.assign({},n);return!FD(i.contentType)&&FD(r.contentType)&&(i.contentType=r.contentType),new QR(this,this.authWrapper,this.location,this.mappings(),new XD(r.data,!0),i)},zR.prototype.delete=function(){var n=this;return LR("delete",[],arguments),this.throwIfRoot_("delete"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e){var n=nR(e.fullServerUrl()),r=t.maxOperationRetryTime(),i=new bR(n,"DELETE",function(t,e){},r);return i.successCodes=[200,204],i.errorHandler=IR(e),i}(n.authWrapper,n.location);return n.authWrapper.makeRequest(e,t).getPromise()})},zR.prototype.listAll=function(){LR("listAll",[],arguments);var t={prefixes:[],items:[]};return this.listAllHelper(t).then(function(){return t})},zR.prototype.listAllHelper=function(o,a){return ya(this,void 0,void 0,function(){var e,n,r,i;return ga(this,function(t){switch(t.label){case 0:return e={pageToken:a},[4,this.list(e)];case 1:return n=t.sent(),(r=o.prefixes).push.apply(r,n.prefixes),(i=o.items).push.apply(i,n.items),null==n.nextPageToken?[3,3]:[4,this.listAllHelper(o,n.nextPageToken)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},zR.prototype.list=function(r){LR("list",[function(t){return new FR(vR,t)}(!0)],arguments);var i=this;return this.authWrapper.getAuthToken().then(function(t){var e=r||{},n=function(t,e,n,r,i){var o={};e.isRoot?o.prefix="":o.prefix=e.path+"/",n&&0<n.length&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var a=nR(e.bucketOnlyServerUrl()),s=t.maxOperationRetryTime(),u=new bR(a,"GET",TR(t),s);return u.urlParams=o,u.errorHandler=SR(e),u}(i.authWrapper,i.location,"/",e.pageToken,e.maxResults);return i.authWrapper.makeRequest(n,t).getPromise()})},zR.prototype.getMetadata=function(){var n=this;return LR("getMetadata",[],arguments),this.throwIfRoot_("getMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=CR(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise()})},zR.prototype.updateMetadata=function(n){var r=this;return LR("updateMetadata",[qR()],arguments),this.throwIfRoot_("updateMetadata"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n,r){var i=nR(e.fullServerUrl()),o=hR(n,r),a=t.maxOperationRetryTime(),s=new bR(i,"PATCH",_R(t,r),a);return s.headers={"Content-Type":"application/json; charset=utf-8"},s.body=o,s.errorHandler=IR(e),s}(r.authWrapper,r.location,n,r.mappings());return r.authWrapper.makeRequest(e,t).getPromise()})},zR.prototype.getDownloadURL=function(){var n=this;return LR("getDownloadURL",[],arguments),this.throwIfRoot_("getDownloadURL"),this.authWrapper.getAuthToken().then(function(t){var e=function(t,e,n){var r=nR(e.fullServerUrl()),i=t.maxOperationRetryTime(),o=new bR(r,"GET",ER(t,n),i);return o.errorHandler=IR(e),o}(n.authWrapper,n.location,n.mappings());return n.authWrapper.makeRequest(e,t).getPromise().then(function(t){if(null===t)throw new sD(cD.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t})})},zR.prototype.throwIfRoot_=function(t){if(""===this.location.path)throw function(t){return new sD(cD.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)},zR);function zR(t,e){this.authWrapper=t,this.location=e instanceof $D?e:$D.makeFromUrl(e)}var YR=(XR.prototype.getPromise=function(){return this.promise_},XR.prototype.cancel=function(t){},XR);function XR(t){this.promise_=Promise.reject(t)}var JR=($R.prototype.addRequest=function(t){var e=this,n=this.id;this.id++,this.map.set(n,t),t.getPromise().then(function(){return e.map.delete(n)},function(){return e.map.delete(n)})},$R.prototype.clear=function(){this.map.forEach(function(t){t&&t.cancel(!0)}),this.map.clear()},$R);function $R(){this.map=new Map,this.id=-9007199254740991}var ZR=(tO.extractBucket_=function(t){var e=t[aD]||null;return null==e?null:$D.makeFromBucketSpec(e).bucket},tO.prototype.getAuthToken=function(){var t=this.authProvider_.getImmediate({optional:!0});return t?t.getToken().then(function(t){return null!==t?t.accessToken:null},function(){return null}):Promise.resolve(null)},tO.prototype.bucket=function(){if(this.deleted_)throw mD();return this.bucket_},tO.prototype.service=function(){return this.service_},tO.prototype.makeStorageReference=function(t){return this.storageRefMaker_(this,t)},tO.prototype.makeRequest=function(t,e){if(this.deleted_)return new YR(mD());var n=this.requestMaker_(t,e,this.pool_);return this.requestMap_.addRequest(n),n},tO.prototype.deleteApp=function(){this.deleted_=!0,this.app_=null,this.requestMap_.clear()},tO.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_},tO.prototype.setMaxUploadRetryTime=function(t){this.maxUploadRetryTime_=t},tO.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_},tO.prototype.setMaxOperationRetryTime=function(t){this.maxOperationRetryTime_=t},tO);function tO(t,e,n,r,i,o){if(this.bucket_=null,this.deleted_=!1,this.app_=t,null!==this.app_){var a=this.app_.options;FD(a)&&(this.bucket_=tO.extractBucket_(a))}this.authProvider_=e,this.storageRefMaker_=n,this.requestMaker_=r,this.pool_=o,this.service_=i,this.maxOperationRetryTime_=12e4,this.maxUploadRetryTime_=6e5,this.requestMap_=new JR}var eO=(nO.prototype.start_=function(){var s=this;function t(t,e){var n,r=s.resolve_,i=s.reject_,o=e.xhr;if(e.wasSuccessCode)try{var a=s.callback_(o,o.getResponseText());UD(a)?r(a):r()}catch(t){i(t)}else null!==o?((n=lD()).setServerResponseProp(o.getResponseText()),s.errorCallback_?i(s.errorCallback_(o,n)):i(n)):e.canceled?i(n=s.appDelete_?mD():fD()):i(n=new sD(cD.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new rO(!1,null,!0)):this.backoffId_=function(e,n,t){var r=1,i=null,o=!1,a=0;function s(){return 2===a}var u=!1;function c(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];u||(u=!0,n.apply(null,t))}function h(t){i=setTimeout(function(){i=null,e(l,s())},t)}function l(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];u||(t?c.call.apply(c,_a([null,t],e)):s()||o?c.call.apply(c,_a([null,t],e)):(r<64&&(r*=2),h(1===a?(a=2,0):1e3*(r+Math.random()))))}var f=!1;function p(t){f||(f=!0,u||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),setTimeout(function(){p(o=!0)},t),p}(function(o,t){if(t)o(!1,new rO(!1,null,!0));else{var e=s.pool_.createXhrIo();s.pendingXhr_=e,null!==s.progressCallback_&&e.addUploadProgressListener(a),e.send(s.url_,s.method_,s.body_,s.headers_).then(function(t){null!==s.progressCallback_&&t.removeUploadProgressListener(a),s.pendingXhr_=null;var e=(t=t).getErrorCode()===ID.NO_ERROR,n=t.getStatus();if(e&&!s.isRetryStatusCode_(n)){var r=-1!==s.successCodes_.indexOf(n);o(!0,new rO(r,t))}else{var i=t.getErrorCode()===ID.ABORT;o(!1,new rO(!1,null,i))}})}function a(t){var e=t.loaded,n=t.lengthComputable?t.total:-1;null!==s.progressCallback_&&s.progressCallback_(e,n)}},t,this.timeout_)},nO.prototype.getPromise=function(){return this.promise_},nO.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&function(t){t(!1)}(this.backoffId_),null!==this.pendingXhr_&&this.pendingXhr_.abort()},nO.prototype.isRetryStatusCode_=function(t){var e=500<=t&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},nO);function nO(t,e,n,r,i,o,a,s,u,c,h){var l=this;this.pendingXhr_=null,this.backoffId_=null,this.resolve_=null,this.reject_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=a,this.errorCallback_=s,this.progressCallback_=c,this.timeout_=u,this.pool_=h,this.promise_=new Promise(function(t,e){l.resolve_=t,l.reject_=e,l.start_()})}var rO=function(t,e,n){this.wasSuccessCode=t,this.xhr=e,this.canceled=!!n};function iO(t,e,n){var r=rR(t.urlParams),i=t.url+r,o=Object.assign({},t.headers);return function(t,e){null!==e&&0<e.length&&(t.Authorization="Firebase "+e)}(o,e),function(t){var e=void 0!==fl?fl.SDK_VERSION:"AppManager";t["X-Firebase-Storage-Version"]="webjs/"+e}(o),new eO(i,t.method,o,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,n)}var oO=(aO.prototype.ref=function(t){if(LR("ref",[UR(function(t){if("string"!=typeof t)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(t))throw"Expected child path but got a URL, use refFromURL instead."},!0)],arguments),null==this.bucket_)throw new Error("No Storage Bucket defined in Firebase Options.");var e=new GR(this.authWrapper_,this.bucket_);return null!=t?e.child(t):e},aO.prototype.refFromURL=function(t){return LR("refFromURL",[UR(function(t){if("string"!=typeof t)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(t))throw"Expected full URL but got a child path, use ref instead.";try{$D.makeFromUrl(t)}catch(t){throw"Expected valid full URL but got an invalid one."}},!1)],arguments),new GR(this.authWrapper_,t)},Object.defineProperty(aO.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:!0,configurable:!0}),aO.prototype.setMaxUploadRetryTime=function(t){LR("setMaxUploadRetryTime",[BR()],arguments),this.authWrapper_.setMaxUploadRetryTime(t)},aO.prototype.setMaxOperationRetryTime=function(t){LR("setMaxOperationRetryTime",[BR()],arguments),this.authWrapper_.setMaxOperationRetryTime(t)},Object.defineProperty(aO.prototype,"app",{get:function(){return this.app_},enumerable:!0,configurable:!0}),Object.defineProperty(aO.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!0,configurable:!0}),aO);function aO(t,e,n,r){if(this.bucket_=null,this.authWrapper_=new ZR(t,e,function(t,e){return new GR(t,e)},iO,this,n),this.app_=t,null!=r)this.bucket_=$D.makeFromBucketSpec(r);else{var i=this.authWrapper_.bucket();null!=i&&(this.bucket_=new $D(i,""))}this.internals_=new sO(this)}var sO=(uO.prototype.delete=function(){return this.service_.authWrapper_.deleteApp(),Promise.resolve()},uO);function uO(t){this.service_=t}var cO,hO;function lO(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal");return new oO(n,r,new GD,e)}hO={TaskState:xD,TaskEvent:ND,StringFormat:vD,Storage:oO,Reference:GR},(cO=fl).INTERNAL.registerComponent(new as("storage",lO,"PUBLIC").setServiceProps(hO).setMultipleInstances(!0)),cO.registerVersion("@firebase/storage","0.3.23");var fO,pO,dO,mO,yO="0.2.29",gO="FB-PERF-TRACE-MEASURE",vO="@firebase/performance/config",bO="@firebase/performance/configexpire",wO="Performance",_O=((fO={})["trace started"]="Trace {$traceName} was started before.",fO["trace stopped"]="Trace {$traceName} is not running.",fO["no window"]="Window is not available.",fO["no app id"]="App id is not available.",fO["no project id"]="Project id is not available.",fO["no api key"]="Api key is not available.",fO["invalid cc log"]="Attempted to queue invalid cc event",fO["FB not default"]="Performance can only start when Firebase app instance is the default one.",fO["RC response not ok"]="RC response is not ok",fO["invalid attribute name"]="Attribute name {$attributeName} is invalid.",fO["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",fO["invalide custom metric name"]="Custom metric name {$customMetricName} is invalid",fO),TO=new Va("performance",wO,_O),EO=(SO.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},SO.prototype.mark=function(t){this.performance&&this.performance.mark&&this.performance.mark(t)},SO.prototype.measure=function(t,e,n){this.performance&&this.performance.measure&&this.performance.measure(t,e,n)},SO.prototype.getEntriesByType=function(t){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(t):[]},SO.prototype.getEntriesByName=function(t){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(t):[]},SO.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},SO.prototype.requiredApisAvailable=function(){return!!(fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled)},SO.prototype.setupObserver=function(t,i){this.PerformanceObserver&&new this.PerformanceObserver(function(t){for(var e=0,n=t.getEntries();e<n.length;e++){var r=n[e];i(r)}}).observe({entryTypes:[t]})},SO.getInstance=function(){return void 0===pO&&(pO=new SO(dO)),pO},SO);function SO(t){if(!(this.window=t))throw TO.create("no window");this.performance=t.performance,this.PerformanceObserver=t.PerformanceObserver,this.windowLocation=t.location,this.navigator=t.navigator,this.document=t.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=t.localStorage),t.perfMetrics&&t.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=t.perfMetrics.onFirstInputDelay)}var IO,CO,NO,AO=(kO.prototype.getAppId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!t)throw TO.create("no app id");return t},kO.prototype.getProjectId=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!t)throw TO.create("no project id");return t},kO.prototype.getApiKey=function(){var t=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!t)throw TO.create("no api key");return t},kO.getInstance=function(){return void 0===mO&&(mO=new kO),mO},kO);function kO(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}function DO(){return IO}(NO=CO=CO||{})[NO.UNKNOWN=0]="UNKNOWN",NO[NO.VISIBLE=1]="VISIBLE",NO[NO.HIDDEN=2]="HIDDEN";var RO=["firebase_","google_","ga_"],OO=new RegExp("^[a-zA-Z]\\w*$");function PO(){switch(EO.getInstance().document.visibilityState){case"visible":return CO.VISIBLE;case"hidden":return CO.HIDDEN;default:return CO.UNKNOWN}}var MO=new bs(wO);MO.logLevel=ls.INFO;var xO="0.0.1",LO={loggingEnabled:!0},FO="FIREBASE_INSTALLATIONS_AUTH";function UO(t){var e=function(){var t=EO.getInstance().localStorage;if(!t)return;var e=t.getItem(bO);if(!e||!function(t){return Number(t)>Date.now()}(e))return;var n=t.getItem(vO);if(!n)return;try{return JSON.parse(n)}catch(t){return}}();return e?(qO(e),Promise.resolve()):function(r){return function(){var t=AO.getInstance().installationsService.getToken();return t.then(function(t){}),t}().then(function(t){var e="https://firebaseremoteconfig.googleapis.com/v1/projects/"+AO.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+AO.getInstance().getApiKey(),n=new Request(e,{method:"POST",headers:{Authorization:FO+" "+t},body:JSON.stringify({app_instance_id:r,app_instance_id_token:t,app_id:AO.getInstance().getAppId(),app_version:yO,sdk_version:xO})});return fetch(n).then(function(t){if(t.ok)return t.json();throw TO.create("RC response not ok")})}).catch(function(){MO.info(VO)})}(t).then(function(t){return qO(t)}).then(function(t){return function(t){var e=EO.getInstance().localStorage;if(!t||!e)return;e.setItem(vO,JSON.stringify(t)),e.setItem(bO,String(Date.now()+60*AO.getInstance().configTimeToLive*60*1e3))}(t)},function(){})}var VO="Could not fetch config, will use default configs";function qO(t){if(!t)return t;var e=AO.getInstance(),n=t.entries||{};return void 0!==n.fpr_enabled?e.loggingEnabled="true"===String(n.fpr_enabled):e.loggingEnabled=LO.loggingEnabled,n.fpr_log_source&&(e.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(e.logEndPointUrl=n.fpr_log_endpoint_url),void 0!==n.fpr_vc_network_request_sampling_rate&&(e.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(e.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),e.logTraceAfterSampling=BO(e.tracesSamplingRate),e.logNetworkAfterSampling=BO(e.networkRequestsSamplingRate),t}function BO(t){return Math.random()<=t}var jO,WO=1;function KO(){return WO=2,jO=jO||function(){var n=EO.getInstance().document;return new Promise(function(t){if(n&&"complete"!==n.readyState){var e=function(){"complete"===n.readyState&&(n.removeEventListener("readystatechange",e),t())};n.addEventListener("readystatechange",e)}else t()})}().then(function(){return function(){var t=AO.getInstance().installationsService.getId();return t.then(function(t){IO=t}),t}()}).then(function(t){return UO(t)}).then(function(){return QO()},function(){return QO()})}function QO(){WO=3}var HO,GO=1e4,zO=3,YO=zO,XO=[];function JO(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t){if(!t.eventTime||!t.message)throw TO.create("invalid cc log");XO=_a(XO,[t])}({message:n.apply(void 0,t),eventTime:Date.now()})}}function $O(t,e){(HO=HO||JO(eP))(t,e)}function ZO(t){var e=AO.getInstance();!e.instrumentationEnabled&&t.isAuto||(e.dataCollectionEnabled||t.isAuto)&&EO.getInstance().requiredApisAvailable()&&(t.isAuto&&PO()!==CO.VISIBLE||e.loggingEnabled&&e.logTraceAfterSampling&&(3===WO?tP(t):KO().then(function(){return tP(t)},function(){return tP(t)})))}function tP(t){DO()&&setTimeout(function(){return $O(t,1)},0)}function eP(t,e){return 0===e?function(t){var e={url:t.url,http_method:t.httpMethod||0,http_response_code:200,response_payload_bytes:t.responsePayloadBytes,client_start_time_us:t.startTimeUs,time_to_response_initiated_us:t.timeToResponseInitiatedUs,time_to_response_completed_us:t.timeToResponseCompletedUs},n={application_info:nP(),network_request_metric:e};return JSON.stringify(n)}(t):function(t){var e={name:t.name,is_auto:t.isAuto,client_start_time_us:t.startTimeUs,duration_us:t.durationUs};0!==Object.keys(t.counters).length&&(e.counters=rP(t.counters));var n=t.getAttributes();0!==Object.keys(n).length&&(e.custom_attributes=rP(n));var r={application_info:nP(),trace_metric:e};return JSON.stringify(r)}(t)}function nP(){return{google_app_id:AO.getInstance().getAppId(),app_instance_id:DO(),web_app_info:{sdk_version:yO,page_url:EO.getInstance().getUrl(),service_worker_status:function(){var t=EO.getInstance().navigator;return"serviceWorker"in t?t.serviceWorker.controller?2:3:1}(),visibility_state:PO(),effective_connection_type:function(){var t=EO.getInstance().navigator.connection;switch(t&&t.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}()},application_process_state:0}}function rP(e){return Object.keys(e).map(function(t){return{key:t,value:e[t]}})}!function r(t){setTimeout(function(){if(0!==YO){if(!XO.length)return r(GO);var t=_a(XO);XO=[];var e=t.map(function(t){return{source_extension_json:t.message,event_time_ms:String(t.eventTime)}}),n={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:AO.getInstance().logSource,log_event:e};fetch(AO.getInstance().logEndPointUrl,{method:"POST",body:JSON.stringify(n)}).then(function(t){return t.ok||MO.info("Call to Firebase backend failed."),t.json()}).then(function(t){var e=Number(t.next_request_wait_millis),n=isNaN(e)?GO:Math.max(GO,e);YO=zO,r(n)}).catch(function(){XO=_a(t,XO),YO--,MO.info("Tries left: "+YO+"."),r(GO)})}},t)}(5500);var iP=["_fp","_fcp","_fid"];var oP=(aP.prototype.start=function(){if(1!==this.state)throw TO.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},aP.prototype.stop=function(){if(2!==this.state)throw TO.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),ZO(this)},aP.prototype.record=function(t,e,n){if(this.durationUs=Math.floor(1e3*e),this.startTimeUs=Math.floor(1e3*t),n&&n.attributes&&(this.customAttributes=ma({},n.attributes)),n&&n.metrics)for(var r=0,i=Object.keys(n.metrics);r<i.length;r++){var o=i[r];isNaN(Number(n.metrics[o]))||(this.counters[o]=Number(Math.floor(n.metrics[o])))}ZO(this)},aP.prototype.incrementMetric=function(t,e){void 0===e&&(e=1),void 0===this.counters[t]&&this.putMetric(t,0),this.counters[t]+=e},aP.prototype.putMetric=function(t,e){if(!function(t,e){return!(0===t.length||100<t.length)&&(e&&e.startsWith("_wt_")&&-1<iP.indexOf(t)||!t.startsWith("_"))}(t,this.name))throw TO.create("invalide custom metric name",{customMetricName:t});this.counters[t]=e},aP.prototype.getMetric=function(t){return this.counters[t]||0},aP.prototype.putAttribute=function(t,e){var n=function(e){return!(0===e.length||40<e.length||RO.some(function(t){return e.startsWith(t)})||!e.match(OO))}(t),r=function(t){return 0!==t.length&&t.length<=100}(e);if(n&&r)this.customAttributes[t]=e;else{if(!n)throw TO.create("invalid attribute name",{attributeName:t});if(!r)throw TO.create("invalid attribute value",{attributeValue:e})}},aP.prototype.getAttribute=function(t){return this.customAttributes[t]},aP.prototype.removeAttribute=function(t){void 0!==this.customAttributes[t]&&delete this.customAttributes[t]},aP.prototype.getAttributes=function(){return ma({},this.customAttributes)},aP.prototype.setStartTime=function(t){this.startTimeUs=t},aP.prototype.setDuration=function(t){this.durationUs=t},aP.prototype.calculateTraceMetrics=function(){var t=this.api.getEntriesByName(this.traceMeasure),e=t&&t[0];e&&(this.durationUs=Math.floor(1e3*e.duration),this.startTimeUs=Math.floor(1e3*(e.startTime+this.api.getTimeOrigin())))},aP.createOobTrace=function(t,e,n){var r=EO.getInstance().getUrl();if(r){var i=new aP("_wt_"+r,!0),o=Math.floor(1e3*EO.getInstance().getTimeOrigin());if(i.setStartTime(o),t&&t[0]&&(i.setDuration(Math.floor(1e3*t[0].duration)),i.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),i.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),i.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd))),e){var a=e.find(function(t){return"first-paint"===t.name});a&&a.startTime&&i.putMetric("_fp",Math.floor(1e3*a.startTime));var s=e.find(function(t){return"first-contentful-paint"===t.name});s&&s.startTime&&i.putMetric("_fcp",Math.floor(1e3*s.startTime)),n&&i.putMetric("_fid",Math.floor(1e3*n))}ZO(i)}},aP.createUserTimingTrace=function(t){ZO(new aP(t,!1,t))},aP);function aP(t,e,n){void 0===e&&(e=!1),this.name=t,this.isAuto=e,this.state=1,this.customAttributes={},this.counters={},this.api=EO.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||gO+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}function sP(t){var e=t;if(e&&void 0!==e.responseStart){var n=EO.getInstance().getTimeOrigin(),r=Math.floor(1e3*(e.startTime+n)),i=e.responseStart?Math.floor(1e3*(e.responseStart-e.startTime)):void 0,o=Math.floor(1e3*(e.responseEnd-e.startTime));!function(t){var e=AO.getInstance();e.instrumentationEnabled&&t.url!==e.logEndPointUrl.split("?")[0]&&e.loggingEnabled&&e.logNetworkAfterSampling&&setTimeout(function(){return $O(t,0)},0)}({url:e.name&&e.name.split("?")[0],responsePayloadBytes:e.transferSize,startTimeUs:r,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:o})}}var uP=5e3;function cP(){DO()&&(setTimeout(function(){return function(){var t=EO.getInstance(),e=t.getEntriesByType("navigation"),n=t.getEntriesByType("paint");if(t.onFirstInputDelay){var r=setTimeout(function(){oP.createOobTrace(e,n),r=void 0},uP);t.onFirstInputDelay(function(t){r&&(clearTimeout(r),oP.createOobTrace(e,n,t))})}else oP.createOobTrace(e,n)}()},0),setTimeout(function(){return function(){for(var t=EO.getInstance(),e=t.getEntriesByType("resource"),n=0,r=e;n<r.length;n++){sP(r[n])}t.setupObserver("resource",sP)}()},0),setTimeout(function(){return function(){for(var t=EO.getInstance(),e=t.getEntriesByType("measure"),n=0,r=e;n<r.length;n++){hP(r[n])}t.setupObserver("measure",hP)}()},0))}function hP(t){var e=t.name;e.substring(0,gO.length)!==gO&&oP.createUserTimingTrace(e)}var lP=(fP.prototype.trace=function(t){return new oP(t)},Object.defineProperty(fP.prototype,"instrumentationEnabled",{get:function(){return AO.getInstance().instrumentationEnabled},set:function(t){AO.getInstance().instrumentationEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(fP.prototype,"dataCollectionEnabled",{get:function(){return AO.getInstance().dataCollectionEnabled},set:function(t){AO.getInstance().dataCollectionEnabled=t},enumerable:!0,configurable:!0}),fP);function fP(t){this.app=t,EO.getInstance().requiredApisAvailable()?KO().then(cP,cP):MO.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.")}var pP;function dP(t,e){if("[DEFAULT]"!==t.name)throw TO.create("FB not default");if("undefined"==typeof window)throw TO.create("no window");return function(t){dO=t}(window),AO.getInstance().firebaseAppInstance=t,AO.getInstance().installationsService=e,new lP(t)}(pP=fl).INTERNAL.registerComponent(new as("performance",function(t){var e=t.getProvider("app").getImmediate(),n=t.getProvider("installations").getImmediate();return dP(e,n)},"PUBLIC")),pP.registerVersion("@firebase/performance","0.2.29");var mP,yP,gP,vP,bP,wP="measurementId",_P="firebase_id",TP="origin",EP="https://www.googletagmanager.com/gtag/js";function SP(t,n,e){var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];window[n].push(arguments)};return window[e]&&"function"==typeof window[e]&&(r=window[e]),window[e]=function(f,p){return function(t,e,n){if(t===mP.EVENT){var r=[];if(n&&n.send_to){var i=n.send_to;Array.isArray(i)||(i=[i]);for(var o=0,a=i;o<a.length;o++){var s=a[o],u=p[s];if(!u){r=[];break}r.push(u)}}if(0===r.length)for(var c=0,h=Object.values(p);c<h.length;c++){var l=h[c];r.push(l)}Promise.all(r).then(function(){return f(mP.EVENT,e,n||{})}).catch(function(t){return console.error(t)})}else if(t===mP.CONFIG){(p[e]||Promise.resolve()).then(function(){f(mP.CONFIG,e,n)}).catch(function(t){return console.error(t)})}else f(mP.SET,e)}}(r,t),{gtagCore:r,wrappedGtag:window[e]}}(yP=mP=mP||{}).EVENT="event",yP.SET="set",yP.CONFIG="config",(vP=gP=gP||{}).ADD_PAYMENT_INFO="add_payment_info",vP.ADD_TO_CART="add_to_cart",vP.ADD_TO_WISHLIST="add_to_wishlist",vP.BEGIN_CHECKOUT="begin_checkout",vP.CHECKOUT_PROGRESS="checkout_progress",vP.EXCEPTION="exception",vP.GENERATE_LEAD="generate_lead",vP.LOGIN="login",vP.PAGE_VIEW="page_view",vP.PURCHASE="purchase",vP.REFUND="refund",vP.REMOVE_FROM_CART="remove_from_cart",vP.SCREEN_VIEW="screen_view",vP.SEARCH="search",vP.SELECT_CONTENT="select_content",vP.SET_CHECKOUT_OPTION="set_checkout_option",vP.SHARE="share",vP.SIGN_UP="sign_up",vP.TIMING_COMPLETE="timing_complete",vP.VIEW_ITEM="view_item",vP.VIEW_ITEM_LIST="view_item_list",vP.VIEW_PROMOTION="view_promotion",vP.VIEW_SEARCH_RESULTS="view_search_results";var IP,CP,NP=((bP={})["no-ga-id"]='"'+wP+'" field is empty in Firebase config. Firebase Analytics requires this field to contain a valid measurement ID.',bP["already-exists"]="A Firebase Analytics instance with the measurement ID ${id}  already exists. Only one Firebase Analytics instance can be created for each measurement ID.",bP["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",bP["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate",bP),AP=new Va("analytics","Analytics",NP),kP={},DP="dataLayer",RP="gtag",OP=!1;function PP(t){if(OP)throw AP.create("already-initialized");t.dataLayerName&&(DP=t.dataLayerName),t.gtagName&&(RP=t.gtagName)}function MP(t,e){var r=t.options[wP];if(!r)throw AP.create("no-ga-id");if(null!=kP[r])throw AP.create("already-exists",{id:r});if(!OP){!function(){for(var t=window.document.getElementsByTagName("script"),e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(r.src&&r.src.includes(EP))return r}return null}()&&function(t){var e=document.createElement("script");e.src=EP+"?l="+t,e.async=!0,document.head.appendChild(e)}(DP),function(t){var e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(DP);var n=SP(kP,DP,RP),i=n.wrappedGtag,o=n.gtagCore;CP=i,IP=o,OP=!0}return kP[r]=function(r,i,o){return ya(this,void 0,void 0,function(){var e,n;return ga(this,function(t){switch(t.label){case 0:return[4,i.getId()];case 1:return e=t.sent(),o("js",new Date),o(mP.CONFIG,r.options[wP],((n={})[_P]=e,n[TP]="firebase",n.update=!0,n)),[2]}})})}(t,e,IP),{app:t,logEvent:function(t,e,n){return function(t,e,n,r,i){var o=r||{};i&&i.global||(o=ma(ma({},r),{send_to:e})),t(mP.EVENT,n,o||{})}(CP,r,t,e,n)},setCurrentScreen:function(t,e){return function(t,e,n,r){r&&r.global?t(mP.SET,{screen_name:n}):t(mP.CONFIG,e,{update:!0,screen_name:n})}(CP,r,t,e)},setUserId:function(t,e){return function(t,e,n,r){r&&r.global?t(mP.SET,{user_id:n}):t(mP.CONFIG,e,{update:!0,user_id:n})}(CP,r,t,e)},setUserProperties:function(t,e){return function(t,e,n,r){if(r&&r.global){for(var i={},o=0,a=Object.keys(n);o<a.length;o++){var s=a[o];i["user_properties."+s]=n[s]}t(mP.SET,i)}else t(mP.CONFIG,e,{update:!0,user_properties:n})}(CP,r,t,e)},setAnalyticsCollectionEnabled:function(t){return function(t,e){window["ga-disable-"+t]=!e}(r,t)}}}var xP,LP="analytics";(xP=fl).INTERNAL.registerComponent(new as(LP,function(t){return MP(t.getProvider("app").getImmediate(),t.getProvider("installations").getImmediate())},"PUBLIC").setServiceProps({settings:PP,EventName:gP})),xP.INTERNAL.registerComponent(new as("analytics-internal",function(t){try{return{logEvent:t.getProvider(LP).getImmediate().logEvent}}catch(t){throw AP.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),xP.registerVersion("@firebase/analytics","0.2.10");var FP,UP=(VP.prototype.isCachedDataFresh=function(t,e){if(!e)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-e,r=n<=t;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+t+". Is cache hit: "+r+"."),r},VP.prototype.fetch=function(a){return ya(this,void 0,void 0,function(){var e,n,r,i,o;return ga(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return e=t.sent(),n=e[0],(r=e[1])&&this.isCachedDataFresh(a.cacheMaxAgeMillis,n)?[2,r]:(a.eTag=r&&r.eTag,[4,this.client.fetch(a)]);case 2:return i=t.sent(),o=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===i.status&&o.push(this.storage.setLastSuccessfulFetchResponse(i)),[4,Promise.all(o)];case 3:return t.sent(),[2,i]}})})},VP);function VP(t,e,n,r){this.client=t,this.storage=e,this.storageCache=n,this.logger=r}var qP=((FP={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",FP["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",FP["registration-api-key"]="Undefined API key. Check Firebase app initialization.",FP["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",FP["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",FP["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",FP["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",FP["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",FP["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",FP["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',FP["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',FP["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",FP["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",FP),BP=new Va("remoteconfig","Remote Config",qP);var jP=(WP.prototype.fetch=function(w){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c,h,l,f,p,d,m,y,g,v,b;return ga(this,function(t){switch(t.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:e=t.sent(),n=e[0],r=e[1],i=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",o=i+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,a={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":w.eTag||"*"},s={sdk_version:this.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:this.appId,language_code:function(t){return void 0===t&&(t=navigator),t.languages&&t.languages[0]||t.language}()},u={method:"POST",headers:a,body:JSON.stringify(s)},c=fetch(o,u),h=new Promise(function(t,e){w.signal.addEventListener(function(){var t=new Error("The operation was aborted.");t.name="AbortError",e(t)})}),t.label=2;case 2:return t.trys.push([2,5,,6]),[4,Promise.race([c,h])];case 3:return t.sent(),[4,c];case 4:return l=t.sent(),[3,6];case 5:throw f=t.sent(),p="fetch-client-network","AbortError"===f.name&&(p="fetch-timeout"),BP.create(p,{originalErrorMessage:f.message});case 6:if(d=l.status,m=l.headers.get("ETag")||void 0,200!==l.status)return[3,11];v=void 0,t.label=7;case 7:return t.trys.push([7,9,,10]),[4,l.json()];case 8:return v=t.sent(),[3,10];case 9:throw b=t.sent(),BP.create("fetch-client-parse",{originalErrorMessage:b.message});case 10:y=v.entries,g=v.state,t.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===g?d=500:"NO_CHANGE"===g?d=304:"NO_TEMPLATE"!==g&&"EMPTY_CONFIG"!==g||(y={}),304!==d&&200!==d)throw BP.create("fetch-status",{httpStatus:d});return[2,{status:d,eTag:m,config:y}]}})})},WP);function WP(t,e,n,r,i,o){this.firebaseInstallations=t,this.sdkVersion=e,this.namespace=n,this.projectId=r,this.apiKey=i,this.appId=o}var KP=(QP.prototype.addEventListener=function(t){this.listeners.push(t)},QP.prototype.abort=function(){this.listeners.forEach(function(t){return t()})},QP);function QP(){this.listeners=[]}var HP=["1","true","t","yes","y","on"],GP=(zP.prototype.asString=function(){return this._value},zP.prototype.asBoolean=function(){return"static"!==this._source&&0<=HP.indexOf(this._value.toLowerCase())},zP.prototype.asNumber=function(){if("static"===this._source)return 0;var t=Number(this._value);return isNaN(t)&&(t=0),t},zP.prototype.getSource=function(){return this._source},zP);function zP(t,e){void 0===e&&(e=""),this._source=t,this._value=e}var YP=(XP.prototype.setLogLevel=function(t){switch(t){case"debug":this._logger.logLevel=ls.DEBUG;break;case"silent":this._logger.logLevel=ls.SILENT;break;default:this._logger.logLevel=ls.ERROR}},Object.defineProperty(XP.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!0,configurable:!0}),Object.defineProperty(XP.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!0,configurable:!0}),XP.prototype.activate=function(){return ya(this,void 0,void 0,function(){var e,n,r;return ga(this,function(t){switch(t.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return e=t.sent(),n=e[0],r=e[1],n&&n.config&&n.eTag&&n.eTag!==r?[4,Promise.all([this._storageCache.setActiveConfig(n.config),this._storage.setActiveConfigEtag(n.eTag)])]:[2,!1];case 2:return t.sent(),[2,!0]}})})},XP.prototype.ensureInitialized=function(){var t=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then(function(){t._isInitializationComplete=!0})),this._initializePromise},XP.prototype.fetch=function(){return ya(this,void 0,void 0,function(){var e,n,r,i=this;return ga(this,function(t){switch(t.label){case 0:e=new KP,setTimeout(function(){return ya(i,void 0,void 0,function(){return ga(this,function(t){return e.abort(),[2]})})},this.settings.fetchTimeoutMillis),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:e})];case 2:return t.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return t.sent(),[3,6];case 4:return n=t.sent(),r=function(t,e){return t instanceof Fa&&-1!==t.code.indexOf(e)}(n,"fetch-throttle")?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(r)];case 5:throw t.sent(),n;case 6:return[2]}})})},XP.prototype.fetchAndActivate=function(){return ya(this,void 0,void 0,function(){return ga(this,function(t){switch(t.label){case 0:return[4,this.fetch()];case 1:return t.sent(),[2,this.activate()]}})})},XP.prototype.getAll=function(){var n=this;return function(t,e){return void 0===t&&(t={}),void 0===e&&(e={}),Object.keys(ma(ma({},t),e))}(this._storageCache.getActiveConfig(),this.defaultConfig).reduce(function(t,e){return t[e]=n.getValue(e),t},{})},XP.prototype.getBoolean=function(t){return this.getValue(t).asBoolean()},XP.prototype.getNumber=function(t){return this.getValue(t).asNumber()},XP.prototype.getString=function(t){return this.getValue(t).asString()},XP.prototype.getValue=function(t){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+t+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var e=this._storageCache.getActiveConfig();return e&&void 0!==e[t]?new GP("remote",e[t]):this.defaultConfig&&void 0!==this.defaultConfig[t]?new GP("default",String(this.defaultConfig[t])):(this._logger.debug('Returning static value for key "'+t+'". Define a default or remote value if this is unintentional.'),new GP("static"))},XP);function XP(t,e,n,r,i){this.app=t,this._client=e,this._storageCache=n,this._storage=r,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}function JP(t,e){var n=t.target.error||void 0;return BP.create(e,{originalErrorMessage:n&&n.message})}var $P="app_namespace_store",ZP="firebase_remote_config",tM=1;var eM=(nM.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},nM.prototype.setLastFetchStatus=function(t){return this.set("last_fetch_status",t)},nM.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},nM.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.set("last_successful_fetch_timestamp_millis",t)},nM.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},nM.prototype.setLastSuccessfulFetchResponse=function(t){return this.set("last_successful_fetch_response",t)},nM.prototype.getActiveConfig=function(){return this.get("active_config")},nM.prototype.setActiveConfig=function(t){return this.set("active_config",t)},nM.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},nM.prototype.setActiveConfigEtag=function(t){return this.set("active_config_etag",t)},nM.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},nM.prototype.setThrottleMetadata=function(t){return this.set("throttle_metadata",t)},nM.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},nM.prototype.get=function(s){return ya(this,void 0,void 0,function(){var o,a=this;return ga(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(n,e){var t=o.transaction([$P],"readonly").objectStore($P),r=a.createCompositeKey(s);try{var i=t.get(r);i.onerror=function(t){e(JP(t,"storage-get"))},i.onsuccess=function(t){var e=t.target.result;n(e?e.value:void 0)}}catch(t){e(BP.create("storage-get",{originalErrorMessage:t&&t.message}))}})]}})})},nM.prototype.set=function(s,u){return ya(this,void 0,void 0,function(){var o,a=this;return ga(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(t,e){var n=o.transaction([$P],"readwrite").objectStore($P),r=a.createCompositeKey(s);try{var i=n.put({compositeKey:r,value:u});i.onerror=function(t){e(JP(t,"storage-set"))},i.onsuccess=function(){t()}}catch(t){e(BP.create("storage-set",{originalErrorMessage:t&&t.message}))}})]}})})},nM.prototype.delete=function(s){return ya(this,void 0,void 0,function(){var o,a=this;return ga(this,function(t){switch(t.label){case 0:return[4,this.openDbPromise];case 1:return o=t.sent(),[2,new Promise(function(t,e){var n=o.transaction([$P],"readwrite").objectStore($P),r=a.createCompositeKey(s);try{var i=n.delete(r);i.onerror=function(t){e(JP(t,"storage-delete"))},i.onsuccess=function(){t()}}catch(t){e(BP.create("storage-delete",{originalErrorMessage:t&&t.message}))}})]}})})},nM.prototype.createCompositeKey=function(t){return[this.appId,this.appName,this.namespace,t].join()},nM);function nM(t,e,n,r){void 0===r&&(r=new Promise(function(e,n){var t=indexedDB.open(ZP,tM);t.onerror=function(t){n(JP(t,"storage-open"))},t.onsuccess=function(t){e(t.target.result)},t.onupgradeneeded=function(t){var e=t.target.result;switch(t.oldVersion){case 0:e.createObjectStore($P,{keyPath:"compositeKey"})}}})),this.appId=t,this.appName=e,this.namespace=n,this.openDbPromise=r}var rM=(iM.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},iM.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},iM.prototype.getActiveConfig=function(){return this.activeConfig},iM.prototype.loadFromStorage=function(){return ya(this,void 0,void 0,function(){var e,n,r,i,o,a;return ga(this,function(t){switch(t.label){case 0:return e=this.storage.getLastFetchStatus(),n=this.storage.getLastSuccessfulFetchTimestampMillis(),r=this.storage.getActiveConfig(),[4,e];case 1:return(i=t.sent())&&(this.lastFetchStatus=i),[4,n];case 2:return(o=t.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,r];case 3:return(a=t.sent())&&(this.activeConfig=a),[2]}})})},iM.prototype.setLastFetchStatus=function(t){return this.lastFetchStatus=t,this.storage.setLastFetchStatus(t)},iM.prototype.setLastSuccessfulFetchTimestampMillis=function(t){return this.lastSuccessfulFetchTimestampMillis=t,this.storage.setLastSuccessfulFetchTimestampMillis(t)},iM.prototype.setActiveConfig=function(t){return this.activeConfig=t,this.storage.setActiveConfig(t)},iM);function iM(t){this.storage=t}var oM=(aM.prototype.fetch=function(n){return ya(this,void 0,void 0,function(){var e;return ga(this,function(t){switch(t.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return e=t.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(n,e)]}})})},aM.prototype.attemptFetch=function(i,t){var o=t.throttleEndTimeMillis,a=t.backoffCount;return ya(this,void 0,void 0,function(){var e,n,r;return ga(this,function(t){switch(t.label){case 0:return[4,function(i,o){return new Promise(function(t,e){var n=Math.max(o-Date.now(),0),r=setTimeout(t,n);i.addEventListener(function(){clearTimeout(r),e(BP.create("fetch-throttle",{throttleEndTimeMillis:o}))})})}(i.signal,o)];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,5,,7]),[4,this.client.fetch(i)];case 3:return e=t.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return t.sent(),[2,e];case 5:if(!function(t){if(!(t instanceof Fa))return!1;var e=Number(t.httpStatus);return 429===e||500===e||503===e||504===e}(n=t.sent()))throw n;return r={throttleEndTimeMillis:Date.now()+function(t){var e=1e3*Math.pow(2,t),n=Math.round(.5*e*(Math.random()-.5)*2);return Math.min(144e5,e+n)}(a),backoffCount:a+1},[4,this.storage.setThrottleMetadata(r)];case 6:return t.sent(),[2,this.attemptFetch(i,r)];case 7:return[2]}})})},aM);function aM(t,e){this.client=t,this.storage=e}var sM,uM="@firebase/remote-config";return(sM=fl).INTERNAL.registerComponent(new as("remoteConfig",function(t,e){var n=t.getProvider("app").getImmediate(),r=t.getProvider("installations").getImmediate();if("undefined"==typeof window)throw BP.create("registration-window");var i=n.options,o=i.projectId,a=i.apiKey,s=i.appId;if(!o)throw BP.create("registration-project-id");if(!a)throw BP.create("registration-api-key");if(!s)throw BP.create("registration-app-id");e=e||"firebase";var u=new eM(s,n.name,e),c=new rM(u),h=new bs(uM);h.logLevel=ls.ERROR;var l=new jP(r,sM.SDK_VERSION,e,o,a,s),f=new oM(l,u),p=new UP(f,u,c,h),d=new YP(n,p,c,u,h);return d.ensureInitialized(),d},"PUBLIC").setMultipleInstances(!0)),sM.registerVersion(uM,"0.1.10"),console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the CDN builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nhttps://www.gstatic.com/firebasejs/5.0.0/firebase-<PACKAGE>.js\n"),fl.registerVersion("firebase","7.6.2","cdn"),fl});
//# sourceMappingURL=firebase.js.map
